/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import { endBatch, startBatch } from '../internal/transaction.internal';
/**
 *  A logical transaction.
 *  Use this transaction to optimize the dispatch of all the stores.
 *  The following code will update the store, BUT  emits only once
 *
 * \@example
 *  applyTransaction(() => {
 *    this.todosStore.add(new Todo(1, title));
 *    this.todosStore.add(new Todo(2, title));
 *  });
 *
 * @template T
 * @param {?} action
 * @param {?=} thisArg
 * @return {?}
 */
export function applyTransaction(action, thisArg = undefined) {
    startBatch();
    try {
        return action.apply(thisArg);
    }
    finally {
        endBatch();
    }
}
/**
 *  A logical transaction.
 *  Use this transaction to optimize the dispatch of all the stores.
 *
 *  The following code will update the store, BUT  emits only once.
 *
 * \@example
 * \@transaction
 *  addTodos() {
 *    this.todosStore.add(new Todo(1, title));
 *    this.todosStore.add(new Todo(2, title));
 *  }
 *
 *
 * @return {?}
 */
export function transaction() {
    return function (target, propertyKey, descriptor) {
        /** @type {?} */
        const originalMethod = descriptor.value;
        descriptor.value = function (...args) {
            return applyTransaction(() => {
                return originalMethod.apply(this, args);
            }, this);
        };
        return descriptor;
    };
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJhbnNhY3Rpb24uanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZGF0b3JhbWEvYWtpdGEvIiwic291cmNlcyI6WyJzcmMvYXBpL3RyYW5zYWN0aW9uLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsUUFBUSxFQUFFLFVBQVUsRUFBRSxNQUFNLGtDQUFrQyxDQUFDOzs7Ozs7Ozs7Ozs7Ozs7OztBQWN4RSxNQUFNLDJCQUE4QixNQUFlLEVBQUUsT0FBTyxHQUFHLFNBQVM7SUFDdEUsVUFBVSxFQUFFLENBQUM7SUFDYixJQUFJO1FBQ0YsT0FBTyxNQUFNLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0tBQzlCO1lBQVM7UUFDUixRQUFRLEVBQUUsQ0FBQztLQUNaO0NBQ0Y7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBaUJELE1BQU07SUFDSixPQUFPLFVBQVMsTUFBVyxFQUFFLFdBQW1CLEVBQUUsVUFBOEI7O1FBQzlFLE1BQU0sY0FBYyxHQUFHLFVBQVUsQ0FBQyxLQUFLLENBQUM7UUFFeEMsVUFBVSxDQUFDLEtBQUssR0FBRyxVQUFTLEdBQUcsSUFBSTtZQUNqQyxPQUFPLGdCQUFnQixDQUFDLEdBQUcsRUFBRTtnQkFDM0IsT0FBTyxjQUFjLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQzthQUN6QyxFQUFFLElBQUksQ0FBQyxDQUFDO1NBQ1YsQ0FBQztRQUVGLE9BQU8sVUFBVSxDQUFDO0tBQ25CLENBQUM7Q0FDSCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGVuZEJhdGNoLCBzdGFydEJhdGNoIH0gZnJvbSAnLi4vaW50ZXJuYWwvdHJhbnNhY3Rpb24uaW50ZXJuYWwnO1xuXG4vKipcbiAqICBBIGxvZ2ljYWwgdHJhbnNhY3Rpb24uXG4gKiAgVXNlIHRoaXMgdHJhbnNhY3Rpb24gdG8gb3B0aW1pemUgdGhlIGRpc3BhdGNoIG9mIGFsbCB0aGUgc3RvcmVzLlxuICogIFRoZSBmb2xsb3dpbmcgY29kZSB3aWxsIHVwZGF0ZSB0aGUgc3RvcmUsIEJVVCAgZW1pdHMgb25seSBvbmNlXG4gKlxuICogIEBleGFtcGxlXG4gKiAgYXBwbHlUcmFuc2FjdGlvbigoKSA9PiB7XG4gKiAgICB0aGlzLnRvZG9zU3RvcmUuYWRkKG5ldyBUb2RvKDEsIHRpdGxlKSk7XG4gKiAgICB0aGlzLnRvZG9zU3RvcmUuYWRkKG5ldyBUb2RvKDIsIHRpdGxlKSk7XG4gKiAgfSk7XG4gKlxuICovXG5leHBvcnQgZnVuY3Rpb24gYXBwbHlUcmFuc2FjdGlvbjxUPihhY3Rpb246ICgpID0+IFQsIHRoaXNBcmcgPSB1bmRlZmluZWQpOiBUIHtcbiAgc3RhcnRCYXRjaCgpO1xuICB0cnkge1xuICAgIHJldHVybiBhY3Rpb24uYXBwbHkodGhpc0FyZyk7XG4gIH0gZmluYWxseSB7XG4gICAgZW5kQmF0Y2goKTtcbiAgfVxufVxuXG4vKipcbiAqICBBIGxvZ2ljYWwgdHJhbnNhY3Rpb24uXG4gKiAgVXNlIHRoaXMgdHJhbnNhY3Rpb24gdG8gb3B0aW1pemUgdGhlIGRpc3BhdGNoIG9mIGFsbCB0aGUgc3RvcmVzLlxuICpcbiAqICBUaGUgZm9sbG93aW5nIGNvZGUgd2lsbCB1cGRhdGUgdGhlIHN0b3JlLCBCVVQgIGVtaXRzIG9ubHkgb25jZS5cbiAqXG4gKiAgQGV4YW1wbGVcbiAqICBAdHJhbnNhY3Rpb25cbiAqICBhZGRUb2RvcygpIHtcbiAqICAgIHRoaXMudG9kb3NTdG9yZS5hZGQobmV3IFRvZG8oMSwgdGl0bGUpKTtcbiAqICAgIHRoaXMudG9kb3NTdG9yZS5hZGQobmV3IFRvZG8oMiwgdGl0bGUpKTtcbiAqICB9XG4gKlxuICpcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHRyYW5zYWN0aW9uKCkge1xuICByZXR1cm4gZnVuY3Rpb24odGFyZ2V0OiBhbnksIHByb3BlcnR5S2V5OiBzdHJpbmcsIGRlc2NyaXB0b3I6IFByb3BlcnR5RGVzY3JpcHRvcikge1xuICAgIGNvbnN0IG9yaWdpbmFsTWV0aG9kID0gZGVzY3JpcHRvci52YWx1ZTtcblxuICAgIGRlc2NyaXB0b3IudmFsdWUgPSBmdW5jdGlvbiguLi5hcmdzKSB7XG4gICAgICByZXR1cm4gYXBwbHlUcmFuc2FjdGlvbigoKSA9PiB7XG4gICAgICAgIHJldHVybiBvcmlnaW5hbE1ldGhvZC5hcHBseSh0aGlzLCBhcmdzKTtcbiAgICAgIH0sIHRoaXMpO1xuICAgIH07XG5cbiAgICByZXR1cm4gZGVzY3JpcHRvcjtcbiAgfTtcbn1cbiJdfQ==