/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import { __stores__, rootDispatcher } from '../api/store';
import { __globalState } from '../internal/global-state';
import { isDefined } from '../internal/utils';
/**
 * @param {?=} ngZoneOrOptions
 * @param {?=} options
 * @return {?}
 */
export function akitaDevtools(ngZoneOrOptions, options = {}) {
    if (!(/** @type {?} */ (window)).__REDUX_DEVTOOLS_EXTENSION__) {
        return;
    }
    /** @type {?} */
    const isAngular = ngZoneOrOptions && ngZoneOrOptions['run'];
    if (!isAngular) {
        ngZoneOrOptions = ngZoneOrOptions || {};
        (/** @type {?} */ (ngZoneOrOptions)).run = cb => cb();
        options = /** @type {?} */ (ngZoneOrOptions);
    }
    /** @type {?} */
    const defaultOptions = { name: 'Akita' };
    /** @type {?} */
    const merged = Object.assign({}, defaultOptions, options);
    /** @type {?} */
    const devTools = (/** @type {?} */ (window)).__REDUX_DEVTOOLS_EXTENSION__.connect(merged);
    /** @type {?} */
    let appState = {};
    rootDispatcher.subscribe(action => {
        if (action.type === 1 /* NEW_STATE */) {
            if (__globalState.skipAction) {
                __globalState.setSkipAction(false);
                return;
            }
            appState = Object.assign({}, appState, { [action.payload["name"]]: __stores__[action.payload["name"]]._value() });
            const { type, entityId } = __globalState.currentAction;
            /** @type {?} */
            const storeName = capitalize(action.payload["name"]);
            /** @type {?} */
            let msg = isDefined(entityId) ? `[${storeName}] - ${type} (ids: ${entityId})` : `[${storeName}] - ${type}`;
            if (options.logTrace) {
                console.group(msg);
                console.trace();
                console.groupEnd();
            }
            devTools.send({ type: msg, transaction: __globalState.currentT.map(t => t.type) }, appState);
        }
    });
    devTools.subscribe(message => {
        if (message.type === 'ACTION') {
            const [storeName] = message.payload.split('.');
            if (__stores__[storeName]) {
                (/** @type {?} */ (ngZoneOrOptions)).run(() => {
                    /** @type {?} */
                    const funcCall = message.payload.replace(storeName, `this['${storeName}']`);
                    try {
                        new Function(`${funcCall}`).call(__stores__);
                    }
                    catch (e) {
                        console.warn('Unknown Method ☹️');
                    }
                });
            }
        }
        if (message.type === 'DISPATCH') {
            /** @type {?} */
            const payloadType = message.payload.type;
            if (payloadType === 'COMMIT') {
                devTools.init(appState);
                return;
            }
            if (message.state) {
                /** @type {?} */
                const rootState = JSON.parse(message.state);
                for (let i = 0, keys = Object.keys(rootState); i < keys.length; i++) {
                    /** @type {?} */
                    const storeName = keys[i];
                    if (__stores__[storeName]) {
                        (/** @type {?} */ (ngZoneOrOptions)).run(() => {
                            __stores__[storeName].setState(() => rootState[storeName], false);
                        });
                    }
                }
            }
        }
    });
}
/**
 * @param {?} string
 * @return {?}
 */
function capitalize(string) {
    return string && string.charAt(0).toUpperCase() + string.slice(1);
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGV2dG9vbHMuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZGF0b3JhbWEvYWtpdGEvIiwic291cmNlcyI6WyJzcmMvZW5oYW5jZXJzL2RldnRvb2xzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFXLGNBQWMsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUNuRSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDekQsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLG1CQUFtQixDQUFDOzs7Ozs7QUFpQjlDLE1BQU0sd0JBQXdCLGVBQXVELEVBQUUsVUFBb0MsRUFBRTtJQUMzSCxJQUFJLENBQUMsbUJBQUMsTUFBYSxFQUFDLENBQUMsNEJBQTRCLEVBQUU7UUFDakQsT0FBTztLQUNSOztJQUVELE1BQU0sU0FBUyxHQUFHLGVBQWUsSUFBSSxlQUFlLENBQUMsS0FBSyxDQUFDLENBQUM7SUFFNUQsSUFBSSxDQUFDLFNBQVMsRUFBRTtRQUNkLGVBQWUsR0FBRyxlQUFlLElBQUksRUFBRSxDQUFDO1FBQ3hDLG1CQUFDLGVBQXNCLEVBQUMsQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztRQUMxQyxPQUFPLHFCQUFHLGVBQTJDLENBQUEsQ0FBQztLQUN2RDs7SUFFRCxNQUFNLGNBQWMsR0FBZ0QsRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLENBQUM7O0lBQ3RGLE1BQU0sTUFBTSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLGNBQWMsRUFBRSxPQUFPLENBQUMsQ0FBQzs7SUFFMUQsTUFBTSxRQUFRLEdBQUcsbUJBQUMsTUFBYSxFQUFDLENBQUMsNEJBQTRCLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDOztJQUM5RSxJQUFJLFFBQVEsR0FBRyxFQUFFLENBQUM7SUFFbEIsY0FBYyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsRUFBRTtRQUNo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QUMsU0FBUyxDQUFDLEVBQUU7d0JBQ3pCLG1CQUFDLGVBQTZCLEVBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFOzRCQUN2QyxVQUFVLENBQUMsU0FBUyxDQUFDLENBQUMsUUFBUSxDQUFDLEdBQUcsRUFBRSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQzt5QkFDbkUsQ0FBQyxDQUFDO3FCQUNKO2lCQUNGO2FBQ0Y7U0FDRjtLQUNGLENBQUMsQ0FBQztDQUNKOzs7OztBQUVELG9CQUFvQixNQUFNO0lBQ3hCLE9BQU8sTUFBTSxJQUFJLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsV0FBVyxFQUFFLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztDQUNuRSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IF9fc3RvcmVzX18sIEFjdGlvbnMsIHJvb3REaXNwYXRjaGVyIH0gZnJvbSAnLi4vYXBpL3N0b3JlJztcbmltcG9ydCB7IF9fZ2xvYmFsU3RhdGUgfSBmcm9tICcuLi9pbnRlcm5hbC9nbG9iYWwtc3RhdGUnO1xuaW1wb3J0IHsgaXNEZWZpbmVkIH0gZnJvbSAnLi4vaW50ZXJuYWwvdXRpbHMnO1xuXG5leHBvcnQgdHlwZSBEZXZ0b29sc09wdGlvbnMgPSB7XG4gIC8qKiAgbWF4aW11bSBhbGxvd2VkIGFjdGlvbnMgdG8gYmUgc3RvcmVkIGluIHRoZSBoaXN0b3J5IHRyZWUgKi9cbiAgbWF4QWdlOiBudW1iZXI7XG4gIGxhdGVuY3k6IG51bWJlcjtcbiAgYWN0aW9uc0JsYWNrbGlzdDogc3RyaW5nW107XG4gIGFjdGlvbnNXaGl0ZWxpc3Q6IHN0cmluZ1tdO1xuICBzaG91bGRDYXRjaEVycm9yczogYm9vbGVhbjtcbiAgbG9nVHJhY2U6IGJvb2xlYW47XG4gIHByZWRpY2F0ZTogKHN0YXRlOiBhbnksIGFjdGlvbjogYW55KSA9PiBib29sZWFuO1xufTtcblxuZXhwb3J0IHR5cGUgTmdab25lTGlrZSA9IHsgcnVuOiBhbnkgfTtcblxuZXhwb3J0IGZ1bmN0aW9uIGFraXRhRGV2dG9vbHMobmdab25lOiBOZ1pvbmVMaWtlLCBvcHRpb25zPzogUGFydGlhbDxEZXZ0b29sc09wdGlvbnM+KTtcbmV4cG9ydCBmdW5jdGlvbiBha2l0YURldnRvb2xzKG9wdGlvbnM/OiBQYXJ0aWFsPERldnRvb2xzT3B0aW9ucz4pO1xuZXhwb3J0IGZ1bmN0aW9uIGFraXRhRGV2dG9vbHMobmdab25lT3JPcHRpb25zPzogTmdab25lTGlrZSB8IFBhcnRpYWw8RGV2dG9vbHNPcHRpb25zPiwgb3B0aW9uczogUGFydGlhbDxEZXZ0b29sc09wdGlvbnM+ID0ge30pIHtcbiAgaWYgKCEod2luZG93IGFzIGFueSkuX19SRURVWF9ERVZUT09MU19FWFRFTlNJT05fXykge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IGlzQW5ndWxhciA9IG5nWm9uZU9yT3B0aW9ucyAmJiBuZ1pvbmVPck9wdGlvbnNbJ3J1biddO1xuXG4gIGlmICghaXNBbmd1bGFyKSB7XG4gICAgbmdab25lT3JPcHRpb25zID0gbmdab25lT3JPcHRpb25zIHx8IHt9O1xuICAgIChuZ1pvbmVPck9wdGlvbnMgYXMgYW55KS5ydW4gPSBjYiA9PiBjYigpO1xuICAgIG9wdGlvbnMgPSBuZ1pvbmVPck9wdGlvbnMgYXMgUGFydGlhbDxEZXZ0b29sc09wdGlvbnM+O1xuICB9XG5cbiAgY29uc3QgZGVmYXVsdE9wdGlvbnM6IFBhcnRpYWw8RGV2dG9vbHNPcHRpb25zPiAmIHsgbmFtZTogc3RyaW5nIH0gPSB7IG5hbWU6ICdBa2l0YScgfTtcbiAgY29uc3QgbWVyZ2VkID0gT2JqZWN0LmFzc2lnbih7fSwgZGVmYXVsdE9wdGlvbnMsIG9wdGlvbnMpO1xuXG4gIGNvbnN0IGRldlRvb2xzID0gKHdpbmRvdyBhcyBhbnkpLl9fUkVEVVhfREVWVE9PTFNfRVhURU5TSU9OX18uY29ubmVjdChtZXJnZWQpO1xuICBsZXQgYXBwU3RhdGUgPSB7fTtcblxuICByb290RGlzcGF0Y2hlci5zdWJzY3JpYmUoYWN0aW9uID0+IHtcbiAgICBpZiAoYWN0aW9uLnR5cGUgPT09IEFjdGlvbnMuTkVXX1NUQVRFKSB7XG4gICAgICBpZiAoX19nbG9iYWxTdGF0ZS5za2lwQWN0aW9uKSB7XG4gICAgICAgIF9fZ2xvYmFsU3RhdGUuc2V0U2tpcEFjdGlvbihmYWxzZSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgYXBwU3RhdGUgPSB7XG4gICAgICAgIC4uLmFwcFN0YXRlLFxuICAgICAgICBbYWN0aW9uLnBheWxvYWQubmFtZV06IF9fc3RvcmVzX19bYWN0aW9uLnBheWxvYWQubmFtZV0uX3ZhbHVlKClcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHsgdHlwZSwgZW50aXR5SWQgfSA9IF9fZ2xvYmFsU3RhdGUuY3VycmVudEFjdGlvbjtcbiAgICAgIGNvbnN0IHN0b3JlTmFtZSA9IGNhcGl0YWxpemUoYWN0aW9uLnBheWxvYWQubmFtZSk7XG4gICAgICBsZXQgbXNnID0gaXNEZWZpbmVkKGVudGl0eUlkKSA/IGBbJHtzdG9yZU5hbWV9XSAtICR7dHlwZX0gKGlkczogJHtlbnRpdHlJZH0pYCA6IGBbJHtzdG9yZU5hbWV9XSAtICR7dHlwZX1gO1xuXG4gICAgICBpZiAob3B0aW9ucy5sb2dUcmFjZSkge1xuICAgICAgICBjb25zb2xlLmdyb3VwKG1zZyk7XG4gICAgICAgIGNvbnNvbGUudHJhY2UoKTtcbiAgICAgICAgY29uc29sZS5ncm91cEVuZCgpO1xuICAgICAgfVxuXG4gICAgICBkZXZUb29scy5zZW5kKHsgdHlwZTogbXNnLCB0cmFuc2FjdGlvbjogX19nbG9iYWxTdGF0ZS5jdXJyZW50VC5tYXAodCA9PiB0LnR5cGUpIH0sIGFwcFN0YXRlKTtcbiAgICB9XG4gIH0pO1xuXG4gIGRldlRvb2xzLnN1YnNjcmliZShtZXNzYWdlID0+IHtcbiAgICBpZiAobWVzc2FnZS50eXBlID09PSAnQUNUSU9OJykge1xuICAgICAgY29uc3QgW3N0b3JlTmFtZV0gPSBtZXNzYWdlLnBheWxvYWQuc3BsaXQoJy4nKTtcblxuICAgICAgaWYgKF9fc3RvcmVzX19bc3RvcmVOYW1lXSkge1xuICAgICAgICAobmdab25lT3JPcHRpb25zIGFzIE5nWm9uZUxpa2UpLnJ1bigoKSA9PiB7XG4gICAgICAgICAgY29uc3QgZnVuY0NhbGwgPSBtZXNzYWdlLnBheWxvYWQucmVwbGFjZShzdG9yZU5hbWUsIGB0aGlzWycke3N0b3JlTmFtZX0nXWApO1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBuZXcgRnVuY3Rpb24oYCR7ZnVuY0NhbGx9YCkuY2FsbChfX3N0b3Jlc19fKTtcbiAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ1Vua25vd24gTWV0aG9kIOKYue+4jycpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKG1lc3NhZ2UudHlwZSA9PT0gJ0RJU1BBVENIJykge1xuICAgICAgY29uc3QgcGF5bG9hZFR5cGUgPSBtZXNzYWdlLnBheWxvYWQudHlwZTtcblxuICAgICAgaWYgKHBheWxvYWRUeXBlID09PSAnQ09NTUlUJykge1xuICAgICAgICBkZXZUb29scy5pbml0KGFwcFN0YXRlKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAobWVzc2FnZS5zdGF0ZSkge1xuICAgICAgICBjb25zdCByb290U3RhdGUgPSBKU09OLnBhcnNlKG1lc3NhZ2Uuc3RhdGUpO1xuICAgICAgICBmb3IgKGxldCBpID0gMCwga2V5cyA9IE9iamVjdC5rZXlzKHJvb3RTdGF0ZSk7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgY29uc3Qgc3RvcmVOYW1lID0ga2V5c1tpXTtcbiAgICAgICAgICBpZiAoX19zdG9yZXNfX1tzdG9yZU5hbWVdKSB7XG4gICAgICAgICAgICAobmdab25lT3JPcHRpb25zIGFzIE5nWm9uZUxpa2UpLnJ1bigoKSA9PiB7XG4gICAgICAgICAgICAgIF9fc3RvcmVzX19bc3RvcmVOYW1lXS5zZXRTdGF0ZSgoKSA9PiByb290U3RhdGVbc3RvcmVOYW1lXSwgZmFsc2UpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn1cblxuZnVuY3Rpb24gY2FwaXRhbGl6ZShzdHJpbmcpIHtcbiAgcmV0dXJuIHN0cmluZyAmJiBzdHJpbmcuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBzdHJpbmcuc2xpY2UoMSk7XG59XG4iXX0=