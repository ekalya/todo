import { __assign, __extends, __spread, __decorate, __metadata, __read, __values, __rest } from 'tslib';
import { Observable, Subject, of, BehaviorSubject, ReplaySubject, combineLatest, from, merge } from 'rxjs';
import { distinctUntilChanged, map, take, auditTime, switchMap, withLatestFrom, filter, delay, debounceTime, skip, pairwise } from 'rxjs/operators';

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/**
 * Wraps the provided value in an array, unless the provided _value is an array.
 * @template T
 * @param {?} value
 * @return {?}
 */
function coerceArray(value) {
    return Array.isArray(value) ? value : [value];
}
/**
 * Check if a value is an object
 * @param {?} value
 * @return {?}
 */
function isObject(value) {
    return Object.prototype.toString.call(value) === '[object Object]';
}
/**
 * @param {?} value
 * @return {?}
 */
function isPlainObject(value) {
    return toBoolean(value) && value.constructor.name === 'Object';
}
/**
 * @param {?} value
 * @return {?}
 */
function isFunction(value) {
    return typeof value === 'function';
}
/**
 * @param {?} value
 * @return {?}
 */
function toBoolean(value) {
    return value != null && "" + value !== 'false';
}
/**
 * @param {?} value
 * @return {?}
 */
function isUndefined(value) {
    return typeof value === 'undefined';
}
/**
 * Check if entity exists
 * @template E
 * @param {?} id
 * @param {?} entities
 * @return {?}
 */
function entityExists(id, entities) {
    return entities.hasOwnProperty(id);
}
/**
 * Observable that emits empty value and complete
 * @template T
 * @return {?}
 */
function noop() {
    return new Observable(function (observer) {
        observer.next();
        observer.complete();
    });
}
/**
 * @param {?} value
 * @return {?}
 */
function isObservable(value) {
    return toBoolean(value) && isFunction(value.subscribe);
}
/**
 * @param {?} val
 * @return {?}
 */
function isString(val) {
    return typeof val === 'string';
}
/**
 * @param {?} value
 * @return {?}
 */
function isNumber(value) {
    return typeof value === 'number';
}
/**
 * @param {?} val
 * @return {?}
 */
function isDefined(val) {
    return val !== null && typeof val !== 'undefined';
}
/**
 * Check if the active entity exist
 * @template E
 * @param {?} state
 * @return {?}
 */
function resetActive(state) {
    return isActiveState(state) && entityExists((/** @type {?} */ (state)).active, state.entities) === false;
}
/**
 * Check if the store supports active entity
 * @template E
 * @param {?} state
 * @return {?}
 */
function isActiveState(state) {
    return (/** @type {?} */ (state)).hasOwnProperty('active');
}
/** *
 * setValue(state, 'todos.ui', { filter: {}})
  @type {?} */
var setValue = function (obj, prop, val) {
    /** @type {?} */
    var split = prop.split('.');
    if (split.length === 1)
        return val;
    obj = __assign({}, obj);
    /** @type {?} */
    var lastIndex = split.length - 2;
    /** @type {?} */
    var removeStoreName = prop.split('.').slice(1);
    removeStoreName.reduce(function (acc, part, index) {
        if (index === lastIndex) {
            acc[part] = val;
        }
        else {
            acc[part] = __assign({}, acc[part]);
        }
        return acc && acc[part];
    }, obj);
    return obj;
};
/** *
 * getValue(state, 'todos.ui')
  @type {?} */
var getValue = function (obj, prop) {
    /** return the whole state  */
    if (prop.split('.').length === 1) {
        return obj;
    }
    /** @type {?} */
    var removeStoreName = prop
        .split('.')
        .slice(1)
        .join('.');
    return removeStoreName.split('.').reduce(function (acc, part) { return acc && acc[part]; }, obj);
};

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
var AkitaError = /** @class */ (function (_super) {
    __extends(AkitaError, _super);
    function AkitaError(message) {
        return _super.call(this, message) || this;
    }
    return AkitaError;
}(Error));
var AkitaImmutabilityError = /** @class */ (function (_super) {
    __extends(AkitaImmutabilityError, _super);
    function AkitaImmutabilityError(storeName) {
        return _super.call(this, "The new state should be immutable. Make sure to return a new immutable state. \n store: \n " + storeName) || this;
    }
    return AkitaImmutabilityError;
}(AkitaError));
var AkitaEntityNotExistsError = /** @class */ (function (_super) {
    __extends(AkitaEntityNotExistsError, _super);
    function AkitaEntityNotExistsError(id) {
        return _super.call(this, "Entity " + id + " does not exists") || this;
    }
    return AkitaEntityNotExistsError;
}(AkitaError));
var AkitaNoActiveError = /** @class */ (function (_super) {
    __extends(AkitaNoActiveError, _super);
    function AkitaNoActiveError() {
        return _super.call(this, "Active is null/undefined") || this;
    }
    return AkitaNoActiveError;
}(AkitaError));
var AkitaInvalidEntityState = /** @class */ (function (_super) {
    __extends(AkitaInvalidEntityState, _super);
    function AkitaInvalidEntityState() {
        return _super.call(this, "Entity state is invalid") || this;
    }
    return AkitaInvalidEntityState;
}(AkitaError));
var AkitaUpdateIdKeyError = /** @class */ (function (_super) {
    __extends(AkitaUpdateIdKeyError, _super);
    function AkitaUpdateIdKeyError() {
        return _super.call(this, "Updating entity id is not permitted when updating many entities") || this;
    }
    return AkitaUpdateIdKeyError;
}(AkitaError));
/**
 * @param {?} id
 * @param {?} entities
 * @return {?}
 */
function assertEntityExists(id, entities) {
    if (!entityExists(id, entities)) {
        throw new AkitaEntityNotExistsError(id);
    }
}
/**
 * @param {?} store
 * @return {?}
 */
function assertActive(store) {
    if (!toBoolean(store.active)) {
        throw new AkitaNoActiveError();
    }
}
/**
 * @param {?} state
 * @return {?}
 */
function assertEntityState(state) {
    /** @type {?} */
    var assertEntities = isObject(state);
    if (!assertEntities) {
        throw new AkitaInvalidEntityState();
    }
}
/**
 * @param {?} name
 * @param {?} className
 * @return {?}
 */
function assertDecorator(name, className) {
    if (!name) {
        console.error("@StoreConfig({ name }) is missing in " + className);
    }
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
var CRUD = /** @class */ (function () {
    function CRUD() {
    }
    /**
     * @template S, E
     * @param {?} state
     * @param {?} entities
     * @param {?} entityClass
     * @param {?} idKey
     * @return {?}
     */
    CRUD.prototype._set = /**
     * @template S, E
     * @param {?} state
     * @param {?} entities
     * @param {?} entityClass
     * @param {?} idKey
     * @return {?}
     */
    function (state, entities, entityClass, idKey) {
        /** @type {?} */
        var ids;
        /** @type {?} */
        var normalized;
        if ((/** @type {?} */ (entities)).ids && (/** @type {?} */ (entities)).entities) {
            ids = (/** @type {?} */ (entities)).ids;
            normalized = (/** @type {?} */ (entities)).entities;
        }
        else {
            /** @type {?} */
            var isArray = Array.isArray(entities);
            normalized = entities;
            if (isArray) {
                normalized = /** @type {?} */ (this.keyBy(/** @type {?} */ (entities), entityClass, idKey));
            }
            else {
                assertEntityState(entities);
            }
            ids = isArray ? (/** @type {?} */ (entities)).map(function (entity) { return entity[idKey]; }) : Object.keys(/** @type {?} */ (normalized)).map(function (id) { return entities[id][idKey]; });
        }
        /** @type {?} */
        var newState = __assign({}, (/** @type {?} */ (state)), { entities: normalized, ids: ids, loading: false });
        if (resetActive(newState)) {
            newState.active = null;
        }
        return newState;
    };
    /**
     * @template T
     * @param {?} state
     * @param {?} id
     * @param {?} entity
     * @return {?}
     */
    CRUD.prototype._replaceEntity = /**
     * @template T
     * @param {?} state
     * @param {?} id
     * @param {?} entity
     * @return {?}
     */
    function (state, id, entity) {
        var _a;
        return __assign({}, (/** @type {?} */ (state)), { entities: __assign({}, state.entities, (_a = {}, _a[id] = entity, _a)) });
    };
    /**
     * @template S, E
     * @param {?} state
     * @param {?} entities
     * @param {?} idKey
     * @return {?}
     */
    CRUD.prototype._add = /**
     * @template S, E
     * @param {?} state
     * @param {?} entities
     * @param {?} idKey
     * @return {?}
     */
    function (state, entities, idKey) {
        /** @type {?} */
        var addedEntities = {};
        /** @type {?} */
        var addedIds = [];
        for (var i = 0; i < entities.length; i++) {
            /** @type {?} */
            var entity = entities[i];
            /** @type {?} */
            var entityId = entity[idKey];
            if (!entityExists(entityId, state.entities)) {
                addedEntities[entityId] = entity;
                addedIds.push(entityId);
            }
        }
        return __assign({}, (/** @type {?} */ (state)), { entities: __assign({}, state.entities, addedEntities), ids: __spread(state.ids, addedIds) });
    };
    /**
     * @template T
     * @param {?} state
     * @param {?} ids
     * @param {?} newStateOrFn
     * @param {?} idKey
     * @return {?}
     */
    CRUD.prototype._update = /**
     * @template T
     * @param {?} state
     * @param {?} ids
     * @param {?} newStateOrFn
     * @param {?} idKey
     * @return {?}
     */
    function (state, ids, newStateOrFn, idKey) {
        /** @type {?} */
        var updatedEntities = {};
        /** @type {?} */
        var isUpdatingIdKey = false;
        /** @type {?} */
        var idToUpdate;
        for (var i = 0; i < ids.length; i++) {
            /** @type {?} */
            var id = ids[i];
            idToUpdate = id;
            assertEntityExists(id, state.entities);
            /** @type {?} */
            var oldEntity = state.entities[id];
            /** @type {?} */
            var newState = isFunction(newStateOrFn) ? newStateOrFn(oldEntity) : newStateOrFn;
            if (newState.hasOwnProperty(idKey) && newState[idKey] !== oldEntity[idKey]) {
                if (ids.length > 1) {
                    throw new AkitaUpdateIdKeyError();
                }
                isUpdatingIdKey = true;
                idToUpdate = newState[idKey];
            }
            /** @type {?} */
            var newEntity = void 0;
            /** @type {?} */
            var merged = __assign({}, oldEntity, newState);
            if (isPlainObject(oldEntity)) {
                newEntity = merged;
            }
            else {
                newEntity = new oldEntity.constructor(merged);
            }
            updatedEntities[idToUpdate] = newEntity;
        }
        /** @type {?} */
        var updatedIds = state.ids;
        /** @type {?} */
        var stateEntities = state.entities;
        if (isUpdatingIdKey) {
            var _a = __read(ids, 1), id_1 = _a[0];
            var _b = state.entities, _c = id_1, deletedEntity = _b[_c], rest = __rest(_b, [typeof _c === "symbol" ? _c : _c + ""]);
            stateEntities = rest;
            updatedIds = state.ids.map(function (current) { return (current === id_1 ? idToUpdate : current); });
        }
        return __assign({}, (/** @type {?} */ (state)), { entities: __assign({}, stateEntities, updatedEntities), ids: updatedIds });
    };
    /**
     * @template T
     * @param {?} state
     * @param {?} ids
     * @return {?}
     */
    CRUD.prototype._remove = /**
     * @template T
     * @param {?} state
     * @param {?} ids
     * @return {?}
     */
    function (state, ids) {
        if (!ids)
            return this._removeAll(state);
        /** @type {?} */
        var removed = ids.reduce(function (acc, id) {
            var _a = id, entity = acc[_a], rest = __rest(acc, [typeof _a === "symbol" ? _a : _a + ""]);
            return rest;
        }, state.entities);
        /** @type {?} */
        var newState = __assign({}, (/** @type {?} */ (state)), { entities: removed, ids: state.ids.filter(function (current) { return ids.indexOf(current) === -1; }) });
        if (resetActive(newState)) {
            newState.active = null;
        }
        return newState;
    };
    /**
     * @template T
     * @param {?} state
     * @return {?}
     */
    CRUD.prototype._removeAll = /**
     * @template T
     * @param {?} state
     * @return {?}
     */
    function (state) {
        /** @type {?} */
        var newState = __assign({}, (/** @type {?} */ (state)), { entities: {}, ids: [], active: null });
        return newState;
    };
    /**
     * @param {?} entities
     * @param {?=} entityClass
     * @param {?=} id
     * @return {?}
     */
    CRUD.prototype.keyBy = /**
     * @param {?} entities
     * @param {?=} entityClass
     * @param {?=} id
     * @return {?}
     */
    function (entities, entityClass, id) {
        if (id === void 0) { id = 'id'; }
        /** @type {?} */
        var acc = {};
        for (var i = 0, len = entities.length; i < len; i++) {
            /** @type {?} */
            var entity = entities[i];
            acc[entity[id]] = entityClass ? new entityClass(entity) : entity;
        }
        return acc;
    };
    return CRUD;
}());
/** @type {?} */
var _crud = new CRUD();

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
var AkitaGlobals = /** @class */ (function () {
    function AkitaGlobals() {
        this.skipAction = false;
        this.skipTransactionMsg = false;
        this.currentT = [];
        this.activeTransactions = 0;
    }
    /**
     * @param {?} _action
     * @return {?}
     */
    AkitaGlobals.prototype.setAction = /**
     * @param {?} _action
     * @return {?}
     */
    function (_action) {
        if (this.customAction) {
            this.currentAction = this.customAction;
            this.customAction = null;
            this.skipTransactionMsg = false;
        }
        else {
            if (this.activeTransactions === 0) {
                this.currentAction = _action;
            }
        }
        if (this.activeTransactions > 0) {
            this.currentT.push(_action);
        }
    };
    /**
     * @param {?} action
     * @param {?=} skipTransactionMsg
     * @return {?}
     */
    AkitaGlobals.prototype.setCustomAction = /**
     * @param {?} action
     * @param {?=} skipTransactionMsg
     * @return {?}
     */
    function (action, skipTransactionMsg) {
        if (skipTransactionMsg === void 0) { skipTransactionMsg = false; }
        this.currentAction = this.customAction = action;
        this.skipTransactionMsg = skipTransactionMsg;
    };
    /**
     * @param {?=} skip
     * @return {?}
     */
    AkitaGlobals.prototype.setSkipAction = /**
     * @param {?=} skip
     * @return {?}
     */
    function (skip$$1) {
        if (skip$$1 === void 0) { skip$$1 = true; }
        this.skipAction = skip$$1;
    };
    return AkitaGlobals;
}());
/** @type {?} */
var __globalState = new AkitaGlobals();

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/**
 * Start a new transaction batch
 * @return {?}
 */
function startBatch() {
    if (!isTransactionInProcess()) {
        __globalState.batchTransaction = new Subject();
    }
    __globalState.activeTransactions++;
}
/**
 * End the transaction
 * @return {?}
 */
function endBatch() {
    if (--__globalState.activeTransactions === 0) {
        __globalState.batchTransaction.next(true);
        __globalState.batchTransaction.complete();
    }
}
/**
 * Whether we're inside batch
 * @return {?}
 */
function isTransactionInProcess() {
    return __globalState.activeTransactions > 0;
}
/**
 *
 * @return {?}
 */
function commit() {
    return __globalState.batchTransaction ? __globalState.batchTransaction.asObservable() : of(true);
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/**
 * @param {?} o
 * @return {?}
 */
function deepFreeze(o) {
    Object.freeze(o);
    Object.getOwnPropertyNames(o).forEach(function (prop) {
        if (o.hasOwnProperty(prop) && o[prop] !== null && (typeof o[prop] === 'object' || typeof o[prop] === 'function') && !Object.isFrozen(o[prop])) {
            deepFreeze(o[prop]);
        }
    });
    return o;
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/** @type {?} */
var configKey = 'akitaConfig';
/**
 * @param {?} metadata
 * @return {?}
 */
function StoreConfig(metadata) {
    return function (constructor) {
        constructor[configKey] = { idKey: 'id' };
        for (var i = 0, keys = Object.keys(metadata); i < keys.length; i++) {
            /** @type {?} */
            var key = keys[i];
            /* name is preserved read only key */
            if (key === 'name') {
                constructor[configKey]['storeName'] = metadata[key];
            }
            else {
                constructor[configKey][key] = metadata[key];
            }
        }
    };
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/** *
 * Whether we are in dev mode
  @type {?} */
var __DEV__ = true;
/** @type {?} */
var __stores__ = {};
/** @type {?} */
var rootDispatcher = new ReplaySubject();
/**
 * @param {?} storeName
 * @param {?=} initialState
 * @return {?}
 */
function nextState(storeName, initialState) {
    if (initialState === void 0) { initialState = false; }
    return {
        type: 1 /* NEW_STATE */,
        payload: {
            name: storeName,
            initialState: initialState
        }
    };
}
/**
 * Enable production mode to disable objectFreeze
 * @return {?}
 */
function enableAkitaProdMode() {
    __DEV__ = false;
}
/**
 * @return {?}
 */
function isDev() {
    return __DEV__;
}
/**
 * The Root Store that every sub store needs to inherit and
 * invoke `super` with the initial state.
 * @template S
 */
var  /**
 * The Root Store that every sub store needs to inherit and
 * invoke `super` with the initial state.
 * @template S
 */
Store = /** @class */ (function () {
    /**
     *
     * Initial the store with the state
     */
    function Store(initialState) {
        /**
         * Whether we are inside transaction *
         */
        this.inTransaction = false;
        this._isPristine = true;
        __globalState.setAction({ type: '@@INIT' });
        __stores__[this.storeName] = this;
        this.setState(function () { return initialState; });
        rootDispatcher.next({
            type: 0 /* NEW_STORE */,
            payload: { store: this }
        });
        isDev() && assertDecorator(this.storeName, this.constructor.name);
    }
    /**
     * @param {?=} loading
     * @return {?}
     */
    Store.prototype.setLoading = /**
     * @param {?=} loading
     * @return {?}
     */
    function (loading) {
        if (loading === void 0) { loading = false; }
        if (loading !== (/** @type {?} */ (this._value())).loading) {
            isDev() && __globalState.setAction({ type: 'Set Loading' });
            this.setState(function (s) { return (/** @type {?} */ (__assign({}, (/** @type {?} */ (s)), { loading: loading }))); });
        }
    };
    /**
     * Update the store's error state.
     */
    /**
     * Update the store's error state.
     * @template T
     * @param {?} error
     * @return {?}
     */
    Store.prototype.setError = /**
     * Update the store's error state.
     * @template T
     * @param {?} error
     * @return {?}
     */
    function (error) {
        if (error !== (/** @type {?} */ (this._value())).error) {
            isDev() && __globalState.setAction({ type: 'Set Error' });
            this.setState(function (s) { return (/** @type {?} */ (__assign({}, (/** @type {?} */ (s)), { error: error }))); });
        }
    };
    /**
     * Select a slice from the store
     *
     * @example
     * this.store.select(state => state.entities)
     *
     */
    /**
     * Select a slice from the store
     *
     * \@example
     * this.store.select(state => state.entities)
     *
     * @template R
     * @param {?} project
     * @return {?}
     */
    Store.prototype._select = /**
     * Select a slice from the store
     *
     * \@example
     * this.store.select(state => state.entities)
     *
     * @template R
     * @param {?} project
     * @return {?}
     */
    function (project) {
        return this.store$.pipe(map(project), distinctUntilChanged());
    };
    /**
     * @return {?}
     */
    Store.prototype._value = /**
     * @return {?}
     */
    function () {
        return this.storeValue;
    };
    Object.defineProperty(Store.prototype, "config", {
        get: /**
         * @return {?}
         */
        function () {
            return this.constructor[configKey];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Store.prototype, "storeName", {
        /**
         * Get the store name
         */
        get: /**
         * Get the store name
         * @return {?}
         */
        function () {
            return this.config && this.config['storeName'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Store.prototype, "isPristine", {
        get: /**
         * @return {?}
         */
        function () {
            return this._isPristine;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * `setState()` is the only way to update a store; It receives a callback function,
     * which gets the current state, and returns a new immutable state,
     * which will be the new value of the store.
     */
    /**
     * `setState()` is the only way to update a store; It receives a callback function,
     * which gets the current state, and returns a new immutable state,
     * which will be the new value of the store.
     * @param {?} newStateFn
     * @param {?=} _rootDispatcher
     * @return {?}
     */
    Store.prototype.setState = /**
     * `setState()` is the only way to update a store; It receives a callback function,
     * which gets the current state, and returns a new immutable state,
     * which will be the new value of the store.
     * @param {?} newStateFn
     * @param {?=} _rootDispatcher
     * @return {?}
     */
    function (newStateFn, _rootDispatcher) {
        if (_rootDispatcher === void 0) { _rootDispatcher = true; }
        /** @type {?} */
        var prevState = this._value();
        this.storeValue = __DEV__ ? deepFreeze(newStateFn(this._value())) : newStateFn(this._value());
        if (prevState === this.storeValue) {
            throw new AkitaImmutabilityError(this.storeName);
        }
        if (!this.store) {
            this.store = new BehaviorSubject(this.storeValue);
            rootDispatcher.next(nextState(this.storeName, true));
            return;
        }
        if (isTransactionInProcess()) {
            this.handleTransaction();
            return;
        }
        this.dispatch(this.storeValue, _rootDispatcher);
    };
    /**
     * @param {?} newStateOrId
     * @param {?=} newState
     * @return {?}
     */
    Store.prototype.update = /**
     * @param {?} newStateOrId
     * @param {?=} newState
     * @return {?}
     */
    function (newStateOrId, newState) {
        __globalState.setAction({ type: 'Update Store' });
        this.setState(function (state) {
            /** @type {?} */
            var value = isFunction(newStateOrId) ? newStateOrId(state) : newStateOrId;
            /** @type {?} */
            var merged = Object.assign({}, state, value);
            return isPlainObject(state) ? merged : new (/** @type {?} */ (state)).constructor(merged);
        });
        this.setDirty();
    };
    /**
     * Sets the store to a pristine state.
     */
    /**
     * Sets the store to a pristine state.
     * @return {?}
     */
    Store.prototype.setPristine = /**
     * Sets the store to a pristine state.
     * @return {?}
     */
    function () {
        this._isPristine = true;
    };
    /**
     * Sets the store to a dirty state, indicating that it is not pristine.
     */
    /**
     * Sets the store to a dirty state, indicating that it is not pristine.
     * @return {?}
     */
    Store.prototype.setDirty = /**
     * Sets the store to a dirty state, indicating that it is not pristine.
     * @return {?}
     */
    function () {
        this._isPristine = false;
    };
    /**
     * @param {?} state
     * @param {?=} _rootDispatcher
     * @return {?}
     */
    Store.prototype.dispatch = /**
     * @param {?} state
     * @param {?=} _rootDispatcher
     * @return {?}
     */
    function (state, _rootDispatcher) {
        if (_rootDispatcher === void 0) { _rootDispatcher = true; }
        this.store.next(state);
        if (_rootDispatcher) {
            rootDispatcher.next(nextState(this.storeName));
            isDev() && __globalState.setAction({ type: 'Set State' });
        }
    };
    Object.defineProperty(Store.prototype, "store$", {
        get: /**
         * @return {?}
         */
        function () {
            return this.store.asObservable();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * When the transaction ends dispatch the final value once
     * @return {?}
     */
    Store.prototype.watchTransaction = /**
     * When the transaction ends dispatch the final value once
     * @return {?}
     */
    function () {
        var _this = this;
        commit().subscribe(function () {
            _this.inTransaction = false;
            if (isDev() && !__globalState.skipTransactionMsg) {
                __globalState.setAction({ type: '@Transaction' });
            }
            _this.dispatch(_this._value());
            __globalState.currentT = [];
            __globalState.skipTransactionMsg = false;
        });
    };
    /**
     * Listen to the transaction stream
     * @return {?}
     */
    Store.prototype.handleTransaction = /**
     * Listen to the transaction stream
     * @return {?}
     */
    function () {
        if (!this.inTransaction) {
            this.watchTransaction();
            this.inTransaction = true;
        }
    };
    /**
     * @return {?}
     */
    Store.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        if (this === __stores__[this.storeName]) {
            delete __stores__[this.storeName];
        }
    };
    return Store;
}());

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
// unsupported: template constraints.
/**
 * The Root Store that every sub store needs to inherit and
 * invoke `super` with the initial state.
 * @template S, E
 */
var  
// unsupported: template constraints.
/**
 * The Root Store that every sub store needs to inherit and
 * invoke `super` with the initial state.
 * @template S, E
 */
EntityStore = /** @class */ (function (_super) {
    __extends(EntityStore, _super);
    /**
     *
     * Initiate the store with the state
     */
    function EntityStore(initialState, options) {
        if (initialState === void 0) { initialState = {}; }
        if (options === void 0) { options = {}; }
        var _this = _super.call(this, __assign({}, getInitialEntitiesState(), initialState)) || this;
        _this.options = options;
        return _this;
    }
    Object.defineProperty(EntityStore.prototype, "entities", {
        get: /**
         * @return {?}
         */
        function () {
            return this._value().entities;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(EntityStore.prototype, "idKey", {
        get: /**
         * @return {?}
         */
        function () {
            /** *
             * backward compatibility
              @type {?} */
            var newIdKey = this.config && this.config.idKey;
            if (!newIdKey) {
                return this.options.idKey || 'id';
            }
            return newIdKey;
        },
        enumerable: true,
        configurable: true
    });
    /**
     *
     * Replace current collection with provided collection
     *
     * @example
     * this.store.set([Entity, Entity]);
     * this.store.set({1: Entity, 2: Entity});
     * this.store.set([{id: 1}, {id: 2}], { entityClass: Product });
     *
     */
    /**
     *
     * Replace current collection with provided collection
     *
     * \@example
     * this.store.set([Entity, Entity]);
     * this.store.set({1: Entity, 2: Entity});
     * this.store.set([{id: 1}, {id: 2}], { entityClass: Product });
     *
     * @param {?} entities
     * @param {?=} options
     * @return {?}
     */
    EntityStore.prototype.set = /**
     *
     * Replace current collection with provided collection
     *
     * \@example
     * this.store.set([Entity, Entity]);
     * this.store.set({1: Entity, 2: Entity});
     * this.store.set([{id: 1}, {id: 2}], { entityClass: Product });
     *
     * @param {?} entities
     * @param {?=} options
     * @return {?}
     */
    function (entities, options) {
        var _this = this;
        if (options === void 0) { options = {}; }
        isDev() && __globalState.setAction({ type: 'Set Entities' });
        this.setState(function (state) { return _crud._set(state, entities, options.entityClass, _this.idKey); });
        this.setDirty();
    };
    /**
     * Create or replace an entity in the store.
     *
     * @example
     * this.store.createOrReplace(3, Entity);
     *
     */
    /**
     * Create or replace an entity in the store.
     *
     * \@example
     * this.store.createOrReplace(3, Entity);
     *
     * @param {?} id
     * @param {?} entity
     * @return {?}
     */
    EntityStore.prototype.createOrReplace = /**
     * Create or replace an entity in the store.
     *
     * \@example
     * this.store.createOrReplace(3, Entity);
     *
     * @param {?} id
     * @param {?} entity
     * @return {?}
     */
    function (id, entity) {
        if (!entityExists(id, this._value().entities)) {
            if (!entity[this.idKey]) {
                entity[this.idKey] = id;
            }
            return this.add(entity);
        }
        isDev() && __globalState.setAction({ type: 'Upsert Entity', entityId: [id] });
        this.setState(function (state) { return _crud._replaceEntity(state, id, entity); });
    };
    /**
     * Add an entity or entities to the store.
     *
     * @example
     * this.store.add([Entity, Entity]);
     * this.store.add(Entity);
     */
    /**
     * Add an entity or entities to the store.
     *
     * \@example
     * this.store.add([Entity, Entity]);
     * this.store.add(Entity);
     * @param {?} entities
     * @return {?}
     */
    EntityStore.prototype.add = /**
     * Add an entity or entities to the store.
     *
     * \@example
     * this.store.add([Entity, Entity]);
     * this.store.add(Entity);
     * @param {?} entities
     * @return {?}
     */
    function (entities) {
        var _this = this;
        /** @type {?} */
        var toArray = coerceArray(entities);
        if (toArray.length === 0)
            return;
        isDev() && __globalState.setAction({ type: 'Add Entity' });
        this.setState(function (state) { return _crud._add(state, toArray, _this.idKey); });
    };
    /**
     * @param {?} idsOrFn
     * @param {?=} newStateOrFn
     * @return {?}
     */
    EntityStore.prototype.update = /**
     * @param {?} idsOrFn
     * @param {?=} newStateOrFn
     * @return {?}
     */
    function (idsOrFn, newStateOrFn) {
        var _this = this;
        /** @type {?} */
        var ids = [];
        /** @type {?} */
        var storeIds = this._value().ids;
        if (isFunction(idsOrFn)) {
            for (var i = 0, len = storeIds.length; i < len; i++) {
                /** @type {?} */
                var id = storeIds[i];
                /** @type {?} */
                var entity = this._value().entities[id];
                if (entity && (/** @type {?} */ (idsOrFn))(entity)) {
                    ids.push(id);
                }
            }
        }
        else {
            ids = toBoolean(idsOrFn) ? coerceArray(idsOrFn) : storeIds;
        }
        if (ids.length === 0)
            return;
        isDev() && __globalState.setAction({ type: 'Update Entity', entityId: ids });
        this.setState(function (state) {
            return _crud._update(state, ids, newStateOrFn, _this.idKey);
        });
    };
    /**
     * An alias to update all.
     */
    /**
     * An alias to update all.
     * @param {?} state
     * @return {?}
     */
    EntityStore.prototype.updateAll = /**
     * An alias to update all.
     * @param {?} state
     * @return {?}
     */
    function (state) {
        if (this._value().ids.length === 0)
            return;
        this.update(null, state);
    };
    /**
     * Update the root state (data which is external to the entities).
     *
     * @example
     * this.store.updateRoot({
     *   metadata: 'new metadata
     * });
     *
     *  this.store.updateRoot(state => {
     *    return {
     *      metadata: {
     *        ...state.metadata,
     *        key: 'new value'
     *      }
     *    }
     *  });
     */
    /**
     * Update the root state (data which is external to the entities).
     *
     * \@example
     * this.store.updateRoot({
     *   metadata: 'new metadata
     * });
     *
     *  this.store.updateRoot(state => {
     *    return {
     *      metadata: {
     *        ...state.metadata,
     *        key: 'new value'
     *      }
     *    }
     *  });
     * @param {?} newStateFn
     * @param {?=} action
     * @return {?}
     */
    EntityStore.prototype.updateRoot = /**
     * Update the root state (data which is external to the entities).
     *
     * \@example
     * this.store.updateRoot({
     *   metadata: 'new metadata
     * });
     *
     *  this.store.updateRoot(state => {
     *    return {
     *      metadata: {
     *        ...state.metadata,
     *        key: 'new value'
     *      }
     *    }
     *  });
     * @param {?} newStateFn
     * @param {?=} action
     * @return {?}
     */
    function (newStateFn, action) {
        /** @type {?} */
        var newState = isFunction(newStateFn) ? newStateFn(this._value()) : newStateFn;
        if (newState === this._value()) {
            throw new AkitaImmutabilityError(this.storeName);
        }
        isDev() && __globalState.setAction(action || { type: 'Update Root' });
        this.setState(function (state) {
            return __assign({}, (/** @type {?} */ (state)), (/** @type {?} */ (newState)));
        });
    };
    /**
     * @param {?=} idsOrFn
     * @return {?}
     */
    EntityStore.prototype.remove = /**
     * @param {?=} idsOrFn
     * @return {?}
     */
    function (idsOrFn) {
        /** @type {?} */
        var storeIds = this._value().ids;
        if (storeIds.length === 0)
            return;
        /** @type {?} */
        var idPassed = toBoolean(idsOrFn);
        if (!idPassed)
            this.setPristine();
        /** @type {?} */
        var ids = [];
        if (isFunction(idsOrFn)) {
            for (var i = 0, len = storeIds.length; i < len; i++) {
                /** @type {?} */
                var id = storeIds[i];
                /** @type {?} */
                var entity = this._value().entities[id];
                if (entity && idsOrFn(entity)) {
                    ids.push(id);
                }
            }
        }
        else {
            ids = idPassed ? coerceArray(idsOrFn) : null;
        }
        if (ids && ids.length === 0)
            return;
        isDev() && __globalState.setAction({ type: 'Remove Entity', entityId: ids });
        this.setState(function (state) {
            return _crud._remove(state, ids);
        });
    };
    /**
     *
     * Update the active entity.
     *
     * @example
     * this.store.updateActive(active => {
     *   return {
     *     config: {
     *      ..active.config,
     *      date
     *     }
     *   }
     * })
     */
    /**
     *
     * Update the active entity.
     *
     * \@example
     * this.store.updateActive(active => {
     *   return {
     *     config: {
     *      ..active.config,
     *      date
     *     }
     *   }
     * })
     * @param {?} newStateFn
     * @return {?}
     */
    EntityStore.prototype.updateActive = /**
     *
     * Update the active entity.
     *
     * \@example
     * this.store.updateActive(active => {
     *   return {
     *     config: {
     *      ..active.config,
     *      date
     *     }
     *   }
     * })
     * @param {?} newStateFn
     * @return {?}
     */
    function (newStateFn) {
        var _this = this;
        assertActive(this._value());
        isDev() && __globalState.setAction({ type: 'Update Active Entity', entityId: this._value()["active"] });
        this.setState(function (state) {
            /** @type {?} */
            var activeId = state["active"];
            /** @type {?} */
            var newState = isFunction(newStateFn) ? newStateFn(state.entities[activeId]) : newStateFn;
            if (newState === state) {
                throw new AkitaImmutabilityError(_this.storeName);
            }
            return _crud._update(state, [activeId], newState, _this.idKey);
        });
    };
    /**
     * Set the given entity as active.
     */
    /**
     * Set the given entity as active.
     * @param {?} id
     * @return {?}
     */
    EntityStore.prototype.setActive = /**
     * Set the given entity as active.
     * @param {?} id
     * @return {?}
     */
    function (id) {
        if (id === this._value()["active"])
            return;
        isDev() && __globalState.setAction({ type: 'Set Active Entity', entityId: id });
        this.setState(function (state) {
            return __assign({}, (/** @type {?} */ (state)), { active: id });
        });
    };
    return EntityStore;
}(Store));
/** @type {?} */
var getInitialEntitiesState = function () {
    return (/** @type {?} */ ({
        entities: {},
        ids: [],
        loading: true,
        error: null
    }));
};
/** @type {?} */
var getInitialActiveState = function () {
    return (/** @type {?} */ ({
        active: null
    }));
};

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/** @enum {string} */
var Order = {
    ASC: 'asc',
    DESC: 'desc',
};
/**
 * @param {?} key
 * @param {?=} order
 * @return {?}
 */
function compareValues(key, order) {
    if (order === void 0) { order = Order.ASC; }
    return function (a, b) {
        if (!a.hasOwnProperty(key) || !b.hasOwnProperty(key)) {
            return 0;
        }
        /** @type {?} */
        var varA = typeof a[key] === 'string' ? a[key].toUpperCase() : a[key];
        /** @type {?} */
        var varB = typeof b[key] === 'string' ? b[key].toUpperCase() : b[key];
        /** @type {?} */
        var comparison = 0;
        if (varA > varB) {
            comparison = 1;
        }
        else if (varA < varB) {
            comparison = -1;
        }
        return order == Order.DESC ? comparison * -1 : comparison;
    };
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/**
 * @param {?} fn
 * @return {?}
 */
function memoizeOne(fn) {
    /** @type {?} */
    var lastArgs;
    /** @type {?} */
    var changed = false;
    /** @type {?} */
    var firstInit = true;
    /** @type {?} */
    var lastResult;
    return function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        if (lastArgs) {
            /** If entities nor ids doesn't change return the last value */
            changed = lastArgs[1] !== args[1] || lastArgs[0] !== args[0];
        }
        if (firstInit || (changed && !firstInit)) {
            lastResult = fn.apply(this, args);
        }
        firstInit = false;
        lastArgs = args;
        return lastResult;
    };
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/** @type {?} */
var queryConfigKey = 'akitaQueryConfig';
/**
 * @template E
 * @param {?} metadata
 * @return {?}
 */
function QueryConfig(metadata) {
    return function (constructor) {
        constructor[queryConfigKey] = {};
        for (var i = 0, keys = Object.keys(metadata); i < keys.length; i++) {
            /** @type {?} */
            var key = keys[i];
            constructor[queryConfigKey][key] = metadata[key];
        }
    };
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/**
 * @template S
 */
var  /**
 * @template S
 */
Query = /** @class */ (function () {
    function Query(store) {
        this.store = store;
        this.__store__ = store;
    }
    /**
     * @template R
     * @param {?=} project
     * @return {?}
     */
    Query.prototype.select = /**
     * @template R
     * @param {?=} project
     * @return {?}
     */
    function (project) {
        /** @type {?} */
        var state = project ? project : function (state) { return state; };
        return this.store._select(state);
    };
    /**
     * Select once and complete.
     */
    /**
     * Select once and complete.
     * @template R
     * @param {?} project
     * @return {?}
     */
    Query.prototype.selectOnce = /**
     * Select once and complete.
     * @template R
     * @param {?} project
     * @return {?}
     */
    function (project) {
        return this.select(project).pipe(take(1));
    };
    /**
     * Select the store's loading state.
     */
    /**
     * Select the store's loading state.
     * @return {?}
     */
    Query.prototype.selectLoading = /**
     * Select the store's loading state.
     * @return {?}
     */
    function () {
        return this.select(function (state) { return (/** @type {?} */ (state)).loading; });
    };
    /**
     * Select the store's error state.
     */
    /**
     * Select the store's error state.
     * @return {?}
     */
    Query.prototype.selectError = /**
     * Select the store's error state.
     * @return {?}
     */
    function () {
        return this.select(function (state) { return (/** @type {?} */ (state)).error; });
    };
    /**
     * Get the raw value of the store.
     */
    /**
     * Get the raw value of the store.
     * @return {?}
     */
    Query.prototype.getSnapshot = /**
     * Get the raw value of the store.
     * @return {?}
     */
    function () {
        return this.store._value();
    };
    Object.defineProperty(Query.prototype, "isPristine", {
        /**
         *  Returns whether the state of the store is pristine (the set() method hasn't been explicitly called
         *  since the store creation, or the last time setPristine()was called).
         */
        get: /**
         *  Returns whether the state of the store is pristine (the set() method hasn't been explicitly called
         *  since the store creation, or the last time setPristine()was called).
         * @return {?}
         */
        function () {
            return this.store.isPristine;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Query.prototype, "isDirty", {
        /**
         * Returns whether the state of the store is dirty (the set() method
         * or the setDirty() method has been explicitly called since the store creation,
         * or the last time setPristine() was called).
         */
        get: /**
         * Returns whether the state of the store is dirty (the set() method
         * or the setDirty() method has been explicitly called since the store creation,
         * or the last time setPristine() was called).
         * @return {?}
         */
        function () {
            return !this.store.isPristine;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Query.prototype, "config", {
        get: /**
         * @return {?}
         */
        function () {
            return this.constructor[queryConfigKey];
        },
        enumerable: true,
        configurable: true
    });
    return Query;
}());

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
// unsupported: template constraints.
/**
 *  An abstraction for querying the entities from the store
 * @template S, E
 */
var  
// unsupported: template constraints.
/**
 *  An abstraction for querying the entities from the store
 * @template S, E
 */
QueryEntity = /** @class */ (function (_super) {
    __extends(QueryEntity, _super);
    function QueryEntity(store) {
        var _this = _super.call(this, store) || this;
        _this.__store__ = store;
        return _this;
    }
    /**
     * @param {?=} options
     * @return {?}
     */
    QueryEntity.prototype.selectAll = /**
     * @param {?=} options
     * @return {?}
     */
    function (options) {
        var _this = this;
        if (options === void 0) { options = {
            asObject: false
        }; }
        /** @type {?} */
        var selectState$ = this.select(function (state) { return state; });
        /** @type {?} */
        var selectEntities$ = this.select(function (state) { return state.entities; });
        options.sortBy = options.sortBy || (this.config && (/** @type {?} */ (this.config.sortBy)));
        options.sortByOrder = options.sortByOrder || (this.config && this.config.sortByOrder);
        return selectEntities$.pipe(withLatestFrom(selectState$, function (entities, state) {
            var ids = state.ids;
            if (options.asObject) {
                return toMap(ids, entities, options);
            }
            else {
                if (!options.filterBy && !options.sortBy) {
                    if (!_this.memoized) {
                        _this.memoized = memoizeOne(toArray);
                    }
                    return _this.memoized(state, options);
                }
                return toArray(state, options);
            }
        }));
    };
    /**
     * @param {?=} options
     * @return {?}
     */
    QueryEntity.prototype.getAll = /**
     * @param {?=} options
     * @return {?}
     */
    function (options) {
        if (options === void 0) { options = { asObject: false, filterBy: undefined, limitTo: undefined }; }
        /** @type {?} */
        var state = this.getSnapshot();
        if (options.asObject) {
            return toMap(state.ids, state.entities, options, true);
        }
        return toArray(state, options);
    };
    /**
     * Select multiple entities from the store.
     *
     * @example
     * this.store.selectMany([1,2]);
     */
    /**
     * Select multiple entities from the store.
     *
     * \@example
     * this.store.selectMany([1,2]);
     * @param {?} ids
     * @param {?=} options
     * @return {?}
     */
    QueryEntity.prototype.selectMany = /**
     * Select multiple entities from the store.
     *
     * \@example
     * this.store.selectMany([1,2]);
     * @param {?} ids
     * @param {?=} options
     * @return {?}
     */
    function (ids, options) {
        var _this = this;
        if (options === void 0) { options = {}; }
        /** @type {?} */
        var filterUndefined = isUndefined(options.filterUndefined) ? true : options.filterUndefined;
        /** @type {?} */
        var entities = ids.map(function (id) { return _this.selectEntity(id); });
        return combineLatest(entities).pipe(map(function (entities) {
            return filterUndefined ? entities.filter(function (val) { return !isUndefined(val); }) : entities;
        }), auditTime(0));
    };
    /**
     * @template R
     * @param {?} id
     * @param {?=} project
     * @return {?}
     */
    QueryEntity.prototype.selectEntity = /**
     * @template R
     * @param {?} id
     * @param {?=} project
     * @return {?}
     */
    function (id, project) {
        var _this = this;
        if (!project) {
            return this._byId(id);
        }
        return this.select(function (state) {
            if (_this.hasEntity(id)) {
                return project(_this.getEntity(id));
            }
            return undefined;
        });
    };
    /**
     * Get an entity by id
     *
     * @example
     * this.store.getEntity(1);
     */
    /**
     * Get an entity by id
     *
     * \@example
     * this.store.getEntity(1);
     * @param {?} id
     * @return {?}
     */
    QueryEntity.prototype.getEntity = /**
     * Get an entity by id
     *
     * \@example
     * this.store.getEntity(1);
     * @param {?} id
     * @return {?}
     */
    function (id) {
        return this.getSnapshot().entities[id];
    };
    /**
     * Select the active entity's id.
     */
    /**
     * Select the active entity's id.
     * @return {?}
     */
    QueryEntity.prototype.selectActiveId = /**
     * Select the active entity's id.
     * @return {?}
     */
    function () {
        return this.select(function (state) { return (/** @type {?} */ (state)).active; });
    };
    /**
     * Get the active id
     */
    /**
     * Get the active id
     * @return {?}
     */
    QueryEntity.prototype.getActiveId = /**
     * Get the active id
     * @return {?}
     */
    function () {
        return (/** @type {?} */ (this.getSnapshot())).active;
    };
    /**
     * @template R
     * @param {?=} project
     * @return {?}
     */
    QueryEntity.prototype.selectActive = /**
     * @template R
     * @param {?=} project
     * @return {?}
     */
    function (project) {
        var _this = this;
        return this.selectActiveId().pipe(switchMap(function (activeId) { return _this.selectEntity(activeId, project); }));
    };
    /**
     * Get the active entity.
     */
    /**
     * Get the active entity.
     * @return {?}
     */
    QueryEntity.prototype.getActive = /**
     * Get the active entity.
     * @return {?}
     */
    function () {
        /** @type {?} */
        var activeId = this.getActiveId();
        return toBoolean(activeId) ? this.getEntity(activeId) : undefined;
    };
    /**
     * Select the store's entity collection length.
     */
    /**
     * Select the store's entity collection length.
     * @param {?=} predicate
     * @return {?}
     */
    QueryEntity.prototype.selectCount = /**
     * Select the store's entity collection length.
     * @param {?=} predicate
     * @return {?}
     */
    function (predicate) {
        if (isFunction(predicate)) {
            return this.selectAll({
                filterBy: predicate
            }).pipe(map(function (entities) { return entities.length; }));
        }
        return this.select(function (store) { return store.ids.length; });
    };
    /**
     * Get the store's entity collection length.
     */
    /**
     * Get the store's entity collection length.
     * @param {?=} predicate
     * @return {?}
     */
    QueryEntity.prototype.getCount = /**
     * Get the store's entity collection length.
     * @param {?=} predicate
     * @return {?}
     */
    function (predicate) {
        if (isFunction(predicate)) {
            return this.getAll().filter(predicate).length;
        }
        return this.getSnapshot().ids.length;
    };
    /**
     * @param {?} projectOrId
     * @return {?}
     */
    QueryEntity.prototype.hasEntity = /**
     * @param {?} projectOrId
     * @return {?}
     */
    function (projectOrId) {
        if (isFunction(projectOrId)) {
            return this.getAll().some(projectOrId);
        }
        return projectOrId in this.store.entities;
    };
    /**
     * @return {?}
     */
    QueryEntity.prototype.isEmpty = /**
     * @return {?}
     */
    function () {
        return this.getSnapshot().ids.length === 0;
    };
    /**
     * @param {?} id
     * @return {?}
     */
    QueryEntity.prototype._byId = /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        var _this = this;
        return this.select(function (state) { return _this.getEntity(id); });
    };
    /**
     * @return {?}
     */
    QueryEntity.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.memoized = null;
    };
    return QueryEntity;
}(Query));
/**
 * @template E, S
 * @param {?} state
 * @param {?} options
 * @return {?}
 */
function toArray(state, options) {
    /** @type {?} */
    var arr = [];
    var ids = state.ids, entities = state.entities;
    var filterBy = options.filterBy, limitTo = options.limitTo, sortBy = options.sortBy, sortByOrder = options.sortByOrder;
    for (var i = 0; i < ids.length; i++) {
        /** @type {?} */
        var id = ids[i];
        if (!entityExists(id, entities)) {
            continue;
        }
        if (!filterBy) {
            arr.push(entities[id]);
            continue;
        }
        if (filterBy(entities[id])) {
            arr.push(entities[id]);
        }
    }
    if (sortBy) {
        /** @type {?} */
        var _sortBy_1 = isFunction(sortBy) ? sortBy : compareValues(sortBy, sortByOrder);
        arr = arr.sort(function (a, b) { return _sortBy_1(a, b, state); });
    }
    /** @type {?} */
    var length = Math.min(limitTo || arr.length, arr.length);
    return length === arr.length ? arr : arr.slice(0, length);
}
/**
 * @template E
 * @param {?} ids
 * @param {?} entities
 * @param {?} options
 * @param {?=} get
 * @return {?}
 */
function toMap(ids, entities, options, get) {
    if (get === void 0) { get = false; }
    /** @type {?} */
    var map$$1 = {};
    var filterBy = options.filterBy, limitTo = options.limitTo;
    if (get && !filterBy && !limitTo) {
        return entities;
    }
    /** @type {?} */
    var length = Math.min(limitTo || ids.length, ids.length);
    if (filterBy && isUndefined(limitTo) === false) {
        /** @type {?} */
        var count = 0;
        for (var i = 0, length_1 = ids.length; i < length_1; i++) {
            if (count === limitTo)
                break;
            /** @type {?} */
            var id = ids[i];
            if (!entityExists(id, entities)) {
                continue;
            }
            if (filterBy(entities[id])) {
                map$$1[id] = entities[id];
                count++;
            }
        }
    }
    else {
        for (var i = 0; i < length; i++) {
            /** @type {?} */
            var id = ids[i];
            if (!entityExists(id, entities)) {
                continue;
            }
            if (!filterBy) {
                map$$1[id] = entities[id];
                continue;
            }
            if (toBoolean(filterBy(entities[id]))) {
                map$$1[id] = entities[id];
            }
        }
    }
    return map$$1;
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/**
 *  A logical transaction.
 *  Use this transaction to optimize the dispatch of all the stores.
 *  The following code will update the store, BUT  emits only once
 *
 * \@example
 *  applyTransaction(() => {
 *    this.todosStore.add(new Todo(1, title));
 *    this.todosStore.add(new Todo(2, title));
 *  });
 *
 * @template T
 * @param {?} action
 * @param {?=} thisArg
 * @return {?}
 */
function applyTransaction(action, thisArg) {
    if (thisArg === void 0) { thisArg = undefined; }
    startBatch();
    try {
        return action.apply(thisArg);
    }
    finally {
        endBatch();
    }
}
/**
 *  A logical transaction.
 *  Use this transaction to optimize the dispatch of all the stores.
 *
 *  The following code will update the store, BUT  emits only once.
 *
 * \@example
 * \@transaction
 *  addTodos() {
 *    this.todosStore.add(new Todo(1, title));
 *    this.todosStore.add(new Todo(2, title));
 *  }
 *
 *
 * @return {?}
 */
function transaction() {
    return function (target, propertyKey, descriptor) {
        /** @type {?} */
        var originalMethod = descriptor.value;
        descriptor.value = function () {
            var _this = this;
            var args = [];
            for (var _i = 0; _i < arguments.length; _i++) {
                args[_i] = arguments[_i];
            }
            return applyTransaction(function () {
                return originalMethod.apply(_this, args);
            }, this);
        };
        return descriptor;
    };
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/**
 * Adds one or more elements to the end of an array by returning
 * a new array instead of mutating the original one.
 *
 * \@example
 * const originalArray = ['a', 'b', 'c', 'd', 'e'];
 * const resultArray = push(originalArray, 'f', 'g');
 * // -> originalArray ['a', 'b', 'c', 'd', 'e']
 * // -> resultArray ['a', 'b', 'c', 'd', 'e', 'f', 'g']
 * @template T
 * @param {?} array
 * @param {...?} elementN
 * @return {?}
 */
function push(array) {
    var elementN = [];
    for (var _i = 1; _i < arguments.length; _i++) {
        elementN[_i - 1] = arguments[_i];
    }
    return __spread(array, elementN);
}
/**
 * Deletes an element from an array by its index in the array.
 *
 * \@example
 * const originalArray = ['a', 'b', 'c', 'd', 'e'];
 * const resultArray = remove(originalArray, 2);
 * // -> originalArray ['a', 'b', 'c', 'd', 'e']
 * // -> resultArray ['a', 'b', 'd', 'e']
 * @template T
 * @param {?} array
 * @param {?} index
 * @return {?}
 */
function remove(array, index) {
    return index >= 0 ? __spread(array.slice(0, index), array.slice(index + 1)) : __spread(array);
}
/**
 * Removes the last element from an array by returning
 * a new array instead of mutating the original one.
 *
 * \@example
 * const originalArray = ['a', 'b', 'c', 'd', 'e'];
 * const resultArray = pop(originalArray);
 * // -> originalArray ['a', 'b', 'c', 'd', 'e']
 * // -> resultArray ['a', 'b', 'c', 'd']
 * @template T
 * @param {?} array
 * @return {?}
 */
function pop(array) {
    return array.slice(0, -1);
}
/**
 * Adds one or more elements to the beginning of an array.
 *
 * \@example
 * const originalArray = ['a', 'b', 'c', 'd', 'e'];
 * const resultArray = unshift(originalArray, 'f', 'g');
 * // -> originalArray ['a', 'b', 'c', 'd', 'e']
 * // -> resultArray ['f', 'g', 'a', 'b', 'c', 'd', 'e']
 * @template T
 * @param {?} array
 * @param {...?} elementN
 * @return {?}
 */
function unshift(array) {
    var elementN = [];
    for (var _i = 1; _i < arguments.length; _i++) {
        elementN[_i - 1] = arguments[_i];
    }
    return __spread(elementN, array);
}
/**
 * Sorts the elements of an array (not in place) and returns a sorted array.
 *
 * \@example
 * const numberArray = [20, 3, 4, 10, -3, 1, 0, 5];
 * const stringArray = ['Blue', 'Humpback', 'Beluga'];
 *
 * const resultArray = sort(numberArray, (a, b) => a - b);
 * // -> numberArray [20, 3, 4, 10, -3, 1, 0, 5]
 * // -> resultArray [-3, 0, 1, 3, 4, 5, 10, 20]
 *
 * const resultArray = sort(numberArray, (a, b) => b - a);
 * // -> numberArray [20, 3, 4, 10, -3, 1, 0, 5]
 * // -> resultArray [20, 10, 5, 4, 3, 1, 0, -3]
 *
 * const resultArray = sort(stringArray);
 * // -> stringArray ['Blue', 'Humpback', 'Beluga']
 * // -> resultArray ['Beluga', 'Blue', 'Humpback']
 *
 * const resultArray = sort(stringArray, (a, b) => a.toLowerCase() < b.toLowerCase());
 * // -> stringArray ['Blue', 'Humpback', 'Beluga']
 * // -> resultArray ['Humpback', 'Blue', 'Beluga']
 * @template T
 * @param {?} array
 * @param {?=} compareFunction
 * @return {?}
 */
function sort(array, compareFunction) {
    return __spread(array).sort(compareFunction);
}
/**
 * Reverses an array (not in place).
 * The first array element becomes the last, and the last array element becomes the first.
 *
 * \@example
 * const originalArray = ['a', 'b', 'c', 'd', 'e'];
 * const resultArray = reverse(originalArray);
 * // -> originalArray ['a', 'b', 'c', 'd', 'e']
 * // -> resultArray ['e', 'd', 'c', 'b', 'a']
 * @template T
 * @param {?} array
 * @return {?}
 */
function reverse(array) {
    return __spread(array).reverse();
}
/**
 * Swap items in the array
 *
 * \@example
 * const originalArray = ['a', 'b', 'c', 'd', 'e'];
 * const resultArray = swap(originalArray, 1, 4);
 * // -> originalArray ['a', 'b', 'c', 'd', 'e']
 * // -> resultArray ['a', 'e', 'c', 'd', 'b']
 * @template T
 * @param {?} array
 * @param {?} firstIndex
 * @param {?} secondIndex
 * @return {?}
 */
function swap(array, firstIndex, secondIndex) {
    /** @type {?} */
    var results = array.slice();
    /** @type {?} */
    var firstItem = array[firstIndex];
    results[firstIndex] = array[secondIndex];
    results[secondIndex] = firstItem;
    return results;
}
/**
 * Update item in the array
 *
 * \@example
 * const originalArray = ['a', 'b', 'c', 'd', 'e'];
 * const resultArray = update(originalArray, 1, 'newItem');
 * // -> resultArray ['a', 'newItem', 'c', 'd', 'b']
 *
 * const originalArray = [{title: 1}, {title: 2}];
 * const resultArray = update(originalArray, originalArray[0], {title: 3});
 * // -> resultArray  [{title: 3}, {title: 2}];
 * @template T
 * @param {?} array
 * @param {?} indexOrItem
 * @param {?} updated
 * @return {?}
 */
function update(array, indexOrItem, updated) {
    return array.map(function (current, idx) {
        if (typeof indexOrItem === 'number' && idx === indexOrItem) {
            return updated;
        }
        if (isObject(indexOrItem) && (/** @type {?} */ (indexOrItem)) === current) {
            return __assign({}, (/** @type {?} */ (indexOrItem)), (/** @type {?} */ (updated)));
        }
        return current;
    });
}
/**
 * Removes existing elements and/or adds new elements to an array.
 *
 * \@example
 * const originalArray = ['a', 'b', 'c', 'd', 'e'];
 * const resultArray = splice(originalArray, 0);
 * // -> originalArray ['a', 'b', 'c', 'd', 'e']
 * // -> resultArray []
 *
 * const originalArray = ['a', 'b', 'c', 'd', 'e'];
 * const resultArray = splice(originalArray, 0, 1);
 * // -> originalArray ['a', 'b', 'c', 'd', 'e']
 * // -> resultArray ['b', 'c', 'd', 'e']
 *
 * const originalArray = ['a', 'b', 'c', 'd', 'e'];
 * const resultArray = splice(originalArray, 0, 3);
 * // -> originalArray ['a', 'b', 'c', 'd', 'e']
 * // -> resultArray ['d', 'e']
 *
 * const originalArray = ['a', 'b', 'c', 'd', 'e'];
 * const resultArray = splice(originalArray, 0, originalArray.length);
 * // -> originalArray ['a', 'b', 'c', 'd', 'e']
 * // -> resultArray []
 *
 * const originalArray = ['a', 'b', 'c', 'd', 'e'];
 * const resultArray = splice(originalArray, 0, -3);
 * // -> originalArray ['a', 'b', 'c', 'd', 'e']
 * // -> resultArray ['a', 'b', 'c', 'd', 'e']
 *
 * const originalArray = ['a', 'b', 'c', 'd', 'e'];
 * const resultArray = splice(originalArray, 0, 0, 'lorem', 'ipsum');
 * // -> originalArray ['a', 'b', 'c', 'd', 'e']
 * // -> resultArray ['lorem', 'ipsum', 'a', 'b', 'c', 'd', 'e']
 *
 * const originalArray = ['a', 'b', 'c', 'd', 'e'];
 * const resultArray = splice(originalArray, originalArray.length, 0, 'lorem', 'ipsum');
 * // -> originalArray ['a', 'b', 'c', 'd', 'e']
 * // -> resultArray ['a', 'b', 'c', 'd', 'e', 'lorem', 'ipsum']
 *
 * const originalArray = ['a', 'b', 'c', 'd', 'e'];
 * const resultArray = splice(originalArray, 0, 2, 'lorem', 'ipsum');
 * // -> originalArray ['a', 'b', 'c', 'd', 'e']
 * // -> resultArray ['lorem', 'ipsum', 'c', 'd', 'e']
 *
 * const originalArray = ['a', 'b', 'c', 'd', 'e'];
 * const resultArray = splice(originalArray, originalArray.length - 2, 2, 'lorem', 'ipsum');
 * // -> originalArray ['a', 'b', 'c', 'd', 'e']
 * // -> resultArray ['a', 'b', 'c', 'lorem', 'ipsum']
 * @template T
 * @param {?} array
 * @param {?=} start
 * @param {?=} deleteCount
 * @param {...?} elementN
 * @return {?}
 */
function splice(array, start, deleteCount) {
    if (start === void 0) { start = array.length; }
    if (deleteCount === void 0) { deleteCount = array.length - start; }
    var elementN = [];
    for (var _i = 3; _i < arguments.length; _i++) {
        elementN[_i - 3] = arguments[_i];
    }
    return __spread(array.slice(0, start), elementN, array.slice(start + (deleteCount < 0 ? 0 : deleteCount)));
}
/**
 * @template T
 * @param {?} arr
 * @param {?} item
 * @return {?}
 */
function toggle(arr, item) {
    return arr.indexOf(item) > -1 ? arr.filter(function (current) { return item !== current; }) : push(arr, item);
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/** @type {?} */
var filterNil = function (source) { return source.pipe(filter(function (value) { return value !== null && typeof value !== 'undefined'; })); };

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/**
 * @template T
 * @param {?} func
 * @param {?} action
 * @param {?=} thisArg
 * @return {?}
 */
function applyAction(func, action, thisArg) {
    if (thisArg === void 0) { thisArg = undefined; }
    __globalState.setCustomAction(action, true);
    return func.apply(thisArg);
}
/**
 * @param {?} action
 * @param {?=} skipTransactionMsg
 * @return {?}
 */
function action(action, skipTransactionMsg) {
    if (skipTransactionMsg === void 0) { skipTransactionMsg = true; }
    return function (target, propertyKey, descriptor) {
        /** @type {?} */
        var originalMethod = descriptor.value;
        descriptor.value = function () {
            var args = [];
            for (var _i = 0; _i < arguments.length; _i++) {
                args[_i] = arguments[_i];
            }
            __globalState.setCustomAction(action, skipTransactionMsg);
            return originalMethod.apply(this, args);
        };
        return descriptor;
    };
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/**
 * @param {?} object
 * @return {?}
 */
function serialize(object) {
    return JSON.stringify(object, function (key, value) {
        if (typeof value === 'function') {
            return value.toString();
        }
        return value;
    });
}
/**
 * @return {?}
 */
function createWorker() {
    /** @type {?} */
    var blob = new Blob([
        "self.onmessage = function(e) {\n\n      function deserialize(str) {\n        return JSON.parse(str || '', function(key, value) {\n          if (value &&\n            typeof value === \"string\" &&\n            value.substr(0, 8) == \"function\") {\n            var startBody = value.indexOf('{') + 1;\n            var endBody = value.lastIndexOf('}');\n            var startArgs = value.indexOf('(') + 1;\n            var endArgs = value.indexOf(')');\n            return new Function(value.substring(startArgs, endArgs), value.substring(startBody, endBody));\n          }\n          return value;\n        });\n      }\n\n      var deserialized = deserialize(e.data);\n      var mapped = deserialized.data.map(function(d) {\n        return deserialized.factory(d);\n      });\n\n      self.postMessage(mapped);\n    }"
    ], {
        type: 'text/javascript'
    });
    /** @type {?} */
    var url = URL.createObjectURL(blob);
    return new Worker(url);
}
/**
 * \@example
 *   const mockTodos = Array.from({length: 10000}, (_, x) => ({id: x}));
 *
 *   of(mockTodos).pipe(mapInWorker<Todo>(createTodo))
 *   .subscribe(res => console.log(res));
 * @template T
 * @param {?} factoryFn
 * @return {?}
 */
function mapInWorker(factoryFn) {
    return function (source) {
        return new Observable(function (observer) {
            /** @type {?} */
            var worker = createWorker();
            worker.onmessage = function (e) {
                observer.next(e.data);
                observer.complete();
                worker.terminate();
            };
            worker.onerror = function (err) {
                observer.error(err);
                observer.complete();
                worker.terminate();
            };
            return source.subscribe(function (value) {
                /** @type {?} */
                var input = {
                    factory: factoryFn,
                    data: value
                };
                /** @type {?} */
                var serialized = serialize(input);
                worker.postMessage(serialized);
            });
        });
    };
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
var SnapshotManager = /** @class */ (function () {
    function SnapshotManager() {
    }
    /**
     * Get a snapshot of the whole state or a specific stores
     * Use it ONLY for things like saving the state in the server
     */
    /**
     * Get a snapshot of the whole state or a specific stores
     * Use it ONLY for things like saving the state in the server
     * @param {?=} stores
     * @return {?}
     */
    SnapshotManager.prototype.getStoresSnapshot = /**
     * Get a snapshot of the whole state or a specific stores
     * Use it ONLY for things like saving the state in the server
     * @param {?=} stores
     * @return {?}
     */
    function (stores) {
        if (stores === void 0) { stores = []; }
        /** @type {?} */
        var acc = {};
        /** @type {?} */
        var hasInclude = stores.length > 0;
        /** @type {?} */
        var keys = hasInclude ? stores : Object.keys(__stores__);
        for (var i = 0; i < keys.length; i++) {
            /** @type {?} */
            var storeName = keys[i];
            acc[storeName] = __stores__[storeName]._value();
        }
        return acc;
    };
    /**
     * Set snapshot we get from the server
     */
    /**
     * Set snapshot we get from the server
     * @param {?} stores
     * @return {?}
     */
    SnapshotManager.prototype.setStoresSnapshot = /**
     * Set snapshot we get from the server
     * @param {?} stores
     * @return {?}
     */
    function (stores) {
        /** @type {?} */
        var normalizedStores = stores;
        if (isString(stores)) {
            normalizedStores = JSON.parse(/** @type {?} */ (normalizedStores));
        }
        var _loop_1 = function (i, keys) {
            /** @type {?} */
            var storeName = keys[i];
            if (__stores__[storeName]) {
                __stores__[storeName].setState(function () { return normalizedStores[storeName]; });
            }
        };
        for (var i = 0, keys = Object.keys(normalizedStores); i < keys.length; i++) {
            _loop_1(i, keys);
        }
    };
    return SnapshotManager;
}());
/** @type {?} */
var snapshotManager = new SnapshotManager();

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/**
 * @abstract
 * @template E, S
 */
var  /**
 * @abstract
 * @template E, S
 */
AkitaPlugin = /** @class */ (function () {
    function AkitaPlugin(query) {
        this.query = query;
    }
    /** This method is responsible for getting access to the query. */
    /**
     * This method is responsible for getting access to the query.
     * @return {?}
     */
    AkitaPlugin.prototype.getQuery = /**
     * This method is responsible for getting access to the query.
     * @return {?}
     */
    function () {
        return this.query;
    };
    /** This method is responsible for getting access to the store. */
    /**
     * This method is responsible for getting access to the store.
     * @return {?}
     */
    AkitaPlugin.prototype.getStore = /**
     * This method is responsible for getting access to the store.
     * @return {?}
     */
    function () {
        return this.getQuery().__store__;
    };
    /** This method is responsible tells whether the plugin is entityBased or not.  */
    /**
     * This method is responsible tells whether the plugin is entityBased or not.
     * @param {?} entityId
     * @return {?}
     */
    AkitaPlugin.prototype.isEntityBased = /**
     * This method is responsible tells whether the plugin is entityBased or not.
     * @param {?} entityId
     * @return {?}
     */
    function (entityId) {
        return toBoolean(entityId);
    };
    /** This method is responsible for selecting the source; it can be the whole store or one entity. */
    /**
     * This method is responsible for selecting the source; it can be the whole store or one entity.
     * @param {?} entityId
     * @return {?}
     */
    AkitaPlugin.prototype.selectSource = /**
     * This method is responsible for selecting the source; it can be the whole store or one entity.
     * @param {?} entityId
     * @return {?}
     */
    function (entityId) {
        if (this.isEntityBased(entityId)) {
            return (/** @type {?} */ (this.getQuery())).selectEntity(entityId).pipe(filterNil);
        }
        return (/** @type {?} */ (this.getQuery())).select(function (state) { return state; });
    };
    /**
     * @param {?} entityId
     * @return {?}
     */
    AkitaPlugin.prototype.getSource = /**
     * @param {?} entityId
     * @return {?}
     */
    function (entityId) {
        if (this.isEntityBased(entityId)) {
            return (/** @type {?} */ (this.getQuery())).getEntity(entityId);
        }
        return this.getQuery().getSnapshot();
    };
    /** This method is responsible for updating the store or one entity; it can be the whole store or one entity. */
    /**
     * This method is responsible for updating the store or one entity; it can be the whole store or one entity.
     * @param {?} newState
     * @param {?=} entityId
     * @return {?}
     */
    AkitaPlugin.prototype.updateStore = /**
     * This method is responsible for updating the store or one entity; it can be the whole store or one entity.
     * @param {?} newState
     * @param {?=} entityId
     * @return {?}
     */
    function (newState, entityId) {
        if (this.isEntityBased(entityId)) {
            this.getStore().update(entityId, newState);
        }
        else {
            this.getStore().setState(function (state) { return (__assign({}, state, newState)); });
        }
    };
    return AkitaPlugin;
}());

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/** @type {?} */
var paginatorDefaults = {
    pagesControls: false,
    range: false,
    startWith: 1,
    cacheTimeout: undefined
};
/**
 * @template E
 */
var PaginatorPlugin = /** @class */ (function (_super) {
    __extends(PaginatorPlugin, _super);
    function PaginatorPlugin(query, config) {
        if (config === void 0) { config = {}; }
        var _this = _super.call(this, query) || this;
        _this.query = query;
        _this.config = config;
        /**
         * Save current filters, sorting, etc. in cache
         */
        _this.metadata = new Map();
        _this.pages = new Map();
        _this.pagination = {
            currentPage: 1,
            perPage: 0,
            total: 0,
            lastPage: 0,
            data: []
        };
        /**
         * When the user navigates to a different page and return
         * we don't want to call `clearCache` on first time.
         */
        _this.initial = false;
        /**
         * Proxy to the query loading
         */
        _this.isLoading$ = _this.query.selectLoading().pipe(delay(0));
        _this.config = Object.assign(paginatorDefaults, config);
        var _a = _this.config, startWith = _a.startWith, cacheTimeout = _a.cacheTimeout;
        _this.page = new BehaviorSubject(startWith);
        if (isObservable(cacheTimeout)) {
            _this.clearCacheSubscription = cacheTimeout.subscribe(function (_) { return _this.clearCache(); });
        }
        return _this;
    }
    Object.defineProperty(PaginatorPlugin.prototype, "pageChanges", {
        /**
         * Listen to page changes
         */
        get: /**
         * Listen to page changes
         * @return {?}
         */
        function () {
            return this.page.asObservable();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PaginatorPlugin.prototype, "currentPage", {
        /**
         * Get the current page number
         */
        get: /**
         * Get the current page number
         * @return {?}
         */
        function () {
            return this.pagination.currentPage;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PaginatorPlugin.prototype, "isFirst", {
        /**
         * Check if current page is the first one
         */
        get: /**
         * Check if current page is the first one
         * @return {?}
         */
        function () {
            return this.currentPage === 1;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PaginatorPlugin.prototype, "isLast", {
        /**
         * Check if current page is the last one
         */
        get: /**
         * Check if current page is the last one
         * @return {?}
         */
        function () {
            return this.currentPage === this.pagination.lastPage;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Whether to generate an array of pages for *ngFor
     * [1, 2, 3, 4]
     */
    /**
     * Whether to generate an array of pages for *ngFor
     * [1, 2, 3, 4]
     * @return {?}
     */
    PaginatorPlugin.prototype.withControls = /**
     * Whether to generate an array of pages for *ngFor
     * [1, 2, 3, 4]
     * @return {?}
     */
    function () {
        this.config.pagesControls = true;
        return this;
    };
    /**
     * Whether to generate the `from` and `to` keys
     * [1, 2, 3, 4]
     */
    /**
     * Whether to generate the `from` and `to` keys
     * [1, 2, 3, 4]
     * @return {?}
     */
    PaginatorPlugin.prototype.withRange = /**
     * Whether to generate the `from` and `to` keys
     * [1, 2, 3, 4]
     * @return {?}
     */
    function () {
        this.config.range = true;
        return this;
    };
    /**
     * Set the loading state
     */
    /**
     * Set the loading state
     * @param {?=} value
     * @return {?}
     */
    PaginatorPlugin.prototype.setLoading = /**
     * Set the loading state
     * @param {?=} value
     * @return {?}
     */
    function (value) {
        if (value === void 0) { value = true; }
        this.getStore().setLoading(value);
    };
    /**
     * Update the pagination object and add the page
     */
    /**
     * Update the pagination object and add the page
     * @param {?} response
     * @return {?}
     */
    PaginatorPlugin.prototype.update = /**
     * Update the pagination object and add the page
     * @param {?} response
     * @return {?}
     */
    function (response) {
        this.pagination = response;
        this.addPage(response.data);
    };
    /**
     *
     * Set the ids and add the page to store
     */
    /**
     *
     * Set the ids and add the page to store
     * @param {?} data
     * @return {?}
     */
    PaginatorPlugin.prototype.addPage = /**
     *
     * Set the ids and add the page to store
     * @param {?} data
     * @return {?}
     */
    function (data) {
        var _this = this;
        this.pages.set(this.currentPage, { ids: data.map(function (entity) { return entity[_this.getStore().idKey]; }) });
        this.getStore().add(data);
    };
    /**
     * Clear the cache.
     */
    /**
     * Clear the cache.
     * @return {?}
     */
    PaginatorPlugin.prototype.clearCache = /**
     * Clear the cache.
     * @return {?}
     */
    function () {
        var _this = this;
        if (!this.initial) {
            applyAction(function () {
                _this.getStore().remove();
            }, { type: '@Pagination - Clear Cache' });
            this.pages = new Map();
        }
        this.initial = false;
    };
    /**
     * @param {?} page
     * @return {?}
     */
    PaginatorPlugin.prototype.clearPage = /**
     * @param {?} page
     * @return {?}
     */
    function (page) {
        this.pages.delete(page);
    };
    /**
     * Clear the cache timeout and optionally the pages
     */
    /**
     * Clear the cache timeout and optionally the pages
     * @param {?=} __0
     * @return {?}
     */
    PaginatorPlugin.prototype.destroy = /**
     * Clear the cache timeout and optionally the pages
     * @param {?=} __0
     * @return {?}
     */
    function (_a) {
        var _b = _a === void 0 ? {} : _a, clearCache = _b.clearCache, currentPage = _b.currentPage;
        if (this.clearCacheSubscription) {
            this.clearCacheSubscription.unsubscribe();
        }
        if (clearCache) {
            this.clearCache();
        }
        if (!isUndefined(currentPage)) {
            this.setPage(currentPage);
        }
        this.initial = true;
    };
    /**
     * Whether the provided page is active
     */
    /**
     * Whether the provided page is active
     * @param {?} page
     * @return {?}
     */
    PaginatorPlugin.prototype.isPageActive = /**
     * Whether the provided page is active
     * @param {?} page
     * @return {?}
     */
    function (page) {
        return this.currentPage === page;
    };
    /**
     * Set the current page
     */
    /**
     * Set the current page
     * @param {?} page
     * @return {?}
     */
    PaginatorPlugin.prototype.setPage = /**
     * Set the current page
     * @param {?} page
     * @return {?}
     */
    function (page) {
        if (page !== this.currentPage || !this.hasPage(page)) {
            this.page.next((this.pagination.currentPage = page));
        }
    };
    /**
     * Increment current page
     */
    /**
     * Increment current page
     * @return {?}
     */
    PaginatorPlugin.prototype.nextPage = /**
     * Increment current page
     * @return {?}
     */
    function () {
        if (this.currentPage !== this.pagination.lastPage) {
            this.setPage(this.pagination.currentPage + 1);
        }
    };
    /**
     * Decrement current page
     */
    /**
     * Decrement current page
     * @return {?}
     */
    PaginatorPlugin.prototype.prevPage = /**
     * Decrement current page
     * @return {?}
     */
    function () {
        if (this.pagination.currentPage > 1) {
            this.setPage(this.pagination.currentPage - 1);
        }
    };
    /**
     * Set current page to last
     */
    /**
     * Set current page to last
     * @return {?}
     */
    PaginatorPlugin.prototype.setLastPage = /**
     * Set current page to last
     * @return {?}
     */
    function () {
        this.setPage(this.pagination.lastPage);
    };
    /**
     * Set current page to first
     */
    /**
     * Set current page to first
     * @return {?}
     */
    PaginatorPlugin.prototype.setFirstPage = /**
     * Set current page to first
     * @return {?}
     */
    function () {
        this.setPage(1);
    };
    /**
     * Check if page exists in cache
     */
    /**
     * Check if page exists in cache
     * @param {?} page
     * @return {?}
     */
    PaginatorPlugin.prototype.hasPage = /**
     * Check if page exists in cache
     * @param {?} page
     * @return {?}
     */
    function (page) {
        return this.pages.has(page);
    };
    /**
     * Get the current page if it's in cache, otherwise invoke the request
     */
    /**
     * Get the current page if it's in cache, otherwise invoke the request
     * @param {?} req
     * @return {?}
     */
    PaginatorPlugin.prototype.getPage = /**
     * Get the current page if it's in cache, otherwise invoke the request
     * @param {?} req
     * @return {?}
     */
    function (req) {
        var _this = this;
        /** @type {?} */
        var page = this.pagination.currentPage;
        if (this.hasPage(page)) {
            return this.selectPage(page);
        }
        else {
            this.setLoading(true);
            return from(req()).pipe(switchMap(function (config) {
                applyTransaction(function () {
                    _this.setLoading(false);
                    _this.update(config);
                });
                return _this.selectPage(page);
            }));
        }
    };
    /**
     * @return {?}
     */
    PaginatorPlugin.prototype.getQuery = /**
     * @return {?}
     */
    function () {
        return this.query;
    };
    /**
     * @return {?}
     */
    PaginatorPlugin.prototype.getFrom = /**
     * @return {?}
     */
    function () {
        if (this.isFirst) {
            return 1;
        }
        return (this.currentPage - 1) * this.pagination.perPage + 1;
    };
    /**
     * @return {?}
     */
    PaginatorPlugin.prototype.getTo = /**
     * @return {?}
     */
    function () {
        return this.currentPage * this.pagination.perPage;
    };
    /**
     * Select the page
     * @param {?} page
     * @return {?}
     */
    PaginatorPlugin.prototype.selectPage = /**
     * Select the page
     * @param {?} page
     * @return {?}
     */
    function (page) {
        var _this = this;
        return this.query.selectAll({ asObject: true }).pipe(take(1), map(function (entities) {
            /** @type {?} */
            var response = __assign({}, _this.pagination, { data: _this.pages.get(page).ids.map(function (id) { return entities[id]; }) });
            var _a = _this.config, range = _a.range, pagesControls = _a.pagesControls;
            if (!_this.pagination.total) {
                response.total = response.perPage * response.lastPage;
                _this.pagination.total = response.total;
            }
            if (range) {
                response.from = _this.getFrom();
                response.to = _this.getTo();
            }
            if (pagesControls) {
                response.pageControls = generatePages(_this.pagination.total, _this.pagination.perPage);
            }
            return response;
        }));
    };
    __decorate([
        action({ type: '@Pagination - New Page' }, true),
        __metadata("design:type", Function),
        __metadata("design:paramtypes", [Object]),
        __metadata("design:returntype", void 0)
    ], PaginatorPlugin.prototype, "update", null);
    return PaginatorPlugin;
}(AkitaPlugin));
/**
 * Generate an array so we can ngFor them to navigate between pages
 * @param {?} total
 * @param {?} perPage
 * @return {?}
 */
function generatePages(total, perPage) {
    /** @type {?} */
    var len = Math.ceil(total / perPage);
    /** @type {?} */
    var arr = [];
    for (var i = 0; i < len; i++) {
        arr.push(i + 1);
    }
    return arr;
}
/** *
 * backward compatibility
  @type {?} */
var Paginator = PaginatorPlugin;

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/**
 * @template T
 */
var  /**
 * @template T
 */
PersistNgFormPlugin = /** @class */ (function (_super) {
    __extends(PersistNgFormPlugin, _super);
    function PersistNgFormPlugin(query, factoryFnOrPath, params) {
        if (params === void 0) { params = {}; }
        var _this = _super.call(this, query) || this;
        _this.query = query;
        _this.factoryFnOrPath = factoryFnOrPath;
        _this.params = params;
        _this.params = __assign({ debounceTime: 300, formKey: 'akitaForm', emitEvent: false }, params);
        _this.isKeyBased = isString(factoryFnOrPath);
        return _this;
    }
    /**
     * @param {?} form
     * @return {?}
     */
    PersistNgFormPlugin.prototype.setForm = /**
     * @param {?} form
     * @return {?}
     */
    function (form) {
        this.form = form;
        this.activate();
        return this;
    };
    /**
     * @param {?=} initialState
     * @return {?}
     */
    PersistNgFormPlugin.prototype.reset = /**
     * @param {?=} initialState
     * @return {?}
     */
    function (initialState) {
        var _a;
        /** @type {?} */
        var value;
        if (initialState) {
            value = initialState;
        }
        else {
            value = this.isKeyBased ? this.initialValue : (/** @type {?} */ (this)).factoryFnOrPath();
        }
        this.form.patchValue(value);
        /** @type {?} */
        var storeValue = this.isKeyBased ? setValue(this.getStore()._value(), this.getStore().storeName + "." + this.factoryFnOrPath, value) : (_a = {}, _a[this.params.formKey] = value, _a);
        this.updateStore(storeValue);
    };
    /**
     * @return {?}
     */
    PersistNgFormPlugin.prototype.activate = /**
     * @return {?}
     */
    function () {
        var _this = this;
        var _a;
        /** @type {?} */
        var path;
        if (this.isKeyBased) {
            path = this.getStore().storeName + "." + this.factoryFnOrPath;
            this.initialValue = getValue(this.getStore()._value(), path);
            this.form.patchValue(this.initialValue, { emitEvent: this.params.emitEvent });
        }
        else {
            if (!(/** @type {?} */ (this.getQuery().getSnapshot()))[this.params.formKey]) {
                __globalState.setAction({ type: '@PersistNgFormPlugin activate' });
                this.updateStore((_a = {}, _a[this.params.formKey] = (/** @type {?} */ (this)).factoryFnOrPath(), _a));
            }
            this.query.selectOnce(function (state) { return (/** @type {?} */ (state))[_this.params.formKey]; }).subscribe(function (formValue) { return _this.form.patchValue(formValue); });
        }
        this.formChanges = this.form.valueChanges.pipe(debounceTime(this.params.debounceTime)).subscribe(function (value) {
            __globalState.setAction({ type: '@PersistForm - Update' });
            /** @type {?} */
            var newState;
            if (_this.isKeyBased) {
                newState = function (state) { return setValue(state, path, value); };
            }
            else {
                newState = function () {
                    var _a;
                    return (_a = {}, _a[_this.params.formKey] = value, _a);
                };
            }
            _this.updateStore(newState(_this.getStore()._value()));
        });
    };
    /**
     * @return {?}
     */
    PersistNgFormPlugin.prototype.destroy = /**
     * @return {?}
     */
    function () {
        this.formChanges && this.formChanges.unsubscribe();
    };
    return PersistNgFormPlugin;
}(AkitaPlugin));

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/** @type {?} */
var notBs = typeof localStorage === 'undefined';
/**
 * @param {?=} params
 * @return {?}
 */
function persistState(params) {
    if (notBs)
        return;
    /** @type {?} */
    var defaults = {
        key: 'AkitaStores',
        storage: localStorage,
        deserialize: JSON.parse,
        serialize: JSON.stringify,
        include: [],
        exclude: []
    };
    var _a = Object.assign({}, defaults, params), storage = _a.storage, deserialize = _a.deserialize, serialize = _a.serialize, include = _a.include, exclude = _a.exclude, key = _a.key;
    /** @type {?} */
    var hasInclude = include.length > 0;
    /** @type {?} */
    var hasExclude = exclude.length > 0;
    if (hasInclude && hasExclude) {
        throw new AkitaError("You can't use both include and exclude");
    }
    /** @type {?} */
    var storageState = deserialize(storage.getItem(key) || '{}');
    /** @type {?} */
    var stores = {};
    /** @type {?} */
    var acc = {};
    /**
     * @return {?}
     */
    function save() {
        storage.setItem(key, serialize(Object.assign({}, storageState, acc)));
    }
    /**
     * @param {?} storeName
     * @param {?} path
     * @return {?}
     */
    function subscribe(storeName, path) {
        stores[storeName] = __stores__[storeName]
            ._select(function (state) { return getValue(state, path); })
            .pipe(skip(1))
            .subscribe(function (data) {
            acc[storeName] = data;
            save();
        });
    }
    /**
     * @param {?} storeName
     * @param {?} store
     * @param {?} path
     * @return {?}
     */
    function setInitial(storeName, store, path) {
        if (storageState[storeName]) {
            __globalState.setAction({ type: '@PersistState' });
            store.setState(function (state) {
                return setValue(state, path, storageState[storeName]);
            });
            if (store.setDirty) {
                store.setDirty();
            }
        }
    }
    /** @type {?} */
    var subscription = rootDispatcher.subscribe(function (action) {
        if (action.type === 0 /* NEW_STORE */) {
            /** @type {?} */
            var currentStoreName_1 = action.payload["store"].storeName;
            if (hasExclude && exclude.indexOf(currentStoreName_1) > -1 === true) {
                return;
            }
            if (hasInclude) {
                /** @type {?} */
                var path = include.find(function (name) { return name.indexOf(currentStoreName_1) > -1; });
                if (!path) {
                    return;
                }
                else {
                    currentStoreName_1 = path.split('.')[0];
                    setInitial(currentStoreName_1, action.payload["store"], path);
                    subscribe(currentStoreName_1, path);
                }
            }
            else {
                setInitial(currentStoreName_1, action.payload["store"], currentStoreName_1);
                subscribe(currentStoreName_1, currentStoreName_1);
            }
        }
    });
    return {
        destroy: /**
         * @return {?}
         */
        function () {
            subscription.unsubscribe();
            for (var i = 0, keys = Object.keys(stores); i < keys.length; i++) {
                /** @type {?} */
                var storeName = keys[i];
                stores[storeName].unsubscribe();
            }
            stores = {};
        },
        clear: /**
         * @return {?}
         */
        function () {
            storage.clear();
        },
        clearStore: /**
         * @param {?} storeName
         * @return {?}
         */
        function (storeName) {
            /** @type {?} */
            var storageState = deserialize(storage.getItem(key) || '{}');
            if (storageState[storeName]) {
                delete storageState[storeName];
                storage.setItem(key, serialize(storageState));
            }
        }
    };
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/**
 * @param {?=} ngZoneOrOptions
 * @param {?=} options
 * @return {?}
 */
function akitaDevtools(ngZoneOrOptions, options) {
    if (options === void 0) { options = {}; }
    if (!(/** @type {?} */ (window)).__REDUX_DEVTOOLS_EXTENSION__) {
        return;
    }
    /** @type {?} */
    var isAngular = ngZoneOrOptions && ngZoneOrOptions['run'];
    if (!isAngular) {
        ngZoneOrOptions = ngZoneOrOptions || {};
        (/** @type {?} */ (ngZoneOrOptions)).run = function (cb) { return cb(); };
        options = /** @type {?} */ (ngZoneOrOptions);
    }
    /** @type {?} */
    var defaultOptions = { name: 'Akita' };
    /** @type {?} */
    var merged = Object.assign({}, defaultOptions, options);
    /** @type {?} */
    var devTools = (/** @type {?} */ (window)).__REDUX_DEVTOOLS_EXTENSION__.connect(merged);
    /** @type {?} */
    var appState = {};
    rootDispatcher.subscribe(function (action) {
        var _a;
        if (action.type === 1 /* NEW_STATE */) {
            if (__globalState.skipAction) {
                __globalState.setSkipAction(false);
                return;
            }
            appState = __assign({}, appState, (_a = {}, _a[action.payload["name"]] = __stores__[action.payload["name"]]._value(), _a));
            var _b = __globalState.currentAction, type = _b.type, entityId = _b.entityId;
            /** @type {?} */
            var storeName = capitalize(action.payload["name"]);
            /** @type {?} */
            var msg = isDefined(entityId) ? "[" + storeName + "] - " + type + " (ids: " + entityId + ")" : "[" + storeName + "] - " + type;
            if (options.logTrace) {
                console.group(msg);
                console.trace();
                console.groupEnd();
            }
            devTools.send({ type: msg, transaction: __globalState.currentT.map(function (t) { return t.type; }) }, appState);
        }
    });
    devTools.subscribe(function (message) {
        if (message.type === 'ACTION') {
            var _a = __read(message.payload.split('.'), 1), storeName_1 = _a[0];
            if (__stores__[storeName_1]) {
                (/** @type {?} */ (ngZoneOrOptions)).run(function () {
                    /** @type {?} */
                    var funcCall = message.payload.replace(storeName_1, "this['" + storeName_1 + "']");
                    try {
                        new Function("" + funcCall).call(__stores__);
                    }
                    catch (e) {
                        console.warn('Unknown Method ☹️');
                    }
                });
            }
        }
        if (message.type === 'DISPATCH') {
            /** @type {?} */
            var payloadType = message.payload.type;
            if (payloadType === 'COMMIT') {
                devTools.init(appState);
                return;
            }
            if (message.state) {
                /** @type {?} */
                var rootState_1 = JSON.parse(message.state);
                var _loop_1 = function (i, keys) {
                    /** @type {?} */
                    var storeName = keys[i];
                    if (__stores__[storeName]) {
                        (/** @type {?} */ (ngZoneOrOptions)).run(function () {
                            __stores__[storeName].setState(function () { return rootState_1[storeName]; }, false);
                        });
                    }
                };
                for (var i = 0, keys = Object.keys(rootState_1); i < keys.length; i++) {
                    _loop_1(i, keys);
                }
            }
        }
    });
}
/**
 * @param {?} string
 * @return {?}
 */
function capitalize(string) {
    return string && string.charAt(0).toUpperCase() + string.slice(1);
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
var ɵ0 = function (plugin) { return plugin.destroy(); };
/** @type {?} */
var defaultActions = { beforeRemove: ɵ0 };
/**
 * @abstract
 * @template E, P
 */
var  /**
 * @abstract
 * @template E, P
 */
EntityCollectionPlugin = /** @class */ (function () {
    function EntityCollectionPlugin(query, entityIds) {
        this.query = query;
        this.entityIds = entityIds;
        this.entities = new Map();
    }
    /**
     * Get the entity plugin instance.
     */
    /**
     * Get the entity plugin instance.
     * @param {?} id
     * @return {?}
     */
    EntityCollectionPlugin.prototype.getEntity = /**
     * Get the entity plugin instance.
     * @param {?} id
     * @return {?}
     */
    function (id) {
        return this.entities.get(id);
    };
    /**
     * Whether the entity plugin exist.
     */
    /**
     * Whether the entity plugin exist.
     * @param {?} id
     * @return {?}
     */
    EntityCollectionPlugin.prototype.hasEntity = /**
     * Whether the entity plugin exist.
     * @param {?} id
     * @return {?}
     */
    function (id) {
        return this.entities.has(id);
    };
    /**
     * Remove the entity plugin instance.
     */
    /**
     * Remove the entity plugin instance.
     * @param {?} id
     * @return {?}
     */
    EntityCollectionPlugin.prototype.removeEntity = /**
     * Remove the entity plugin instance.
     * @param {?} id
     * @return {?}
     */
    function (id) {
        return this.entities.delete(id);
    };
    /**
     * Set the entity plugin instance.
     */
    /**
     * Set the entity plugin instance.
     * @param {?} id
     * @param {?} plugin
     * @return {?}
     */
    EntityCollectionPlugin.prototype.createEntity = /**
     * Set the entity plugin instance.
     * @param {?} id
     * @param {?} plugin
     * @return {?}
     */
    function (id, plugin) {
        return this.entities.set(id, plugin);
    };
    /**
     * If the user passes `entityIds` we take them; otherwise, we take all.
     */
    /**
     * If the user passes `entityIds` we take them; otherwise, we take all.
     * @return {?}
     */
    EntityCollectionPlugin.prototype.getIds = /**
     * If the user passes `entityIds` we take them; otherwise, we take all.
     * @return {?}
     */
    function () {
        return isUndefined(this.entityIds) ? this.query.getSnapshot().ids : coerceArray(this.entityIds);
    };
    /**
     * When you call one of the plugin methods, you can pass id/ids or undefined which means all.
     */
    /**
     * When you call one of the plugin methods, you can pass id/ids or undefined which means all.
     * @param {?=} ids
     * @return {?}
     */
    EntityCollectionPlugin.prototype.resolvedIds = /**
     * When you call one of the plugin methods, you can pass id/ids or undefined which means all.
     * @param {?=} ids
     * @return {?}
     */
    function (ids) {
        return isUndefined(ids) ? this.getIds() : coerceArray(ids);
    };
    /**
     * Call this method when you want to activate the plugin on init or when you need to listen to add/remove of entities dynamically.
     *
     * For example in your plugin you may do the following:
     *
     * this.query.select(state => state.ids).pipe(skip(1)).subscribe(ids => this.activate(ids));
     */
    /**
     * Call this method when you want to activate the plugin on init or when you need to listen to add/remove of entities dynamically.
     *
     * For example in your plugin you may do the following:
     *
     * this.query.select(state => state.ids).pipe(skip(1)).subscribe(ids => this.activate(ids));
     * @param {?} ids
     * @param {?=} actions
     * @return {?}
     */
    EntityCollectionPlugin.prototype.rebase = /**
     * Call this method when you want to activate the plugin on init or when you need to listen to add/remove of entities dynamically.
     *
     * For example in your plugin you may do the following:
     *
     * this.query.select(state => state.ids).pipe(skip(1)).subscribe(ids => this.activate(ids));
     * @param {?} ids
     * @param {?=} actions
     * @return {?}
     */
    function (ids, actions) {
        var _this = this;
        if (actions === void 0) { actions = defaultActions; }
        /**
             *
             * If the user passes `entityIds` & we have new ids check if we need to add/remove instances.
             *
             * This phase will be called only upon update.
             */
        if (toBoolean(ids)) {
            /**
                   * Which means all
                   */
            if (isUndefined(this.entityIds)) {
                for (var i = 0, len = ids.length; i < len; i++) {
                    /** @type {?} */
                    var entityId = ids[i];
                    if (this.hasEntity(entityId) === false) {
                        isFunction(actions.beforeAdd) && actions.beforeAdd(entityId);
                        /** @type {?} */
                        var plugin = this.instantiatePlugin(entityId);
                        this.entities.set(entityId, plugin);
                        isFunction(actions.afterAdd) && actions.afterAdd(plugin);
                    }
                }
                this.entities.forEach(function (plugin, entityId) {
                    if (ids.indexOf(entityId) === -1) {
                        isFunction(actions.beforeRemove) && actions.beforeRemove(plugin);
                        _this.removeEntity(entityId);
                    }
                });
            }
            else {
                /** *
                 * Which means the user passes specific ids
                  @type {?} */
                var _ids = coerceArray(this.entityIds);
                for (var i = 0, len = _ids.length; i < len; i++) {
                    /** @type {?} */
                    var entityId = _ids[i];
                    /** The Entity in current ids and doesn't exist, add it. */
                    if (ids.indexOf(entityId) > -1 && this.hasEntity(entityId) === false) {
                        isFunction(actions.beforeAdd) && actions.beforeAdd(entityId);
                        /** @type {?} */
                        var plugin = this.instantiatePlugin(entityId);
                        this.entities.set(entityId, plugin);
                        isFunction(actions.afterAdd) && actions.afterAdd(plugin);
                    }
                    else {
                        this.entities.forEach(function (plugin, entityId) {
                            /** The Entity not in current ids and exists, remove it. */
                            if (ids.indexOf(entityId) === -1 && _this.hasEntity(entityId) === true) {
                                isFunction(actions.beforeRemove) && actions.beforeRemove(plugin);
                                _this.removeEntity(entityId);
                            }
                        });
                    }
                }
            }
        }
        else {
            /**
                   * Otherwise, start with the provided ids or all.
                   */
            this.getIds().forEach(function (id) {
                if (!_this.hasEntity(id))
                    _this.createEntity(id, _this.instantiatePlugin(id));
            });
        }
    };
    /**
     * Listen for add/remove entities.
     */
    /**
     * Listen for add/remove entities.
     * @return {?}
     */
    EntityCollectionPlugin.prototype.selectIds = /**
     * Listen for add/remove entities.
     * @return {?}
     */
    function () {
        return this.query.select(function (state) { return state.ids; });
    };
    /**
     * Base method for activation, you can override it if you need to.
     */
    /**
     * Base method for activation, you can override it if you need to.
     * @param {?=} ids
     * @return {?}
     */
    EntityCollectionPlugin.prototype.activate = /**
     * Base method for activation, you can override it if you need to.
     * @param {?=} ids
     * @return {?}
     */
    function (ids) {
        this.rebase(ids);
    };
    /**
     * Loop over each id and invoke the plugin method.
     */
    /**
     * Loop over each id and invoke the plugin method.
     * @param {?} ids
     * @param {?} cb
     * @return {?}
     */
    EntityCollectionPlugin.prototype.forEachId = /**
     * Loop over each id and invoke the plugin method.
     * @param {?} ids
     * @param {?} cb
     * @return {?}
     */
    function (ids, cb) {
        /** @type {?} */
        var _ids = this.resolvedIds(ids);
        for (var i = 0, len = _ids.length; i < len; i++) {
            /** @type {?} */
            var id = _ids[i];
            if (this.hasEntity(id)) {
                cb(this.getEntity(id));
            }
        }
    };
    return EntityCollectionPlugin;
}());

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/**
 * @template E, S
 */
var  /**
 * @template E, S
 */
StateHistoryPlugin = /** @class */ (function (_super) {
    __extends(StateHistoryPlugin, _super);
    function StateHistoryPlugin(query, params, _entityId) {
        if (params === void 0) { params = {}; }
        var _this = _super.call(this, query) || this;
        _this.query = query;
        _this.params = params;
        _this._entityId = _entityId;
        /**
         * Allow skipping an update from outside
         */
        _this.skip = false;
        _this.history = {
            past: [],
            present: null,
            future: []
        };
        /**
         * Skip the update when redo/undo
         */
        _this.skipUpdate = false;
        params.maxAge = toBoolean(params.maxAge) ? params.maxAge : 10;
        _this.activate();
        return _this;
    }
    Object.defineProperty(StateHistoryPlugin.prototype, "hasPast", {
        get: /**
         * @return {?}
         */
        function () {
            return this.history.past.length > 0;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StateHistoryPlugin.prototype, "hasFuture", {
        get: /**
         * @return {?}
         */
        function () {
            return this.history.future.length > 0;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    StateHistoryPlugin.prototype.activate = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.history.present = this.getSource(this._entityId);
        this.subscription = this.selectSource(this._entityId)
            .pipe(pairwise())
            .subscribe(function (_a) {
            var _b = __read(_a, 2), past = _b[0], present = _b[1];
            if (_this.skip) {
                _this.skip = false;
                return;
            }
            if (!_this.skipUpdate) {
                if (_this.history.past.length === _this.params.maxAge) {
                    _this.history.past = _this.history.past.slice(1);
                }
                _this.history.past = __spread(_this.history.past, [past]);
                _this.history.present = present;
            }
        });
    };
    /**
     * @return {?}
     */
    StateHistoryPlugin.prototype.undo = /**
     * @return {?}
     */
    function () {
        if (this.history.past.length > 0) {
            var _a = this.history, past = _a.past, present = _a.present, future = _a.future;
            /** @type {?} */
            var previous = past[past.length - 1];
            /** @type {?} */
            var newPast = past.slice(0, past.length - 1);
            this.history.past = newPast;
            this.history.present = previous;
            this.history.future = __spread([present], this.history.future);
            this.update();
        }
    };
    /**
     * @return {?}
     */
    StateHistoryPlugin.prototype.redo = /**
     * @return {?}
     */
    function () {
        if (this.history.future.length > 0) {
            var _a = this.history, past = _a.past, present = _a.present, future = _a.future;
            /** @type {?} */
            var next = this.history.future[0];
            /** @type {?} */
            var newFuture = this.history.future.slice(1);
            this.history.past = __spread(past, [present]);
            this.history.present = next;
            this.history.future = newFuture;
            this.update('Redo');
        }
    };
    /**
     * @param {?} index
     * @return {?}
     */
    StateHistoryPlugin.prototype.jumpToPast = /**
     * @param {?} index
     * @return {?}
     */
    function (index) {
        if (index < 0 || index >= this.history.past.length)
            return;
        var _a = this.history, past = _a.past, future = _a.future;
        /** *
         *
         * const past = [1, 2, 3, 4, 5];
         *
         * newPast = past.slice(0, 2) = [1, 2];
         * present = past[index] = 3;
         * [...past.slice(2 + 1), ...future] = [4, 5];
         *
          @type {?} */
        var newPast = past.slice(0, index);
        /** @type {?} */
        var newFuture = __spread(past.slice(index + 1), future);
        /** @type {?} */
        var newPresent = past[index];
        this.history.past = newPast;
        this.history.present = newPresent;
        this.history.future = newFuture;
        this.update();
    };
    /**
     * @param {?} index
     * @return {?}
     */
    StateHistoryPlugin.prototype.jumpToFuture = /**
     * @param {?} index
     * @return {?}
     */
    function (index) {
        if (index < 0 || index >= this.history.future.length)
            return;
        var _a = this.history, past = _a.past, future = _a.future;
        /** @type {?} */
        var newPast = __spread(past, future.slice(0, index));
        /** @type {?} */
        var newPresent = future[index];
        /** @type {?} */
        var newFuture = future.slice(index + 1);
        this.history.past = newPast;
        this.history.present = newPresent;
        this.history.future = newFuture;
        this.update('Redo');
    };
    /**
     * @return {?}
     */
    StateHistoryPlugin.prototype.clear = /**
     * @return {?}
     */
    function () {
        this.history = {
            past: [],
            present: null,
            future: []
        };
    };
    /**
     * @param {?=} clearHistory
     * @return {?}
     */
    StateHistoryPlugin.prototype.destroy = /**
     * @param {?=} clearHistory
     * @return {?}
     */
    function (clearHistory) {
        if (clearHistory === void 0) { clearHistory = false; }
        if (clearHistory) {
            this.clear();
        }
        this.subscription.unsubscribe();
    };
    /**
     * @return {?}
     */
    StateHistoryPlugin.prototype.ignoreNext = /**
     * @return {?}
     */
    function () {
        this.skip = true;
    };
    /**
     * @param {?=} action
     * @return {?}
     */
    StateHistoryPlugin.prototype.update = /**
     * @param {?=} action
     * @return {?}
     */
    function (action) {
        if (action === void 0) { action = 'Undo'; }
        this.skipUpdate = true;
        __globalState.setCustomAction({ type: "@StateHistory - " + action });
        this.updateStore(this.history.present, this._entityId);
        this.skipUpdate = false;
    };
    return StateHistoryPlugin;
}(AkitaPlugin));

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
// unsupported: template constraints.
/**
 * @template E, P
 */
var  
// unsupported: template constraints.
/**
 * @template E, P
 */
EntityStateHistoryPlugin = /** @class */ (function (_super) {
    __extends(EntityStateHistoryPlugin, _super);
    function EntityStateHistoryPlugin(query, params) {
        if (params === void 0) { params = {}; }
        var _this = _super.call(this, query, params.entityIds) || this;
        _this.query = query;
        _this.params = params;
        params.maxAge = toBoolean(params.maxAge) ? params.maxAge : 10;
        _this.activate();
        _this.selectIds()
            .pipe(skip(1))
            .subscribe(function (ids) { return _this.activate(ids); });
        return _this;
    }
    /**
     * @param {?=} ids
     * @return {?}
     */
    EntityStateHistoryPlugin.prototype.redo = /**
     * @param {?=} ids
     * @return {?}
     */
    function (ids) {
        this.forEachId(ids, function (e) { return e.redo(); });
    };
    /**
     * @param {?=} ids
     * @return {?}
     */
    EntityStateHistoryPlugin.prototype.undo = /**
     * @param {?=} ids
     * @return {?}
     */
    function (ids) {
        this.forEachId(ids, function (e) { return e.undo(); });
    };
    /**
     * @param {?} id
     * @return {?}
     */
    EntityStateHistoryPlugin.prototype.hasPast = /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        if (this.hasEntity(id)) {
            return this.getEntity(id).hasPast;
        }
    };
    /**
     * @param {?} id
     * @return {?}
     */
    EntityStateHistoryPlugin.prototype.hasFuture = /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        if (this.hasEntity(id)) {
            return this.getEntity(id).hasFuture;
        }
    };
    /**
     * @param {?} ids
     * @param {?} index
     * @return {?}
     */
    EntityStateHistoryPlugin.prototype.jumpToFuture = /**
     * @param {?} ids
     * @param {?} index
     * @return {?}
     */
    function (ids, index) {
        this.forEachId(ids, function (e) { return e.jumpToFuture(index); });
    };
    /**
     * @param {?} ids
     * @param {?} index
     * @return {?}
     */
    EntityStateHistoryPlugin.prototype.jumpToPast = /**
     * @param {?} ids
     * @param {?} index
     * @return {?}
     */
    function (ids, index) {
        this.forEachId(ids, function (e) { return e.jumpToPast(index); });
    };
    /**
     * @param {?=} ids
     * @return {?}
     */
    EntityStateHistoryPlugin.prototype.clear = /**
     * @param {?=} ids
     * @return {?}
     */
    function (ids) {
        this.forEachId(ids, function (e) { return e.clear(); });
    };
    /**
     * @param {?=} ids
     * @param {?=} clearHistory
     * @return {?}
     */
    EntityStateHistoryPlugin.prototype.destroy = /**
     * @param {?=} ids
     * @param {?=} clearHistory
     * @return {?}
     */
    function (ids, clearHistory) {
        if (clearHistory === void 0) { clearHistory = false; }
        this.forEachId(ids, function (e) { return e.destroy(clearHistory); });
    };
    /**
     * @param {?} id
     * @return {?}
     */
    EntityStateHistoryPlugin.prototype.instantiatePlugin = /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        return /** @type {?} */ (new StateHistoryPlugin(this.query, this.params, id));
    };
    return EntityStateHistoryPlugin;
}(EntityCollectionPlugin));

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/** @type {?} */
var dirtyCheckDefaultParams = {
    comparator: function (head, current) { return JSON.stringify(head) !== JSON.stringify(current); }
};
/**
 * @template Entity, StoreState
 */
var  /**
 * @template Entity, StoreState
 */
DirtyCheckPlugin = /** @class */ (function (_super) {
    __extends(DirtyCheckPlugin, _super);
    function DirtyCheckPlugin(query, params, _entityId) {
        var _this = _super.call(this, query) || this;
        _this.query = query;
        _this.params = params;
        _this._entityId = _entityId;
        _this.dirty = new BehaviorSubject(false);
        _this.active = false;
        _this.isDirty$ = _this.dirty.asObservable().pipe(distinctUntilChanged());
        _this.params = __assign({}, dirtyCheckDefaultParams, params);
        if (_this.params.watchProperty) {
            /** @type {?} */
            var watchProp = _this.params.watchProperty;
            watchProp = coerceArray(watchProp);
            if (watchProp.includes('entities') && !watchProp.includes('ids') && query instanceof QueryEntity) {
                watchProp.push('ids');
            }
            _this.params.watchProperty = watchProp;
        }
        return _this;
    }
    /**
     * @return {?}
     */
    DirtyCheckPlugin.prototype.getHead = /**
     * @return {?}
     */
    function () {
        return this.head;
    };
    /**
     * @return {?}
     */
    DirtyCheckPlugin.prototype.activate = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.head = this._getHead();
        /** *
         * if we are tracking specific properties select only the relevant ones
          @type {?} */
        var source = this.params.watchProperty
            ? (/** @type {?} */ (this.params.watchProperty)).map(function (prop) { return _this.query.select(function (state) { return state[prop]; }).pipe(map(function (val) { return ({ val: val, __akitaKey: prop }); })); })
            : [this.selectSource(this._entityId)];
        this.subscription = merge.apply(void 0, __spread(source)).pipe(skip(1))
            .subscribe(function (currentState) {
            if (isUndefined(_this.head))
                return;
            /** *
             * __akitaKey is used to determine if we are tracking a specific property or a store change
              @type {?} */
            var head = currentState.__akitaKey ? _this.head[/** @type {?} */ (currentState.__akitaKey)] : _this.head;
            /** @type {?} */
            var compareTo = currentState.__akitaKey ? currentState.val : currentState;
            /** @type {?} */
            var isChange = _this.params.comparator(head, compareTo);
            _this.updateDirtiness(isChange);
        });
    };
    /**
     * @param {?=} params
     * @return {?}
     */
    DirtyCheckPlugin.prototype.reset = /**
     * @param {?=} params
     * @return {?}
     */
    function (params) {
        if (params === void 0) { params = {}; }
        /** @type {?} */
        var currentValue = this.head;
        if (isFunction(params.updateFn)) {
            if (this.isEntityBased(this._entityId)) {
                currentValue = params.updateFn(this.head, (/** @type {?} */ (this.getQuery())).getEntity(this._entityId));
            }
            else {
                currentValue = params.updateFn(this.head, (/** @type {?} */ (this.getQuery())).getSnapshot());
            }
        }
        /** *
         * If we are watching specific props compare them, if not compare the entire store
          @type {?} */
        var update = this.params.watchProperty ? this.compareProp(currentValue) : this._getHead() !== currentValue;
        if (update) {
            __globalState.setCustomAction({ type: "@DirtyCheck - Revert" });
            this.updateStore(currentValue, this._entityId);
        }
    };
    /**
     * @return {?}
     */
    DirtyCheckPlugin.prototype.setHead = /**
     * @return {?}
     */
    function () {
        if (!this.active) {
            this.activate();
            this.active = true;
        }
        else {
            this.head = this._getHead();
        }
        this.updateDirtiness(false);
        return this;
    };
    /**
     * @return {?}
     */
    DirtyCheckPlugin.prototype.isDirty = /**
     * @return {?}
     */
    function () {
        return toBoolean(this.dirty.value);
    };
    /**
     * @return {?}
     */
    DirtyCheckPlugin.prototype.hasHead = /**
     * @return {?}
     */
    function () {
        return toBoolean(this.getHead());
    };
    /**
     * @return {?}
     */
    DirtyCheckPlugin.prototype.destroy = /**
     * @return {?}
     */
    function () {
        this.head = null;
        this.subscription && this.subscription.unsubscribe();
    };
    /**
     * @param {?} isDirty
     * @return {?}
     */
    DirtyCheckPlugin.prototype.updateDirtiness = /**
     * @param {?} isDirty
     * @return {?}
     */
    function (isDirty) {
        this.dirty.next(isDirty);
    };
    /**
     * @return {?}
     */
    DirtyCheckPlugin.prototype._getHead = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var head = /** @type {?} */ (this.getSource(this._entityId));
        if (this.params.watchProperty) {
            head = (/** @type {?} */ (this.params.watchProperty)).reduce(function (_head, prop) {
                _head[prop] = (/** @type {?} */ (head))[prop];
                return _head;
            }, /** @type {?} */ ({}));
        }
        return head;
    };
    /**
     * @param {?} currentState
     * @return {?}
     */
    DirtyCheckPlugin.prototype.compareProp = /**
     * @param {?} currentState
     * @return {?}
     */
    function (currentState) {
        /** @type {?} */
        var propKeys = Object.keys(currentState);
        /** @type {?} */
        var head = this._getHead();
        return propKeys.some(function (propKey) { return currentState[propKey] !== head[propKey]; });
    };
    return DirtyCheckPlugin;
}(AkitaPlugin));

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
// unsupported: template constraints.
/**
 * @template E, P
 */
var  
// unsupported: template constraints.
/**
 * @template E, P
 */
EntityDirtyCheckPlugin = /** @class */ (function (_super) {
    __extends(EntityDirtyCheckPlugin, _super);
    function EntityDirtyCheckPlugin(query, params) {
        if (params === void 0) { params = {}; }
        var _this = _super.call(this, query, params.entityIds) || this;
        _this.query = query;
        _this.params = params;
        _this.isSomeDirty$ = _this.query.select(function (state) { return state.entities; })
            .pipe(map(function (entities) { return _this.checkSomeDirty(entities); }));
        _this.params = __assign({}, dirtyCheckDefaultParams, params);
        _this.activate();
        _this.selectIds().pipe(skip(1)).subscribe(function (ids) {
            _this.rebase(ids, { afterAdd: function (plugin) { return plugin.setHead(); } });
        });
        return _this;
    }
    /**
     * @param {?=} ids
     * @return {?}
     */
    EntityDirtyCheckPlugin.prototype.setHead = /**
     * @param {?=} ids
     * @return {?}
     */
    function (ids) {
        this.forEachId(ids, function (e) { return e.setHead(); });
        return this;
    };
    /**
     * @param {?} id
     * @return {?}
     */
    EntityDirtyCheckPlugin.prototype.hasHead = /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        if (this.entities.has(id)) {
            /** @type {?} */
            var entity = this.getEntity(id);
            return entity.hasHead();
        }
        return false;
    };
    /**
     * @param {?=} ids
     * @param {?=} params
     * @return {?}
     */
    EntityDirtyCheckPlugin.prototype.reset = /**
     * @param {?=} ids
     * @param {?=} params
     * @return {?}
     */
    function (ids, params) {
        if (params === void 0) { params = {}; }
        this.forEachId(ids, function (e) { return e.reset(params); });
    };
    /**
     * @param {?} id
     * @param {?=} asObservable
     * @return {?}
     */
    EntityDirtyCheckPlugin.prototype.isDirty = /**
     * @param {?} id
     * @param {?=} asObservable
     * @return {?}
     */
    function (id, asObservable) {
        if (asObservable === void 0) { asObservable = true; }
        if (this.entities.has(id)) {
            /** @type {?} */
            var entity = this.getEntity(id);
            return asObservable ? entity.isDirty$ : entity.isDirty();
        }
        return false;
    };
    /**
     * @return {?}
     */
    EntityDirtyCheckPlugin.prototype.isSomeDirty = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var entities = this.query.getAll({ asObject: true });
        return this.checkSomeDirty(entities);
    };
    /**
     * @param {?=} ids
     * @return {?}
     */
    EntityDirtyCheckPlugin.prototype.destroy = /**
     * @param {?=} ids
     * @return {?}
     */
    function (ids) {
        this.forEachId(ids, function (e) { return e.destroy(); });
    };
    /**
     * @param {?} id
     * @return {?}
     */
    EntityDirtyCheckPlugin.prototype.instantiatePlugin = /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        return /** @type {?} */ (new DirtyCheckPlugin(this.query, this.params, id));
    };
    /**
     * @param {?} entities
     * @return {?}
     */
    EntityDirtyCheckPlugin.prototype.checkSomeDirty = /**
     * @param {?} entities
     * @return {?}
     */
    function (entities) {
        var e_1, _a;
        /** @type {?} */
        var entitiesIds = this.resolvedIds();
        try {
            for (var entitiesIds_1 = __values(entitiesIds), entitiesIds_1_1 = entitiesIds_1.next(); !entitiesIds_1_1.done; entitiesIds_1_1 = entitiesIds_1.next()) {
                var id = entitiesIds_1_1.value;
                /** @type {?} */
                var dirty = this.params.comparator((/** @type {?} */ (this.getEntity(id))).getHead(), entities[id]);
                if (dirty) {
                    return true;
                }
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (entitiesIds_1_1 && !entitiesIds_1_1.done && (_a = entitiesIds_1.return)) _a.call(entitiesIds_1);
            }
            finally { if (e_1) throw e_1.error; }
        }
        return false;
    };
    return EntityDirtyCheckPlugin;
}(EntityCollectionPlugin));

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/**
 * \@example
 *
 * this.peopleStore.update(id, person => ({
 *   guests: increment(person.guests)
 * }));
 * @param {?} value
 * @param {?=} params
 * @return {?}
 */
function increment(value, params) {
    if (params === void 0) { params = { maxValue: undefined }; }
    if (isNumber(value) === false)
        return;
    if (params.maxValue && value === params.maxValue)
        return value;
    return value + 1;
}
/**
 * \@example
 *
 * this.peopleStore.update(id, person => ({
 *   guests: decrement(person.guests)
 * }));
 * @param {?} value
 * @param {?=} params
 * @return {?}
 */
function decrement(value, params) {
    if (params === void 0) { params = { allowNegative: false }; }
    if (isNumber(value) === false)
        return;
    if (params.allowNegative === false && value === 0) {
        return value;
    }
    return value - 1;
}
/**
 * Generate random guid
 * @return {?}
 */
function guid() {
    return 'xxxxxx4xyx'.replace(/[xy]/g, function (c) {
        /** @type {?} */
        var r = (Math.random() * 16) | 0;
        /** @type {?} */
        var v = c == 'x' ? r : (r & 0x3) | 0x8;
        return v.toString(16);
    });
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */

export { __globalState, EntityStore, getInitialEntitiesState, getInitialActiveState, QueryEntity, Query, enableAkitaProdMode, isDev, __stores__, rootDispatcher, Store, applyTransaction, transaction, push, remove, pop, unshift, sort, reverse, swap, update, splice, toggle, filterNil, coerceArray, isObject, isPlainObject, isFunction, toBoolean, isUndefined, entityExists, noop, isObservable, isString, isNumber, isDefined, resetActive, isActiveState, setValue, getValue, applyAction, action, mapInWorker, memoizeOne, SnapshotManager, snapshotManager, StoreConfig, configKey, QueryConfig, queryConfigKey, compareValues, Order, AkitaPlugin, PaginatorPlugin, Paginator, PersistNgFormPlugin, persistState, akitaDevtools, EntityCollectionPlugin, StateHistoryPlugin, EntityStateHistoryPlugin, dirtyCheckDefaultParams, DirtyCheckPlugin, EntityDirtyCheckPlugin, increment, decrement, guid, AkitaGlobals as ɵa };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0b3JhbWEtYWtpdGEuanMubWFwIiwic291cmNlcyI6WyJuZzovL0BkYXRvcmFtYS9ha2l0YS9zcmMvaW50ZXJuYWwvdXRpbHMudHMiLCJuZzovL0BkYXRvcmFtYS9ha2l0YS9zcmMvaW50ZXJuYWwvZXJyb3IudHMiLCJuZzovL0BkYXRvcmFtYS9ha2l0YS9zcmMvaW50ZXJuYWwvY3J1ZC50cyIsIm5nOi8vQGRhdG9yYW1hL2FraXRhL3NyYy9pbnRlcm5hbC9nbG9iYWwtc3RhdGUudHMiLCJuZzovL0BkYXRvcmFtYS9ha2l0YS9zcmMvaW50ZXJuYWwvdHJhbnNhY3Rpb24uaW50ZXJuYWwudHMiLCJuZzovL0BkYXRvcmFtYS9ha2l0YS9zcmMvaW50ZXJuYWwvZGVlcC1mcmVlemUudHMiLCJuZzovL0BkYXRvcmFtYS9ha2l0YS9zcmMvYXBpL3N0b3JlLWNvbmZpZy50cyIsIm5nOi8vQGRhdG9yYW1hL2FraXRhL3NyYy9hcGkvc3RvcmUudHMiLCJuZzovL0BkYXRvcmFtYS9ha2l0YS9zcmMvYXBpL2VudGl0eS1zdG9yZS50cyIsIm5nOi8vQGRhdG9yYW1hL2FraXRhL3NyYy9pbnRlcm5hbC9zb3J0LnRzIiwibmc6Ly9AZGF0b3JhbWEvYWtpdGEvc3JjL2FwaS9tZW1vaXplLnRzIiwibmc6Ly9AZGF0b3JhbWEvYWtpdGEvc3JjL2FwaS9xdWVyeS1jb25maWcudHMiLCJuZzovL0BkYXRvcmFtYS9ha2l0YS9zcmMvYXBpL3F1ZXJ5LnRzIiwibmc6Ly9AZGF0b3JhbWEvYWtpdGEvc3JjL2FwaS9xdWVyeS1lbnRpdHkudHMiLCJuZzovL0BkYXRvcmFtYS9ha2l0YS9zcmMvYXBpL3RyYW5zYWN0aW9uLnRzIiwibmc6Ly9AZGF0b3JhbWEvYWtpdGEvc3JjL2FwaS9hcnJheXMudHMiLCJuZzovL0BkYXRvcmFtYS9ha2l0YS9zcmMvYXBpL29wZXJhdG9ycy50cyIsIm5nOi8vQGRhdG9yYW1hL2FraXRhL3NyYy9pbnRlcm5hbC9hY3Rpb24udHMiLCJuZzovL0BkYXRvcmFtYS9ha2l0YS9zcmMvYXBpL3dvcmtlci50cyIsIm5nOi8vQGRhdG9yYW1hL2FraXRhL3NyYy9hcGkvc25hcHNob3QtbWFuYWdlci50cyIsIm5nOi8vQGRhdG9yYW1hL2FraXRhL3NyYy9wbHVnaW5zL3BsdWdpbi50cyIsIm5nOi8vQGRhdG9yYW1hL2FraXRhL3NyYy9wbHVnaW5zL3BhZ2luYXRvci9wYWdpbmF0b3ItcGx1Z2luLnRzIiwibmc6Ly9AZGF0b3JhbWEvYWtpdGEvc3JjL3BsdWdpbnMvcGVyc2lzdC1mb3JtL3BlcnNpc3QtbmctZm9ybS1wbHVnaW4udHMiLCJuZzovL0BkYXRvcmFtYS9ha2l0YS9zcmMvZW5oYW5jZXJzL3BlcnNpc3Qtc3RhdGUudHMiLCJuZzovL0BkYXRvcmFtYS9ha2l0YS9zcmMvZW5oYW5jZXJzL2RldnRvb2xzLnRzIiwibmc6Ly9AZGF0b3JhbWEvYWtpdGEvc3JjL3BsdWdpbnMvZW50aXR5LWNvbGxlY3Rpb24tcGx1Z2luLnRzIiwibmc6Ly9AZGF0b3JhbWEvYWtpdGEvc3JjL3BsdWdpbnMvc3RhdGUtaGlzdG9yeS9zdGF0ZS1oaXN0b3J5LXBsdWdpbi50cyIsIm5nOi8vQGRhdG9yYW1hL2FraXRhL3NyYy9wbHVnaW5zL3N0YXRlLWhpc3RvcnkvZW50aXR5LXN0YXRlLWhpc3RvcnktcGx1Z2luLnRzIiwibmc6Ly9AZGF0b3JhbWEvYWtpdGEvc3JjL3BsdWdpbnMvZGlydHktY2hlY2svZGlydHktY2hlY2stcGx1Z2luLnRzIiwibmc6Ly9AZGF0b3JhbWEvYWtpdGEvc3JjL3BsdWdpbnMvZGlydHktY2hlY2svZW50aXR5LWRpcnR5LWNoZWNrLXBsdWdpbi50cyIsIm5nOi8vQGRhdG9yYW1hL2FraXRhL3NyYy9hcGkvc3RvcmUtdXRpbHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgQWN0aXZlU3RhdGUsIEVudGl0eVN0YXRlLCBIYXNoTWFwLCBJRCB9IGZyb20gJy4uL2FwaS90eXBlcyc7XG5cbi8qKiBXcmFwcyB0aGUgcHJvdmlkZWQgdmFsdWUgaW4gYW4gYXJyYXksIHVubGVzcyB0aGUgcHJvdmlkZWQgX3ZhbHVlIGlzIGFuIGFycmF5LiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNvZXJjZUFycmF5PFQ+KHZhbHVlOiBUIHwgVFtdKTogVFtdIHtcbiAgcmV0dXJuIEFycmF5LmlzQXJyYXkodmFsdWUpID8gdmFsdWUgOiBbdmFsdWVdO1xufVxuXG4vKiogQ2hlY2sgaWYgYSB2YWx1ZSBpcyBhbiBvYmplY3QgKi9cbmV4cG9ydCBmdW5jdGlvbiBpc09iamVjdCh2YWx1ZTogYW55KSB7XG4gIHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodmFsdWUpID09PSAnW29iamVjdCBPYmplY3RdJztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzUGxhaW5PYmplY3QodmFsdWUpIHtcbiAgcmV0dXJuIHRvQm9vbGVhbih2YWx1ZSkgJiYgdmFsdWUuY29uc3RydWN0b3IubmFtZSA9PT0gJ09iamVjdCc7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0Z1bmN0aW9uKHZhbHVlKTogdmFsdWUgaXMgRnVuY3Rpb24ge1xuICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdG9Cb29sZWFuKHZhbHVlOiBhbnkpOiBib29sZWFuIHtcbiAgcmV0dXJuIHZhbHVlICE9IG51bGwgJiYgYCR7dmFsdWV9YCAhPT0gJ2ZhbHNlJztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzVW5kZWZpbmVkKHZhbHVlKSB7XG4gIHJldHVybiB0eXBlb2YgdmFsdWUgPT09ICd1bmRlZmluZWQnO1xufVxuXG4vKipcbiAqIENoZWNrIGlmIGVudGl0eSBleGlzdHNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGVudGl0eUV4aXN0czxFPihpZDogSUQsIGVudGl0aWVzOiBIYXNoTWFwPEU+KSB7XG4gIHJldHVybiBlbnRpdGllcy5oYXNPd25Qcm9wZXJ0eShpZCk7XG59XG5cbi8qKlxuICogT2JzZXJ2YWJsZSB0aGF0IGVtaXRzIGVtcHR5IHZhbHVlIGFuZCBjb21wbGV0ZVxuICovXG5leHBvcnQgZnVuY3Rpb24gbm9vcDxUPigpOiBPYnNlcnZhYmxlPFQ+IHtcbiAgcmV0dXJuIG5ldyBPYnNlcnZhYmxlKG9ic2VydmVyID0+IHtcbiAgICBvYnNlcnZlci5uZXh0KCk7XG4gICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcbiAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc09ic2VydmFibGUodmFsdWUpIHtcbiAgcmV0dXJuIHRvQm9vbGVhbih2YWx1ZSkgJiYgaXNGdW5jdGlvbih2YWx1ZS5zdWJzY3JpYmUpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNTdHJpbmcodmFsOiBzdHJpbmcgfCBhbnkpOiB2YWwgaXMgc3RyaW5nIHtcbiAgcmV0dXJuIHR5cGVvZiB2YWwgPT09ICdzdHJpbmcnO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNOdW1iZXIodmFsdWUpIHtcbiAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcic7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0RlZmluZWQodmFsKSB7XG4gIHJldHVybiB2YWwgIT09IG51bGwgJiYgdHlwZW9mIHZhbCAhPT0gJ3VuZGVmaW5lZCc7XG59XG5cbi8qKlxuICogQ2hlY2sgaWYgdGhlIGFjdGl2ZSBlbnRpdHkgZXhpc3RcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlc2V0QWN0aXZlPEU+KHN0YXRlOiBFbnRpdHlTdGF0ZTxFPikge1xuICByZXR1cm4gaXNBY3RpdmVTdGF0ZShzdGF0ZSkgJiYgZW50aXR5RXhpc3RzKChzdGF0ZSBhcyBBY3RpdmVTdGF0ZSkuYWN0aXZlLCBzdGF0ZS5lbnRpdGllcykgPT09IGZhbHNlO1xufVxuXG4vKipcbiAqIENoZWNrIGlmIHRoZSBzdG9yZSBzdXBwb3J0cyBhY3RpdmUgZW50aXR5XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc0FjdGl2ZVN0YXRlPEU+KHN0YXRlOiBFbnRpdHlTdGF0ZTxFPikge1xuICByZXR1cm4gKHN0YXRlIGFzIEFjdGl2ZVN0YXRlKS5oYXNPd25Qcm9wZXJ0eSgnYWN0aXZlJyk7XG59XG5cbi8qKlxuICogc2V0VmFsdWUoc3RhdGUsICd0b2Rvcy51aScsIHsgZmlsdGVyOiB7fX0pXG4gKi9cbmV4cG9ydCBjb25zdCBzZXRWYWx1ZSA9IChvYmo6IGFueSwgcHJvcDogc3RyaW5nLCB2YWw6IGFueSkgPT4ge1xuICBjb25zdCBzcGxpdCA9IHByb3Auc3BsaXQoJy4nKTtcblxuICBpZiAoc3BsaXQubGVuZ3RoID09PSAxKSByZXR1cm4gdmFsO1xuXG4gIG9iaiA9IHsgLi4ub2JqIH07XG5cbiAgY29uc3QgbGFzdEluZGV4ID0gc3BsaXQubGVuZ3RoIC0gMjtcbiAgY29uc3QgcmVtb3ZlU3RvcmVOYW1lID0gcHJvcC5zcGxpdCgnLicpLnNsaWNlKDEpO1xuXG4gIHJlbW92ZVN0b3JlTmFtZS5yZWR1Y2UoKGFjYywgcGFydCwgaW5kZXgpID0+IHtcbiAgICBpZiAoaW5kZXggPT09IGxhc3RJbmRleCkge1xuICAgICAgYWNjW3BhcnRdID0gdmFsO1xuICAgIH0gZWxzZSB7XG4gICAgICBhY2NbcGFydF0gPSB7IC4uLmFjY1twYXJ0XSB9O1xuICAgIH1cblxuICAgIHJldHVybiBhY2MgJiYgYWNjW3BhcnRdO1xuICB9LCBvYmopO1xuXG4gIHJldHVybiBvYmo7XG59O1xuXG4vKipcbiAqIGdldFZhbHVlKHN0YXRlLCAndG9kb3MudWknKVxuICovXG5leHBvcnQgY29uc3QgZ2V0VmFsdWUgPSAob2JqOiBhbnksIHByb3A6IHN0cmluZykgPT4ge1xuICAvKiogcmV0dXJuIHRoZSB3aG9sZSBzdGF0ZSAgKi9cbiAgaWYgKHByb3Auc3BsaXQoJy4nKS5sZW5ndGggPT09IDEpIHtcbiAgICByZXR1cm4gb2JqO1xuICB9XG4gIGNvbnN0IHJlbW92ZVN0b3JlTmFtZSA9IHByb3BcbiAgICAuc3BsaXQoJy4nKVxuICAgIC5zbGljZSgxKVxuICAgIC5qb2luKCcuJyk7XG4gIHJldHVybiByZW1vdmVTdG9yZU5hbWUuc3BsaXQoJy4nKS5yZWR1Y2UoKGFjYzogYW55LCBwYXJ0OiBzdHJpbmcpID0+IGFjYyAmJiBhY2NbcGFydF0sIG9iaik7XG59O1xuIiwiaW1wb3J0IHsgZW50aXR5RXhpc3RzLCBpc09iamVjdCwgdG9Cb29sZWFuIH0gZnJvbSAnLi91dGlscyc7XG5pbXBvcnQgeyBFbnRpdHlTdGF0ZSwgSUQgfSBmcm9tICcuLi9hcGkvdHlwZXMnO1xuXG5leHBvcnQgY2xhc3MgQWtpdGFFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgY29uc3RydWN0b3IobWVzc2FnZTogc3RyaW5nKSB7XG4gICAgc3VwZXIobWVzc2FnZSk7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIEFraXRhSW1tdXRhYmlsaXR5RXJyb3IgZXh0ZW5kcyBBa2l0YUVycm9yIHtcbiAgY29uc3RydWN0b3Ioc3RvcmVOYW1lKSB7XG4gICAgc3VwZXIoYFRoZSBuZXcgc3RhdGUgc2hvdWxkIGJlIGltbXV0YWJsZS4gTWFrZSBzdXJlIHRvIHJldHVybiBhIG5ldyBpbW11dGFibGUgc3RhdGUuIFxcbiBzdG9yZTogXFxuICR7c3RvcmVOYW1lfWApO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBBa2l0YUVudGl0eU5vdEV4aXN0c0Vycm9yIGV4dGVuZHMgQWtpdGFFcnJvciB7XG4gIGNvbnN0cnVjdG9yKGlkKSB7XG4gICAgc3VwZXIoYEVudGl0eSAke2lkfSBkb2VzIG5vdCBleGlzdHNgKTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgQWtpdGFOb0FjdGl2ZUVycm9yIGV4dGVuZHMgQWtpdGFFcnJvciB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKGBBY3RpdmUgaXMgbnVsbC91bmRlZmluZWRgKTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgQWtpdGFJbnZhbGlkRW50aXR5U3RhdGUgZXh0ZW5kcyBBa2l0YUVycm9yIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoYEVudGl0eSBzdGF0ZSBpcyBpbnZhbGlkYCk7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIEFraXRhVXBkYXRlSWRLZXlFcnJvciBleHRlbmRzIEFraXRhRXJyb3Ige1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlcihgVXBkYXRpbmcgZW50aXR5IGlkIGlzIG5vdCBwZXJtaXR0ZWQgd2hlbiB1cGRhdGluZyBtYW55IGVudGl0aWVzYCk7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGFzc2VydEVudGl0eUV4aXN0cyhpZDogSUQsIGVudGl0aWVzKSB7XG4gIGlmICghZW50aXR5RXhpc3RzKGlkLCBlbnRpdGllcykpIHtcbiAgICB0aHJvdyBuZXcgQWtpdGFFbnRpdHlOb3RFeGlzdHNFcnJvcihpZCk7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGFzc2VydEFjdGl2ZShzdG9yZSkge1xuICBpZiAoIXRvQm9vbGVhbihzdG9yZS5hY3RpdmUpKSB7XG4gICAgdGhyb3cgbmV3IEFraXRhTm9BY3RpdmVFcnJvcigpO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhc3NlcnRFbnRpdHlTdGF0ZShzdGF0ZTogRW50aXR5U3RhdGU8YW55Pikge1xuICBjb25zdCBhc3NlcnRFbnRpdGllcyA9IGlzT2JqZWN0KHN0YXRlKTtcblxuICBpZiAoIWFzc2VydEVudGl0aWVzKSB7XG4gICAgdGhyb3cgbmV3IEFraXRhSW52YWxpZEVudGl0eVN0YXRlKCk7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGFzc2VydERlY29yYXRvcihuYW1lOiBzdHJpbmcsIGNsYXNzTmFtZTogc3RyaW5nKSB7XG4gIGlmICghbmFtZSkge1xuICAgIGNvbnNvbGUuZXJyb3IoYEBTdG9yZUNvbmZpZyh7IG5hbWUgfSkgaXMgbWlzc2luZyBpbiAke2NsYXNzTmFtZX1gKTtcbiAgfVxufVxuIiwiaW1wb3J0IHsgRW50aXRpZXMsIEVudGl0eVN0YXRlLCBIYXNoTWFwLCBJRCwgTmV3YWJsZSB9IGZyb20gJy4uL2FwaS90eXBlcyc7XG5pbXBvcnQgeyBBa2l0YVVwZGF0ZUlkS2V5RXJyb3IsIGFzc2VydEVudGl0eUV4aXN0cywgYXNzZXJ0RW50aXR5U3RhdGUgfSBmcm9tICcuL2Vycm9yJztcbmltcG9ydCB7IGVudGl0eUV4aXN0cywgaXNGdW5jdGlvbiwgaXNQbGFpbk9iamVjdCwgcmVzZXRBY3RpdmUgfSBmcm9tICcuL3V0aWxzJztcblxuZXhwb3J0IGNsYXNzIENSVUQge1xuICBfc2V0PFMsIEU+KHN0YXRlOiBTLCBlbnRpdGllczogRVtdIHwgSGFzaE1hcDxFPiB8IEVudGl0aWVzPEU+LCBlbnRpdHlDbGFzczogTmV3YWJsZTxFPiwgaWRLZXkpOiBTIHtcbiAgICBsZXQgaWRzLCBub3JtYWxpemVkO1xuXG4gICAgaWYgKChlbnRpdGllcyBhcyBFbnRpdGllczxFPikuaWRzICYmIChlbnRpdGllcyBhcyBFbnRpdGllczxFPikuZW50aXRpZXMpIHtcbiAgICAgIGlkcyA9IChlbnRpdGllcyBhcyBFbnRpdGllczxFPikuaWRzO1xuICAgICAgbm9ybWFsaXplZCA9IChlbnRpdGllcyBhcyBFbnRpdGllczxFPikuZW50aXRpZXM7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IGlzQXJyYXkgPSBBcnJheS5pc0FycmF5KGVudGl0aWVzKTtcbiAgICAgIG5vcm1hbGl6ZWQgPSBlbnRpdGllcztcblxuICAgICAgaWYgKGlzQXJyYXkpIHtcbiAgICAgICAgbm9ybWFsaXplZCA9IHRoaXMua2V5QnkoZW50aXRpZXMgYXMgRVtdLCBlbnRpdHlDbGFzcywgaWRLZXkpIGFzIEVbXTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGFzc2VydEVudGl0eVN0YXRlKGVudGl0aWVzKTtcbiAgICAgIH1cblxuICAgICAgaWRzID0gaXNBcnJheSA/IChlbnRpdGllcyBhcyBFW10pLm1hcChlbnRpdHkgPT4gZW50aXR5W2lkS2V5XSkgOiBPYmplY3Qua2V5cyhub3JtYWxpemVkIGFzIEhhc2hNYXA8RT4pLm1hcChpZCA9PiBlbnRpdGllc1tpZF1baWRLZXldKTtcbiAgICB9XG5cbiAgICBjb25zdCBuZXdTdGF0ZSA9IHtcbiAgICAgIC4uLihzdGF0ZSBhcyBhbnkpLFxuICAgICAgZW50aXRpZXM6IG5vcm1hbGl6ZWQsXG4gICAgICBpZHMsXG4gICAgICBsb2FkaW5nOiBmYWxzZVxuICAgIH07XG5cbiAgICBpZiAocmVzZXRBY3RpdmUobmV3U3RhdGUpKSB7XG4gICAgICBuZXdTdGF0ZS5hY3RpdmUgPSBudWxsO1xuICAgIH1cblxuICAgIHJldHVybiBuZXdTdGF0ZTtcbiAgfVxuXG4gIF9yZXBsYWNlRW50aXR5PFQgZXh0ZW5kcyBFbnRpdHlTdGF0ZT4oc3RhdGU6IFQsIGlkOiBJRCwgZW50aXR5KTogVCB7XG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLihzdGF0ZSBhcyBhbnkpLFxuICAgICAgZW50aXRpZXM6IHtcbiAgICAgICAgLi4uc3RhdGUuZW50aXRpZXMsXG4gICAgICAgIFtpZF06IGVudGl0eVxuICAgICAgfVxuICAgIH07XG4gIH1cblxuICBfYWRkPFMgZXh0ZW5kcyBFbnRpdHlTdGF0ZSwgRT4oc3RhdGU6IFMsIGVudGl0aWVzOiBFW10sIGlkS2V5KTogUyB7XG4gICAgbGV0IGFkZGVkRW50aXRpZXMgPSB7fTtcbiAgICBsZXQgYWRkZWRJZHMgPSBbXTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZW50aXRpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IGVudGl0eSA9IGVudGl0aWVzW2ldO1xuICAgICAgY29uc3QgZW50aXR5SWQgPSBlbnRpdHlbaWRLZXldO1xuXG4gICAgICBpZiAoIWVudGl0eUV4aXN0cyhlbnRpdHlJZCwgc3RhdGUuZW50aXRpZXMpKSB7XG4gICAgICAgIGFkZGVkRW50aXRpZXNbZW50aXR5SWRdID0gZW50aXR5O1xuICAgICAgICBhZGRlZElkcy5wdXNoKGVudGl0eUlkKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgLi4uKHN0YXRlIGFzIGFueSksXG4gICAgICBlbnRpdGllczoge1xuICAgICAgICAuLi5zdGF0ZS5lbnRpdGllcyxcbiAgICAgICAgLi4uYWRkZWRFbnRpdGllc1xuICAgICAgfSxcbiAgICAgIGlkczogWy4uLnN0YXRlLmlkcywgLi4uYWRkZWRJZHNdXG4gICAgfTtcbiAgfVxuXG4gIF91cGRhdGU8VCBleHRlbmRzIEVudGl0eVN0YXRlPihzdGF0ZTogVCwgaWRzOiBJRFtdLCBuZXdTdGF0ZU9yRm46IG9iamVjdCB8ICgoZTogUmVhZG9ubHk8YW55PikgPT4gb2JqZWN0KSwgaWRLZXk6IHN0cmluZyk6IFQge1xuICAgIGNvbnN0IHVwZGF0ZWRFbnRpdGllcyA9IHt9O1xuXG4gICAgbGV0IGlzVXBkYXRpbmdJZEtleSA9IGZhbHNlO1xuICAgIGxldCBpZFRvVXBkYXRlOiBJRDtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaWRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBpZCA9IGlkc1tpXTtcbiAgICAgIGlkVG9VcGRhdGUgPSBpZDtcbiAgICAgIGFzc2VydEVudGl0eUV4aXN0cyhpZCwgc3RhdGUuZW50aXRpZXMpO1xuXG4gICAgICBjb25zdCBvbGRFbnRpdHkgPSBzdGF0ZS5lbnRpdGllc1tpZF07XG4gICAgICBjb25zdCBuZXdTdGF0ZSA9IGlzRnVuY3Rpb24obmV3U3RhdGVPckZuKSA/IG5ld1N0YXRlT3JGbihvbGRFbnRpdHkpIDogbmV3U3RhdGVPckZuO1xuXG4gICAgICBpZiAobmV3U3RhdGUuaGFzT3duUHJvcGVydHkoaWRLZXkpICYmIG5ld1N0YXRlW2lkS2V5XSAhPT0gb2xkRW50aXR5W2lkS2V5XSkge1xuICAgICAgICBpZiAoaWRzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgQWtpdGFVcGRhdGVJZEtleUVycm9yKCk7XG4gICAgICAgIH1cbiAgICAgICAgaXNVcGRhdGluZ0lkS2V5ID0gdHJ1ZTtcbiAgICAgICAgaWRUb1VwZGF0ZSA9IG5ld1N0YXRlW2lkS2V5XTtcbiAgICAgIH1cblxuICAgICAgbGV0IG5ld0VudGl0eTtcblxuICAgICAgY29uc3QgbWVyZ2VkID0ge1xuICAgICAgICAuLi5vbGRFbnRpdHksXG4gICAgICAgIC4uLm5ld1N0YXRlXG4gICAgICB9O1xuXG4gICAgICBpZiAoaXNQbGFpbk9iamVjdChvbGRFbnRpdHkpKSB7XG4gICAgICAgIG5ld0VudGl0eSA9IG1lcmdlZDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG5ld0VudGl0eSA9IG5ldyBvbGRFbnRpdHkuY29uc3RydWN0b3IobWVyZ2VkKTtcbiAgICAgIH1cblxuICAgICAgdXBkYXRlZEVudGl0aWVzW2lkVG9VcGRhdGVdID0gbmV3RW50aXR5O1xuICAgIH1cblxuICAgIGxldCB1cGRhdGVkSWRzID0gc3RhdGUuaWRzO1xuICAgIGxldCBzdGF0ZUVudGl0aWVzID0gc3RhdGUuZW50aXRpZXM7XG4gICAgaWYgKGlzVXBkYXRpbmdJZEtleSkge1xuICAgICAgY29uc3QgW2lkXSA9IGlkcztcbiAgICAgIGNvbnN0IHsgW2lkXTogZGVsZXRlZEVudGl0eSwgLi4ucmVzdCB9ID0gc3RhdGUuZW50aXRpZXM7XG4gICAgICBzdGF0ZUVudGl0aWVzID0gcmVzdDtcbiAgICAgIHVwZGF0ZWRJZHMgPSBzdGF0ZS5pZHMubWFwKGN1cnJlbnQgPT4gKGN1cnJlbnQgPT09IGlkID8gaWRUb1VwZGF0ZSA6IGN1cnJlbnQpKTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgLi4uKHN0YXRlIGFzIGFueSksXG4gICAgICBlbnRpdGllczoge1xuICAgICAgICAuLi5zdGF0ZUVudGl0aWVzLFxuICAgICAgICAuLi51cGRhdGVkRW50aXRpZXNcbiAgICAgIH0sXG4gICAgICBpZHM6IHVwZGF0ZWRJZHNcbiAgICB9O1xuICB9XG5cbiAgX3JlbW92ZTxUIGV4dGVuZHMgRW50aXR5U3RhdGU+KHN0YXRlOiBULCBpZHM6IElEW10gfCBudWxsKTogVCB7XG4gICAgaWYgKCFpZHMpIHJldHVybiB0aGlzLl9yZW1vdmVBbGwoc3RhdGUpO1xuXG4gICAgY29uc3QgcmVtb3ZlZCA9IGlkcy5yZWR1Y2UoKGFjYywgaWQpID0+IHtcbiAgICAgIGNvbnN0IHsgW2lkXTogZW50aXR5LCAuLi5yZXN0IH0gPSBhY2M7XG4gICAgICByZXR1cm4gcmVzdDtcbiAgICB9LCBzdGF0ZS5lbnRpdGllcyk7XG4gICAgY29uc3QgbmV3U3RhdGUgPSB7XG4gICAgICAuLi4oc3RhdGUgYXMgYW55KSxcbiAgICAgIGVudGl0aWVzOiByZW1vdmVkLFxuICAgICAgaWRzOiBzdGF0ZS5pZHMuZmlsdGVyKGN1cnJlbnQgPT4gaWRzLmluZGV4T2YoY3VycmVudCkgPT09IC0xKVxuICAgIH07XG5cbiAgICBpZiAocmVzZXRBY3RpdmUobmV3U3RhdGUpKSB7XG4gICAgICBuZXdTdGF0ZS5hY3RpdmUgPSBudWxsO1xuICAgIH1cblxuICAgIHJldHVybiBuZXdTdGF0ZTtcbiAgfVxuXG4gIHByaXZhdGUgX3JlbW92ZUFsbDxUIGV4dGVuZHMgRW50aXR5U3RhdGU+KHN0YXRlOiBUKTogVCB7XG4gICAgY29uc3QgbmV3U3RhdGUgPSB7XG4gICAgICAuLi4oc3RhdGUgYXMgYW55KSxcbiAgICAgIGVudGl0aWVzOiB7fSxcbiAgICAgIGlkczogW10sXG4gICAgICBhY3RpdmU6IG51bGxcbiAgICB9O1xuXG4gICAgcmV0dXJuIG5ld1N0YXRlO1xuICB9XG5cbiAgcHJpdmF0ZSBrZXlCeShlbnRpdGllczogYW55W10sIGVudGl0eUNsYXNzPzogTmV3YWJsZTxhbnk+LCBpZCA9ICdpZCcpIHtcbiAgICBjb25zdCBhY2MgPSB7fTtcblxuICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBlbnRpdGllcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgY29uc3QgZW50aXR5ID0gZW50aXRpZXNbaV07XG4gICAgICBhY2NbZW50aXR5W2lkXV0gPSBlbnRpdHlDbGFzcyA/IG5ldyBlbnRpdHlDbGFzcyhlbnRpdHkpIDogZW50aXR5O1xuICAgIH1cblxuICAgIHJldHVybiBhY2M7XG4gIH1cbn1cblxuZXhwb3J0IGNvbnN0IF9jcnVkID0gbmV3IENSVUQoKTtcbiIsImltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IElEIH0gZnJvbSAnLi4vYXBpL3R5cGVzJztcblxuZXhwb3J0IHR5cGUgQWN0aW9uID0ge1xuICB0eXBlOiBzdHJpbmc7XG4gIGVudGl0eUlkPzogSURbXSB8IElEO1xuICBwYXlsb2FkPzogYW55O1xufTtcblxuZXhwb3J0IGNsYXNzIEFraXRhR2xvYmFscyB7XG4gIHByaXZhdGUgY3VzdG9tQWN0aW9uO1xuICBjdXJyZW50QWN0aW9uOiBBY3Rpb247XG4gIHNraXBBY3Rpb24gPSBmYWxzZTtcbiAgc2tpcFRyYW5zYWN0aW9uTXNnID0gZmFsc2U7XG4gIGN1cnJlbnRUID0gW107XG4gIGFjdGl2ZVRyYW5zYWN0aW9ucyA9IDA7XG4gIGJhdGNoVHJhbnNhY3Rpb246IFN1YmplY3Q8Ym9vbGVhbj47XG5cbiAgc2V0QWN0aW9uKF9hY3Rpb246IEFjdGlvbikge1xuICAgIGlmICh0aGlzLmN1c3RvbUFjdGlvbikge1xuICAgICAgdGhpcy5jdXJyZW50QWN0aW9uID0gdGhpcy5jdXN0b21BY3Rpb247XG4gICAgICB0aGlzLmN1c3RvbUFjdGlvbiA9IG51bGw7XG4gICAgICB0aGlzLnNraXBUcmFuc2FjdGlvbk1zZyA9IGZhbHNlO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAodGhpcy5hY3RpdmVUcmFuc2FjdGlvbnMgPT09IDApIHtcbiAgICAgICAgdGhpcy5jdXJyZW50QWN0aW9uID0gX2FjdGlvbjtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodGhpcy5hY3RpdmVUcmFuc2FjdGlvbnMgPiAwKSB7XG4gICAgICB0aGlzLmN1cnJlbnRULnB1c2goX2FjdGlvbik7XG4gICAgfVxuICB9XG5cbiAgc2V0Q3VzdG9tQWN0aW9uKGFjdGlvbjogQWN0aW9uLCBza2lwVHJhbnNhY3Rpb25Nc2cgPSBmYWxzZSkge1xuICAgIHRoaXMuY3VycmVudEFjdGlvbiA9IHRoaXMuY3VzdG9tQWN0aW9uID0gYWN0aW9uO1xuICAgIHRoaXMuc2tpcFRyYW5zYWN0aW9uTXNnID0gc2tpcFRyYW5zYWN0aW9uTXNnO1xuICB9XG5cbiAgc2V0U2tpcEFjdGlvbihza2lwID0gdHJ1ZSkge1xuICAgIHRoaXMuc2tpcEFjdGlvbiA9IHNraXA7XG4gIH1cbn1cblxuZXhwb3J0IGNvbnN0IF9fZ2xvYmFsU3RhdGUgPSBuZXcgQWtpdGFHbG9iYWxzKCk7XG4iLCJpbXBvcnQgeyBfX2dsb2JhbFN0YXRlIH0gZnJvbSAnLi9nbG9iYWwtc3RhdGUnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgU3ViamVjdCwgb2YgfSBmcm9tICdyeGpzJztcblxuLyoqXG4gKiBTdGFydCBhIG5ldyB0cmFuc2FjdGlvbiBiYXRjaFxuICovXG5leHBvcnQgZnVuY3Rpb24gc3RhcnRCYXRjaCgpIHtcbiAgaWYgKCFpc1RyYW5zYWN0aW9uSW5Qcm9jZXNzKCkpIHtcbiAgICBfX2dsb2JhbFN0YXRlLmJhdGNoVHJhbnNhY3Rpb24gPSBuZXcgU3ViamVjdCgpO1xuICB9XG4gIF9fZ2xvYmFsU3RhdGUuYWN0aXZlVHJhbnNhY3Rpb25zKys7XG59XG5cbi8qKlxuICogRW5kIHRoZSB0cmFuc2FjdGlvblxuICovXG5leHBvcnQgZnVuY3Rpb24gZW5kQmF0Y2goKSB7XG4gIGlmICgtLV9fZ2xvYmFsU3RhdGUuYWN0aXZlVHJhbnNhY3Rpb25zID09PSAwKSB7XG4gICAgX19nbG9iYWxTdGF0ZS5iYXRjaFRyYW5zYWN0aW9uLm5leHQodHJ1ZSk7XG4gICAgX19nbG9iYWxTdGF0ZS5iYXRjaFRyYW5zYWN0aW9uLmNvbXBsZXRlKCk7XG4gIH1cbn1cblxuLyoqXG4gKiBXaGV0aGVyIHdlJ3JlIGluc2lkZSBiYXRjaFxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNUcmFuc2FjdGlvbkluUHJvY2VzcygpIHtcbiAgcmV0dXJuIF9fZ2xvYmFsU3RhdGUuYWN0aXZlVHJhbnNhY3Rpb25zID4gMDtcbn1cblxuLyoqXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjb21taXQoKTogT2JzZXJ2YWJsZTxib29sZWFuPiB7XG4gIHJldHVybiBfX2dsb2JhbFN0YXRlLmJhdGNoVHJhbnNhY3Rpb24gPyBfX2dsb2JhbFN0YXRlLmJhdGNoVHJhbnNhY3Rpb24uYXNPYnNlcnZhYmxlKCkgOiBvZih0cnVlKTtcbn1cbiIsImV4cG9ydCBmdW5jdGlvbiBkZWVwRnJlZXplKG8pIHtcbiAgT2JqZWN0LmZyZWV6ZShvKTtcblxuICBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhvKS5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcbiAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eShwcm9wKSAmJiBvW3Byb3BdICE9PSBudWxsICYmICh0eXBlb2Ygb1twcm9wXSA9PT0gJ29iamVjdCcgfHwgdHlwZW9mIG9bcHJvcF0gPT09ICdmdW5jdGlvbicpICYmICFPYmplY3QuaXNGcm96ZW4ob1twcm9wXSkpIHtcbiAgICAgIGRlZXBGcmVlemUob1twcm9wXSk7XG4gICAgfVxuICB9KTtcblxuICByZXR1cm4gbztcbn1cbiIsImV4cG9ydCB0eXBlIFN0b3JlQ29uZmlnT3B0aW9ucyA9IHtcbiAgbmFtZTogc3RyaW5nO1xuICBpZEtleT86IHN0cmluZztcbn07XG5cbmV4cG9ydCBjb25zdCBjb25maWdLZXkgPSAnYWtpdGFDb25maWcnO1xuXG5leHBvcnQgZnVuY3Rpb24gU3RvcmVDb25maWcobWV0YWRhdGE6IFN0b3JlQ29uZmlnT3B0aW9ucykge1xuICByZXR1cm4gZnVuY3Rpb24oY29uc3RydWN0b3I6IEZ1bmN0aW9uKSB7XG4gICAgY29uc3RydWN0b3JbY29uZmlnS2V5XSA9IHsgaWRLZXk6ICdpZCcgfTtcblxuICAgIGZvciAobGV0IGkgPSAwLCBrZXlzID0gT2JqZWN0LmtleXMobWV0YWRhdGEpOyBpIDwga2V5cy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3Qga2V5ID0ga2V5c1tpXTtcbiAgICAgIC8qIG5hbWUgaXMgcHJlc2VydmVkIHJlYWQgb25seSBrZXkgKi9cbiAgICAgIGlmIChrZXkgPT09ICduYW1lJykge1xuICAgICAgICBjb25zdHJ1Y3Rvcltjb25maWdLZXldWydzdG9yZU5hbWUnXSA9IG1ldGFkYXRhW2tleV07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdHJ1Y3Rvcltjb25maWdLZXldW2tleV0gPSBtZXRhZGF0YVtrZXldO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbn1cbiIsImltcG9ydCB7IEhhc2hNYXAsIElEIH0gZnJvbSAnLi90eXBlcyc7XG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QsIE9ic2VydmFibGUsIFJlcGxheVN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGRpc3RpbmN0VW50aWxDaGFuZ2VkLCBtYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBBa2l0YUltbXV0YWJpbGl0eUVycm9yLCBhc3NlcnREZWNvcmF0b3IgfSBmcm9tICcuLi9pbnRlcm5hbC9lcnJvcic7XG5pbXBvcnQgeyBjb21taXQsIGlzVHJhbnNhY3Rpb25JblByb2Nlc3MgfSBmcm9tICcuLi9pbnRlcm5hbC90cmFuc2FjdGlvbi5pbnRlcm5hbCc7XG5pbXBvcnQgeyBpc0Z1bmN0aW9uLCBpc1BsYWluT2JqZWN0IH0gZnJvbSAnLi4vaW50ZXJuYWwvdXRpbHMnO1xuaW1wb3J0IHsgZGVlcEZyZWV6ZSB9IGZyb20gJy4uL2ludGVybmFsL2RlZXAtZnJlZXplJztcbmltcG9ydCB7IGNvbmZpZ0tleSwgU3RvcmVDb25maWdPcHRpb25zIH0gZnJvbSAnLi9zdG9yZS1jb25maWcnO1xuaW1wb3J0IHsgX19nbG9iYWxTdGF0ZSB9IGZyb20gJy4uL2ludGVybmFsL2dsb2JhbC1zdGF0ZSc7XG5cbi8qKiBXaGV0aGVyIHdlIGFyZSBpbiBkZXYgbW9kZSAqL1xubGV0IF9fREVWX18gPSB0cnVlO1xuXG5leHBvcnQgY29uc3QgX19zdG9yZXNfXzogeyBbc3RvcmVOYW1lOiBzdHJpbmddOiBTdG9yZTxhbnk+IH0gPSB7fTtcblxuZXhwb3J0IGNvbnN0IGVudW0gQWN0aW9ucyB7XG4gIE5FV19TVE9SRSxcbiAgTkVXX1NUQVRFXG59XG5cbmV4cG9ydCB0eXBlIEFjdGlvbiA9IHtcbiAgdHlwZTogQWN0aW9ucztcbiAgcGF5bG9hZDogSGFzaE1hcDxhbnk+O1xufTtcblxuZXhwb3J0IGNvbnN0IHJvb3REaXNwYXRjaGVyID0gbmV3IFJlcGxheVN1YmplY3Q8QWN0aW9uPigpO1xuXG5mdW5jdGlvbiBuZXh0U3RhdGUoc3RvcmVOYW1lLCBpbml0aWFsU3RhdGUgPSBmYWxzZSkge1xuICByZXR1cm4ge1xuICAgIHR5cGU6IEFjdGlvbnMuTkVXX1NUQVRFLFxuICAgIHBheWxvYWQ6IHtcbiAgICAgIG5hbWU6IHN0b3JlTmFtZSxcbiAgICAgIGluaXRpYWxTdGF0ZVxuICAgIH1cbiAgfTtcbn1cblxuLyoqXG4gKiBFbmFibGUgcHJvZHVjdGlvbiBtb2RlIHRvIGRpc2FibGUgb2JqZWN0RnJlZXplXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBlbmFibGVBa2l0YVByb2RNb2RlKCkge1xuICBfX0RFVl9fID0gZmFsc2U7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0RldigpIHtcbiAgcmV0dXJuIF9fREVWX187XG59XG5cbi8qKlxuICogVGhlIFJvb3QgU3RvcmUgdGhhdCBldmVyeSBzdWIgc3RvcmUgbmVlZHMgdG8gaW5oZXJpdCBhbmRcbiAqIGludm9rZSBgc3VwZXJgIHdpdGggdGhlIGluaXRpYWwgc3RhdGUuXG4gKi9cbmV4cG9ydCBjbGFzcyBTdG9yZTxTPiB7XG4gIC8qKiBNYW5hZ2UgdGhlIHN0b3JlIHdpdGggQmVoYXZpb3JTdWJqZWN0ICovXG4gIHByaXZhdGUgc3RvcmU6IEJlaGF2aW9yU3ViamVjdDxSZWFkb25seTxTPj47XG5cbiAgLyoqIFRoZSBjdXJyZW50IHN0YXRlIHZhbHVlICovXG4gIHByaXZhdGUgc3RvcmVWYWx1ZTogUztcblxuICAvKiogV2hldGhlciB3ZSBhcmUgaW5zaWRlIHRyYW5zYWN0aW9uICoqL1xuICBwcml2YXRlIGluVHJhbnNhY3Rpb24gPSBmYWxzZTtcblxuICBwcml2YXRlIF9pc1ByaXN0aW5lID0gdHJ1ZTtcblxuICAvKipcbiAgICpcbiAgICogSW5pdGlhbCB0aGUgc3RvcmUgd2l0aCB0aGUgc3RhdGVcbiAgICovXG4gIGNvbnN0cnVjdG9yKGluaXRpYWxTdGF0ZSkge1xuICAgIF9fZ2xvYmFsU3RhdGUuc2V0QWN0aW9uKHsgdHlwZTogJ0BASU5JVCcgfSk7XG4gICAgX19zdG9yZXNfX1t0aGlzLnN0b3JlTmFtZV0gPSB0aGlzO1xuICAgIHRoaXMuc2V0U3RhdGUoKCkgPT4gaW5pdGlhbFN0YXRlKTtcbiAgICByb290RGlzcGF0Y2hlci5uZXh0KHtcbiAgICAgIHR5cGU6IEFjdGlvbnMuTkVXX1NUT1JFLFxuICAgICAgcGF5bG9hZDogeyBzdG9yZTogdGhpcyB9XG4gICAgfSk7XG4gICAgaXNEZXYoKSAmJiBhc3NlcnREZWNvcmF0b3IodGhpcy5zdG9yZU5hbWUsIHRoaXMuY29uc3RydWN0b3IubmFtZSk7XG4gIH1cblxuICBzZXRMb2FkaW5nKGxvYWRpbmcgPSBmYWxzZSkge1xuICAgIGlmIChsb2FkaW5nICE9PSAodGhpcy5fdmFsdWUoKSBhcyBTICYgeyBsb2FkaW5nOiBib29sZWFuIH0pLmxvYWRpbmcpIHtcbiAgICAgIGlzRGV2KCkgJiYgX19nbG9iYWxTdGF0ZS5zZXRBY3Rpb24oeyB0eXBlOiAnU2V0IExvYWRpbmcnIH0pO1xuICAgICAgdGhpcy5zZXRTdGF0ZShzID0+ICh7IC4uLihzIGFzIG9iamVjdCksIGxvYWRpbmcgfSBhcyBhbnkpKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIHRoZSBzdG9yZSdzIGVycm9yIHN0YXRlLlxuICAgKi9cbiAgc2V0RXJyb3I8VD4oZXJyb3I6IFQpIHtcbiAgICBpZiAoZXJyb3IgIT09ICh0aGlzLl92YWx1ZSgpIGFzIFMgJiB7IGVycm9yOiBhbnkgfSkuZXJyb3IpIHtcbiAgICAgIGlzRGV2KCkgJiYgX19nbG9iYWxTdGF0ZS5zZXRBY3Rpb24oeyB0eXBlOiAnU2V0IEVycm9yJyB9KTtcbiAgICAgIHRoaXMuc2V0U3RhdGUocyA9PiAoeyAuLi4ocyBhcyBvYmplY3QpLCBlcnJvciB9IGFzIGFueSkpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZWxlY3QgYSBzbGljZSBmcm9tIHRoZSBzdG9yZVxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiB0aGlzLnN0b3JlLnNlbGVjdChzdGF0ZSA9PiBzdGF0ZS5lbnRpdGllcylcbiAgICpcbiAgICovXG4gIF9zZWxlY3Q8Uj4ocHJvamVjdDogKHN0b3JlOiBTKSA9PiBSKTogT2JzZXJ2YWJsZTxSPiB7XG4gICAgcmV0dXJuIHRoaXMuc3RvcmUkLnBpcGUoXG4gICAgICBtYXAocHJvamVjdCksXG4gICAgICBkaXN0aW5jdFVudGlsQ2hhbmdlZCgpXG4gICAgKTtcbiAgfVxuXG4gIF92YWx1ZSgpOiBTIHtcbiAgICByZXR1cm4gdGhpcy5zdG9yZVZhbHVlO1xuICB9XG5cbiAgZ2V0IGNvbmZpZygpOiBTdG9yZUNvbmZpZ09wdGlvbnMge1xuICAgIHJldHVybiB0aGlzLmNvbnN0cnVjdG9yW2NvbmZpZ0tleV07XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBzdG9yZSBuYW1lXG4gICAqL1xuICBnZXQgc3RvcmVOYW1lKCkge1xuICAgIHJldHVybiB0aGlzLmNvbmZpZyAmJiB0aGlzLmNvbmZpZ1snc3RvcmVOYW1lJ107XG4gIH1cblxuICBnZXQgaXNQcmlzdGluZSgpIHtcbiAgICByZXR1cm4gdGhpcy5faXNQcmlzdGluZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBgc2V0U3RhdGUoKWAgaXMgdGhlIG9ubHkgd2F5IHRvIHVwZGF0ZSBhIHN0b3JlOyBJdCByZWNlaXZlcyBhIGNhbGxiYWNrIGZ1bmN0aW9uLFxuICAgKiB3aGljaCBnZXRzIHRoZSBjdXJyZW50IHN0YXRlLCBhbmQgcmV0dXJucyBhIG5ldyBpbW11dGFibGUgc3RhdGUsXG4gICAqIHdoaWNoIHdpbGwgYmUgdGhlIG5ldyB2YWx1ZSBvZiB0aGUgc3RvcmUuXG4gICAqL1xuICBzZXRTdGF0ZShuZXdTdGF0ZUZuOiAoc3RhdGU6IFJlYWRvbmx5PFM+KSA9PiBTLCBfcm9vdERpc3BhdGNoZXIgPSB0cnVlKSB7XG4gICAgY29uc3QgcHJldlN0YXRlID0gdGhpcy5fdmFsdWUoKTtcbiAgICB0aGlzLnN0b3JlVmFsdWUgPSBfX0RFVl9fID8gZGVlcEZyZWV6ZShuZXdTdGF0ZUZuKHRoaXMuX3ZhbHVlKCkpKSA6IG5ld1N0YXRlRm4odGhpcy5fdmFsdWUoKSk7XG5cbiAgICBpZiAocHJldlN0YXRlID09PSB0aGlzLnN0b3JlVmFsdWUpIHtcbiAgICAgIHRocm93IG5ldyBBa2l0YUltbXV0YWJpbGl0eUVycm9yKHRoaXMuc3RvcmVOYW1lKTtcbiAgICB9XG5cbiAgICBpZiAoIXRoaXMuc3RvcmUpIHtcbiAgICAgIHRoaXMuc3RvcmUgPSBuZXcgQmVoYXZpb3JTdWJqZWN0KHRoaXMuc3RvcmVWYWx1ZSk7XG4gICAgICByb290RGlzcGF0Y2hlci5uZXh0KG5leHRTdGF0ZSh0aGlzLnN0b3JlTmFtZSwgdHJ1ZSkpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChpc1RyYW5zYWN0aW9uSW5Qcm9jZXNzKCkpIHtcbiAgICAgIHRoaXMuaGFuZGxlVHJhbnNhY3Rpb24oKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmRpc3BhdGNoKHRoaXMuc3RvcmVWYWx1ZSwgX3Jvb3REaXNwYXRjaGVyKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGlzIG1ldGhvZCBpcyBhIHNob3J0Y3V0IGZvciBgc2V0U3RhdGUoKWAuXG4gICAqIEl0IGNhbiBiZSB1c2VmdWwgd2hlbiB5b3Ugd2FudCB0byBwYXNzIHRoZSB3aG9sZSBzdGF0ZSBvYmplY3QgaW5zdGVhZCBvZiBtZXJnaW5nIGEgcGFydGlhbCBzdGF0ZS5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogdGhpcy5zdG9yZS51cGRhdGUobmV3U3RhdGUpXG4gICAqL1xuICB1cGRhdGUobmV3U3RhdGU6IFBhcnRpYWw8Uz4pO1xuICB1cGRhdGUobmV3U3RhdGU6IChzdGF0ZTogUmVhZG9ubHk8Uz4pID0+IFBhcnRpYWw8Uz4pO1xuICB1cGRhdGUoaWQ6IElEIHwgSURbXSB8IG51bGwsIG5ld1N0YXRlOiBQYXJ0aWFsPFM+KTtcbiAgdXBkYXRlKG5ld1N0YXRlT3JJZDogUGFydGlhbDxTPiB8IElEIHwgSURbXSB8IG51bGwgfCAoKHN0YXRlOiBSZWFkb25seTxTPikgPT4gUGFydGlhbDxTPiksIG5ld1N0YXRlPzogUGFydGlhbDxTPikge1xuICAgIF9fZ2xvYmFsU3RhdGUuc2V0QWN0aW9uKHsgdHlwZTogJ1VwZGF0ZSBTdG9yZScgfSk7XG4gICAgdGhpcy5zZXRTdGF0ZShzdGF0ZSA9PiB7XG4gICAgICBsZXQgdmFsdWUgPSBpc0Z1bmN0aW9uKG5ld1N0YXRlT3JJZCkgPyBuZXdTdGF0ZU9ySWQoc3RhdGUpIDogbmV3U3RhdGVPcklkO1xuICAgICAgbGV0IG1lcmdlZCA9IE9iamVjdC5hc3NpZ24oe30sIHN0YXRlLCB2YWx1ZSk7XG4gICAgICByZXR1cm4gaXNQbGFpbk9iamVjdChzdGF0ZSkgPyBtZXJnZWQgOiBuZXcgKHN0YXRlIGFzIGFueSkuY29uc3RydWN0b3IobWVyZ2VkKTtcbiAgICB9KTtcbiAgICB0aGlzLnNldERpcnR5KCk7XG4gIH1cblxuICAvKipcbiAgICogU2V0cyB0aGUgc3RvcmUgdG8gYSBwcmlzdGluZSBzdGF0ZS5cbiAgICovXG4gIHNldFByaXN0aW5lKCkge1xuICAgIHRoaXMuX2lzUHJpc3RpbmUgPSB0cnVlO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgdGhlIHN0b3JlIHRvIGEgZGlydHkgc3RhdGUsIGluZGljYXRpbmcgdGhhdCBpdCBpcyBub3QgcHJpc3RpbmUuXG4gICAqL1xuICBzZXREaXJ0eSgpIHtcbiAgICB0aGlzLl9pc1ByaXN0aW5lID0gZmFsc2U7XG4gIH1cblxuICBwcml2YXRlIGRpc3BhdGNoKHN0YXRlOiBTLCBfcm9vdERpc3BhdGNoZXIgPSB0cnVlKSB7XG4gICAgdGhpcy5zdG9yZS5uZXh0KHN0YXRlKTtcbiAgICBpZiAoX3Jvb3REaXNwYXRjaGVyKSB7XG4gICAgICByb290RGlzcGF0Y2hlci5uZXh0KG5leHRTdGF0ZSh0aGlzLnN0b3JlTmFtZSkpO1xuICAgICAgaXNEZXYoKSAmJiBfX2dsb2JhbFN0YXRlLnNldEFjdGlvbih7IHR5cGU6ICdTZXQgU3RhdGUnIH0pO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2V0IHN0b3JlJCgpIHtcbiAgICByZXR1cm4gdGhpcy5zdG9yZS5hc09ic2VydmFibGUoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBXaGVuIHRoZSB0cmFuc2FjdGlvbiBlbmRzIGRpc3BhdGNoIHRoZSBmaW5hbCB2YWx1ZSBvbmNlXG4gICAqL1xuICBwcml2YXRlIHdhdGNoVHJhbnNhY3Rpb24oKSB7XG4gICAgY29tbWl0KCkuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgIHRoaXMuaW5UcmFuc2FjdGlvbiA9IGZhbHNlO1xuICAgICAgaWYgKGlzRGV2KCkgJiYgIV9fZ2xvYmFsU3RhdGUuc2tpcFRyYW5zYWN0aW9uTXNnKSB7XG4gICAgICAgIF9fZ2xvYmFsU3RhdGUuc2V0QWN0aW9uKHsgdHlwZTogJ0BUcmFuc2FjdGlvbicgfSk7XG4gICAgICB9XG4gICAgICB0aGlzLmRpc3BhdGNoKHRoaXMuX3ZhbHVlKCkpO1xuICAgICAgX19nbG9iYWxTdGF0ZS5jdXJyZW50VCA9IFtdO1xuICAgICAgX19nbG9iYWxTdGF0ZS5za2lwVHJhbnNhY3Rpb25Nc2cgPSBmYWxzZTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBMaXN0ZW4gdG8gdGhlIHRyYW5zYWN0aW9uIHN0cmVhbVxuICAgKi9cbiAgcHJpdmF0ZSBoYW5kbGVUcmFuc2FjdGlvbigpIHtcbiAgICBpZiAoIXRoaXMuaW5UcmFuc2FjdGlvbikge1xuICAgICAgdGhpcy53YXRjaFRyYW5zYWN0aW9uKCk7XG4gICAgICB0aGlzLmluVHJhbnNhY3Rpb24gPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgbmdPbkRlc3Ryb3koKSB7XG4gICAgaWYgKHRoaXMgPT09IF9fc3RvcmVzX19bdGhpcy5zdG9yZU5hbWVdKSB7XG4gICAgICBkZWxldGUgX19zdG9yZXNfX1t0aGlzLnN0b3JlTmFtZV07XG4gICAgfVxuICB9XG59XG4iLCJpbXBvcnQgeyBfY3J1ZCB9IGZyb20gJy4uL2ludGVybmFsL2NydWQnO1xuaW1wb3J0IHsgQWtpdGFJbW11dGFiaWxpdHlFcnJvciwgYXNzZXJ0QWN0aXZlIH0gZnJvbSAnLi4vaW50ZXJuYWwvZXJyb3InO1xuaW1wb3J0IHsgQWN0aW9uLCBfX2dsb2JhbFN0YXRlIH0gZnJvbSAnLi4vaW50ZXJuYWwvZ2xvYmFsLXN0YXRlJztcbmltcG9ydCB7IGNvZXJjZUFycmF5LCBlbnRpdHlFeGlzdHMsIGlzRnVuY3Rpb24sIHRvQm9vbGVhbiB9IGZyb20gJy4uL2ludGVybmFsL3V0aWxzJztcbmltcG9ydCB7IGlzRGV2LCBTdG9yZSB9IGZyb20gJy4vc3RvcmUnO1xuaW1wb3J0IHsgQWN0aXZlU3RhdGUsIEVudGl0aWVzLCBFbnRpdHlTdGF0ZSwgSGFzaE1hcCwgSUQsIE5ld2FibGUgfSBmcm9tICcuL3R5cGVzJztcblxuLyoqXG4gKiBUaGUgUm9vdCBTdG9yZSB0aGF0IGV2ZXJ5IHN1YiBzdG9yZSBuZWVkcyB0byBpbmhlcml0IGFuZFxuICogaW52b2tlIGBzdXBlcmAgd2l0aCB0aGUgaW5pdGlhbCBzdGF0ZS5cbiAqL1xuZXhwb3J0IGNsYXNzIEVudGl0eVN0b3JlPFMgZXh0ZW5kcyBFbnRpdHlTdGF0ZTxFPiwgRT4gZXh0ZW5kcyBTdG9yZTxTPiB7XG4gIC8qKlxuICAgKlxuICAgKiBJbml0aWF0ZSB0aGUgc3RvcmUgd2l0aCB0aGUgc3RhdGVcbiAgICovXG4gIGNvbnN0cnVjdG9yKGluaXRpYWxTdGF0ZSA9IHt9LCBwcml2YXRlIG9wdGlvbnM6IHsgaWRLZXk/OiBzdHJpbmcgfSA9IHt9KSB7XG4gICAgc3VwZXIoeyAuLi5nZXRJbml0aWFsRW50aXRpZXNTdGF0ZSgpLCAuLi5pbml0aWFsU3RhdGUgfSk7XG4gIH1cblxuICBnZXQgZW50aXRpZXMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3ZhbHVlKCkuZW50aXRpZXM7XG4gIH1cblxuICBnZXQgaWRLZXkoKSB7XG4gICAgLyoqIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkgKi9cbiAgICBjb25zdCBuZXdJZEtleSA9IHRoaXMuY29uZmlnICYmIHRoaXMuY29uZmlnLmlkS2V5O1xuICAgIGlmICghbmV3SWRLZXkpIHtcbiAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMuaWRLZXkgfHwgJ2lkJztcbiAgICB9XG4gICAgcmV0dXJuIG5ld0lkS2V5O1xuICB9XG5cbiAgLyoqXG4gICAqXG4gICAqIFJlcGxhY2UgY3VycmVudCBjb2xsZWN0aW9uIHdpdGggcHJvdmlkZWQgY29sbGVjdGlvblxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiB0aGlzLnN0b3JlLnNldChbRW50aXR5LCBFbnRpdHldKTtcbiAgICogdGhpcy5zdG9yZS5zZXQoezE6IEVudGl0eSwgMjogRW50aXR5fSk7XG4gICAqIHRoaXMuc3RvcmUuc2V0KFt7aWQ6IDF9LCB7aWQ6IDJ9XSwgeyBlbnRpdHlDbGFzczogUHJvZHVjdCB9KTtcbiAgICpcbiAgICovXG4gIHNldChlbnRpdGllczogRVtdIHwgSGFzaE1hcDxFPiB8IEVudGl0aWVzPEU+LCBvcHRpb25zOiB7IGVudGl0eUNsYXNzPzogTmV3YWJsZTxFPiB9ID0ge30pIHtcbiAgICBpc0RldigpICYmIF9fZ2xvYmFsU3RhdGUuc2V0QWN0aW9uKHsgdHlwZTogJ1NldCBFbnRpdGllcycgfSk7XG4gICAgdGhpcy5zZXRTdGF0ZShzdGF0ZSA9PiBfY3J1ZC5fc2V0KHN0YXRlLCBlbnRpdGllcywgb3B0aW9ucy5lbnRpdHlDbGFzcywgdGhpcy5pZEtleSkpO1xuICAgIHRoaXMuc2V0RGlydHkoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgb3IgcmVwbGFjZSBhbiBlbnRpdHkgaW4gdGhlIHN0b3JlLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiB0aGlzLnN0b3JlLmNyZWF0ZU9yUmVwbGFjZSgzLCBFbnRpdHkpO1xuICAgKlxuICAgKi9cbiAgY3JlYXRlT3JSZXBsYWNlKGlkOiBJRCwgZW50aXR5OiBFKSB7XG4gICAgaWYgKCFlbnRpdHlFeGlzdHMoaWQsIHRoaXMuX3ZhbHVlKCkuZW50aXRpZXMpKSB7XG4gICAgICBpZiAoIWVudGl0eVt0aGlzLmlkS2V5XSkge1xuICAgICAgICBlbnRpdHlbdGhpcy5pZEtleV0gPSBpZDtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzLmFkZChlbnRpdHkpO1xuICAgIH1cbiAgICBpc0RldigpICYmIF9fZ2xvYmFsU3RhdGUuc2V0QWN0aW9uKHsgdHlwZTogJ1Vwc2VydCBFbnRpdHknLCBlbnRpdHlJZDogW2lkXSB9KTtcbiAgICB0aGlzLnNldFN0YXRlKHN0YXRlID0+IF9jcnVkLl9yZXBsYWNlRW50aXR5KHN0YXRlLCBpZCwgZW50aXR5KSk7XG4gIH1cblxuICAvKipcbiAgICogQWRkIGFuIGVudGl0eSBvciBlbnRpdGllcyB0byB0aGUgc3RvcmUuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIHRoaXMuc3RvcmUuYWRkKFtFbnRpdHksIEVudGl0eV0pO1xuICAgKiB0aGlzLnN0b3JlLmFkZChFbnRpdHkpO1xuICAgKi9cbiAgYWRkKGVudGl0aWVzOiBFW10gfCBFKSB7XG4gICAgY29uc3QgdG9BcnJheSA9IGNvZXJjZUFycmF5KGVudGl0aWVzKTtcbiAgICBpZiAodG9BcnJheS5sZW5ndGggPT09IDApIHJldHVybjtcbiAgICBpc0RldigpICYmIF9fZ2xvYmFsU3RhdGUuc2V0QWN0aW9uKHsgdHlwZTogJ0FkZCBFbnRpdHknIH0pO1xuICAgIHRoaXMuc2V0U3RhdGUoc3RhdGUgPT4gX2NydWQuX2FkZDxTLCBFPihzdGF0ZSwgdG9BcnJheSwgdGhpcy5pZEtleSkpO1xuICB9XG5cbiAgLyoqXG4gICAqXG4gICAqIFVwZGF0ZSBhbiBlbnRpdHkgb3IgZW50aXRpZXMgaW4gdGhlIHN0b3JlLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiB0aGlzLnN0b3JlLnVwZGF0ZSgzLCB7XG4gICAqICAgbmFtZTogJ05ldyBOYW1lJ1xuICAgKiB9KTtcbiAgICpcbiAgICogIHRoaXMuc3RvcmUudXBkYXRlKDMsIGVudGl0eSA9PiB7XG4gICAqICAgIHJldHVybiB7XG4gICAqICAgICAgY29uZmlnOiB7XG4gICAqICAgICAgICAuLi5lbnRpdHkuZmlsdGVyLFxuICAgKiAgICAgICAgZGF0ZVxuICAgKiAgICAgIH1cbiAgICogICAgfVxuICAgKiAgfSk7XG4gICAqXG4gICAqIHRoaXMuc3RvcmUudXBkYXRlKFsxLDIsM10sIHtcbiAgICogICBuYW1lOiAnTmV3IE5hbWUnXG4gICAqIH0pO1xuICAgKlxuICAgKiB0aGlzLnN0b3JlLnVwZGF0ZShlID0+IGUubmFtZSA9PT0gJ3ZhbHVlJywge1xuICAgKiAgIG5hbWU6ICdOZXcgTmFtZSdcbiAgICogfSk7XG4gICAqXG4gICAqIHRoaXMuc3RvcmUudXBkYXRlKG51bGwsIHtcbiAgICogICBuYW1lOiAnTmV3IE5hbWUnXG4gICAqIH0pO1xuICAgKlxuICAgKi9cbiAgdXBkYXRlKGlkOiBJRCB8IElEW10gfCBudWxsLCBuZXdTdGF0ZUZuOiAoKGVudGl0eTogUmVhZG9ubHk8RT4pID0+IFBhcnRpYWw8RT4pKTtcbiAgdXBkYXRlKGlkOiBJRCB8IElEW10gfCBudWxsLCBuZXdTdGF0ZTogUGFydGlhbDxFPik7XG4gIHVwZGF0ZShpZDogSUQgfCBJRFtdIHwgbnVsbCwgbmV3U3RhdGU6IFBhcnRpYWw8Uz4pO1xuICB1cGRhdGUobmV3U3RhdGU6IChzdGF0ZTogUmVhZG9ubHk8Uz4pID0+IFBhcnRpYWw8Uz4pO1xuICB1cGRhdGUocHJlZGljYXRlOiAoKGVudGl0eTogUmVhZG9ubHk8RT4pID0+IGJvb2xlYW4pLCBuZXdTdGF0ZUZuOiAoKGVudGl0eTogUmVhZG9ubHk8RT4pID0+IFBhcnRpYWw8RT4pKTtcbiAgdXBkYXRlKHByZWRpY2F0ZTogKChlbnRpdHk6IFJlYWRvbmx5PEU+KSA9PiBib29sZWFuKSwgbmV3U3RhdGU6IFBhcnRpYWw8RT4pO1xuICB1cGRhdGUocHJlZGljYXRlOiAoKGVudGl0eTogUmVhZG9ubHk8RT4pID0+IGJvb2xlYW4pLCBuZXdTdGF0ZTogUGFydGlhbDxTPik7XG4gIHVwZGF0ZShuZXdTdGF0ZTogUGFydGlhbDxTPik7XG4gIHVwZGF0ZShcbiAgICBpZHNPckZuOiBJRCB8IElEW10gfCBudWxsIHwgUGFydGlhbDxTPiB8ICgoc3RhdGU6IFJlYWRvbmx5PFM+KSA9PiBQYXJ0aWFsPFM+KSB8ICgoZW50aXR5OiBSZWFkb25seTxFPikgPT4gYm9vbGVhbiksXG4gICAgbmV3U3RhdGVPckZuPzogKChlbnRpdHk6IFJlYWRvbmx5PEU+KSA9PiBQYXJ0aWFsPEU+KSB8IFBhcnRpYWw8RT4gfCBQYXJ0aWFsPFM+XG4gICkge1xuICAgIGxldCBpZHM6IElEW10gPSBbXTtcbiAgICBjb25zdCBzdG9yZUlkcyA9IHRoaXMuX3ZhbHVlKCkuaWRzO1xuXG4gICAgaWYgKGlzRnVuY3Rpb24oaWRzT3JGbikpIHtcbiAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBzdG9yZUlkcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICBjb25zdCBpZCA9IHN0b3JlSWRzW2ldO1xuICAgICAgICBjb25zdCBlbnRpdHkgPSB0aGlzLl92YWx1ZSgpLmVudGl0aWVzW2lkXTtcbiAgICAgICAgaWYgKGVudGl0eSAmJiAoaWRzT3JGbiBhcyBGdW5jdGlvbikoZW50aXR5KSkge1xuICAgICAgICAgIGlkcy5wdXNoKGlkKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBpZHMgPSB0b0Jvb2xlYW4oaWRzT3JGbikgPyBjb2VyY2VBcnJheShpZHNPckZuKSA6IHN0b3JlSWRzO1xuICAgIH1cblxuICAgIGlmIChpZHMubGVuZ3RoID09PSAwKSByZXR1cm47XG4gICAgaXNEZXYoKSAmJiBfX2dsb2JhbFN0YXRlLnNldEFjdGlvbih7IHR5cGU6ICdVcGRhdGUgRW50aXR5JywgZW50aXR5SWQ6IGlkcyB9KTtcblxuICAgIHRoaXMuc2V0U3RhdGUoc3RhdGUgPT4ge1xuICAgICAgcmV0dXJuIF9jcnVkLl91cGRhdGUoc3RhdGUsIGlkcywgbmV3U3RhdGVPckZuLCB0aGlzLmlkS2V5KTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBbiBhbGlhcyB0byB1cGRhdGUgYWxsLlxuICAgKi9cbiAgdXBkYXRlQWxsKHN0YXRlOiBQYXJ0aWFsPEU+KSB7XG4gICAgaWYgKHRoaXMuX3ZhbHVlKCkuaWRzLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xuICAgIHRoaXMudXBkYXRlKG51bGwsIHN0YXRlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgdGhlIHJvb3Qgc3RhdGUgKGRhdGEgd2hpY2ggaXMgZXh0ZXJuYWwgdG8gdGhlIGVudGl0aWVzKS5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogdGhpcy5zdG9yZS51cGRhdGVSb290KHtcbiAgICogICBtZXRhZGF0YTogJ25ldyBtZXRhZGF0YVxuICAgKiB9KTtcbiAgICpcbiAgICogIHRoaXMuc3RvcmUudXBkYXRlUm9vdChzdGF0ZSA9PiB7XG4gICAqICAgIHJldHVybiB7XG4gICAqICAgICAgbWV0YWRhdGE6IHtcbiAgICogICAgICAgIC4uLnN0YXRlLm1ldGFkYXRhLFxuICAgKiAgICAgICAga2V5OiAnbmV3IHZhbHVlJ1xuICAgKiAgICAgIH1cbiAgICogICAgfVxuICAgKiAgfSk7XG4gICAqL1xuICB1cGRhdGVSb290KG5ld1N0YXRlRm46ICgoc3RhdGU6IFJlYWRvbmx5PFM+KSA9PiBQYXJ0aWFsPFM+KSB8IFBhcnRpYWw8Uz4sIGFjdGlvbj86IEFjdGlvbikge1xuICAgIGNvbnN0IG5ld1N0YXRlID0gaXNGdW5jdGlvbihuZXdTdGF0ZUZuKSA/IG5ld1N0YXRlRm4odGhpcy5fdmFsdWUoKSkgOiBuZXdTdGF0ZUZuO1xuXG4gICAgaWYgKG5ld1N0YXRlID09PSB0aGlzLl92YWx1ZSgpKSB7XG4gICAgICB0aHJvdyBuZXcgQWtpdGFJbW11dGFiaWxpdHlFcnJvcih0aGlzLnN0b3JlTmFtZSk7XG4gICAgfVxuXG4gICAgaXNEZXYoKSAmJiBfX2dsb2JhbFN0YXRlLnNldEFjdGlvbihhY3Rpb24gfHwgeyB0eXBlOiAnVXBkYXRlIFJvb3QnIH0pO1xuXG4gICAgdGhpcy5zZXRTdGF0ZShzdGF0ZSA9PiB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi4oc3RhdGUgYXMgYW55KSxcbiAgICAgICAgLi4uKG5ld1N0YXRlIGFzIGFueSlcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICpcbiAgICogUmVtb3ZlIG9uZSBvciBtb3JlIGVudGl0aWVzIGZyb20gdGhlIHN0b3JlOlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiB0aGlzLnN0b3JlLnJlbW92ZSg1KTtcbiAgICogdGhpcy5zdG9yZS5yZW1vdmUoWzEsMiwzXSk7XG4gICAqIHRoaXMuc3RvcmUucmVtb3ZlKGVudGl0eSA9PiBlbnRpdHkuaWQgPT09IDEpO1xuICAgKiB0aGlzLnN0b3JlLnJlbW92ZSgpO1xuICAgKi9cbiAgcmVtb3ZlKGlkPzogSUQgfCBJRFtdKTtcbiAgcmVtb3ZlKHByZWRpY2F0ZTogKGVudGl0eTogUmVhZG9ubHk8RT4pID0+IGJvb2xlYW4pO1xuICByZW1vdmUoaWRzT3JGbj86IElEIHwgSURbXSB8ICgoZW50aXR5OiBSZWFkb25seTxFPikgPT4gYm9vbGVhbikpIHtcbiAgICBjb25zdCBzdG9yZUlkcyA9IHRoaXMuX3ZhbHVlKCkuaWRzO1xuXG4gICAgaWYgKHN0b3JlSWRzLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xuICAgIGNvbnN0IGlkUGFzc2VkID0gdG9Cb29sZWFuKGlkc09yRm4pO1xuICAgIGlmICghaWRQYXNzZWQpIHRoaXMuc2V0UHJpc3RpbmUoKTtcblxuICAgIGxldCBpZHM6IElEW10gPSBbXTtcbiAgICBpZiAoaXNGdW5jdGlvbihpZHNPckZuKSkge1xuICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHN0b3JlSWRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGlkID0gc3RvcmVJZHNbaV07XG4gICAgICAgIGNvbnN0IGVudGl0eSA9IHRoaXMuX3ZhbHVlKCkuZW50aXRpZXNbaWRdO1xuICAgICAgICBpZiAoZW50aXR5ICYmIGlkc09yRm4oZW50aXR5KSkge1xuICAgICAgICAgIGlkcy5wdXNoKGlkKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBpZHMgPSBpZFBhc3NlZCA/IGNvZXJjZUFycmF5KGlkc09yRm4pIDogbnVsbDtcbiAgICB9XG5cbiAgICBpZiAoaWRzICYmIGlkcy5sZW5ndGggPT09IDApIHJldHVybjtcbiAgICBpc0RldigpICYmIF9fZ2xvYmFsU3RhdGUuc2V0QWN0aW9uKHsgdHlwZTogJ1JlbW92ZSBFbnRpdHknLCBlbnRpdHlJZDogaWRzIH0pO1xuXG4gICAgdGhpcy5zZXRTdGF0ZShzdGF0ZSA9PiB7XG4gICAgICByZXR1cm4gX2NydWQuX3JlbW92ZShzdGF0ZSwgaWRzKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKiBVcGRhdGUgdGhlIGFjdGl2ZSBlbnRpdHkuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIHRoaXMuc3RvcmUudXBkYXRlQWN0aXZlKGFjdGl2ZSA9PiB7XG4gICAqICAgcmV0dXJuIHtcbiAgICogICAgIGNvbmZpZzoge1xuICAgKiAgICAgIC4uYWN0aXZlLmNvbmZpZyxcbiAgICogICAgICBkYXRlXG4gICAqICAgICB9XG4gICAqICAgfVxuICAgKiB9KVxuICAgKi9cbiAgdXBkYXRlQWN0aXZlKG5ld1N0YXRlRm46ICgoZW50aXR5OiBSZWFkb25seTxFPikgPT4gUGFydGlhbDxFPikgfCBQYXJ0aWFsPEU+KSB7XG4gICAgYXNzZXJ0QWN0aXZlKHRoaXMuX3ZhbHVlKCkpO1xuICAgIGlzRGV2KCkgJiYgX19nbG9iYWxTdGF0ZS5zZXRBY3Rpb24oeyB0eXBlOiAnVXBkYXRlIEFjdGl2ZSBFbnRpdHknLCBlbnRpdHlJZDogdGhpcy5fdmFsdWUoKS5hY3RpdmUgfSk7XG4gICAgdGhpcy5zZXRTdGF0ZShzdGF0ZSA9PiB7XG4gICAgICBjb25zdCBhY3RpdmVJZCA9IHN0YXRlLmFjdGl2ZTtcbiAgICAgIGNvbnN0IG5ld1N0YXRlID0gaXNGdW5jdGlvbihuZXdTdGF0ZUZuKSA/IG5ld1N0YXRlRm4oc3RhdGUuZW50aXRpZXNbYWN0aXZlSWRdKSA6IG5ld1N0YXRlRm47XG4gICAgICBpZiAobmV3U3RhdGUgPT09IHN0YXRlKSB7XG4gICAgICAgIHRocm93IG5ldyBBa2l0YUltbXV0YWJpbGl0eUVycm9yKHRoaXMuc3RvcmVOYW1lKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBfY3J1ZC5fdXBkYXRlKHN0YXRlLCBbYWN0aXZlSWRdLCBuZXdTdGF0ZSwgdGhpcy5pZEtleSk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHRoZSBnaXZlbiBlbnRpdHkgYXMgYWN0aXZlLlxuICAgKi9cbiAgc2V0QWN0aXZlKGlkOiBJRCkge1xuICAgIGlmIChpZCA9PT0gdGhpcy5fdmFsdWUoKS5hY3RpdmUpIHJldHVybjtcbiAgICBpc0RldigpICYmIF9fZ2xvYmFsU3RhdGUuc2V0QWN0aW9uKHsgdHlwZTogJ1NldCBBY3RpdmUgRW50aXR5JywgZW50aXR5SWQ6IGlkIH0pO1xuICAgIHRoaXMuc2V0U3RhdGUoc3RhdGUgPT4ge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4uKHN0YXRlIGFzIGFueSksXG4gICAgICAgIGFjdGl2ZTogaWRcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cbn1cblxuZXhwb3J0IGNvbnN0IGdldEluaXRpYWxFbnRpdGllc1N0YXRlID0gKCkgPT5cbiAgKHtcbiAgICBlbnRpdGllczoge30sXG4gICAgaWRzOiBbXSxcbiAgICBsb2FkaW5nOiB0cnVlLFxuICAgIGVycm9yOiBudWxsXG4gIH0gYXMgRW50aXR5U3RhdGUpO1xuXG5leHBvcnQgY29uc3QgZ2V0SW5pdGlhbEFjdGl2ZVN0YXRlID0gKCkgPT5cbiAgKHtcbiAgICBhY3RpdmU6IG51bGxcbiAgfSBhcyBBY3RpdmVTdGF0ZSk7XG4iLCJleHBvcnQgZW51bSBPcmRlciB7XG4gIEFTQyA9ICdhc2MnLFxuICBERVNDID0gJ2Rlc2MnXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjb21wYXJlVmFsdWVzKGtleSwgb3JkZXI6IE9yZGVyID0gT3JkZXIuQVNDKSB7XG4gIHJldHVybiBmdW5jdGlvbihhLCBiKSB7XG4gICAgaWYgKCFhLmhhc093blByb3BlcnR5KGtleSkgfHwgIWIuaGFzT3duUHJvcGVydHkoa2V5KSkge1xuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuXG4gICAgY29uc3QgdmFyQSA9IHR5cGVvZiBhW2tleV0gPT09ICdzdHJpbmcnID8gYVtrZXldLnRvVXBwZXJDYXNlKCkgOiBhW2tleV07XG4gICAgY29uc3QgdmFyQiA9IHR5cGVvZiBiW2tleV0gPT09ICdzdHJpbmcnID8gYltrZXldLnRvVXBwZXJDYXNlKCkgOiBiW2tleV07XG5cbiAgICBsZXQgY29tcGFyaXNvbiA9IDA7XG4gICAgaWYgKHZhckEgPiB2YXJCKSB7XG4gICAgICBjb21wYXJpc29uID0gMTtcbiAgICB9IGVsc2UgaWYgKHZhckEgPCB2YXJCKSB7XG4gICAgICBjb21wYXJpc29uID0gLTE7XG4gICAgfVxuICAgIHJldHVybiBvcmRlciA9PSBPcmRlci5ERVNDID8gY29tcGFyaXNvbiAqIC0xIDogY29tcGFyaXNvbjtcbiAgfTtcbn1cbiIsImV4cG9ydCBmdW5jdGlvbiBtZW1vaXplT25lKGZuOiBGdW5jdGlvbikge1xuICBsZXQgbGFzdEFyZ3M7XG4gIGxldCBjaGFuZ2VkID0gZmFsc2U7XG4gIGxldCBmaXJzdEluaXQgPSB0cnVlO1xuICBsZXQgbGFzdFJlc3VsdDtcblxuICByZXR1cm4gZnVuY3Rpb24oLi4uYXJncykge1xuICAgIGlmIChsYXN0QXJncykge1xuICAgICAgLyoqIElmIGVudGl0aWVzIG5vciBpZHMgZG9lc24ndCBjaGFuZ2UgcmV0dXJuIHRoZSBsYXN0IHZhbHVlICovXG4gICAgICBjaGFuZ2VkID0gbGFzdEFyZ3NbMV0gIT09IGFyZ3NbMV0gfHwgbGFzdEFyZ3NbMF0gIT09IGFyZ3NbMF07XG4gICAgfVxuXG4gICAgaWYgKGZpcnN0SW5pdCB8fCAoY2hhbmdlZCAmJiAhZmlyc3RJbml0KSkge1xuICAgICAgbGFzdFJlc3VsdCA9IGZuLmFwcGx5KHRoaXMsIGFyZ3MpO1xuICAgIH1cblxuICAgIGZpcnN0SW5pdCA9IGZhbHNlO1xuICAgIGxhc3RBcmdzID0gYXJncztcbiAgICByZXR1cm4gbGFzdFJlc3VsdDtcbiAgfTtcbn1cbiIsImltcG9ydCB7IE9yZGVyIH0gZnJvbSAnLi4vaW50ZXJuYWwvc29ydCc7XG5cbmV4cG9ydCB0eXBlIFNvcnRCeTxFLCBTID0gYW55PiA9ICgoYTogRSwgYjogRSwgc3RhdGU/OiBTKSA9PiBudW1iZXIpIHwga2V5b2YgRTtcblxuZXhwb3J0IGludGVyZmFjZSBTb3J0QnlPcHRpb25zPEU+IHtcbiAgc29ydEJ5PzogU29ydEJ5PEU+O1xuICBzb3J0QnlPcmRlcj86IE9yZGVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFF1ZXJ5Q29uZmlnT3B0aW9uczxFID0gYW55PiBleHRlbmRzIFNvcnRCeU9wdGlvbnM8RT4ge31cblxuZXhwb3J0IGNvbnN0IHF1ZXJ5Q29uZmlnS2V5ID0gJ2FraXRhUXVlcnlDb25maWcnO1xuXG5leHBvcnQgZnVuY3Rpb24gUXVlcnlDb25maWc8RT4obWV0YWRhdGE6IFF1ZXJ5Q29uZmlnT3B0aW9uczxFPikge1xuICByZXR1cm4gZnVuY3Rpb24oY29uc3RydWN0b3I6IEZ1bmN0aW9uKSB7XG4gICAgY29uc3RydWN0b3JbcXVlcnlDb25maWdLZXldID0ge307XG4gICAgZm9yIChsZXQgaSA9IDAsIGtleXMgPSBPYmplY3Qua2V5cyhtZXRhZGF0YSk7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBrZXkgPSBrZXlzW2ldO1xuICAgICAgY29uc3RydWN0b3JbcXVlcnlDb25maWdLZXldW2tleV0gPSBtZXRhZGF0YVtrZXldO1xuICAgIH1cbiAgfTtcbn1cbiIsImltcG9ydCB7IFN0b3JlIH0gZnJvbSAnLi9zdG9yZSc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyB0YWtlIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgcXVlcnlDb25maWdLZXksIFF1ZXJ5Q29uZmlnT3B0aW9ucyB9IGZyb20gJy4vcXVlcnktY29uZmlnJztcblxuZXhwb3J0IGNsYXNzIFF1ZXJ5PFM+IHtcbiAgLyoqIFVzZSBvbmx5IGZvciBpbnRlcm5hbCBwbHVnaW5zIGxpa2UgUGFnaW5hdGlvbiAtIGRvbid0IHVzZSB0aGlzIHByb3BlcnR5ICoqL1xuICBfX3N0b3JlX186IFN0b3JlPFM+O1xuXG4gIGNvbnN0cnVjdG9yKHByb3RlY3RlZCBzdG9yZTogU3RvcmU8Uz4pIHtcbiAgICB0aGlzLl9fc3RvcmVfXyA9IHN0b3JlO1xuICB9XG5cbiAgLyoqXG4gICAqIFNlbGVjdCBhIHNsaWNlIGZyb20gdGhlIHN0b3JlLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiB0aGlzLnF1ZXJ5LnNlbGVjdCgpXG4gICAqIHRoaXMucXVlcnkuc2VsZWN0KHN0YXRlID0+IHN0YXRlLmVudGl0aWVzKVxuICAgKi9cbiAgc2VsZWN0PFI+KHByb2plY3Q/OiAoc3RvcmU6IFMpID0+IFIpOiBPYnNlcnZhYmxlPFI+O1xuICBzZWxlY3QoKTogT2JzZXJ2YWJsZTxTPjtcbiAgc2VsZWN0PFI+KHByb2plY3Q/OiAoc3RvcmU6IFMpID0+IFIpOiBPYnNlcnZhYmxlPFIgfCBTPiB7XG4gICAgbGV0IHN0YXRlID0gcHJvamVjdCA/IHByb2plY3QgOiBzdGF0ZSA9PiBzdGF0ZTtcbiAgICByZXR1cm4gdGhpcy5zdG9yZS5fc2VsZWN0KHN0YXRlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZWxlY3Qgb25jZSBhbmQgY29tcGxldGUuXG4gICAqL1xuICBzZWxlY3RPbmNlPFI+KHByb2plY3Q6IChzdG9yZTogUykgPT4gUik6IE9ic2VydmFibGU8Uj4ge1xuICAgIHJldHVybiB0aGlzLnNlbGVjdChwcm9qZWN0KS5waXBlKHRha2UoMSkpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNlbGVjdCB0aGUgc3RvcmUncyBsb2FkaW5nIHN0YXRlLlxuICAgKi9cbiAgc2VsZWN0TG9hZGluZygpIHtcbiAgICByZXR1cm4gdGhpcy5zZWxlY3Qoc3RhdGUgPT4gKHN0YXRlIGFzIFMgJiB7IGxvYWRpbmc6IGJvb2xlYW4gfSkubG9hZGluZyk7XG4gIH1cblxuICAvKipcbiAgICogU2VsZWN0IHRoZSBzdG9yZSdzIGVycm9yIHN0YXRlLlxuICAgKi9cbiAgc2VsZWN0RXJyb3IoKSB7XG4gICAgcmV0dXJuIHRoaXMuc2VsZWN0KHN0YXRlID0+IChzdGF0ZSBhcyBTICYgeyBlcnJvcjogYW55IH0pLmVycm9yKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHJhdyB2YWx1ZSBvZiB0aGUgc3RvcmUuXG4gICAqL1xuICBnZXRTbmFwc2hvdCgpOiBTIHtcbiAgICByZXR1cm4gdGhpcy5zdG9yZS5fdmFsdWUoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiAgUmV0dXJucyB3aGV0aGVyIHRoZSBzdGF0ZSBvZiB0aGUgc3RvcmUgaXMgcHJpc3RpbmUgKHRoZSBzZXQoKSBtZXRob2QgaGFzbid0IGJlZW4gZXhwbGljaXRseSBjYWxsZWRcbiAgICogIHNpbmNlIHRoZSBzdG9yZSBjcmVhdGlvbiwgb3IgdGhlIGxhc3QgdGltZSBzZXRQcmlzdGluZSgpd2FzIGNhbGxlZCkuXG4gICAqL1xuICBnZXQgaXNQcmlzdGluZSgpIHtcbiAgICByZXR1cm4gdGhpcy5zdG9yZS5pc1ByaXN0aW5lO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgd2hldGhlciB0aGUgc3RhdGUgb2YgdGhlIHN0b3JlIGlzIGRpcnR5ICh0aGUgc2V0KCkgbWV0aG9kXG4gICAqIG9yIHRoZSBzZXREaXJ0eSgpIG1ldGhvZCBoYXMgYmVlbiBleHBsaWNpdGx5IGNhbGxlZCBzaW5jZSB0aGUgc3RvcmUgY3JlYXRpb24sXG4gICAqIG9yIHRoZSBsYXN0IHRpbWUgc2V0UHJpc3RpbmUoKSB3YXMgY2FsbGVkKS5cbiAgICovXG4gIGdldCBpc0RpcnR5KCkge1xuICAgIHJldHVybiAhdGhpcy5zdG9yZS5pc1ByaXN0aW5lO1xuICB9XG5cbiAgZ2V0IGNvbmZpZygpOiBRdWVyeUNvbmZpZ09wdGlvbnMge1xuICAgIHJldHVybiB0aGlzLmNvbnN0cnVjdG9yW3F1ZXJ5Q29uZmlnS2V5XTtcbiAgfVxufVxuIiwiaW1wb3J0IHsgY29tYmluZUxhdGVzdCwgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgYXVkaXRUaW1lLCBtYXAsIHN3aXRjaE1hcCwgd2l0aExhdGVzdEZyb20gfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbmltcG9ydCB7IGNvbXBhcmVWYWx1ZXMsIE9yZGVyIH0gZnJvbSAnLi4vaW50ZXJuYWwvc29ydCc7XG5pbXBvcnQgeyBlbnRpdHlFeGlzdHMsIGlzRnVuY3Rpb24sIGlzVW5kZWZpbmVkLCB0b0Jvb2xlYW4gfSBmcm9tICcuLi9pbnRlcm5hbC91dGlscyc7XG5pbXBvcnQgeyBFbnRpdHlTdG9yZSB9IGZyb20gJy4vZW50aXR5LXN0b3JlJztcbmltcG9ydCB7IG1lbW9pemVPbmUgfSBmcm9tICcuL21lbW9pemUnO1xuaW1wb3J0IHsgUXVlcnkgfSBmcm9tICcuL3F1ZXJ5JztcbmltcG9ydCB7IFNvcnRCeSwgU29ydEJ5T3B0aW9ucyB9IGZyb20gJy4vcXVlcnktY29uZmlnJztcbmltcG9ydCB7IEFjdGl2ZVN0YXRlLCBFbnRpdHlTdGF0ZSwgSGFzaE1hcCwgSUQgfSBmcm9tICcuL3R5cGVzJztcblxuZXhwb3J0IGludGVyZmFjZSBTZWxlY3RPcHRpb25zPEU+IGV4dGVuZHMgU29ydEJ5T3B0aW9uczxFPiB7XG4gIGFzT2JqZWN0PzogYm9vbGVhbjtcbiAgZmlsdGVyQnk/OiAoKGVudGl0eTogRSkgPT4gYm9vbGVhbikgfCB1bmRlZmluZWQ7XG4gIGxpbWl0VG8/OiBudW1iZXI7XG59XG5cbi8qKlxuICogIEFuIGFic3RyYWN0aW9uIGZvciBxdWVyeWluZyB0aGUgZW50aXRpZXMgZnJvbSB0aGUgc3RvcmVcbiAqL1xuZXhwb3J0IGNsYXNzIFF1ZXJ5RW50aXR5PFMgZXh0ZW5kcyBFbnRpdHlTdGF0ZSwgRT4gZXh0ZW5kcyBRdWVyeTxTPiB7XG4gIHByb3RlY3RlZCBzdG9yZTogRW50aXR5U3RvcmU8UywgRT47XG4gIHByaXZhdGUgbWVtb2l6ZWQ7XG5cbiAgLyoqIFVzZSBvbmx5IGZvciBpbnRlcm5hbCBwbHVnaW5zIGxpa2UgUGFnaW5hdGlvbiAtIGRvbid0IHVzZSB0aGlzIHByb3BlcnR5ICoqL1xuICBfX3N0b3JlX187XG5cbiAgY29uc3RydWN0b3Ioc3RvcmU6IEVudGl0eVN0b3JlPFMsIEU+KSB7XG4gICAgc3VwZXIoc3RvcmUpO1xuICAgIHRoaXMuX19zdG9yZV9fID0gc3RvcmU7XG4gIH1cblxuICAvKipcbiAgICogU2VsZWN0IHRoZSBlbnRpcmUgc3RvcmUncyBlbnRpdHkgY29sbGVjdGlvbi5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogdGhpcy5zdG9yZS5zZWxlY3RBbGwoKTtcbiAgICovXG4gIHNlbGVjdEFsbChvcHRpb25zOiB7IGFzT2JqZWN0OiB0cnVlOyBmaWx0ZXJCeT86IFNlbGVjdE9wdGlvbnM8RT5bJ2ZpbHRlckJ5J107IGxpbWl0VG8/OiBudW1iZXI7IHNvcnRCeT86IHVuZGVmaW5lZDsgc29ydEJ5T3JkZXI/OiB1bmRlZmluZWQgfSk6IE9ic2VydmFibGU8SGFzaE1hcDxFPj47XG4gIHNlbGVjdEFsbChvcHRpb25zOiB7IGZpbHRlckJ5OiBTZWxlY3RPcHRpb25zPEU+WydmaWx0ZXJCeSddOyBsaW1pdFRvPzogbnVtYmVyOyBzb3J0Qnk/OiBTb3J0Qnk8RT47IHNvcnRCeU9yZGVyPzogT3JkZXIgfSk6IE9ic2VydmFibGU8RVtdPjtcbiAgc2VsZWN0QWxsKG9wdGlvbnM6IHsgYXNPYmplY3Q6IHRydWU7IGxpbWl0VG8/OiBudW1iZXI7IHNvcnRCeT86IHVuZGVmaW5lZDsgc29ydEJ5T3JkZXI/OiB1bmRlZmluZWQgfSk6IE9ic2VydmFibGU8SGFzaE1hcDxFPj47XG4gIHNlbGVjdEFsbChvcHRpb25zOiB7IGxpbWl0VG8/OiBudW1iZXI7IHNvcnRCeT86IFNvcnRCeTxFPjsgc29ydEJ5T3JkZXI/OiBPcmRlciB9KTogT2JzZXJ2YWJsZTxFW10+O1xuICBzZWxlY3RBbGwob3B0aW9uczogeyBhc09iamVjdDogZmFsc2U7IGZpbHRlckJ5PzogU2VsZWN0T3B0aW9uczxFPlsnZmlsdGVyQnknXTsgbGltaXRUbz86IG51bWJlcjsgc29ydEJ5PzogU29ydEJ5PEU+OyBzb3J0QnlPcmRlcj86IE9yZGVyIH0pOiBPYnNlcnZhYmxlPEVbXT47XG4gIHNlbGVjdEFsbCgpOiBPYnNlcnZhYmxlPEVbXT47XG4gIHNlbGVjdEFsbChcbiAgICBvcHRpb25zOiBTZWxlY3RPcHRpb25zPEU+ID0ge1xuICAgICAgYXNPYmplY3Q6IGZhbHNlXG4gICAgfVxuICApOiBPYnNlcnZhYmxlPEVbXSB8IEhhc2hNYXA8RT4+IHtcbiAgICBjb25zdCBzZWxlY3RTdGF0ZSQgPSB0aGlzLnNlbGVjdChzdGF0ZSA9PiBzdGF0ZSk7XG4gICAgY29uc3Qgc2VsZWN0RW50aXRpZXMkID0gdGhpcy5zZWxlY3Qoc3RhdGUgPT4gc3RhdGUuZW50aXRpZXMpO1xuXG4gICAgb3B0aW9ucy5zb3J0QnkgPSBvcHRpb25zLnNvcnRCeSB8fCAodGhpcy5jb25maWcgJiYgKHRoaXMuY29uZmlnLnNvcnRCeSBhcyBTb3J0Qnk8RT4pKTtcbiAgICBvcHRpb25zLnNvcnRCeU9yZGVyID0gb3B0aW9ucy5zb3J0QnlPcmRlciB8fCAodGhpcy5jb25maWcgJiYgdGhpcy5jb25maWcuc29ydEJ5T3JkZXIpO1xuXG4gICAgcmV0dXJuIHNlbGVjdEVudGl0aWVzJC5waXBlKFxuICAgICAgd2l0aExhdGVzdEZyb20oc2VsZWN0U3RhdGUkLCAoZW50aXRpZXM6IEhhc2hNYXA8RT4sIHN0YXRlOiBTKSA9PiB7XG4gICAgICAgIGNvbnN0IHsgaWRzIH0gPSBzdGF0ZTtcbiAgICAgICAgaWYgKG9wdGlvbnMuYXNPYmplY3QpIHtcbiAgICAgICAgICByZXR1cm4gdG9NYXAoaWRzLCBlbnRpdGllcywgb3B0aW9ucyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKCFvcHRpb25zLmZpbHRlckJ5ICYmICFvcHRpb25zLnNvcnRCeSkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLm1lbW9pemVkKSB7XG4gICAgICAgICAgICAgIHRoaXMubWVtb2l6ZWQgPSBtZW1vaXplT25lKHRvQXJyYXkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMubWVtb2l6ZWQoc3RhdGUsIG9wdGlvbnMpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiB0b0FycmF5KHN0YXRlLCBvcHRpb25zKTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgZW50aXJlIHN0b3JlJ3MgZW50aXR5IGNvbGxlY3Rpb24uXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIHRoaXMuc3RvcmUuZ2V0QWxsKCk7XG4gICAqL1xuICBnZXRBbGwob3B0aW9uczogeyBhc09iamVjdDogdHJ1ZTsgZmlsdGVyQnk/OiBTZWxlY3RPcHRpb25zPEU+WydmaWx0ZXJCeSddOyBsaW1pdFRvPzogbnVtYmVyIH0pOiBIYXNoTWFwPEU+O1xuICBnZXRBbGwob3B0aW9uczogeyBmaWx0ZXJCeTogU2VsZWN0T3B0aW9uczxFPlsnZmlsdGVyQnknXTsgbGltaXRUbz86IG51bWJlciB9KTogRVtdO1xuICBnZXRBbGwob3B0aW9uczogeyBhc09iamVjdDogdHJ1ZTsgbGltaXRUbz86IG51bWJlciB9KTogSGFzaE1hcDxFPjtcbiAgZ2V0QWxsKG9wdGlvbnM6IHsgbGltaXRUbz86IG51bWJlciB9KTogRVtdO1xuICBnZXRBbGwob3B0aW9uczogeyBhc09iamVjdDogZmFsc2U7IGZpbHRlckJ5PzogU2VsZWN0T3B0aW9uczxFPlsnZmlsdGVyQnknXTsgbGltaXRUbz86IG51bWJlciB9KTogRVtdO1xuICBnZXRBbGwoKTogRVtdO1xuICBnZXRBbGwob3B0aW9uczogU2VsZWN0T3B0aW9uczxFPiA9IHsgYXNPYmplY3Q6IGZhbHNlLCBmaWx0ZXJCeTogdW5kZWZpbmVkLCBsaW1pdFRvOiB1bmRlZmluZWQgfSk6IEVbXSB8IEhhc2hNYXA8RT4ge1xuICAgIGNvbnN0IHN0YXRlID0gdGhpcy5nZXRTbmFwc2hvdCgpO1xuXG4gICAgaWYgKG9wdGlvbnMuYXNPYmplY3QpIHtcbiAgICAgIHJldHVybiB0b01hcChzdGF0ZS5pZHMsIHN0YXRlLmVudGl0aWVzLCBvcHRpb25zLCB0cnVlKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdG9BcnJheShzdGF0ZSwgb3B0aW9ucyk7XG4gIH1cblxuICAvKipcbiAgICogU2VsZWN0IG11bHRpcGxlIGVudGl0aWVzIGZyb20gdGhlIHN0b3JlLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiB0aGlzLnN0b3JlLnNlbGVjdE1hbnkoWzEsMl0pO1xuICAgKi9cbiAgc2VsZWN0TWFueShpZHM6IElEW10sIG9wdGlvbnM6IHsgZmlsdGVyVW5kZWZpbmVkPzogYm9vbGVhbiB9ID0ge30pOiBPYnNlcnZhYmxlPEVbXT4ge1xuICAgIGNvbnN0IGZpbHRlclVuZGVmaW5lZCA9IGlzVW5kZWZpbmVkKG9wdGlvbnMuZmlsdGVyVW5kZWZpbmVkKSA/IHRydWUgOiBvcHRpb25zLmZpbHRlclVuZGVmaW5lZDtcbiAgICBjb25zdCBlbnRpdGllcyA9IGlkcy5tYXAoaWQgPT4gdGhpcy5zZWxlY3RFbnRpdHkoaWQpKTtcblxuICAgIHJldHVybiBjb21iaW5lTGF0ZXN0KGVudGl0aWVzKS5waXBlKFxuICAgICAgbWFwKGVudGl0aWVzID0+IHtcbiAgICAgICAgcmV0dXJuIGZpbHRlclVuZGVmaW5lZCA/IGVudGl0aWVzLmZpbHRlcih2YWwgPT4gIWlzVW5kZWZpbmVkKHZhbCkpIDogZW50aXRpZXM7XG4gICAgICB9KSxcbiAgICAgIGF1ZGl0VGltZSgwKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogU2VsZWN0IGFuIGVudGl0eSBvciBhIHNsaWNlIG9mIGFuIGVudGl0eS5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogdGhpcy5wYWdlc1N0b3JlLnNlbGVjdEVudGl0eSgxKVxuICAgKiB0aGlzLnBhZ2VzU3RvcmUuc2VsZWN0RW50aXR5KDEsIGVudGl0eSA9PiBlbnRpdHkuY29uZmlnLmRhdGUpXG4gICAqXG4gICAqL1xuICBzZWxlY3RFbnRpdHk8Uj4oaWQ6IElEKTogT2JzZXJ2YWJsZTxFPjtcbiAgc2VsZWN0RW50aXR5PFI+KGlkOiBJRCwgcHJvamVjdDogKGVudGl0eTogRSkgPT4gUik6IE9ic2VydmFibGU8Uj47XG4gIHNlbGVjdEVudGl0eTxSPihpZDogSUQsIHByb2plY3Q/OiAoZW50aXR5OiBFKSA9PiBSKTogT2JzZXJ2YWJsZTxSIHwgRT4ge1xuICAgIGlmICghcHJvamVjdCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2J5SWQoaWQpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLnNlbGVjdChzdGF0ZSA9PiB7XG4gICAgICBpZiAodGhpcy5oYXNFbnRpdHkoaWQpKSB7XG4gICAgICAgIHJldHVybiBwcm9qZWN0KHRoaXMuZ2V0RW50aXR5KGlkKSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGFuIGVudGl0eSBieSBpZFxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiB0aGlzLnN0b3JlLmdldEVudGl0eSgxKTtcbiAgICovXG4gIGdldEVudGl0eShpZDogSUQpOiBFIHtcbiAgICByZXR1cm4gdGhpcy5nZXRTbmFwc2hvdCgpLmVudGl0aWVzW2lkXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZWxlY3QgdGhlIGFjdGl2ZSBlbnRpdHkncyBpZC5cbiAgICovXG4gIHNlbGVjdEFjdGl2ZUlkKCk6IE9ic2VydmFibGU8SUQ+IHtcbiAgICByZXR1cm4gdGhpcy5zZWxlY3Qoc3RhdGUgPT4gKHN0YXRlIGFzIFMgJiBBY3RpdmVTdGF0ZSkuYWN0aXZlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIGFjdGl2ZSBpZFxuICAgKi9cbiAgZ2V0QWN0aXZlSWQoKTogSUQge1xuICAgIHJldHVybiAodGhpcy5nZXRTbmFwc2hvdCgpIGFzIFMgJiBBY3RpdmVTdGF0ZSkuYWN0aXZlO1xuICB9XG5cbiAgLyoqXG4gICAqIFNlbGVjdCB0aGUgYWN0aXZlIGVudGl0eS5cbiAgICovXG4gIHNlbGVjdEFjdGl2ZTxSPigpOiBPYnNlcnZhYmxlPEU+O1xuICBzZWxlY3RBY3RpdmU8Uj4ocHJvamVjdDogKGVudGl0eTogRSkgPT4gUik6IE9ic2VydmFibGU8Uj47XG4gIHNlbGVjdEFjdGl2ZTxSPihwcm9qZWN0PzogKGVudGl0eTogRSkgPT4gUik6IE9ic2VydmFibGU8UiB8IEU+IHtcbiAgICByZXR1cm4gdGhpcy5zZWxlY3RBY3RpdmVJZCgpLnBpcGUoc3dpdGNoTWFwKGFjdGl2ZUlkID0+IHRoaXMuc2VsZWN0RW50aXR5KGFjdGl2ZUlkLCBwcm9qZWN0KSkpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgYWN0aXZlIGVudGl0eS5cbiAgICovXG4gIGdldEFjdGl2ZSgpOiBFIHtcbiAgICBjb25zdCBhY3RpdmVJZDogSUQgPSB0aGlzLmdldEFjdGl2ZUlkKCk7XG4gICAgcmV0dXJuIHRvQm9vbGVhbihhY3RpdmVJZCkgPyB0aGlzLmdldEVudGl0eShhY3RpdmVJZCkgOiB1bmRlZmluZWQ7XG4gIH1cblxuICAvKipcbiAgICogU2VsZWN0IHRoZSBzdG9yZSdzIGVudGl0eSBjb2xsZWN0aW9uIGxlbmd0aC5cbiAgICovXG4gIHNlbGVjdENvdW50KHByZWRpY2F0ZT86IChlbnRpdHk6IEUpID0+IGJvb2xlYW4pOiBPYnNlcnZhYmxlPG51bWJlcj4ge1xuICAgIGlmIChpc0Z1bmN0aW9uKHByZWRpY2F0ZSkpIHtcbiAgICAgIHJldHVybiB0aGlzLnNlbGVjdEFsbCh7XG4gICAgICAgIGZpbHRlckJ5OiBwcmVkaWNhdGVcbiAgICAgIH0pLnBpcGUobWFwKGVudGl0aWVzID0+IGVudGl0aWVzLmxlbmd0aCkpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLnNlbGVjdChzdG9yZSA9PiBzdG9yZS5pZHMubGVuZ3RoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHN0b3JlJ3MgZW50aXR5IGNvbGxlY3Rpb24gbGVuZ3RoLlxuICAgKi9cbiAgZ2V0Q291bnQocHJlZGljYXRlPzogKGVudGl0eTogRSkgPT4gYm9vbGVhbik6IG51bWJlciB7XG4gICAgaWYgKGlzRnVuY3Rpb24ocHJlZGljYXRlKSkge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0QWxsKCkuZmlsdGVyKHByZWRpY2F0ZSkubGVuZ3RoO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5nZXRTbmFwc2hvdCgpLmlkcy5sZW5ndGg7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB3aGV0aGVyIGVudGl0eSBleGlzdHMuXG4gICAqL1xuICBoYXNFbnRpdHkoaWQ6IElEKTogYm9vbGVhbjtcbiAgaGFzRW50aXR5KHByb2plY3Q6IChlbnRpdHk6IEUpID0+IGJvb2xlYW4pOiBib29sZWFuO1xuICBoYXNFbnRpdHkocHJvamVjdE9ySWQ6IGFueSk6IGJvb2xlYW4ge1xuICAgIGlmIChpc0Z1bmN0aW9uKHByb2plY3RPcklkKSkge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0QWxsKCkuc29tZShwcm9qZWN0T3JJZCk7XG4gICAgfVxuICAgIHJldHVybiBwcm9qZWN0T3JJZCBpbiB0aGlzLnN0b3JlLmVudGl0aWVzO1xuICB9XG5cbiAgaXNFbXB0eSgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRTbmFwc2hvdCgpLmlkcy5sZW5ndGggPT09IDA7XG4gIH1cblxuICBwcml2YXRlIF9ieUlkKGlkOiBJRCk6IE9ic2VydmFibGU8RT4ge1xuICAgIHJldHVybiB0aGlzLnNlbGVjdChzdGF0ZSA9PiB0aGlzLmdldEVudGl0eShpZCkpO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5tZW1vaXplZCA9IG51bGw7XG4gIH1cbn1cblxuZnVuY3Rpb24gdG9BcnJheTxFLCBTIGV4dGVuZHMgRW50aXR5U3RhdGU+KHN0YXRlOiBTLCBvcHRpb25zOiBTZWxlY3RPcHRpb25zPEU+KTogRVtdIHtcbiAgbGV0IGFyciA9IFtdO1xuICBjb25zdCB7IGlkcywgZW50aXRpZXMgfSA9IHN0YXRlO1xuICBjb25zdCB7IGZpbHRlckJ5LCBsaW1pdFRvLCBzb3J0QnksIHNvcnRCeU9yZGVyIH0gPSBvcHRpb25zO1xuXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgaWRzLmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgaWQgPSBpZHNbaV07XG5cbiAgICBpZiAoIWVudGl0eUV4aXN0cyhpZCwgZW50aXRpZXMpKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICBpZiAoIWZpbHRlckJ5KSB7XG4gICAgICBhcnIucHVzaChlbnRpdGllc1tpZF0pO1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgaWYgKGZpbHRlckJ5KGVudGl0aWVzW2lkXSkpIHtcbiAgICAgIGFyci5wdXNoKGVudGl0aWVzW2lkXSk7XG4gICAgfVxuICB9XG5cbiAgaWYgKHNvcnRCeSkge1xuICAgIGxldCBfc29ydEJ5OiBhbnkgPSBpc0Z1bmN0aW9uKHNvcnRCeSkgPyBzb3J0QnkgOiBjb21wYXJlVmFsdWVzKHNvcnRCeSwgc29ydEJ5T3JkZXIpO1xuICAgIGFyciA9IGFyci5zb3J0KChhLCBiKSA9PiBfc29ydEJ5KGEsIGIsIHN0YXRlKSk7XG4gIH1cbiAgY29uc3QgbGVuZ3RoID0gTWF0aC5taW4obGltaXRUbyB8fCBhcnIubGVuZ3RoLCBhcnIubGVuZ3RoKTtcblxuICByZXR1cm4gbGVuZ3RoID09PSBhcnIubGVuZ3RoID8gYXJyIDogYXJyLnNsaWNlKDAsIGxlbmd0aCk7XG59XG5cbmZ1bmN0aW9uIHRvTWFwPEU+KGlkczogSURbXSwgZW50aXRpZXM6IEhhc2hNYXA8RT4sIG9wdGlvbnM6IFNlbGVjdE9wdGlvbnM8RT4sIGdldCA9IGZhbHNlKTogSGFzaE1hcDxFPiB7XG4gIGNvbnN0IG1hcCA9IHt9O1xuICBjb25zdCB7IGZpbHRlckJ5LCBsaW1pdFRvIH0gPSBvcHRpb25zO1xuXG4gIGlmIChnZXQgJiYgIWZpbHRlckJ5ICYmICFsaW1pdFRvKSB7XG4gICAgcmV0dXJuIGVudGl0aWVzO1xuICB9XG5cbiAgY29uc3QgbGVuZ3RoID0gTWF0aC5taW4obGltaXRUbyB8fCBpZHMubGVuZ3RoLCBpZHMubGVuZ3RoKTtcblxuICBpZiAoZmlsdGVyQnkgJiYgaXNVbmRlZmluZWQobGltaXRUbykgPT09IGZhbHNlKSB7XG4gICAgbGV0IGNvdW50ID0gMDtcbiAgICBmb3IgKGxldCBpID0gMCwgbGVuZ3RoID0gaWRzLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoY291bnQgPT09IGxpbWl0VG8pIGJyZWFrO1xuICAgICAgY29uc3QgaWQgPSBpZHNbaV07XG4gICAgICBpZiAoIWVudGl0eUV4aXN0cyhpZCwgZW50aXRpZXMpKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgaWYgKGZpbHRlckJ5KGVudGl0aWVzW2lkXSkpIHtcbiAgICAgICAgbWFwW2lkXSA9IGVudGl0aWVzW2lkXTtcbiAgICAgICAgY291bnQrKztcbiAgICAgIH1cbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgaWQgPSBpZHNbaV07XG5cbiAgICAgIGlmICghZW50aXR5RXhpc3RzKGlkLCBlbnRpdGllcykpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIGlmICghZmlsdGVyQnkpIHtcbiAgICAgICAgbWFwW2lkXSA9IGVudGl0aWVzW2lkXTtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIGlmICh0b0Jvb2xlYW4oZmlsdGVyQnkoZW50aXRpZXNbaWRdKSkpIHtcbiAgICAgICAgbWFwW2lkXSA9IGVudGl0aWVzW2lkXTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gbWFwO1xufVxuIiwiaW1wb3J0IHsgZW5kQmF0Y2gsIHN0YXJ0QmF0Y2ggfSBmcm9tICcuLi9pbnRlcm5hbC90cmFuc2FjdGlvbi5pbnRlcm5hbCc7XG5cbi8qKlxuICogIEEgbG9naWNhbCB0cmFuc2FjdGlvbi5cbiAqICBVc2UgdGhpcyB0cmFuc2FjdGlvbiB0byBvcHRpbWl6ZSB0aGUgZGlzcGF0Y2ggb2YgYWxsIHRoZSBzdG9yZXMuXG4gKiAgVGhlIGZvbGxvd2luZyBjb2RlIHdpbGwgdXBkYXRlIHRoZSBzdG9yZSwgQlVUICBlbWl0cyBvbmx5IG9uY2VcbiAqXG4gKiAgQGV4YW1wbGVcbiAqICBhcHBseVRyYW5zYWN0aW9uKCgpID0+IHtcbiAqICAgIHRoaXMudG9kb3NTdG9yZS5hZGQobmV3IFRvZG8oMSwgdGl0bGUpKTtcbiAqICAgIHRoaXMudG9kb3NTdG9yZS5hZGQobmV3IFRvZG8oMiwgdGl0bGUpKTtcbiAqICB9KTtcbiAqXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBhcHBseVRyYW5zYWN0aW9uPFQ+KGFjdGlvbjogKCkgPT4gVCwgdGhpc0FyZyA9IHVuZGVmaW5lZCk6IFQge1xuICBzdGFydEJhdGNoKCk7XG4gIHRyeSB7XG4gICAgcmV0dXJuIGFjdGlvbi5hcHBseSh0aGlzQXJnKTtcbiAgfSBmaW5hbGx5IHtcbiAgICBlbmRCYXRjaCgpO1xuICB9XG59XG5cbi8qKlxuICogIEEgbG9naWNhbCB0cmFuc2FjdGlvbi5cbiAqICBVc2UgdGhpcyB0cmFuc2FjdGlvbiB0byBvcHRpbWl6ZSB0aGUgZGlzcGF0Y2ggb2YgYWxsIHRoZSBzdG9yZXMuXG4gKlxuICogIFRoZSBmb2xsb3dpbmcgY29kZSB3aWxsIHVwZGF0ZSB0aGUgc3RvcmUsIEJVVCAgZW1pdHMgb25seSBvbmNlLlxuICpcbiAqICBAZXhhbXBsZVxuICogIEB0cmFuc2FjdGlvblxuICogIGFkZFRvZG9zKCkge1xuICogICAgdGhpcy50b2Rvc1N0b3JlLmFkZChuZXcgVG9kbygxLCB0aXRsZSkpO1xuICogICAgdGhpcy50b2Rvc1N0b3JlLmFkZChuZXcgVG9kbygyLCB0aXRsZSkpO1xuICogIH1cbiAqXG4gKlxuICovXG5leHBvcnQgZnVuY3Rpb24gdHJhbnNhY3Rpb24oKSB7XG4gIHJldHVybiBmdW5jdGlvbih0YXJnZXQ6IGFueSwgcHJvcGVydHlLZXk6IHN0cmluZywgZGVzY3JpcHRvcjogUHJvcGVydHlEZXNjcmlwdG9yKSB7XG4gICAgY29uc3Qgb3JpZ2luYWxNZXRob2QgPSBkZXNjcmlwdG9yLnZhbHVlO1xuXG4gICAgZGVzY3JpcHRvci52YWx1ZSA9IGZ1bmN0aW9uKC4uLmFyZ3MpIHtcbiAgICAgIHJldHVybiBhcHBseVRyYW5zYWN0aW9uKCgpID0+IHtcbiAgICAgICAgcmV0dXJuIG9yaWdpbmFsTWV0aG9kLmFwcGx5KHRoaXMsIGFyZ3MpO1xuICAgICAgfSwgdGhpcyk7XG4gICAgfTtcblxuICAgIHJldHVybiBkZXNjcmlwdG9yO1xuICB9O1xufVxuIiwiaW1wb3J0IHsgaXNPYmplY3QgfSBmcm9tICcuLi9pbnRlcm5hbC91dGlscyc7XG5cbi8vIGh0dHBzOi8vZ2l0aHViLmNvbS9nZW9yYXBib3gvaW1tdXRhYmxlLWFycmF5c1xuXG4vKipcbiAqIEFkZHMgb25lIG9yIG1vcmUgZWxlbWVudHMgdG8gdGhlIGVuZCBvZiBhbiBhcnJheSBieSByZXR1cm5pbmdcbiAqIGEgbmV3IGFycmF5IGluc3RlYWQgb2YgbXV0YXRpbmcgdGhlIG9yaWdpbmFsIG9uZS5cbiAqXG4gKiBAZXhhbXBsZVxuICogY29uc3Qgb3JpZ2luYWxBcnJheSA9IFsnYScsICdiJywgJ2MnLCAnZCcsICdlJ107XG4gKiBjb25zdCByZXN1bHRBcnJheSA9IHB1c2gob3JpZ2luYWxBcnJheSwgJ2YnLCAnZycpO1xuICogLy8gLT4gb3JpZ2luYWxBcnJheSBbJ2EnLCAnYicsICdjJywgJ2QnLCAnZSddXG4gKiAvLyAtPiByZXN1bHRBcnJheSBbJ2EnLCAnYicsICdjJywgJ2QnLCAnZScsICdmJywgJ2cnXVxuICovXG5leHBvcnQgZnVuY3Rpb24gcHVzaDxUPihhcnJheTogVFtdLCAuLi5lbGVtZW50TjogVFtdKTogVFtdIHtcbiAgcmV0dXJuIFsuLi5hcnJheSwgLi4uZWxlbWVudE5dO1xufVxuXG4vKipcbiAqIERlbGV0ZXMgYW4gZWxlbWVudCBmcm9tIGFuIGFycmF5IGJ5IGl0cyBpbmRleCBpbiB0aGUgYXJyYXkuXG4gKlxuICogQGV4YW1wbGVcbiAqIGNvbnN0IG9yaWdpbmFsQXJyYXkgPSBbJ2EnLCAnYicsICdjJywgJ2QnLCAnZSddO1xuICogY29uc3QgcmVzdWx0QXJyYXkgPSByZW1vdmUob3JpZ2luYWxBcnJheSwgMik7XG4gKiAvLyAtPiBvcmlnaW5hbEFycmF5IFsnYScsICdiJywgJ2MnLCAnZCcsICdlJ11cbiAqIC8vIC0+IHJlc3VsdEFycmF5IFsnYScsICdiJywgJ2QnLCAnZSddXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiByZW1vdmU8VD4oYXJyYXk6IFRbXSwgaW5kZXg6IG51bWJlcik6IFRbXSB7XG4gIHJldHVybiBpbmRleCA+PSAwID8gWy4uLmFycmF5LnNsaWNlKDAsIGluZGV4KSwgLi4uYXJyYXkuc2xpY2UoaW5kZXggKyAxKV0gOiBbLi4uYXJyYXldO1xufVxuXG4vKipcbiAqIFJlbW92ZXMgdGhlIGxhc3QgZWxlbWVudCBmcm9tIGFuIGFycmF5IGJ5IHJldHVybmluZ1xuICogYSBuZXcgYXJyYXkgaW5zdGVhZCBvZiBtdXRhdGluZyB0aGUgb3JpZ2luYWwgb25lLlxuICpcbiAqIEBleGFtcGxlXG4gKiBjb25zdCBvcmlnaW5hbEFycmF5ID0gWydhJywgJ2InLCAnYycsICdkJywgJ2UnXTtcbiAqIGNvbnN0IHJlc3VsdEFycmF5ID0gcG9wKG9yaWdpbmFsQXJyYXkpO1xuICogLy8gLT4gb3JpZ2luYWxBcnJheSBbJ2EnLCAnYicsICdjJywgJ2QnLCAnZSddXG4gKiAvLyAtPiByZXN1bHRBcnJheSBbJ2EnLCAnYicsICdjJywgJ2QnXVxuICovXG5leHBvcnQgZnVuY3Rpb24gcG9wPFQ+KGFycmF5OiBUW10pOiBUW10ge1xuICByZXR1cm4gYXJyYXkuc2xpY2UoMCwgLTEpO1xufVxuXG4vKipcbiAqIEFkZHMgb25lIG9yIG1vcmUgZWxlbWVudHMgdG8gdGhlIGJlZ2lubmluZyBvZiBhbiBhcnJheS5cbiAqXG4gKiBAZXhhbXBsZVxuICogY29uc3Qgb3JpZ2luYWxBcnJheSA9IFsnYScsICdiJywgJ2MnLCAnZCcsICdlJ107XG4gKiBjb25zdCByZXN1bHRBcnJheSA9IHVuc2hpZnQob3JpZ2luYWxBcnJheSwgJ2YnLCAnZycpO1xuICogLy8gLT4gb3JpZ2luYWxBcnJheSBbJ2EnLCAnYicsICdjJywgJ2QnLCAnZSddXG4gKiAvLyAtPiByZXN1bHRBcnJheSBbJ2YnLCAnZycsICdhJywgJ2InLCAnYycsICdkJywgJ2UnXVxuICovXG5leHBvcnQgZnVuY3Rpb24gdW5zaGlmdDxUPihhcnJheTogVFtdLCAuLi5lbGVtZW50TjogVFtdKTogVFtdIHtcbiAgcmV0dXJuIFsuLi5lbGVtZW50TiwgLi4uYXJyYXldO1xufVxuXG4vKipcbiAqIFNvcnRzIHRoZSBlbGVtZW50cyBvZiBhbiBhcnJheSAobm90IGluIHBsYWNlKSBhbmQgcmV0dXJucyBhIHNvcnRlZCBhcnJheS5cbiAqXG4gKiBAZXhhbXBsZVxuICogY29uc3QgbnVtYmVyQXJyYXkgPSBbMjAsIDMsIDQsIDEwLCAtMywgMSwgMCwgNV07XG4gKiBjb25zdCBzdHJpbmdBcnJheSA9IFsnQmx1ZScsICdIdW1wYmFjaycsICdCZWx1Z2EnXTtcbiAqXG4gKiBjb25zdCByZXN1bHRBcnJheSA9IHNvcnQobnVtYmVyQXJyYXksIChhLCBiKSA9PiBhIC0gYik7XG4gKiAvLyAtPiBudW1iZXJBcnJheSBbMjAsIDMsIDQsIDEwLCAtMywgMSwgMCwgNV1cbiAqIC8vIC0+IHJlc3VsdEFycmF5IFstMywgMCwgMSwgMywgNCwgNSwgMTAsIDIwXVxuICpcbiAqIGNvbnN0IHJlc3VsdEFycmF5ID0gc29ydChudW1iZXJBcnJheSwgKGEsIGIpID0+IGIgLSBhKTtcbiAqIC8vIC0+IG51bWJlckFycmF5IFsyMCwgMywgNCwgMTAsIC0zLCAxLCAwLCA1XVxuICogLy8gLT4gcmVzdWx0QXJyYXkgWzIwLCAxMCwgNSwgNCwgMywgMSwgMCwgLTNdXG4gKlxuICogY29uc3QgcmVzdWx0QXJyYXkgPSBzb3J0KHN0cmluZ0FycmF5KTtcbiAqIC8vIC0+IHN0cmluZ0FycmF5IFsnQmx1ZScsICdIdW1wYmFjaycsICdCZWx1Z2EnXVxuICogLy8gLT4gcmVzdWx0QXJyYXkgWydCZWx1Z2EnLCAnQmx1ZScsICdIdW1wYmFjayddXG4gKlxuICogY29uc3QgcmVzdWx0QXJyYXkgPSBzb3J0KHN0cmluZ0FycmF5LCAoYSwgYikgPT4gYS50b0xvd2VyQ2FzZSgpIDwgYi50b0xvd2VyQ2FzZSgpKTtcbiAqIC8vIC0+IHN0cmluZ0FycmF5IFsnQmx1ZScsICdIdW1wYmFjaycsICdCZWx1Z2EnXVxuICogLy8gLT4gcmVzdWx0QXJyYXkgWydIdW1wYmFjaycsICdCbHVlJywgJ0JlbHVnYSddXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzb3J0PFQ+KGFycmF5OiBUW10sIGNvbXBhcmVGdW5jdGlvbj86IChhOiBULCBiOiBUKSA9PiBudW1iZXIpOiBUW10ge1xuICByZXR1cm4gWy4uLmFycmF5XS5zb3J0KGNvbXBhcmVGdW5jdGlvbik7XG59XG5cbi8qKlxuICogUmV2ZXJzZXMgYW4gYXJyYXkgKG5vdCBpbiBwbGFjZSkuXG4gKiBUaGUgZmlyc3QgYXJyYXkgZWxlbWVudCBiZWNvbWVzIHRoZSBsYXN0LCBhbmQgdGhlIGxhc3QgYXJyYXkgZWxlbWVudCBiZWNvbWVzIHRoZSBmaXJzdC5cbiAqXG4gKiBAZXhhbXBsZVxuICogY29uc3Qgb3JpZ2luYWxBcnJheSA9IFsnYScsICdiJywgJ2MnLCAnZCcsICdlJ107XG4gKiBjb25zdCByZXN1bHRBcnJheSA9IHJldmVyc2Uob3JpZ2luYWxBcnJheSk7XG4gKiAvLyAtPiBvcmlnaW5hbEFycmF5IFsnYScsICdiJywgJ2MnLCAnZCcsICdlJ11cbiAqIC8vIC0+IHJlc3VsdEFycmF5IFsnZScsICdkJywgJ2MnLCAnYicsICdhJ11cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJldmVyc2U8VD4oYXJyYXk6IFRbXSk6IFRbXSB7XG4gIHJldHVybiBbLi4uYXJyYXldLnJldmVyc2UoKTtcbn1cblxuLyoqXG4gKiBTd2FwIGl0ZW1zIGluIHRoZSBhcnJheVxuICpcbiAqIEBleGFtcGxlXG4gKiBjb25zdCBvcmlnaW5hbEFycmF5ID0gWydhJywgJ2InLCAnYycsICdkJywgJ2UnXTtcbiAqIGNvbnN0IHJlc3VsdEFycmF5ID0gc3dhcChvcmlnaW5hbEFycmF5LCAxLCA0KTtcbiAqIC8vIC0+IG9yaWdpbmFsQXJyYXkgWydhJywgJ2InLCAnYycsICdkJywgJ2UnXVxuICogLy8gLT4gcmVzdWx0QXJyYXkgWydhJywgJ2UnLCAnYycsICdkJywgJ2InXVxuICovXG5leHBvcnQgZnVuY3Rpb24gc3dhcDxUPihhcnJheTogVFtdLCBmaXJzdEluZGV4OiBudW1iZXIsIHNlY29uZEluZGV4OiBudW1iZXIpOiBUW10ge1xuICBjb25zdCByZXN1bHRzID0gYXJyYXkuc2xpY2UoKTtcbiAgY29uc3QgZmlyc3RJdGVtID0gYXJyYXlbZmlyc3RJbmRleF07XG4gIHJlc3VsdHNbZmlyc3RJbmRleF0gPSBhcnJheVtzZWNvbmRJbmRleF07XG4gIHJlc3VsdHNbc2Vjb25kSW5kZXhdID0gZmlyc3RJdGVtO1xuXG4gIHJldHVybiByZXN1bHRzO1xufVxuXG4vKipcbiAqIFVwZGF0ZSBpdGVtIGluIHRoZSBhcnJheVxuICpcbiAqIEBleGFtcGxlXG4gKiBjb25zdCBvcmlnaW5hbEFycmF5ID0gWydhJywgJ2InLCAnYycsICdkJywgJ2UnXTtcbiAqIGNvbnN0IHJlc3VsdEFycmF5ID0gdXBkYXRlKG9yaWdpbmFsQXJyYXksIDEsICduZXdJdGVtJyk7XG4gKiAvLyAtPiByZXN1bHRBcnJheSBbJ2EnLCAnbmV3SXRlbScsICdjJywgJ2QnLCAnYiddXG4gKlxuICogY29uc3Qgb3JpZ2luYWxBcnJheSA9IFt7dGl0bGU6IDF9LCB7dGl0bGU6IDJ9XTtcbiAqIGNvbnN0IHJlc3VsdEFycmF5ID0gdXBkYXRlKG9yaWdpbmFsQXJyYXksIG9yaWdpbmFsQXJyYXlbMF0sIHt0aXRsZTogM30pO1xuICogLy8gLT4gcmVzdWx0QXJyYXkgIFt7dGl0bGU6IDN9LCB7dGl0bGU6IDJ9XTtcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZTxUPihhcnJheTogVFtdLCBpbmRleE9ySXRlbTogbnVtYmVyIHwgb2JqZWN0LCB1cGRhdGVkOiBUKTogVFtdIHtcbiAgcmV0dXJuIGFycmF5Lm1hcCgoY3VycmVudCwgaWR4KSA9PiB7XG4gICAgaWYgKHR5cGVvZiBpbmRleE9ySXRlbSA9PT0gJ251bWJlcicgJiYgaWR4ID09PSBpbmRleE9ySXRlbSkge1xuICAgICAgcmV0dXJuIHVwZGF0ZWQ7XG4gICAgfVxuXG4gICAgaWYgKGlzT2JqZWN0KGluZGV4T3JJdGVtKSAmJiAoaW5kZXhPckl0ZW0gYXMgYW55KSA9PT0gY3VycmVudCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4uKGluZGV4T3JJdGVtIGFzIG9iamVjdCksXG4gICAgICAgIC4uLih1cGRhdGVkIGFzIGFueSlcbiAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIGN1cnJlbnQ7XG4gIH0pO1xufVxuXG4vKipcbiAqIFJlbW92ZXMgZXhpc3RpbmcgZWxlbWVudHMgYW5kL29yIGFkZHMgbmV3IGVsZW1lbnRzIHRvIGFuIGFycmF5LlxuICpcbiAqIEBleGFtcGxlXG4gKiBjb25zdCBvcmlnaW5hbEFycmF5ID0gWydhJywgJ2InLCAnYycsICdkJywgJ2UnXTtcbiAqIGNvbnN0IHJlc3VsdEFycmF5ID0gc3BsaWNlKG9yaWdpbmFsQXJyYXksIDApO1xuICogLy8gLT4gb3JpZ2luYWxBcnJheSBbJ2EnLCAnYicsICdjJywgJ2QnLCAnZSddXG4gKiAvLyAtPiByZXN1bHRBcnJheSBbXVxuICpcbiAqIGNvbnN0IG9yaWdpbmFsQXJyYXkgPSBbJ2EnLCAnYicsICdjJywgJ2QnLCAnZSddO1xuICogY29uc3QgcmVzdWx0QXJyYXkgPSBzcGxpY2Uob3JpZ2luYWxBcnJheSwgMCwgMSk7XG4gKiAvLyAtPiBvcmlnaW5hbEFycmF5IFsnYScsICdiJywgJ2MnLCAnZCcsICdlJ11cbiAqIC8vIC0+IHJlc3VsdEFycmF5IFsnYicsICdjJywgJ2QnLCAnZSddXG4gKlxuICogY29uc3Qgb3JpZ2luYWxBcnJheSA9IFsnYScsICdiJywgJ2MnLCAnZCcsICdlJ107XG4gKiBjb25zdCByZXN1bHRBcnJheSA9IHNwbGljZShvcmlnaW5hbEFycmF5LCAwLCAzKTtcbiAqIC8vIC0+IG9yaWdpbmFsQXJyYXkgWydhJywgJ2InLCAnYycsICdkJywgJ2UnXVxuICogLy8gLT4gcmVzdWx0QXJyYXkgWydkJywgJ2UnXVxuICpcbiAqIGNvbnN0IG9yaWdpbmFsQXJyYXkgPSBbJ2EnLCAnYicsICdjJywgJ2QnLCAnZSddO1xuICogY29uc3QgcmVzdWx0QXJyYXkgPSBzcGxpY2Uob3JpZ2luYWxBcnJheSwgMCwgb3JpZ2luYWxBcnJheS5sZW5ndGgpO1xuICogLy8gLT4gb3JpZ2luYWxBcnJheSBbJ2EnLCAnYicsICdjJywgJ2QnLCAnZSddXG4gKiAvLyAtPiByZXN1bHRBcnJheSBbXVxuICpcbiAqIGNvbnN0IG9yaWdpbmFsQXJyYXkgPSBbJ2EnLCAnYicsICdjJywgJ2QnLCAnZSddO1xuICogY29uc3QgcmVzdWx0QXJyYXkgPSBzcGxpY2Uob3JpZ2luYWxBcnJheSwgMCwgLTMpO1xuICogLy8gLT4gb3JpZ2luYWxBcnJheSBbJ2EnLCAnYicsICdjJywgJ2QnLCAnZSddXG4gKiAvLyAtPiByZXN1bHRBcnJheSBbJ2EnLCAnYicsICdjJywgJ2QnLCAnZSddXG4gKlxuICogY29uc3Qgb3JpZ2luYWxBcnJheSA9IFsnYScsICdiJywgJ2MnLCAnZCcsICdlJ107XG4gKiBjb25zdCByZXN1bHRBcnJheSA9IHNwbGljZShvcmlnaW5hbEFycmF5LCAwLCAwLCAnbG9yZW0nLCAnaXBzdW0nKTtcbiAqIC8vIC0+IG9yaWdpbmFsQXJyYXkgWydhJywgJ2InLCAnYycsICdkJywgJ2UnXVxuICogLy8gLT4gcmVzdWx0QXJyYXkgWydsb3JlbScsICdpcHN1bScsICdhJywgJ2InLCAnYycsICdkJywgJ2UnXVxuICpcbiAqIGNvbnN0IG9yaWdpbmFsQXJyYXkgPSBbJ2EnLCAnYicsICdjJywgJ2QnLCAnZSddO1xuICogY29uc3QgcmVzdWx0QXJyYXkgPSBzcGxpY2Uob3JpZ2luYWxBcnJheSwgb3JpZ2luYWxBcnJheS5sZW5ndGgsIDAsICdsb3JlbScsICdpcHN1bScpO1xuICogLy8gLT4gb3JpZ2luYWxBcnJheSBbJ2EnLCAnYicsICdjJywgJ2QnLCAnZSddXG4gKiAvLyAtPiByZXN1bHRBcnJheSBbJ2EnLCAnYicsICdjJywgJ2QnLCAnZScsICdsb3JlbScsICdpcHN1bSddXG4gKlxuICogY29uc3Qgb3JpZ2luYWxBcnJheSA9IFsnYScsICdiJywgJ2MnLCAnZCcsICdlJ107XG4gKiBjb25zdCByZXN1bHRBcnJheSA9IHNwbGljZShvcmlnaW5hbEFycmF5LCAwLCAyLCAnbG9yZW0nLCAnaXBzdW0nKTtcbiAqIC8vIC0+IG9yaWdpbmFsQXJyYXkgWydhJywgJ2InLCAnYycsICdkJywgJ2UnXVxuICogLy8gLT4gcmVzdWx0QXJyYXkgWydsb3JlbScsICdpcHN1bScsICdjJywgJ2QnLCAnZSddXG4gKlxuICogY29uc3Qgb3JpZ2luYWxBcnJheSA9IFsnYScsICdiJywgJ2MnLCAnZCcsICdlJ107XG4gKiBjb25zdCByZXN1bHRBcnJheSA9IHNwbGljZShvcmlnaW5hbEFycmF5LCBvcmlnaW5hbEFycmF5Lmxlbmd0aCAtIDIsIDIsICdsb3JlbScsICdpcHN1bScpO1xuICogLy8gLT4gb3JpZ2luYWxBcnJheSBbJ2EnLCAnYicsICdjJywgJ2QnLCAnZSddXG4gKiAvLyAtPiByZXN1bHRBcnJheSBbJ2EnLCAnYicsICdjJywgJ2xvcmVtJywgJ2lwc3VtJ11cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNwbGljZTxUPihhcnJheTogVFtdLCBzdGFydCA9IGFycmF5Lmxlbmd0aCwgZGVsZXRlQ291bnQgPSBhcnJheS5sZW5ndGggLSBzdGFydCwgLi4uZWxlbWVudE46IFRbXSk6IFRbXSB7XG4gIHJldHVybiBbLi4uYXJyYXkuc2xpY2UoMCwgc3RhcnQpLCAuLi5lbGVtZW50TiwgLi4uYXJyYXkuc2xpY2Uoc3RhcnQgKyAoZGVsZXRlQ291bnQgPCAwID8gMCA6IGRlbGV0ZUNvdW50KSldO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdG9nZ2xlPFQ+KGFycjogVFtdLCBpdGVtOiBUKSB7XG4gIHJldHVybiBhcnIuaW5kZXhPZihpdGVtKSA+IC0xID8gYXJyLmZpbHRlcihjdXJyZW50ID0+IGl0ZW0gIT09IGN1cnJlbnQpIDogcHVzaChhcnIsIGl0ZW0pO1xufVxuIiwiLyoqIENoZWNrcyBpZiB2YWx1ZSBpcyBudWxsIG9yIHVuZGVmaW5lZCAqL1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgZmlsdGVyIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5leHBvcnQgY29uc3QgZmlsdGVyTmlsID0gPFQ+KHNvdXJjZTogT2JzZXJ2YWJsZTxUPikgPT4gc291cmNlLnBpcGUoZmlsdGVyKHZhbHVlID0+IHZhbHVlICE9PSBudWxsICYmIHR5cGVvZiB2YWx1ZSAhPT0gJ3VuZGVmaW5lZCcpKTtcbiIsImltcG9ydCB7IEFjdGlvbiwgX19nbG9iYWxTdGF0ZSB9IGZyb20gJy4vZ2xvYmFsLXN0YXRlJztcblxuZXhwb3J0IGZ1bmN0aW9uIGFwcGx5QWN0aW9uPFQ+KGZ1bmM6ICgpID0+IFQsIGFjdGlvbjogQWN0aW9uLCB0aGlzQXJnID0gdW5kZWZpbmVkKTogVCB7XG4gIF9fZ2xvYmFsU3RhdGUuc2V0Q3VzdG9tQWN0aW9uKGFjdGlvbiwgdHJ1ZSk7XG4gIHJldHVybiBmdW5jLmFwcGx5KHRoaXNBcmcpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYWN0aW9uKGFjdGlvbjogQWN0aW9uLCBza2lwVHJhbnNhY3Rpb25Nc2cgPSB0cnVlKSB7XG4gIHJldHVybiBmdW5jdGlvbih0YXJnZXQ6IGFueSwgcHJvcGVydHlLZXk6IHN0cmluZywgZGVzY3JpcHRvcjogUHJvcGVydHlEZXNjcmlwdG9yKSB7XG4gICAgY29uc3Qgb3JpZ2luYWxNZXRob2QgPSBkZXNjcmlwdG9yLnZhbHVlO1xuICAgIGRlc2NyaXB0b3IudmFsdWUgPSBmdW5jdGlvbiguLi5hcmdzKSB7XG4gICAgICBfX2dsb2JhbFN0YXRlLnNldEN1c3RvbUFjdGlvbihhY3Rpb24sIHNraXBUcmFuc2FjdGlvbk1zZyk7XG4gICAgICByZXR1cm4gb3JpZ2luYWxNZXRob2QuYXBwbHkodGhpcywgYXJncyk7XG4gICAgfTtcblxuICAgIHJldHVybiBkZXNjcmlwdG9yO1xuICB9O1xufVxuIiwiaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuXG5mdW5jdGlvbiBzZXJpYWxpemUob2JqZWN0KSB7XG4gIHJldHVybiBKU09OLnN0cmluZ2lmeShvYmplY3QsIGZ1bmN0aW9uKGtleSwgdmFsdWUpIHtcbiAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICByZXR1cm4gdmFsdWUudG9TdHJpbmcoKTtcbiAgICB9XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlV29ya2VyKCkge1xuICBjb25zdCBibG9iID0gbmV3IEJsb2IoXG4gICAgW1xuICAgICAgYHNlbGYub25tZXNzYWdlID0gZnVuY3Rpb24oZSkge1xuXG4gICAgICBmdW5jdGlvbiBkZXNlcmlhbGl6ZShzdHIpIHtcbiAgICAgICAgcmV0dXJuIEpTT04ucGFyc2Uoc3RyIHx8ICcnLCBmdW5jdGlvbihrZXksIHZhbHVlKSB7XG4gICAgICAgICAgaWYgKHZhbHVlICYmXG4gICAgICAgICAgICB0eXBlb2YgdmFsdWUgPT09IFwic3RyaW5nXCIgJiZcbiAgICAgICAgICAgIHZhbHVlLnN1YnN0cigwLCA4KSA9PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgIHZhciBzdGFydEJvZHkgPSB2YWx1ZS5pbmRleE9mKCd7JykgKyAxO1xuICAgICAgICAgICAgdmFyIGVuZEJvZHkgPSB2YWx1ZS5sYXN0SW5kZXhPZignfScpO1xuICAgICAgICAgICAgdmFyIHN0YXJ0QXJncyA9IHZhbHVlLmluZGV4T2YoJygnKSArIDE7XG4gICAgICAgICAgICB2YXIgZW5kQXJncyA9IHZhbHVlLmluZGV4T2YoJyknKTtcbiAgICAgICAgICAgIHJldHVybiBuZXcgRnVuY3Rpb24odmFsdWUuc3Vic3RyaW5nKHN0YXJ0QXJncywgZW5kQXJncyksIHZhbHVlLnN1YnN0cmluZyhzdGFydEJvZHksIGVuZEJvZHkpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgdmFyIGRlc2VyaWFsaXplZCA9IGRlc2VyaWFsaXplKGUuZGF0YSk7XG4gICAgICB2YXIgbWFwcGVkID0gZGVzZXJpYWxpemVkLmRhdGEubWFwKGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgcmV0dXJuIGRlc2VyaWFsaXplZC5mYWN0b3J5KGQpO1xuICAgICAgfSk7XG5cbiAgICAgIHNlbGYucG9zdE1lc3NhZ2UobWFwcGVkKTtcbiAgICB9YFxuICAgIF0sXG4gICAge1xuICAgICAgdHlwZTogJ3RleHQvamF2YXNjcmlwdCdcbiAgICB9XG4gICk7XG5cbiAgY29uc3QgdXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTtcbiAgcmV0dXJuIG5ldyBXb3JrZXIodXJsKTtcbn1cblxuLyoqXG4gKiAgQGV4YW1wbGVcbiAqICAgY29uc3QgbW9ja1RvZG9zID0gQXJyYXkuZnJvbSh7bGVuZ3RoOiAxMDAwMH0sIChfLCB4KSA9PiAoe2lkOiB4fSkpO1xuICpcbiAqICAgb2YobW9ja1RvZG9zKS5waXBlKG1hcEluV29ya2VyPFRvZG8+KGNyZWF0ZVRvZG8pKVxuICogICAuc3Vic2NyaWJlKHJlcyA9PiBjb25zb2xlLmxvZyhyZXMpKTtcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG1hcEluV29ya2VyPFQ+KGZhY3RvcnlGbjogRnVuY3Rpb24pIHtcbiAgcmV0dXJuIGZ1bmN0aW9uKHNvdXJjZSk6IE9ic2VydmFibGU8VFtdPiB7XG4gICAgcmV0dXJuIG5ldyBPYnNlcnZhYmxlKG9ic2VydmVyID0+IHtcbiAgICAgIGNvbnN0IHdvcmtlciA9IGNyZWF0ZVdvcmtlcigpO1xuXG4gICAgICB3b3JrZXIub25tZXNzYWdlID0gZnVuY3Rpb24oZSkge1xuICAgICAgICBvYnNlcnZlci5uZXh0KGUuZGF0YSk7XG4gICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XG4gICAgICAgIHdvcmtlci50ZXJtaW5hdGUoKTtcbiAgICAgIH07XG5cbiAgICAgIHdvcmtlci5vbmVycm9yID0gZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgIG9ic2VydmVyLmVycm9yKGVycik7XG4gICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XG4gICAgICAgIHdvcmtlci50ZXJtaW5hdGUoKTtcbiAgICAgIH07XG5cbiAgICAgIHJldHVybiBzb3VyY2Uuc3Vic2NyaWJlKHZhbHVlID0+IHtcbiAgICAgICAgY29uc3QgaW5wdXQgPSB7XG4gICAgICAgICAgZmFjdG9yeTogZmFjdG9yeUZuLFxuICAgICAgICAgIGRhdGE6IHZhbHVlXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHNlcmlhbGl6ZWQgPSBzZXJpYWxpemUoaW5wdXQpO1xuXG4gICAgICAgIHdvcmtlci5wb3N0TWVzc2FnZShzZXJpYWxpemVkKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9O1xufVxuIiwiaW1wb3J0IHsgX19zdG9yZXNfXyB9IGZyb20gJy4vc3RvcmUnO1xuaW1wb3J0IHsgaXNTdHJpbmcgfSBmcm9tICcuLi9pbnRlcm5hbC91dGlscyc7XG5cbmV4cG9ydCBjbGFzcyBTbmFwc2hvdE1hbmFnZXIge1xuICAvKipcbiAgICogR2V0IGEgc25hcHNob3Qgb2YgdGhlIHdob2xlIHN0YXRlIG9yIGEgc3BlY2lmaWMgc3RvcmVzXG4gICAqIFVzZSBpdCBPTkxZIGZvciB0aGluZ3MgbGlrZSBzYXZpbmcgdGhlIHN0YXRlIGluIHRoZSBzZXJ2ZXJcbiAgICovXG4gIGdldFN0b3Jlc1NuYXBzaG90KHN0b3Jlczogc3RyaW5nW10gPSBbXSkge1xuICAgIGxldCBhY2MgPSB7fTtcbiAgICBjb25zdCBoYXNJbmNsdWRlID0gc3RvcmVzLmxlbmd0aCA+IDA7XG4gICAgY29uc3Qga2V5cyA9IGhhc0luY2x1ZGUgPyBzdG9yZXMgOiBPYmplY3Qua2V5cyhfX3N0b3Jlc19fKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGxldCBzdG9yZU5hbWUgPSBrZXlzW2ldO1xuICAgICAgYWNjW3N0b3JlTmFtZV0gPSBfX3N0b3Jlc19fW3N0b3JlTmFtZV0uX3ZhbHVlKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGFjYztcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgc25hcHNob3Qgd2UgZ2V0IGZyb20gdGhlIHNlcnZlclxuICAgKi9cbiAgc2V0U3RvcmVzU25hcHNob3Qoc3RvcmVzOiB7IFtzdG9yZU5hbWU6IHN0cmluZ106IGFueSB9IHwgc3RyaW5nKSB7XG4gICAgbGV0IG5vcm1hbGl6ZWRTdG9yZXMgPSBzdG9yZXM7XG4gICAgaWYgKGlzU3RyaW5nKHN0b3JlcykpIHtcbiAgICAgIG5vcm1hbGl6ZWRTdG9yZXMgPSBKU09OLnBhcnNlKG5vcm1hbGl6ZWRTdG9yZXMgYXMgc3RyaW5nKTtcbiAgICB9XG5cbiAgICBmb3IgKGxldCBpID0gMCwga2V5cyA9IE9iamVjdC5rZXlzKG5vcm1hbGl6ZWRTdG9yZXMpOyBpIDwga2V5cy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3Qgc3RvcmVOYW1lID0ga2V5c1tpXTtcbiAgICAgIGlmIChfX3N0b3Jlc19fW3N0b3JlTmFtZV0pIHtcbiAgICAgICAgX19zdG9yZXNfX1tzdG9yZU5hbWVdLnNldFN0YXRlKCgpID0+IG5vcm1hbGl6ZWRTdG9yZXNbc3RvcmVOYW1lXSk7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBjb25zdCBzbmFwc2hvdE1hbmFnZXIgPSBuZXcgU25hcHNob3RNYW5hZ2VyKCk7XG4iLCJpbXBvcnQgeyBRdWVyeUVudGl0eSB9IGZyb20gJy4uL2FwaS9xdWVyeS1lbnRpdHknO1xuaW1wb3J0IHsgUXVlcnkgfSBmcm9tICcuLi9hcGkvcXVlcnknO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgZmlsdGVyTmlsIH0gZnJvbSAnLi4vYXBpL29wZXJhdG9ycyc7XG5pbXBvcnQgeyB0b0Jvb2xlYW4gfSBmcm9tICcuLi9pbnRlcm5hbC91dGlscyc7XG5pbXBvcnQgeyBJRCB9IGZyb20gJy4uL2FwaS90eXBlcyc7XG5cbmV4cG9ydCB0eXBlIFF1ZXJpZXM8RSwgUz4gPSBRdWVyeTxTPiB8IFF1ZXJ5RW50aXR5PFMsIEU+O1xuXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgQWtpdGFQbHVnaW48RSA9IGFueSwgUyA9IGFueT4ge1xuICBwcm90ZWN0ZWQgY29uc3RydWN0b3IocHJvdGVjdGVkIHF1ZXJ5OiBRdWVyaWVzPEUsIFM+KSB7fVxuXG4gIC8qKiBUaGlzIG1ldGhvZCBpcyByZXNwb25zaWJsZSBmb3IgZ2V0dGluZyBhY2Nlc3MgdG8gdGhlIHF1ZXJ5LiAqL1xuICBwcm90ZWN0ZWQgZ2V0UXVlcnkoKTogUXVlcmllczxFLCBTPiB7XG4gICAgcmV0dXJuIHRoaXMucXVlcnk7XG4gIH1cblxuICAvKiogVGhpcyBtZXRob2QgaXMgcmVzcG9uc2libGUgZm9yIGdldHRpbmcgYWNjZXNzIHRvIHRoZSBzdG9yZS4gKi9cbiAgcHJvdGVjdGVkIGdldFN0b3JlKCkge1xuICAgIHJldHVybiB0aGlzLmdldFF1ZXJ5KCkuX19zdG9yZV9fO1xuICB9XG5cbiAgLyoqIFRoaXMgbWV0aG9kIGlzIHJlc3BvbnNpYmxlIGZvciBjbGVhbmluZy4gKi9cbiAgcHVibGljIGFic3RyYWN0IGRlc3Ryb3koKTtcblxuICAvKiogVGhpcyBtZXRob2QgaXMgcmVzcG9uc2libGUgdGVsbHMgd2hldGhlciB0aGUgcGx1Z2luIGlzIGVudGl0eUJhc2VkIG9yIG5vdC4gICovXG4gIHByb3RlY3RlZCBpc0VudGl0eUJhc2VkKGVudGl0eUlkOiBJRCkge1xuICAgIHJldHVybiB0b0Jvb2xlYW4oZW50aXR5SWQpO1xuICB9XG5cbiAgLyoqIFRoaXMgbWV0aG9kIGlzIHJlc3BvbnNpYmxlIGZvciBzZWxlY3RpbmcgdGhlIHNvdXJjZTsgaXQgY2FuIGJlIHRoZSB3aG9sZSBzdG9yZSBvciBvbmUgZW50aXR5LiAqL1xuICBwcm90ZWN0ZWQgc2VsZWN0U291cmNlKGVudGl0eUlkOiBJRCk6IE9ic2VydmFibGU8UyB8IEU+IHtcbiAgICBpZiAodGhpcy5pc0VudGl0eUJhc2VkKGVudGl0eUlkKSkge1xuICAgICAgcmV0dXJuICh0aGlzLmdldFF1ZXJ5KCkgYXMgUXVlcnlFbnRpdHk8UywgRT4pLnNlbGVjdEVudGl0eShlbnRpdHlJZCkucGlwZShmaWx0ZXJOaWwpO1xuICAgIH1cblxuICAgIHJldHVybiAodGhpcy5nZXRRdWVyeSgpIGFzIFF1ZXJ5PFM+KS5zZWxlY3Qoc3RhdGUgPT4gc3RhdGUpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGdldFNvdXJjZShlbnRpdHlJZDogSUQpOiBTIHwgRSB7XG4gICAgaWYgKHRoaXMuaXNFbnRpdHlCYXNlZChlbnRpdHlJZCkpIHtcbiAgICAgIHJldHVybiAodGhpcy5nZXRRdWVyeSgpIGFzIFF1ZXJ5RW50aXR5PFMsIEU+KS5nZXRFbnRpdHkoZW50aXR5SWQpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmdldFF1ZXJ5KCkuZ2V0U25hcHNob3QoKTtcbiAgfVxuXG4gIC8qKiBUaGlzIG1ldGhvZCBpcyByZXNwb25zaWJsZSBmb3IgdXBkYXRpbmcgdGhlIHN0b3JlIG9yIG9uZSBlbnRpdHk7IGl0IGNhbiBiZSB0aGUgd2hvbGUgc3RvcmUgb3Igb25lIGVudGl0eS4gKi9cbiAgcHJvdGVjdGVkIHVwZGF0ZVN0b3JlKG5ld1N0YXRlLCBlbnRpdHlJZD8pIHtcbiAgICBpZiAodGhpcy5pc0VudGl0eUJhc2VkKGVudGl0eUlkKSkge1xuICAgICAgdGhpcy5nZXRTdG9yZSgpLnVwZGF0ZShlbnRpdHlJZCwgbmV3U3RhdGUpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmdldFN0b3JlKCkuc2V0U3RhdGUoKHN0YXRlKSA9PiAoey4uLnN0YXRlLCAuLi5uZXdTdGF0ZX0pKTtcbiAgICB9XG4gIH1cbn1cbiIsImltcG9ydCB7IFF1ZXJ5RW50aXR5IH0gZnJvbSAnLi4vLi4vYXBpL3F1ZXJ5LWVudGl0eSc7XG5pbXBvcnQgeyBkZWxheSwgbWFwLCBzd2l0Y2hNYXAsIHRha2UgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QsIGZyb20sIE9ic2VydmFibGUsIFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgaXNPYnNlcnZhYmxlLCBpc1VuZGVmaW5lZCB9IGZyb20gJy4uLy4uL2ludGVybmFsL3V0aWxzJztcbmltcG9ydCB7IElEIH0gZnJvbSAnLi4vLi4vYXBpL3R5cGVzJztcbmltcG9ydCB7IEFraXRhUGx1Z2luIH0gZnJvbSAnLi4vcGx1Z2luJztcbmltcG9ydCB7IGFwcGx5VHJhbnNhY3Rpb24gfSBmcm9tICcuLi8uLi9hcGkvdHJhbnNhY3Rpb24nO1xuaW1wb3J0IHsgYWN0aW9uLCBhcHBseUFjdGlvbiB9IGZyb20gJy4uLy4uL2ludGVybmFsL2FjdGlvbic7XG5cbmV4cG9ydCBpbnRlcmZhY2UgUGFnaW5hdGlvblJlc3BvbnNlPEU+IHtcbiAgY3VycmVudFBhZ2U6IG51bWJlcjtcbiAgcGVyUGFnZTogbnVtYmVyO1xuICBsYXN0UGFnZTogbnVtYmVyO1xuICBkYXRhOiBFW107XG4gIHRvdGFsPzogbnVtYmVyO1xuICBmcm9tPzogbnVtYmVyO1xuICB0bz86IG51bWJlcjtcbiAgcGFnZUNvbnRyb2xzPzogbnVtYmVyW107XG59XG5cbmV4cG9ydCB0eXBlIFBhZ2luYXRvckNvbmZpZyA9IHtcbiAgcGFnZXNDb250cm9scz86IGJvb2xlYW47XG4gIHJhbmdlPzogYm9vbGVhbjtcbiAgc3RhcnRXaXRoPzogbnVtYmVyO1xuICBjYWNoZVRpbWVvdXQ/OiBPYnNlcnZhYmxlPG51bWJlcj47XG59O1xuXG5jb25zdCBwYWdpbmF0b3JEZWZhdWx0czogUGFnaW5hdG9yQ29uZmlnID0ge1xuICBwYWdlc0NvbnRyb2xzOiBmYWxzZSxcbiAgcmFuZ2U6IGZhbHNlLFxuICBzdGFydFdpdGg6IDEsXG4gIGNhY2hlVGltZW91dDogdW5kZWZpbmVkXG59O1xuXG5leHBvcnQgY2xhc3MgUGFnaW5hdG9yUGx1Z2luPEU+IGV4dGVuZHMgQWtpdGFQbHVnaW48RT4ge1xuICAvKiogU2F2ZSBjdXJyZW50IGZpbHRlcnMsIHNvcnRpbmcsIGV0Yy4gaW4gY2FjaGUgKi9cbiAgbWV0YWRhdGEgPSBuZXcgTWFwKCk7XG5cbiAgcHJpdmF0ZSBwYWdlOiBCZWhhdmlvclN1YmplY3Q8bnVtYmVyPjtcbiAgcHJpdmF0ZSBwYWdlcyA9IG5ldyBNYXA8bnVtYmVyLCB7IGlkczogSURbXSB9PigpO1xuICBwcml2YXRlIHJlYWRvbmx5IGNsZWFyQ2FjaGVTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcblxuICBwcml2YXRlIHBhZ2luYXRpb246IFBhZ2luYXRpb25SZXNwb25zZTxFPiA9IHtcbiAgICBjdXJyZW50UGFnZTogMSxcbiAgICBwZXJQYWdlOiAwLFxuICAgIHRvdGFsOiAwLFxuICAgIGxhc3RQYWdlOiAwLFxuICAgIGRhdGE6IFtdXG4gIH07XG5cbiAgLyoqXG4gICAqIFdoZW4gdGhlIHVzZXIgbmF2aWdhdGVzIHRvIGEgZGlmZmVyZW50IHBhZ2UgYW5kIHJldHVyblxuICAgKiB3ZSBkb24ndCB3YW50IHRvIGNhbGwgYGNsZWFyQ2FjaGVgIG9uIGZpcnN0IHRpbWUuXG4gICAqL1xuICBwcml2YXRlIGluaXRpYWwgPSBmYWxzZTtcblxuICBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgcXVlcnk6IFF1ZXJ5RW50aXR5PGFueSwgRT4sIHB1YmxpYyBjb25maWc6IFBhZ2luYXRvckNvbmZpZyA9IHt9KSB7XG4gICAgc3VwZXIocXVlcnkpO1xuICAgIHRoaXMuY29uZmlnID0gT2JqZWN0LmFzc2lnbihwYWdpbmF0b3JEZWZhdWx0cywgY29uZmlnKTtcbiAgICBjb25zdCB7IHN0YXJ0V2l0aCwgY2FjaGVUaW1lb3V0IH0gPSB0aGlzLmNvbmZpZztcbiAgICB0aGlzLnBhZ2UgPSBuZXcgQmVoYXZpb3JTdWJqZWN0KHN0YXJ0V2l0aCk7XG4gICAgaWYgKGlzT2JzZXJ2YWJsZShjYWNoZVRpbWVvdXQpKSB7XG4gICAgICB0aGlzLmNsZWFyQ2FjaGVTdWJzY3JpcHRpb24gPSBjYWNoZVRpbWVvdXQuc3Vic2NyaWJlKF8gPT4gdGhpcy5jbGVhckNhY2hlKCkpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBQcm94eSB0byB0aGUgcXVlcnkgbG9hZGluZ1xuICAgKi9cbiAgaXNMb2FkaW5nJCA9IHRoaXMucXVlcnkuc2VsZWN0TG9hZGluZygpLnBpcGUoZGVsYXkoMCkpO1xuXG4gIC8qKlxuICAgKiBMaXN0ZW4gdG8gcGFnZSBjaGFuZ2VzXG4gICAqL1xuICBnZXQgcGFnZUNoYW5nZXMoKSB7XG4gICAgcmV0dXJuIHRoaXMucGFnZS5hc09ic2VydmFibGUoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIGN1cnJlbnQgcGFnZSBudW1iZXJcbiAgICovXG4gIGdldCBjdXJyZW50UGFnZSgpIHtcbiAgICByZXR1cm4gdGhpcy5wYWdpbmF0aW9uLmN1cnJlbnRQYWdlO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIGN1cnJlbnQgcGFnZSBpcyB0aGUgZmlyc3Qgb25lXG4gICAqL1xuICBnZXQgaXNGaXJzdCgpIHtcbiAgICByZXR1cm4gdGhpcy5jdXJyZW50UGFnZSA9PT0gMTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayBpZiBjdXJyZW50IHBhZ2UgaXMgdGhlIGxhc3Qgb25lXG4gICAqL1xuICBnZXQgaXNMYXN0KCkge1xuICAgIHJldHVybiB0aGlzLmN1cnJlbnRQYWdlID09PSB0aGlzLnBhZ2luYXRpb24ubGFzdFBhZ2U7XG4gIH1cblxuICAvKipcbiAgICogV2hldGhlciB0byBnZW5lcmF0ZSBhbiBhcnJheSBvZiBwYWdlcyBmb3IgKm5nRm9yXG4gICAqIFsxLCAyLCAzLCA0XVxuICAgKi9cbiAgd2l0aENvbnRyb2xzKCkge1xuICAgIHRoaXMuY29uZmlnLnBhZ2VzQ29udHJvbHMgPSB0cnVlO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgdG8gZ2VuZXJhdGUgdGhlIGBmcm9tYCBhbmQgYHRvYCBrZXlzXG4gICAqIFsxLCAyLCAzLCA0XVxuICAgKi9cbiAgd2l0aFJhbmdlKCkge1xuICAgIHRoaXMuY29uZmlnLnJhbmdlID0gdHJ1ZTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgdGhlIGxvYWRpbmcgc3RhdGVcbiAgICovXG4gIHNldExvYWRpbmcodmFsdWUgPSB0cnVlKSB7XG4gICAgdGhpcy5nZXRTdG9yZSgpLnNldExvYWRpbmcodmFsdWUpO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSB0aGUgcGFnaW5hdGlvbiBvYmplY3QgYW5kIGFkZCB0aGUgcGFnZVxuICAgKi9cbiAgQGFjdGlvbih7IHR5cGU6ICdAUGFnaW5hdGlvbiAtIE5ldyBQYWdlJyB9LCB0cnVlKVxuICB1cGRhdGUocmVzcG9uc2U6IFBhZ2luYXRpb25SZXNwb25zZTxFPikge1xuICAgIHRoaXMucGFnaW5hdGlvbiA9IHJlc3BvbnNlO1xuICAgIHRoaXMuYWRkUGFnZShyZXNwb25zZS5kYXRhKTtcbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKiBTZXQgdGhlIGlkcyBhbmQgYWRkIHRoZSBwYWdlIHRvIHN0b3JlXG4gICAqL1xuICBhZGRQYWdlKGRhdGE6IEVbXSkge1xuICAgIHRoaXMucGFnZXMuc2V0KHRoaXMuY3VycmVudFBhZ2UsIHsgaWRzOiBkYXRhLm1hcChlbnRpdHkgPT4gZW50aXR5W3RoaXMuZ2V0U3RvcmUoKS5pZEtleV0pIH0pO1xuICAgIHRoaXMuZ2V0U3RvcmUoKS5hZGQoZGF0YSk7XG4gIH1cblxuICAvKipcbiAgICogQ2xlYXIgdGhlIGNhY2hlLlxuICAgKi9cbiAgY2xlYXJDYWNoZSgpIHtcbiAgICBpZiAoIXRoaXMuaW5pdGlhbCkge1xuICAgICAgYXBwbHlBY3Rpb24oXG4gICAgICAgICgpID0+IHtcbiAgICAgICAgICB0aGlzLmdldFN0b3JlKCkucmVtb3ZlKCk7XG4gICAgICAgIH0sXG4gICAgICAgIHsgdHlwZTogJ0BQYWdpbmF0aW9uIC0gQ2xlYXIgQ2FjaGUnIH1cbiAgICAgICk7XG4gICAgICB0aGlzLnBhZ2VzID0gbmV3IE1hcCgpO1xuICAgIH1cbiAgICB0aGlzLmluaXRpYWwgPSBmYWxzZTtcbiAgfVxuXG4gIGNsZWFyUGFnZShwYWdlOiBudW1iZXIpIHtcbiAgICB0aGlzLnBhZ2VzLmRlbGV0ZShwYWdlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDbGVhciB0aGUgY2FjaGUgdGltZW91dCBhbmQgb3B0aW9uYWxseSB0aGUgcGFnZXNcbiAgICovXG4gIGRlc3Ryb3koeyBjbGVhckNhY2hlLCBjdXJyZW50UGFnZSB9OiB7IGNsZWFyQ2FjaGU/OiBib29sZWFuOyBjdXJyZW50UGFnZT86IG51bWJlciB9ID0ge30pIHtcbiAgICBpZiAodGhpcy5jbGVhckNhY2hlU3Vic2NyaXB0aW9uKSB7XG4gICAgICB0aGlzLmNsZWFyQ2FjaGVTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICB9XG4gICAgaWYgKGNsZWFyQ2FjaGUpIHtcbiAgICAgIHRoaXMuY2xlYXJDYWNoZSgpO1xuICAgIH1cbiAgICBpZiAoIWlzVW5kZWZpbmVkKGN1cnJlbnRQYWdlKSkge1xuICAgICAgdGhpcy5zZXRQYWdlKGN1cnJlbnRQYWdlKTtcbiAgICB9XG4gICAgdGhpcy5pbml0aWFsID0gdHJ1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBXaGV0aGVyIHRoZSBwcm92aWRlZCBwYWdlIGlzIGFjdGl2ZVxuICAgKi9cbiAgaXNQYWdlQWN0aXZlKHBhZ2U6IG51bWJlcikge1xuICAgIHJldHVybiB0aGlzLmN1cnJlbnRQYWdlID09PSBwYWdlO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCB0aGUgY3VycmVudCBwYWdlXG4gICAqL1xuICBzZXRQYWdlKHBhZ2U6IG51bWJlcikge1xuICAgIGlmIChwYWdlICE9PSB0aGlzLmN1cnJlbnRQYWdlIHx8ICF0aGlzLmhhc1BhZ2UocGFnZSkpIHtcbiAgICAgIHRoaXMucGFnZS5uZXh0KCh0aGlzLnBhZ2luYXRpb24uY3VycmVudFBhZ2UgPSBwYWdlKSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEluY3JlbWVudCBjdXJyZW50IHBhZ2VcbiAgICovXG4gIG5leHRQYWdlKCkge1xuICAgIGlmICh0aGlzLmN1cnJlbnRQYWdlICE9PSB0aGlzLnBhZ2luYXRpb24ubGFzdFBhZ2UpIHtcbiAgICAgIHRoaXMuc2V0UGFnZSh0aGlzLnBhZ2luYXRpb24uY3VycmVudFBhZ2UgKyAxKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRGVjcmVtZW50IGN1cnJlbnQgcGFnZVxuICAgKi9cbiAgcHJldlBhZ2UoKSB7XG4gICAgaWYgKHRoaXMucGFnaW5hdGlvbi5jdXJyZW50UGFnZSA+IDEpIHtcbiAgICAgIHRoaXMuc2V0UGFnZSh0aGlzLnBhZ2luYXRpb24uY3VycmVudFBhZ2UgLSAxKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2V0IGN1cnJlbnQgcGFnZSB0byBsYXN0XG4gICAqL1xuICBzZXRMYXN0UGFnZSgpIHtcbiAgICB0aGlzLnNldFBhZ2UodGhpcy5wYWdpbmF0aW9uLmxhc3RQYWdlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgY3VycmVudCBwYWdlIHRvIGZpcnN0XG4gICAqL1xuICBzZXRGaXJzdFBhZ2UoKSB7XG4gICAgdGhpcy5zZXRQYWdlKDEpO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIHBhZ2UgZXhpc3RzIGluIGNhY2hlXG4gICAqL1xuICBoYXNQYWdlKHBhZ2U6IG51bWJlcikge1xuICAgIHJldHVybiB0aGlzLnBhZ2VzLmhhcyhwYWdlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIGN1cnJlbnQgcGFnZSBpZiBpdCdzIGluIGNhY2hlLCBvdGhlcndpc2UgaW52b2tlIHRoZSByZXF1ZXN0XG4gICAqL1xuICBnZXRQYWdlKHJlcTogKCkgPT4gT2JzZXJ2YWJsZTxQYWdpbmF0aW9uUmVzcG9uc2U8RT4+KSB7XG4gICAgY29uc3QgcGFnZSA9IHRoaXMucGFnaW5hdGlvbi5jdXJyZW50UGFnZTtcbiAgICBpZiAodGhpcy5oYXNQYWdlKHBhZ2UpKSB7XG4gICAgICByZXR1cm4gdGhpcy5zZWxlY3RQYWdlKHBhZ2UpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnNldExvYWRpbmcodHJ1ZSk7XG4gICAgICByZXR1cm4gZnJvbShyZXEoKSkucGlwZShcbiAgICAgICAgc3dpdGNoTWFwKChjb25maWc6IFBhZ2luYXRpb25SZXNwb25zZTxFPikgPT4ge1xuICAgICAgICAgIGFwcGx5VHJhbnNhY3Rpb24oKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZXRMb2FkaW5nKGZhbHNlKTtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlKGNvbmZpZyk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0UGFnZShwYWdlKTtcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgZ2V0UXVlcnkoKTogUXVlcnlFbnRpdHk8YW55LCBFPiB7XG4gICAgcmV0dXJuIHRoaXMucXVlcnk7XG4gIH1cblxuICBwcml2YXRlIGdldEZyb20oKSB7XG4gICAgaWYgKHRoaXMuaXNGaXJzdCkge1xuICAgICAgcmV0dXJuIDE7XG4gICAgfVxuICAgIHJldHVybiAodGhpcy5jdXJyZW50UGFnZSAtIDEpICogdGhpcy5wYWdpbmF0aW9uLnBlclBhZ2UgKyAxO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRUbygpIHtcbiAgICByZXR1cm4gdGhpcy5jdXJyZW50UGFnZSAqIHRoaXMucGFnaW5hdGlvbi5wZXJQYWdlO1xuICB9XG5cbiAgLyoqXG4gICAqIFNlbGVjdCB0aGUgcGFnZVxuICAgKi9cbiAgcHJpdmF0ZSBzZWxlY3RQYWdlKHBhZ2U6IG51bWJlcik6IE9ic2VydmFibGU8UGFnaW5hdGlvblJlc3BvbnNlPEU+PiB7XG4gICAgcmV0dXJuIHRoaXMucXVlcnkuc2VsZWN0QWxsKHsgYXNPYmplY3Q6IHRydWUgfSkucGlwZShcbiAgICAgIHRha2UoMSksXG4gICAgICBtYXAoZW50aXRpZXMgPT4ge1xuICAgICAgICBsZXQgcmVzcG9uc2U6IFBhZ2luYXRpb25SZXNwb25zZTxFPiA9IHtcbiAgICAgICAgICAuLi50aGlzLnBhZ2luYXRpb24sXG4gICAgICAgICAgZGF0YTogdGhpcy5wYWdlcy5nZXQocGFnZSkuaWRzLm1hcChpZCA9PiBlbnRpdGllc1tpZF0pXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgeyByYW5nZSwgcGFnZXNDb250cm9scyB9ID0gdGhpcy5jb25maWc7XG5cbiAgICAgICAgaWYgKCF0aGlzLnBhZ2luYXRpb24udG90YWwpIHtcbiAgICAgICAgICByZXNwb25zZS50b3RhbCA9IHJlc3BvbnNlLnBlclBhZ2UgKiByZXNwb25zZS5sYXN0UGFnZTtcbiAgICAgICAgICB0aGlzLnBhZ2luYXRpb24udG90YWwgPSByZXNwb25zZS50b3RhbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChyYW5nZSkge1xuICAgICAgICAgIHJlc3BvbnNlLmZyb20gPSB0aGlzLmdldEZyb20oKTtcbiAgICAgICAgICByZXNwb25zZS50byA9IHRoaXMuZ2V0VG8oKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChwYWdlc0NvbnRyb2xzKSB7XG4gICAgICAgICAgcmVzcG9uc2UucGFnZUNvbnRyb2xzID0gZ2VuZXJhdGVQYWdlcyh0aGlzLnBhZ2luYXRpb24udG90YWwsIHRoaXMucGFnaW5hdGlvbi5wZXJQYWdlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgIH0pXG4gICAgKTtcbiAgfVxufVxuXG4vKipcbiAqIEdlbmVyYXRlIGFuIGFycmF5IHNvIHdlIGNhbiBuZ0ZvciB0aGVtIHRvIG5hdmlnYXRlIGJldHdlZW4gcGFnZXNcbiAqL1xuZnVuY3Rpb24gZ2VuZXJhdGVQYWdlcyh0b3RhbDogbnVtYmVyLCBwZXJQYWdlOiBudW1iZXIpIHtcbiAgY29uc3QgbGVuID0gTWF0aC5jZWlsKHRvdGFsIC8gcGVyUGFnZSk7XG4gIGxldCBhcnIgPSBbXTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW47IGkrKykge1xuICAgIGFyci5wdXNoKGkgKyAxKTtcbiAgfVxuICByZXR1cm4gYXJyO1xufVxuXG4vKiogYmFja3dhcmQgY29tcGF0aWJpbGl0eSAqL1xuZXhwb3J0IGNvbnN0IFBhZ2luYXRvciA9IFBhZ2luYXRvclBsdWdpbjtcbiIsImltcG9ydCB7IEFraXRhUGx1Z2luIH0gZnJvbSAnLi4vcGx1Z2luJztcbmltcG9ydCB7IFF1ZXJ5IH0gZnJvbSAnLi4vLi4vYXBpL3F1ZXJ5JztcbmltcG9ydCB7IE9ic2VydmFibGUsIFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgZGVib3VuY2VUaW1lIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgX19nbG9iYWxTdGF0ZSB9IGZyb20gJy4uLy4uL2ludGVybmFsL2dsb2JhbC1zdGF0ZSc7XG5pbXBvcnQgeyBnZXRWYWx1ZSwgaXNTdHJpbmcsIHNldFZhbHVlIH0gZnJvbSAnLi4vLi4vaW50ZXJuYWwvdXRpbHMnO1xuXG5leHBvcnQgdHlwZSBGb3JtR3JvdXBMaWtlID0ge1xuICBwYXRjaFZhbHVlOiBGdW5jdGlvbjtcbiAgc2V0VmFsdWU6IEZ1bmN0aW9uO1xuICB2YWx1ZUNoYW5nZXM6IE9ic2VydmFibGU8YW55Pjtcbn07XG5cbmV4cG9ydCB0eXBlIEFraXRhRm9ybVByb3A8VD4gPSB7XG4gIFtrZXk6IHN0cmluZ106IFQ7XG59O1xuXG5leHBvcnQgdHlwZSBQZXJzaXN0Rm9ybVBhcmFtcyA9IHtcbiAgZGVib3VuY2VUaW1lPzogbnVtYmVyO1xuICBmb3JtS2V5Pzogc3RyaW5nO1xuICBlbWl0RXZlbnQ/OiBib29sZWFuO1xufTtcblxuZXhwb3J0IGNsYXNzIFBlcnNpc3ROZ0Zvcm1QbHVnaW48VCA9IGFueT4gZXh0ZW5kcyBBa2l0YVBsdWdpbiB7XG4gIGZvcm1DaGFuZ2VzOiBTdWJzY3JpcHRpb247XG4gIHByaXZhdGUgZm9ybTogRm9ybUdyb3VwTGlrZTtcbiAgcHJpdmF0ZSBpc0tleUJhc2VkOiBib29sZWFuO1xuICBwcml2YXRlIGluaXRpYWxWYWx1ZTtcblxuICBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgcXVlcnk6IFF1ZXJ5PGFueT4sIHByaXZhdGUgZmFjdG9yeUZuT3JQYXRoOiBGdW5jdGlvbiB8IHN0cmluZywgcHJpdmF0ZSBwYXJhbXM6IFBlcnNpc3RGb3JtUGFyYW1zID0ge30pIHtcbiAgICBzdXBlcihxdWVyeSk7XG4gICAgdGhpcy5wYXJhbXMgPSB7IC4uLnsgZGVib3VuY2VUaW1lOiAzMDAsIGZvcm1LZXk6ICdha2l0YUZvcm0nLCBlbWl0RXZlbnQ6IGZhbHNlIH0sIC4uLnBhcmFtcyB9O1xuICAgIHRoaXMuaXNLZXlCYXNlZCA9IGlzU3RyaW5nKGZhY3RvcnlGbk9yUGF0aCk7XG4gIH1cblxuICBzZXRGb3JtKGZvcm06IEZvcm1Hcm91cExpa2UpIHtcbiAgICB0aGlzLmZvcm0gPSBmb3JtO1xuICAgIHRoaXMuYWN0aXZhdGUoKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHJlc2V0KGluaXRpYWxTdGF0ZT86IFQpIHtcbiAgICBsZXQgdmFsdWU7XG4gICAgaWYgKGluaXRpYWxTdGF0ZSkge1xuICAgICAgdmFsdWUgPSBpbml0aWFsU3RhdGU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhbHVlID0gdGhpcy5pc0tleUJhc2VkID8gdGhpcy5pbml0aWFsVmFsdWUgOiAodGhpcyBhcyBhbnkpLmZhY3RvcnlGbk9yUGF0aCgpO1xuICAgIH1cblxuICAgIHRoaXMuZm9ybS5wYXRjaFZhbHVlKHZhbHVlKTtcblxuICAgIGNvbnN0IHN0b3JlVmFsdWUgPSB0aGlzLmlzS2V5QmFzZWQgPyBzZXRWYWx1ZSh0aGlzLmdldFN0b3JlKCkuX3ZhbHVlKCksIGAke3RoaXMuZ2V0U3RvcmUoKS5zdG9yZU5hbWV9LiR7dGhpcy5mYWN0b3J5Rm5PclBhdGh9YCwgdmFsdWUpIDogeyBbdGhpcy5wYXJhbXMuZm9ybUtleV06IHZhbHVlIH07XG4gICAgdGhpcy51cGRhdGVTdG9yZShzdG9yZVZhbHVlKTtcbiAgfVxuXG4gIHByaXZhdGUgYWN0aXZhdGUoKSB7XG4gICAgbGV0IHBhdGg7XG5cbiAgICBpZiAodGhpcy5pc0tleUJhc2VkKSB7XG4gICAgICBwYXRoID0gYCR7dGhpcy5nZXRTdG9yZSgpLnN0b3JlTmFtZX0uJHt0aGlzLmZhY3RvcnlGbk9yUGF0aH1gO1xuICAgICAgdGhpcy5pbml0aWFsVmFsdWUgPSBnZXRWYWx1ZSh0aGlzLmdldFN0b3JlKCkuX3ZhbHVlKCksIHBhdGgpO1xuICAgICAgdGhpcy5mb3JtLnBhdGNoVmFsdWUodGhpcy5pbml0aWFsVmFsdWUsIHsgZW1pdEV2ZW50OiB0aGlzLnBhcmFtcy5lbWl0RXZlbnQgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICghKHRoaXMuZ2V0UXVlcnkoKS5nZXRTbmFwc2hvdCgpIGFzIEFraXRhRm9ybVByb3A8VD4pW3RoaXMucGFyYW1zLmZvcm1LZXldKSB7XG4gICAgICAgIF9fZ2xvYmFsU3RhdGUuc2V0QWN0aW9uKHsgdHlwZTogJ0BQZXJzaXN0TmdGb3JtUGx1Z2luIGFjdGl2YXRlJyB9KTtcbiAgICAgICAgdGhpcy51cGRhdGVTdG9yZSh7IFt0aGlzLnBhcmFtcy5mb3JtS2V5XTogKHRoaXMgYXMgYW55KS5mYWN0b3J5Rm5PclBhdGgoKSB9KTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5xdWVyeS5zZWxlY3RPbmNlKHN0YXRlID0+IChzdGF0ZSBhcyBBa2l0YUZvcm1Qcm9wPFQ+KVt0aGlzLnBhcmFtcy5mb3JtS2V5XSkuc3Vic2NyaWJlKGZvcm1WYWx1ZSA9PiB0aGlzLmZvcm0ucGF0Y2hWYWx1ZShmb3JtVmFsdWUpKTtcbiAgICB9XG5cbiAgICB0aGlzLmZvcm1DaGFuZ2VzID0gdGhpcy5mb3JtLnZhbHVlQ2hhbmdlcy5waXBlKGRlYm91bmNlVGltZSh0aGlzLnBhcmFtcy5kZWJvdW5jZVRpbWUpKS5zdWJzY3JpYmUodmFsdWUgPT4ge1xuICAgICAgX19nbG9iYWxTdGF0ZS5zZXRBY3Rpb24oeyB0eXBlOiAnQFBlcnNpc3RGb3JtIC0gVXBkYXRlJyB9KTtcbiAgICAgIGxldCBuZXdTdGF0ZTtcbiAgICAgIGlmICh0aGlzLmlzS2V5QmFzZWQpIHtcbiAgICAgICAgbmV3U3RhdGUgPSBzdGF0ZSA9PiBzZXRWYWx1ZShzdGF0ZSwgcGF0aCwgdmFsdWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbmV3U3RhdGUgPSAoKSA9PiAoeyBbdGhpcy5wYXJhbXMuZm9ybUtleV06IHZhbHVlIH0pO1xuICAgICAgfVxuICAgICAgdGhpcy51cGRhdGVTdG9yZShuZXdTdGF0ZSh0aGlzLmdldFN0b3JlKCkuX3ZhbHVlKCkpKTtcbiAgICB9KTtcbiAgfVxuXG4gIGRlc3Ryb3koKSB7XG4gICAgdGhpcy5mb3JtQ2hhbmdlcyAmJiB0aGlzLmZvcm1DaGFuZ2VzLnVuc3Vic2NyaWJlKCk7XG4gIH1cbn1cbiIsImltcG9ydCB7IEFraXRhRXJyb3IgfSBmcm9tICcuLi9pbnRlcm5hbC9lcnJvcic7XG5pbXBvcnQgeyBfX3N0b3Jlc19fLCBBY3Rpb25zLCByb290RGlzcGF0Y2hlciB9IGZyb20gJy4uL2FwaS9zdG9yZSc7XG5pbXBvcnQgeyBza2lwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgZ2V0VmFsdWUsIHNldFZhbHVlIH0gZnJvbSAnLi4vaW50ZXJuYWwvdXRpbHMnO1xuaW1wb3J0IHsgX19nbG9iYWxTdGF0ZSB9IGZyb20gJy4uL2ludGVybmFsL2dsb2JhbC1zdGF0ZSc7XG5cbmNvbnN0IG5vdEJzID0gdHlwZW9mIGxvY2FsU3RvcmFnZSA9PT0gJ3VuZGVmaW5lZCc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgUGVyc2lzdFN0YXRlUGFyYW1zIHtcbiAgLyoqIFRoZSBzdG9yYWdlIGtleSAqL1xuICBrZXk6IHN0cmluZztcbiAgLyoqIFN0b3JhZ2Ugc3RyYXRlZ3kgdG8gdXNlLiBUaGlzIGRlZmF1bHRzIHRvIExvY2FsU3RvcmFnZSBidXQgeW91IGNhbiBwYXNzIFNlc3Npb25TdG9yYWdlIG9yIGFueXRoaW5nIHRoYXQgaW1wbGVtZW50cyB0aGUgU3RvcmFnZUVuZ2luZSBBUEkuICovXG4gIHN0b3JhZ2U6IFN0b3JhZ2U7XG4gIC8qKiBDdXN0b20gZGVzZXJpYWxpemVyLiBEZWZhdWx0cyB0byBKU09OLnBhcnNlICovXG4gIGRlc2VyaWFsaXplOiBGdW5jdGlvbjtcbiAgLyoqIEN1c3RvbSBzZXJpYWxpemVyLCBkZWZhdWx0cyB0byBKU09OLnN0cmluZ2lmeSAqL1xuICBzZXJpYWxpemU6IEZ1bmN0aW9uO1xuICAvKipcbiAgICogQnkgZGVmYXVsdCB0aGUgd2hvbGUgc3RhdGUgaXMgc2F2ZWQgdG8gc3RvcmFnZSwgdXNlIHRoaXMgcGFyYW0gdG8gaW5jbHVkZSBvbmx5IHRoZSBzdG9yZXMgeW91IG5lZWQuXG4gICAqIFBheSBhdHRlbnRpb24gdGhhdCB5b3UgY2FuJ3QgdXNlIGJvdGggaW5jbHVkZSBhbmQgZXhjbHVkZVxuICAgKi9cbiAgaW5jbHVkZTogc3RyaW5nW107XG4gIC8qKlxuICAgKiAgQnkgZGVmYXVsdCB0aGUgd2hvbGUgc3RhdGUgaXMgc2F2ZWQgdG8gc3RvcmFnZSwgdXNlIHRoaXMgcGFyYW0gdG8gZXhjbHVkZSBzdG9yZXMgdGhhdCB5b3UgZG9uJ3QgbmVlZC5cbiAgICogIFBheSBhdHRlbnRpb24gdGhhdCB5b3UgY2FuJ3QgdXNlIGJvdGggaW5jbHVkZSBhbmQgZXhjbHVkZVxuICAgKi9cbiAgZXhjbHVkZTogc3RyaW5nW107XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwZXJzaXN0U3RhdGUocGFyYW1zPzogUGFydGlhbDxQZXJzaXN0U3RhdGVQYXJhbXM+KSB7XG4gIGlmIChub3RCcykgcmV0dXJuO1xuXG4gIGNvbnN0IGRlZmF1bHRzOiBQZXJzaXN0U3RhdGVQYXJhbXMgPSB7XG4gICAga2V5OiAnQWtpdGFTdG9yZXMnLFxuICAgIHN0b3JhZ2U6IGxvY2FsU3RvcmFnZSxcbiAgICBkZXNlcmlhbGl6ZTogSlNPTi5wYXJzZSxcbiAgICBzZXJpYWxpemU6IEpTT04uc3RyaW5naWZ5LFxuICAgIGluY2x1ZGU6IFtdLFxuICAgIGV4Y2x1ZGU6IFtdXG4gIH07XG4gIGNvbnN0IHsgc3RvcmFnZSwgZGVzZXJpYWxpemUsIHNlcmlhbGl6ZSwgaW5jbHVkZSwgZXhjbHVkZSwga2V5IH0gPSBPYmplY3QuYXNzaWduKHt9LCBkZWZhdWx0cywgcGFyYW1zKTtcblxuICBjb25zdCBoYXNJbmNsdWRlID0gaW5jbHVkZS5sZW5ndGggPiAwO1xuICBjb25zdCBoYXNFeGNsdWRlID0gZXhjbHVkZS5sZW5ndGggPiAwO1xuXG4gIGlmIChoYXNJbmNsdWRlICYmIGhhc0V4Y2x1ZGUpIHtcbiAgICB0aHJvdyBuZXcgQWtpdGFFcnJvcihcIllvdSBjYW4ndCB1c2UgYm90aCBpbmNsdWRlIGFuZCBleGNsdWRlXCIpO1xuICB9XG5cbiAgY29uc3Qgc3RvcmFnZVN0YXRlID0gZGVzZXJpYWxpemUoc3RvcmFnZS5nZXRJdGVtKGtleSkgfHwgJ3t9Jyk7XG5cbiAgbGV0IHN0b3JlcyA9IHt9O1xuICBsZXQgYWNjID0ge307XG5cbiAgZnVuY3Rpb24gc2F2ZSgpIHtcbiAgICBzdG9yYWdlLnNldEl0ZW0oa2V5LCBzZXJpYWxpemUoT2JqZWN0LmFzc2lnbih7fSwgc3RvcmFnZVN0YXRlLCBhY2MpKSk7XG4gIH1cblxuICBmdW5jdGlvbiBzdWJzY3JpYmUoc3RvcmVOYW1lLCBwYXRoKSB7XG4gICAgc3RvcmVzW3N0b3JlTmFtZV0gPSBfX3N0b3Jlc19fW3N0b3JlTmFtZV1cbiAgICAgIC5fc2VsZWN0KHN0YXRlID0+IGdldFZhbHVlKHN0YXRlLCBwYXRoKSlcbiAgICAgIC5waXBlKHNraXAoMSkpXG4gICAgICAuc3Vic2NyaWJlKGRhdGEgPT4ge1xuICAgICAgICBhY2Nbc3RvcmVOYW1lXSA9IGRhdGE7XG4gICAgICAgIHNhdmUoKTtcbiAgICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gc2V0SW5pdGlhbChzdG9yZU5hbWUsIHN0b3JlLCBwYXRoKSB7XG4gICAgaWYgKHN0b3JhZ2VTdGF0ZVtzdG9yZU5hbWVdKSB7XG4gICAgICBfX2dsb2JhbFN0YXRlLnNldEFjdGlvbih7IHR5cGU6ICdAUGVyc2lzdFN0YXRlJyB9KTtcbiAgICAgIHN0b3JlLnNldFN0YXRlKHN0YXRlID0+IHtcbiAgICAgICAgcmV0dXJuIHNldFZhbHVlKHN0YXRlLCBwYXRoLCBzdG9yYWdlU3RhdGVbc3RvcmVOYW1lXSk7XG4gICAgICB9KTtcbiAgICAgIGlmIChzdG9yZS5zZXREaXJ0eSkge1xuICAgICAgICBzdG9yZS5zZXREaXJ0eSgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGNvbnN0IHN1YnNjcmlwdGlvbiA9IHJvb3REaXNwYXRjaGVyLnN1YnNjcmliZShhY3Rpb24gPT4ge1xuICAgIGlmIChhY3Rpb24udHlwZSA9PT0gQWN0aW9ucy5ORVdfU1RPUkUpIHtcbiAgICAgIGxldCBjdXJyZW50U3RvcmVOYW1lID0gYWN0aW9uLnBheWxvYWQuc3RvcmUuc3RvcmVOYW1lO1xuXG4gICAgICBpZiAoaGFzRXhjbHVkZSAmJiBleGNsdWRlLmluZGV4T2YoY3VycmVudFN0b3JlTmFtZSkgPiAtMSA9PT0gdHJ1ZSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmIChoYXNJbmNsdWRlKSB7XG4gICAgICAgIGNvbnN0IHBhdGggPSBpbmNsdWRlLmZpbmQobmFtZSA9PiBuYW1lLmluZGV4T2YoY3VycmVudFN0b3JlTmFtZSkgPiAtMSk7XG4gICAgICAgIGlmICghcGF0aCkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjdXJyZW50U3RvcmVOYW1lID0gcGF0aC5zcGxpdCgnLicpWzBdO1xuICAgICAgICAgIHNldEluaXRpYWwoY3VycmVudFN0b3JlTmFtZSwgYWN0aW9uLnBheWxvYWQuc3RvcmUsIHBhdGgpO1xuICAgICAgICAgIHN1YnNjcmliZShjdXJyZW50U3RvcmVOYW1lLCBwYXRoKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc2V0SW5pdGlhbChjdXJyZW50U3RvcmVOYW1lLCBhY3Rpb24ucGF5bG9hZC5zdG9yZSwgY3VycmVudFN0b3JlTmFtZSk7XG4gICAgICAgIHN1YnNjcmliZShjdXJyZW50U3RvcmVOYW1lLCBjdXJyZW50U3RvcmVOYW1lKTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiB7XG4gICAgZGVzdHJveSgpIHtcbiAgICAgIHN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgZm9yIChsZXQgaSA9IDAsIGtleXMgPSBPYmplY3Qua2V5cyhzdG9yZXMpOyBpIDwga2V5cy5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCBzdG9yZU5hbWUgPSBrZXlzW2ldO1xuICAgICAgICBzdG9yZXNbc3RvcmVOYW1lXS51bnN1YnNjcmliZSgpO1xuICAgICAgfVxuICAgICAgc3RvcmVzID0ge307XG4gICAgfSxcbiAgICBjbGVhcigpIHtcbiAgICAgIHN0b3JhZ2UuY2xlYXIoKTtcbiAgICB9LFxuICAgIGNsZWFyU3RvcmUoc3RvcmVOYW1lOiBzdHJpbmcpIHtcbiAgICAgIGNvbnN0IHN0b3JhZ2VTdGF0ZSA9IGRlc2VyaWFsaXplKHN0b3JhZ2UuZ2V0SXRlbShrZXkpIHx8ICd7fScpO1xuXG4gICAgICBpZiAoc3RvcmFnZVN0YXRlW3N0b3JlTmFtZV0pIHtcbiAgICAgICAgZGVsZXRlIHN0b3JhZ2VTdGF0ZVtzdG9yZU5hbWVdO1xuICAgICAgICBzdG9yYWdlLnNldEl0ZW0oa2V5LCBzZXJpYWxpemUoc3RvcmFnZVN0YXRlKSk7XG4gICAgICB9XG4gICAgfVxuICB9O1xufVxuIiwiaW1wb3J0IHsgX19zdG9yZXNfXywgQWN0aW9ucywgcm9vdERpc3BhdGNoZXIgfSBmcm9tICcuLi9hcGkvc3RvcmUnO1xuaW1wb3J0IHsgX19nbG9iYWxTdGF0ZSB9IGZyb20gJy4uL2ludGVybmFsL2dsb2JhbC1zdGF0ZSc7XG5pbXBvcnQgeyBpc0RlZmluZWQgfSBmcm9tICcuLi9pbnRlcm5hbC91dGlscyc7XG5cbmV4cG9ydCB0eXBlIERldnRvb2xzT3B0aW9ucyA9IHtcbiAgLyoqICBtYXhpbXVtIGFsbG93ZWQgYWN0aW9ucyB0byBiZSBzdG9yZWQgaW4gdGhlIGhpc3RvcnkgdHJlZSAqL1xuICBtYXhBZ2U6IG51bWJlcjtcbiAgbGF0ZW5jeTogbnVtYmVyO1xuICBhY3Rpb25zQmxhY2tsaXN0OiBzdHJpbmdbXTtcbiAgYWN0aW9uc1doaXRlbGlzdDogc3RyaW5nW107XG4gIHNob3VsZENhdGNoRXJyb3JzOiBib29sZWFuO1xuICBsb2dUcmFjZTogYm9vbGVhbjtcbiAgcHJlZGljYXRlOiAoc3RhdGU6IGFueSwgYWN0aW9uOiBhbnkpID0+IGJvb2xlYW47XG59O1xuXG5leHBvcnQgdHlwZSBOZ1pvbmVMaWtlID0geyBydW46IGFueSB9O1xuXG5leHBvcnQgZnVuY3Rpb24gYWtpdGFEZXZ0b29scyhuZ1pvbmU6IE5nWm9uZUxpa2UsIG9wdGlvbnM/OiBQYXJ0aWFsPERldnRvb2xzT3B0aW9ucz4pO1xuZXhwb3J0IGZ1bmN0aW9uIGFraXRhRGV2dG9vbHMob3B0aW9ucz86IFBhcnRpYWw8RGV2dG9vbHNPcHRpb25zPik7XG5leHBvcnQgZnVuY3Rpb24gYWtpdGFEZXZ0b29scyhuZ1pvbmVPck9wdGlvbnM/OiBOZ1pvbmVMaWtlIHwgUGFydGlhbDxEZXZ0b29sc09wdGlvbnM+LCBvcHRpb25zOiBQYXJ0aWFsPERldnRvb2xzT3B0aW9ucz4gPSB7fSkge1xuICBpZiAoISh3aW5kb3cgYXMgYW55KS5fX1JFRFVYX0RFVlRPT0xTX0VYVEVOU0lPTl9fKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgaXNBbmd1bGFyID0gbmdab25lT3JPcHRpb25zICYmIG5nWm9uZU9yT3B0aW9uc1sncnVuJ107XG5cbiAgaWYgKCFpc0FuZ3VsYXIpIHtcbiAgICBuZ1pvbmVPck9wdGlvbnMgPSBuZ1pvbmVPck9wdGlvbnMgfHwge307XG4gICAgKG5nWm9uZU9yT3B0aW9ucyBhcyBhbnkpLnJ1biA9IGNiID0+IGNiKCk7XG4gICAgb3B0aW9ucyA9IG5nWm9uZU9yT3B0aW9ucyBhcyBQYXJ0aWFsPERldnRvb2xzT3B0aW9ucz47XG4gIH1cblxuICBjb25zdCBkZWZhdWx0T3B0aW9uczogUGFydGlhbDxEZXZ0b29sc09wdGlvbnM+ICYgeyBuYW1lOiBzdHJpbmcgfSA9IHsgbmFtZTogJ0FraXRhJyB9O1xuICBjb25zdCBtZXJnZWQgPSBPYmplY3QuYXNzaWduKHt9LCBkZWZhdWx0T3B0aW9ucywgb3B0aW9ucyk7XG5cbiAgY29uc3QgZGV2VG9vbHMgPSAod2luZG93IGFzIGFueSkuX19SRURVWF9ERVZUT09MU19FWFRFTlNJT05fXy5jb25uZWN0KG1lcmdlZCk7XG4gIGxldCBhcHBTdGF0ZSA9IHt9O1xuXG4gIHJvb3REaXNwYXRjaGVyLnN1YnNjcmliZShhY3Rpb24gPT4ge1xuICAgIGlmIChhY3Rpb24udHlwZSA9PT0gQWN0aW9ucy5ORVdfU1RBVEUpIHtcbiAgICAgIGlmIChfX2dsb2JhbFN0YXRlLnNraXBBY3Rpb24pIHtcbiAgICAgICAgX19nbG9iYWxTdGF0ZS5zZXRTa2lwQWN0aW9uKGZhbHNlKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBhcHBTdGF0ZSA9IHtcbiAgICAgICAgLi4uYXBwU3RhdGUsXG4gICAgICAgIFthY3Rpb24ucGF5bG9hZC5uYW1lXTogX19zdG9yZXNfX1thY3Rpb24ucGF5bG9hZC5uYW1lXS5fdmFsdWUoKVxuICAgICAgfTtcblxuICAgICAgY29uc3QgeyB0eXBlLCBlbnRpdHlJZCB9ID0gX19nbG9iYWxTdGF0ZS5jdXJyZW50QWN0aW9uO1xuICAgICAgY29uc3Qgc3RvcmVOYW1lID0gY2FwaXRhbGl6ZShhY3Rpb24ucGF5bG9hZC5uYW1lKTtcbiAgICAgIGxldCBtc2cgPSBpc0RlZmluZWQoZW50aXR5SWQpID8gYFske3N0b3JlTmFtZX1dIC0gJHt0eXBlfSAoaWRzOiAke2VudGl0eUlkfSlgIDogYFske3N0b3JlTmFtZX1dIC0gJHt0eXBlfWA7XG5cbiAgICAgIGlmIChvcHRpb25zLmxvZ1RyYWNlKSB7XG4gICAgICAgIGNvbnNvbGUuZ3JvdXAobXNnKTtcbiAgICAgICAgY29uc29sZS50cmFjZSgpO1xuICAgICAgICBjb25zb2xlLmdyb3VwRW5kKCk7XG4gICAgICB9XG5cbiAgICAgIGRldlRvb2xzLnNlbmQoeyB0eXBlOiBtc2csIHRyYW5zYWN0aW9uOiBfX2dsb2JhbFN0YXRlLmN1cnJlbnRULm1hcCh0ID0+IHQudHlwZSkgfSwgYXBwU3RhdGUpO1xuICAgIH1cbiAgfSk7XG5cbiAgZGV2VG9vbHMuc3Vic2NyaWJlKG1lc3NhZ2UgPT4ge1xuICAgIGlmIChtZXNzYWdlLnR5cGUgPT09ICdBQ1RJT04nKSB7XG4gICAgICBjb25zdCBbc3RvcmVOYW1lXSA9IG1lc3NhZ2UucGF5bG9hZC5zcGxpdCgnLicpO1xuXG4gICAgICBpZiAoX19zdG9yZXNfX1tzdG9yZU5hbWVdKSB7XG4gICAgICAgIChuZ1pvbmVPck9wdGlvbnMgYXMgTmdab25lTGlrZSkucnVuKCgpID0+IHtcbiAgICAgICAgICBjb25zdCBmdW5jQ2FsbCA9IG1lc3NhZ2UucGF5bG9hZC5yZXBsYWNlKHN0b3JlTmFtZSwgYHRoaXNbJyR7c3RvcmVOYW1lfSddYCk7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIG5ldyBGdW5jdGlvbihgJHtmdW5jQ2FsbH1gKS5jYWxsKF9fc3RvcmVzX18pO1xuICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybignVW5rbm93biBNZXRob2Qgw6LCmMK5w6/CuMKPJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAobWVzc2FnZS50eXBlID09PSAnRElTUEFUQ0gnKSB7XG4gICAgICBjb25zdCBwYXlsb2FkVHlwZSA9IG1lc3NhZ2UucGF5bG9hZC50eXBlO1xuXG4gICAgICBpZiAocGF5bG9hZFR5cGUgPT09ICdDT01NSVQnKSB7XG4gICAgICAgIGRldlRvb2xzLmluaXQoYXBwU3RhdGUpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmIChtZXNzYWdlLnN0YXRlKSB7XG4gICAgICAgIGNvbnN0IHJvb3RTdGF0ZSA9IEpTT04ucGFyc2UobWVzc2FnZS5zdGF0ZSk7XG4gICAgICAgIGZvciAobGV0IGkgPSAwLCBrZXlzID0gT2JqZWN0LmtleXMocm9vdFN0YXRlKTsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBjb25zdCBzdG9yZU5hbWUgPSBrZXlzW2ldO1xuICAgICAgICAgIGlmIChfX3N0b3Jlc19fW3N0b3JlTmFtZV0pIHtcbiAgICAgICAgICAgIChuZ1pvbmVPck9wdGlvbnMgYXMgTmdab25lTGlrZSkucnVuKCgpID0+IHtcbiAgICAgICAgICAgICAgX19zdG9yZXNfX1tzdG9yZU5hbWVdLnNldFN0YXRlKCgpID0+IHJvb3RTdGF0ZVtzdG9yZU5hbWVdLCBmYWxzZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBjYXBpdGFsaXplKHN0cmluZykge1xuICByZXR1cm4gc3RyaW5nICYmIHN0cmluZy5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHN0cmluZy5zbGljZSgxKTtcbn1cbiIsImltcG9ydCB7Y29lcmNlQXJyYXksIGlzRnVuY3Rpb24sIGlzVW5kZWZpbmVkLCB0b0Jvb2xlYW59IGZyb20gJy4uL2ludGVybmFsL3V0aWxzJztcbmltcG9ydCB7UXVlcnlFbnRpdHl9IGZyb20gJy4uL2FwaS9xdWVyeS1lbnRpdHknO1xuaW1wb3J0IHtJRCwgSURTfSBmcm9tICcuLi9hcGkvdHlwZXMnO1xuaW1wb3J0IHtPYnNlcnZhYmxlfSBmcm9tICdyeGpzJztcblxuLyoqXG4gKiBFYWNoIHBsdWdpbiB0aGF0IHdhbnRzIHRvIGFkZCBzdXBwb3J0IGZvciBlbnRpdGllcyBzaG91bGQgZXh0ZW5kIHRoaXMgaW50ZXJmYWNlLlxuICovXG5leHBvcnQgdHlwZSBFbnRpdHlQYXJhbSA9IElEO1xuXG5leHBvcnQgdHlwZSBFbnRpdHlDb2xsZWN0aW9uUGFyYW1zID0gSUQgfCBJRFtdO1xuXG5leHBvcnQgdHlwZSBSZWJhc2VBY3Rpb25zPFAgPSBhbnk+ID0geyBiZWZvcmVSZW1vdmU/OiBGdW5jdGlvbjsgYmVmb3JlQWRkPzogRnVuY3Rpb247IGFmdGVyQWRkPzogKHBsdWdpbjogUCkgPT4gYW55OyB9O1xuXG5jb25zdCBkZWZhdWx0QWN0aW9uczogUmViYXNlQWN0aW9ucyA9IHtiZWZvcmVSZW1vdmU6IHBsdWdpbiA9PiBwbHVnaW4uZGVzdHJveSgpfTtcblxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIEVudGl0eUNvbGxlY3Rpb25QbHVnaW48RSwgUD4ge1xuICBwcm90ZWN0ZWQgZW50aXRpZXMgPSBuZXcgTWFwPElELCBQPigpO1xuXG4gIHByb3RlY3RlZCBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgcXVlcnk6IFF1ZXJ5RW50aXR5PGFueSwgRT4sIHByaXZhdGUgZW50aXR5SWRzOiBFbnRpdHlDb2xsZWN0aW9uUGFyYW1zKSB7fVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIGVudGl0eSBwbHVnaW4gaW5zdGFuY2UuXG4gICAqL1xuICBwcm90ZWN0ZWQgZ2V0RW50aXR5KGlkOiBJRCk6IFAge1xuICAgIHJldHVybiB0aGlzLmVudGl0aWVzLmdldChpZCk7XG4gIH1cblxuICAvKipcbiAgICogV2hldGhlciB0aGUgZW50aXR5IHBsdWdpbiBleGlzdC5cbiAgICovXG4gIHByb3RlY3RlZCBoYXNFbnRpdHkoaWQ6IElEKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuZW50aXRpZXMuaGFzKGlkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW1vdmUgdGhlIGVudGl0eSBwbHVnaW4gaW5zdGFuY2UuXG4gICAqL1xuICBwcm90ZWN0ZWQgcmVtb3ZlRW50aXR5KGlkOiBJRCkge1xuICAgIHJldHVybiB0aGlzLmVudGl0aWVzLmRlbGV0ZShpZCk7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHRoZSBlbnRpdHkgcGx1Z2luIGluc3RhbmNlLlxuICAgKi9cbiAgcHJvdGVjdGVkIGNyZWF0ZUVudGl0eShpZDogSUQsIHBsdWdpbjogUCkge1xuICAgIHJldHVybiB0aGlzLmVudGl0aWVzLnNldChpZCwgcGx1Z2luKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJZiB0aGUgdXNlciBwYXNzZXMgYGVudGl0eUlkc2Agd2UgdGFrZSB0aGVtOyBvdGhlcndpc2UsIHdlIHRha2UgYWxsLlxuICAgKi9cbiAgcHJvdGVjdGVkIGdldElkcygpOiBJRFtdIHtcbiAgICByZXR1cm4gaXNVbmRlZmluZWQodGhpcy5lbnRpdHlJZHMpID8gdGhpcy5xdWVyeS5nZXRTbmFwc2hvdCgpLmlkcyA6IGNvZXJjZUFycmF5KHRoaXMuZW50aXR5SWRzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBXaGVuIHlvdSBjYWxsIG9uZSBvZiB0aGUgcGx1Z2luIG1ldGhvZHMsIHlvdSBjYW4gcGFzcyBpZC9pZHMgb3IgdW5kZWZpbmVkIHdoaWNoIG1lYW5zIGFsbC5cbiAgICovXG4gIHByb3RlY3RlZCByZXNvbHZlZElkcyhpZHM/KTogSURbXSB7XG4gICAgcmV0dXJuIGlzVW5kZWZpbmVkKGlkcykgPyB0aGlzLmdldElkcygpIDogY29lcmNlQXJyYXkoaWRzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxsIHRoaXMgbWV0aG9kIHdoZW4geW91IHdhbnQgdG8gYWN0aXZhdGUgdGhlIHBsdWdpbiBvbiBpbml0IG9yIHdoZW4geW91IG5lZWQgdG8gbGlzdGVuIHRvIGFkZC9yZW1vdmUgb2YgZW50aXRpZXMgZHluYW1pY2FsbHkuXG4gICAqXG4gICAqIEZvciBleGFtcGxlIGluIHlvdXIgcGx1Z2luIHlvdSBtYXkgZG8gdGhlIGZvbGxvd2luZzpcbiAgICpcbiAgICogdGhpcy5xdWVyeS5zZWxlY3Qoc3RhdGUgPT4gc3RhdGUuaWRzKS5waXBlKHNraXAoMSkpLnN1YnNjcmliZShpZHMgPT4gdGhpcy5hY3RpdmF0ZShpZHMpKTtcbiAgICovXG4gIHByb3RlY3RlZCByZWJhc2UoaWRzOiBJRFtdLCBhY3Rpb25zOiBSZWJhc2VBY3Rpb25zPFA+ID0gZGVmYXVsdEFjdGlvbnMpIHtcbiAgICAvKipcbiAgICAgKlxuICAgICAqIElmIHRoZSB1c2VyIHBhc3NlcyBgZW50aXR5SWRzYCAmIHdlIGhhdmUgbmV3IGlkcyBjaGVjayBpZiB3ZSBuZWVkIHRvIGFkZC9yZW1vdmUgaW5zdGFuY2VzLlxuICAgICAqXG4gICAgICogVGhpcyBwaGFzZSB3aWxsIGJlIGNhbGxlZCBvbmx5IHVwb24gdXBkYXRlLlxuICAgICAqL1xuICAgIGlmICh0b0Jvb2xlYW4oaWRzKSkge1xuICAgICAgLyoqXG4gICAgICAgKiBXaGljaCBtZWFucyBhbGxcbiAgICAgICAqL1xuICAgICAgaWYgKGlzVW5kZWZpbmVkKHRoaXMuZW50aXR5SWRzKSkge1xuICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gaWRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgY29uc3QgZW50aXR5SWQgPSBpZHNbaV07XG4gICAgICAgICAgaWYgKHRoaXMuaGFzRW50aXR5KGVudGl0eUlkKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIGlzRnVuY3Rpb24oYWN0aW9ucy5iZWZvcmVBZGQpICYmIGFjdGlvbnMuYmVmb3JlQWRkKGVudGl0eUlkKTtcbiAgICAgICAgICAgIGNvbnN0IHBsdWdpbiA9IHRoaXMuaW5zdGFudGlhdGVQbHVnaW4oZW50aXR5SWQpO1xuICAgICAgICAgICAgdGhpcy5lbnRpdGllcy5zZXQoZW50aXR5SWQsIHBsdWdpbik7XG4gICAgICAgICAgICBpc0Z1bmN0aW9uKGFjdGlvbnMuYWZ0ZXJBZGQpICYmIGFjdGlvbnMuYWZ0ZXJBZGQocGx1Z2luKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmVudGl0aWVzLmZvckVhY2goKHBsdWdpbiwgZW50aXR5SWQpID0+IHtcbiAgICAgICAgICBpZiAoaWRzLmluZGV4T2YoZW50aXR5SWQpID09PSAtMSkge1xuICAgICAgICAgICAgaXNGdW5jdGlvbihhY3Rpb25zLmJlZm9yZVJlbW92ZSkgJiYgYWN0aW9ucy5iZWZvcmVSZW1vdmUocGx1Z2luKTtcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlRW50aXR5KGVudGl0eUlkKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdoaWNoIG1lYW5zIHRoZSB1c2VyIHBhc3NlcyBzcGVjaWZpYyBpZHNcbiAgICAgICAgICovXG4gICAgICAgIGNvbnN0IF9pZHMgPSBjb2VyY2VBcnJheSh0aGlzLmVudGl0eUlkcyk7XG4gICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBfaWRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgY29uc3QgZW50aXR5SWQgPSBfaWRzW2ldO1xuICAgICAgICAgIC8qKiBUaGUgRW50aXR5IGluIGN1cnJlbnQgaWRzIGFuZCBkb2Vzbid0IGV4aXN0LCBhZGQgaXQuICovXG4gICAgICAgICAgaWYgKGlkcy5pbmRleE9mKGVudGl0eUlkKSA+IC0xICYmIHRoaXMuaGFzRW50aXR5KGVudGl0eUlkKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIGlzRnVuY3Rpb24oYWN0aW9ucy5iZWZvcmVBZGQpICYmIGFjdGlvbnMuYmVmb3JlQWRkKGVudGl0eUlkKTtcbiAgICAgICAgICAgIGNvbnN0IHBsdWdpbiA9IHRoaXMuaW5zdGFudGlhdGVQbHVnaW4oZW50aXR5SWQpO1xuICAgICAgICAgICAgdGhpcy5lbnRpdGllcy5zZXQoZW50aXR5SWQsIHBsdWdpbik7XG4gICAgICAgICAgICBpc0Z1bmN0aW9uKGFjdGlvbnMuYWZ0ZXJBZGQpICYmIGFjdGlvbnMuYWZ0ZXJBZGQocGx1Z2luKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5lbnRpdGllcy5mb3JFYWNoKChwbHVnaW4sIGVudGl0eUlkKSA9PiB7XG4gICAgICAgICAgICAgIC8qKiBUaGUgRW50aXR5IG5vdCBpbiBjdXJyZW50IGlkcyBhbmQgZXhpc3RzLCByZW1vdmUgaXQuICovXG4gICAgICAgICAgICAgIGlmIChpZHMuaW5kZXhPZihlbnRpdHlJZCkgPT09IC0xICYmIHRoaXMuaGFzRW50aXR5KGVudGl0eUlkKSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIGlzRnVuY3Rpb24oYWN0aW9ucy5iZWZvcmVSZW1vdmUpICYmIGFjdGlvbnMuYmVmb3JlUmVtb3ZlKHBsdWdpbik7XG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVFbnRpdHkoZW50aXR5SWQpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLyoqXG4gICAgICAgKiBPdGhlcndpc2UsIHN0YXJ0IHdpdGggdGhlIHByb3ZpZGVkIGlkcyBvciBhbGwuXG4gICAgICAgKi9cbiAgICAgIHRoaXMuZ2V0SWRzKCkuZm9yRWFjaChpZCA9PiB7XG4gICAgICAgIGlmICghdGhpcy5oYXNFbnRpdHkoaWQpKSB0aGlzLmNyZWF0ZUVudGl0eShpZCwgdGhpcy5pbnN0YW50aWF0ZVBsdWdpbihpZCkpXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTGlzdGVuIGZvciBhZGQvcmVtb3ZlIGVudGl0aWVzLlxuICAgKi9cbiAgcHJvdGVjdGVkIHNlbGVjdElkcygpOiBPYnNlcnZhYmxlPElEW10+IHtcbiAgICByZXR1cm4gdGhpcy5xdWVyeS5zZWxlY3Qoc3RhdGUgPT4gc3RhdGUuaWRzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBCYXNlIG1ldGhvZCBmb3IgYWN0aXZhdGlvbiwgeW91IGNhbiBvdmVycmlkZSBpdCBpZiB5b3UgbmVlZCB0by5cbiAgICovXG4gIHByb3RlY3RlZCBhY3RpdmF0ZShpZHM/OiBJRFtdKSB7XG4gICAgdGhpcy5yZWJhc2UoaWRzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGlzIG1ldGhvZCBpcyByZXNwb25zaWJsZSBmb3IgcGx1Z2luIGluc3RhbnRpYXRpb24uXG4gICAqXG4gICAqIEZvciBleGFtcGxlOlxuICAgKiByZXR1cm4gbmV3IFN0YXRlSGlzdG9yeSh0aGlzLnF1ZXJ5LCB0aGlzLnBhcmFtcywgaWQpIGFzIFA7XG4gICAqL1xuICBwcm90ZWN0ZWQgYWJzdHJhY3QgaW5zdGFudGlhdGVQbHVnaW4oaWQ6IElEKTogUDtcblxuICAvKipcbiAgICogVGhpcyBtZXRob2QgaXMgcmVzcG9uc2libGUgZm9yIGNsZWFuaW5nLlxuICAgKi9cbiAgcHVibGljIGFic3RyYWN0IGRlc3Ryb3koaWQ/OiBJRCk7XG5cbiAgLyoqXG4gICAqIExvb3Agb3ZlciBlYWNoIGlkIGFuZCBpbnZva2UgdGhlIHBsdWdpbiBtZXRob2QuXG4gICAqL1xuICBwcm90ZWN0ZWQgZm9yRWFjaElkKGlkczogSURTLCBjYjogKGVudGl0eTogUCkgPT4gYW55KSB7XG4gICAgY29uc3QgX2lkcyA9IHRoaXMucmVzb2x2ZWRJZHMoaWRzKTtcblxuICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBfaWRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICBjb25zdCBpZCA9IF9pZHNbaV07XG4gICAgICBpZiAodGhpcy5oYXNFbnRpdHkoaWQpKSB7XG4gICAgICAgIGNiKHRoaXMuZ2V0RW50aXR5KGlkKSk7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG4iLCJpbXBvcnQgeyBmaWx0ZXIsIHBhaXJ3aXNlIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgX19nbG9iYWxTdGF0ZSB9IGZyb20gJy4uLy4uL2ludGVybmFsL2dsb2JhbC1zdGF0ZSc7XG5pbXBvcnQgeyB0b0Jvb2xlYW4gfSBmcm9tICcuLi8uLi9pbnRlcm5hbC91dGlscyc7XG5pbXBvcnQgeyBBa2l0YVBsdWdpbiwgUXVlcmllcyB9IGZyb20gJy4uL3BsdWdpbic7XG5pbXBvcnQgeyBFbnRpdHlQYXJhbSB9IGZyb20gJy4uL2VudGl0eS1jb2xsZWN0aW9uLXBsdWdpbic7XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdGVIaXN0b3J5UGFyYW1zIHtcbiAgbWF4QWdlPzogbnVtYmVyO1xufVxuXG5leHBvcnQgY2xhc3MgU3RhdGVIaXN0b3J5UGx1Z2luPEUgPSBhbnksIFMgPSBhbnk+IGV4dGVuZHMgQWtpdGFQbHVnaW48RSwgUz4ge1xuICAvKiogQWxsb3cgc2tpcHBpbmcgYW4gdXBkYXRlIGZyb20gb3V0c2lkZSAqL1xuICBwcml2YXRlIHNraXAgPSBmYWxzZTtcblxuICBwcml2YXRlIGhpc3RvcnkgPSB7XG4gICAgcGFzdDogW10sXG4gICAgcHJlc2VudDogbnVsbCxcbiAgICBmdXR1cmU6IFtdXG4gIH07XG5cbiAgLyoqIFNraXAgdGhlIHVwZGF0ZSB3aGVuIHJlZG8vdW5kbyAqL1xuICBwcml2YXRlIHNraXBVcGRhdGUgPSBmYWxzZTtcbiAgcHJpdmF0ZSBzdWJzY3JpcHRpb247XG5cbiAgY29uc3RydWN0b3IocHJvdGVjdGVkIHF1ZXJ5OiBRdWVyaWVzPEUsIFM+LCBwcml2YXRlIHBhcmFtczogU3RhdGVIaXN0b3J5UGFyYW1zID0ge30sIHByaXZhdGUgX2VudGl0eUlkPzogRW50aXR5UGFyYW0pIHtcbiAgICBzdXBlcihxdWVyeSk7XG4gICAgcGFyYW1zLm1heEFnZSA9IHRvQm9vbGVhbihwYXJhbXMubWF4QWdlKSA/IHBhcmFtcy5tYXhBZ2UgOiAxMDtcbiAgICB0aGlzLmFjdGl2YXRlKCk7XG4gIH1cblxuICBnZXQgaGFzUGFzdCgpIHtcbiAgICByZXR1cm4gdGhpcy5oaXN0b3J5LnBhc3QubGVuZ3RoID4gMDtcbiAgfVxuXG4gIGdldCBoYXNGdXR1cmUoKSB7XG4gICAgcmV0dXJuIHRoaXMuaGlzdG9yeS5mdXR1cmUubGVuZ3RoID4gMDtcbiAgfVxuXG4gIGFjdGl2YXRlKCkge1xuICAgIHRoaXMuaGlzdG9yeS5wcmVzZW50ID0gdGhpcy5nZXRTb3VyY2UodGhpcy5fZW50aXR5SWQpO1xuICAgIHRoaXMuc3Vic2NyaXB0aW9uID0gdGhpcy5zZWxlY3RTb3VyY2UodGhpcy5fZW50aXR5SWQpXG4gICAgICAucGlwZShwYWlyd2lzZSgpKVxuICAgICAgLnN1YnNjcmliZSgoW3Bhc3QsIHByZXNlbnRdKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLnNraXApIHtcbiAgICAgICAgICB0aGlzLnNraXAgPSBmYWxzZTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLnNraXBVcGRhdGUpIHtcbiAgICAgICAgICBpZiAodGhpcy5oaXN0b3J5LnBhc3QubGVuZ3RoID09PSB0aGlzLnBhcmFtcy5tYXhBZ2UpIHtcbiAgICAgICAgICAgIHRoaXMuaGlzdG9yeS5wYXN0ID0gdGhpcy5oaXN0b3J5LnBhc3Quc2xpY2UoMSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMuaGlzdG9yeS5wYXN0ID0gWy4uLnRoaXMuaGlzdG9yeS5wYXN0LCBwYXN0XTtcbiAgICAgICAgICB0aGlzLmhpc3RvcnkucHJlc2VudCA9IHByZXNlbnQ7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICB9XG5cbiAgdW5kbygpIHtcbiAgICBpZiAodGhpcy5oaXN0b3J5LnBhc3QubGVuZ3RoID4gMCkge1xuICAgICAgY29uc3QgeyBwYXN0LCBwcmVzZW50LCBmdXR1cmUgfSA9IHRoaXMuaGlzdG9yeTtcbiAgICAgIGNvbnN0IHByZXZpb3VzID0gcGFzdFtwYXN0Lmxlbmd0aCAtIDFdO1xuICAgICAgY29uc3QgbmV3UGFzdCA9IHBhc3Quc2xpY2UoMCwgcGFzdC5sZW5ndGggLSAxKTtcblxuICAgICAgdGhpcy5oaXN0b3J5LnBhc3QgPSBuZXdQYXN0O1xuICAgICAgdGhpcy5oaXN0b3J5LnByZXNlbnQgPSBwcmV2aW91cztcbiAgICAgIHRoaXMuaGlzdG9yeS5mdXR1cmUgPSBbcHJlc2VudCwgLi4udGhpcy5oaXN0b3J5LmZ1dHVyZV07XG4gICAgICB0aGlzLnVwZGF0ZSgpO1xuICAgIH1cbiAgfVxuXG4gIHJlZG8oKSB7XG4gICAgaWYgKHRoaXMuaGlzdG9yeS5mdXR1cmUubGVuZ3RoID4gMCkge1xuICAgICAgY29uc3QgeyBwYXN0LCBwcmVzZW50LCBmdXR1cmUgfSA9IHRoaXMuaGlzdG9yeTtcbiAgICAgIGNvbnN0IG5leHQgPSB0aGlzLmhpc3RvcnkuZnV0dXJlWzBdO1xuICAgICAgY29uc3QgbmV3RnV0dXJlID0gdGhpcy5oaXN0b3J5LmZ1dHVyZS5zbGljZSgxKTtcbiAgICAgIHRoaXMuaGlzdG9yeS5wYXN0ID0gWy4uLnBhc3QsIHByZXNlbnRdO1xuICAgICAgdGhpcy5oaXN0b3J5LnByZXNlbnQgPSBuZXh0O1xuICAgICAgdGhpcy5oaXN0b3J5LmZ1dHVyZSA9IG5ld0Z1dHVyZTtcbiAgICAgIHRoaXMudXBkYXRlKCdSZWRvJyk7XG4gICAgfVxuICB9XG5cbiAganVtcFRvUGFzdChpbmRleDogbnVtYmVyKSB7XG4gICAgaWYgKGluZGV4IDwgMCB8fCBpbmRleCA+PSB0aGlzLmhpc3RvcnkucGFzdC5sZW5ndGgpIHJldHVybjtcblxuICAgIGNvbnN0IHsgcGFzdCwgZnV0dXJlIH0gPSB0aGlzLmhpc3Rvcnk7XG4gICAgLyoqXG4gICAgICpcbiAgICAgKiBjb25zdCBwYXN0ID0gWzEsIDIsIDMsIDQsIDVdO1xuICAgICAqXG4gICAgICogbmV3UGFzdCA9IHBhc3Quc2xpY2UoMCwgMikgPSBbMSwgMl07XG4gICAgICogcHJlc2VudCA9IHBhc3RbaW5kZXhdID0gMztcbiAgICAgKiBbLi4ucGFzdC5zbGljZSgyICsgMSksIC4uLmZ1dHVyZV0gPSBbNCwgNV07XG4gICAgICpcbiAgICAgKi9cbiAgICBjb25zdCBuZXdQYXN0ID0gcGFzdC5zbGljZSgwLCBpbmRleCk7XG4gICAgY29uc3QgbmV3RnV0dXJlID0gWy4uLnBhc3Quc2xpY2UoaW5kZXggKyAxKSwgLi4uZnV0dXJlXTtcbiAgICBjb25zdCBuZXdQcmVzZW50ID0gcGFzdFtpbmRleF07XG4gICAgdGhpcy5oaXN0b3J5LnBhc3QgPSBuZXdQYXN0O1xuICAgIHRoaXMuaGlzdG9yeS5wcmVzZW50ID0gbmV3UHJlc2VudDtcbiAgICB0aGlzLmhpc3RvcnkuZnV0dXJlID0gbmV3RnV0dXJlO1xuICAgIHRoaXMudXBkYXRlKCk7XG4gIH1cblxuICBqdW1wVG9GdXR1cmUoaW5kZXg6IG51bWJlcikge1xuICAgIGlmIChpbmRleCA8IDAgfHwgaW5kZXggPj0gdGhpcy5oaXN0b3J5LmZ1dHVyZS5sZW5ndGgpIHJldHVybjtcblxuICAgIGNvbnN0IHsgcGFzdCwgZnV0dXJlIH0gPSB0aGlzLmhpc3Rvcnk7XG5cbiAgICBjb25zdCBuZXdQYXN0ID0gWy4uLnBhc3QsIC4uLmZ1dHVyZS5zbGljZSgwLCBpbmRleCldO1xuICAgIGNvbnN0IG5ld1ByZXNlbnQgPSBmdXR1cmVbaW5kZXhdO1xuICAgIGNvbnN0IG5ld0Z1dHVyZSA9IGZ1dHVyZS5zbGljZShpbmRleCArIDEpO1xuXG4gICAgdGhpcy5oaXN0b3J5LnBhc3QgPSBuZXdQYXN0O1xuICAgIHRoaXMuaGlzdG9yeS5wcmVzZW50ID0gbmV3UHJlc2VudDtcbiAgICB0aGlzLmhpc3RvcnkuZnV0dXJlID0gbmV3RnV0dXJlO1xuICAgIHRoaXMudXBkYXRlKCdSZWRvJyk7XG4gIH1cblxuICBjbGVhcigpIHtcbiAgICB0aGlzLmhpc3RvcnkgPSB7XG4gICAgICBwYXN0OiBbXSxcbiAgICAgIHByZXNlbnQ6IG51bGwsXG4gICAgICBmdXR1cmU6IFtdXG4gICAgfTtcbiAgfVxuXG4gIGRlc3Ryb3koY2xlYXJIaXN0b3J5ID0gZmFsc2UpIHtcbiAgICBpZiAoY2xlYXJIaXN0b3J5KSB7XG4gICAgICB0aGlzLmNsZWFyKCk7XG4gICAgfVxuICAgIHRoaXMuc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gIH1cblxuICBpZ25vcmVOZXh0KCkge1xuICAgIHRoaXMuc2tpcCA9IHRydWU7XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZShhY3Rpb24gPSAnVW5kbycpIHtcbiAgICB0aGlzLnNraXBVcGRhdGUgPSB0cnVlO1xuICAgIF9fZ2xvYmFsU3RhdGUuc2V0Q3VzdG9tQWN0aW9uKHsgdHlwZTogYEBTdGF0ZUhpc3RvcnkgLSAke2FjdGlvbn1gIH0pO1xuICAgIHRoaXMudXBkYXRlU3RvcmUodGhpcy5oaXN0b3J5LnByZXNlbnQsIHRoaXMuX2VudGl0eUlkKTtcbiAgICB0aGlzLnNraXBVcGRhdGUgPSBmYWxzZTtcbiAgfVxufVxuIiwiaW1wb3J0IHsgSUQsIElEUyB9IGZyb20gJy4uLy4uL2FwaS90eXBlcyc7XG5pbXBvcnQgeyBRdWVyeUVudGl0eSB9IGZyb20gJy4uLy4uL2FwaS9xdWVyeS1lbnRpdHknO1xuaW1wb3J0IHsgU3RhdGVIaXN0b3J5UGx1Z2luLCBTdGF0ZUhpc3RvcnlQYXJhbXMgfSBmcm9tICcuL3N0YXRlLWhpc3RvcnktcGx1Z2luJztcbmltcG9ydCB7IHRvQm9vbGVhbiB9IGZyb20gJy4uLy4uL2ludGVybmFsL3V0aWxzJztcbmltcG9ydCB7IHNraXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBFbnRpdHlDb2xsZWN0aW9uUGx1Z2luLCBFbnRpdHlDb2xsZWN0aW9uUGFyYW1zIH0gZnJvbSAnLi4vZW50aXR5LWNvbGxlY3Rpb24tcGx1Z2luJztcblxuZXhwb3J0IGludGVyZmFjZSBTdGF0ZUhpc3RvcnlFbnRpdHlQYXJhbXMgZXh0ZW5kcyBTdGF0ZUhpc3RvcnlQYXJhbXMge1xuICBlbnRpdHlJZHM/OiBFbnRpdHlDb2xsZWN0aW9uUGFyYW1zO1xufVxuXG5leHBvcnQgY2xhc3MgRW50aXR5U3RhdGVIaXN0b3J5UGx1Z2luPEUsIFAgZXh0ZW5kcyBTdGF0ZUhpc3RvcnlQbHVnaW48RSwgYW55PiA9IFN0YXRlSGlzdG9yeVBsdWdpbjxFLCBhbnk+PiBleHRlbmRzIEVudGl0eUNvbGxlY3Rpb25QbHVnaW48RSwgUD4ge1xuICBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgcXVlcnk6IFF1ZXJ5RW50aXR5PGFueSwgRT4sIHByb3RlY3RlZCByZWFkb25seSBwYXJhbXM6IFN0YXRlSGlzdG9yeUVudGl0eVBhcmFtcyA9IHt9KSB7XG4gICAgc3VwZXIocXVlcnksIHBhcmFtcy5lbnRpdHlJZHMpO1xuICAgIHBhcmFtcy5tYXhBZ2UgPSB0b0Jvb2xlYW4ocGFyYW1zLm1heEFnZSkgPyBwYXJhbXMubWF4QWdlIDogMTA7XG4gICAgdGhpcy5hY3RpdmF0ZSgpO1xuICAgIHRoaXMuc2VsZWN0SWRzKClcbiAgICAgIC5waXBlKHNraXAoMSkpXG4gICAgICAuc3Vic2NyaWJlKGlkcyA9PiB0aGlzLmFjdGl2YXRlKGlkcykpO1xuICB9XG5cbiAgcmVkbyhpZHM/OiBJRFMpIHtcbiAgICB0aGlzLmZvckVhY2hJZChpZHMsIGUgPT4gZS5yZWRvKCkpO1xuICB9XG5cbiAgdW5kbyhpZHM/OiBJRFMpIHtcbiAgICB0aGlzLmZvckVhY2hJZChpZHMsIGUgPT4gZS51bmRvKCkpO1xuICB9XG5cbiAgaGFzUGFzdChpZDogSUQpIHtcbiAgICBpZiAodGhpcy5oYXNFbnRpdHkoaWQpKSB7XG4gICAgICByZXR1cm4gdGhpcy5nZXRFbnRpdHkoaWQpLmhhc1Bhc3Q7XG4gICAgfVxuICB9XG5cbiAgaGFzRnV0dXJlKGlkOiBJRCkge1xuICAgIGlmICh0aGlzLmhhc0VudGl0eShpZCkpIHtcbiAgICAgIHJldHVybiB0aGlzLmdldEVudGl0eShpZCkuaGFzRnV0dXJlO1xuICAgIH1cbiAgfVxuXG4gIGp1bXBUb0Z1dHVyZShpZHM6IElEUywgaW5kZXg6IG51bWJlcikge1xuICAgIHRoaXMuZm9yRWFjaElkKGlkcywgZSA9PiBlLmp1bXBUb0Z1dHVyZShpbmRleCkpO1xuICB9XG5cbiAganVtcFRvUGFzdChpZHM6IElEUywgaW5kZXg6IG51bWJlcikge1xuICAgIHRoaXMuZm9yRWFjaElkKGlkcywgZSA9PiBlLmp1bXBUb1Bhc3QoaW5kZXgpKTtcbiAgfVxuXG4gIGNsZWFyKGlkcz86IElEUykge1xuICAgIHRoaXMuZm9yRWFjaElkKGlkcywgZSA9PiBlLmNsZWFyKCkpO1xuICB9XG5cbiAgZGVzdHJveShpZHM/OiBJRFMsIGNsZWFySGlzdG9yeSA9IGZhbHNlKSB7XG4gICAgdGhpcy5mb3JFYWNoSWQoaWRzLCBlID0+IGUuZGVzdHJveShjbGVhckhpc3RvcnkpKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBpbnN0YW50aWF0ZVBsdWdpbihpZDogSUQpIHtcbiAgICByZXR1cm4gbmV3IFN0YXRlSGlzdG9yeVBsdWdpbjxFLCBhbnk+KHRoaXMucXVlcnksIHRoaXMucGFyYW1zLCBpZCkgYXMgUDtcbiAgfVxufVxuIiwiaW1wb3J0IHsgQWtpdGFQbHVnaW4sIFF1ZXJpZXMgfSBmcm9tICcuLi9wbHVnaW4nO1xuaW1wb3J0IHsgUXVlcnlFbnRpdHkgfSBmcm9tICcuLi8uLi9hcGkvcXVlcnktZW50aXR5JztcbmltcG9ydCB7IE9ic2VydmFibGUsIEJlaGF2aW9yU3ViamVjdCwgU3Vic2NyaXB0aW9uLCBtZXJnZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgZGlzdGluY3RVbnRpbENoYW5nZWQsIG1hcCwgc2tpcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IGNvZXJjZUFycmF5LCBpc0Z1bmN0aW9uLCBpc1VuZGVmaW5lZCwgdG9Cb29sZWFuIH0gZnJvbSAnLi4vLi4vaW50ZXJuYWwvdXRpbHMnO1xuaW1wb3J0IHsgRW50aXR5UGFyYW0gfSBmcm9tICcuLi9lbnRpdHktY29sbGVjdGlvbi1wbHVnaW4nO1xuaW1wb3J0IHsgX19nbG9iYWxTdGF0ZSB9IGZyb20gJy4uLy4uL2ludGVybmFsL2dsb2JhbC1zdGF0ZSc7XG5pbXBvcnQgeyBRdWVyeSB9IGZyb20gJy4uLy4uL2FwaS9xdWVyeSc7XG5cbmV4cG9ydCB0eXBlIERpcnR5Q2hlY2tDb21wYXJhdG9yPEVudGl0eT4gPSAoaGVhZDogRW50aXR5LCBjdXJyZW50OiBFbnRpdHkpID0+IGJvb2xlYW47XG5cbmV4cG9ydCB0eXBlIERpcnR5Q2hlY2tQYXJhbXM8U3RvcmVTdGF0ZSA9IGFueT4gPSB7XG4gIGNvbXBhcmF0b3I/OiBEaXJ0eUNoZWNrQ29tcGFyYXRvcjxTdG9yZVN0YXRlPjtcbiAgd2F0Y2hQcm9wZXJ0eT86IGtleW9mIFN0b3JlU3RhdGUgfCAoa2V5b2YgU3RvcmVTdGF0ZSlbXTtcbn07XG5cbmV4cG9ydCBjb25zdCBkaXJ0eUNoZWNrRGVmYXVsdFBhcmFtcyA9IHtcbiAgY29tcGFyYXRvcjogKGhlYWQsIGN1cnJlbnQpID0+IEpTT04uc3RyaW5naWZ5KGhlYWQpICE9PSBKU09OLnN0cmluZ2lmeShjdXJyZW50KVxufTtcblxuZXhwb3J0IHR5cGUgRGlydHlDaGVja1Jlc2V0UGFyYW1zPFN0b3JlU3RhdGUgPSBhbnk+ID0ge1xuICB1cGRhdGVGbj86IFN0b3JlU3RhdGUgfCAoKGhlYWQ6IFN0b3JlU3RhdGUsIGN1cnJlbnQ6IFN0b3JlU3RhdGUpID0+IGFueSk7XG59O1xuXG5leHBvcnQgY2xhc3MgRGlydHlDaGVja1BsdWdpbjxFbnRpdHkgPSBhbnksIFN0b3JlU3RhdGUgPSBhbnk+IGV4dGVuZHMgQWtpdGFQbHVnaW48RW50aXR5LCBTdG9yZVN0YXRlPiB7XG4gIHByaXZhdGUgaGVhZDogU3RvcmVTdGF0ZSB8IFBhcnRpYWw8U3RvcmVTdGF0ZT4gfCBFbnRpdHk7XG4gIHByaXZhdGUgZGlydHkgPSBuZXcgQmVoYXZpb3JTdWJqZWN0KGZhbHNlKTtcbiAgcHJpdmF0ZSBzdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcbiAgcHJpdmF0ZSBhY3RpdmUgPSBmYWxzZTtcblxuICBpc0RpcnR5JDogT2JzZXJ2YWJsZTxib29sZWFuPiA9IHRoaXMuZGlydHkuYXNPYnNlcnZhYmxlKCkucGlwZShkaXN0aW5jdFVudGlsQ2hhbmdlZCgpKTtcblxuICBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgcXVlcnk6IFF1ZXJpZXM8RW50aXR5LCBTdG9yZVN0YXRlPiwgcHJpdmF0ZSBwYXJhbXM/OiBEaXJ0eUNoZWNrUGFyYW1zLCBwcml2YXRlIF9lbnRpdHlJZD86IEVudGl0eVBhcmFtKSB7XG4gICAgc3VwZXIocXVlcnkpO1xuICAgIHRoaXMucGFyYW1zID0geyAuLi5kaXJ0eUNoZWNrRGVmYXVsdFBhcmFtcywgLi4ucGFyYW1zIH07XG4gICAgaWYgKHRoaXMucGFyYW1zLndhdGNoUHJvcGVydHkpIHtcbiAgICAgIGxldCB3YXRjaFByb3AgPSB0aGlzLnBhcmFtcy53YXRjaFByb3BlcnR5O1xuICAgICAgd2F0Y2hQcm9wID0gY29lcmNlQXJyYXkod2F0Y2hQcm9wKTtcbiAgICAgIGlmICh3YXRjaFByb3AuaW5jbHVkZXMoJ2VudGl0aWVzJykgJiYgIXdhdGNoUHJvcC5pbmNsdWRlcygnaWRzJykgJiYgcXVlcnkgaW5zdGFuY2VvZiBRdWVyeUVudGl0eSkge1xuICAgICAgICB3YXRjaFByb3AucHVzaCgnaWRzJyk7XG4gICAgICB9XG4gICAgICB0aGlzLnBhcmFtcy53YXRjaFByb3BlcnR5ID0gd2F0Y2hQcm9wO1xuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCBnZXRIZWFkKCkge1xuICAgIHJldHVybiB0aGlzLmhlYWQ7XG4gIH1cblxuICBwcml2YXRlIGFjdGl2YXRlKCkge1xuICAgIHRoaXMuaGVhZCA9IHRoaXMuX2dldEhlYWQoKTtcbiAgICAvKiogaWYgd2UgYXJlIHRyYWNraW5nIHNwZWNpZmljIHByb3BlcnRpZXMgc2VsZWN0IG9ubHkgdGhlIHJlbGV2YW50IG9uZXMgKi9cbiAgICBjb25zdCBzb3VyY2UgPSB0aGlzLnBhcmFtcy53YXRjaFByb3BlcnR5XG4gICAgICA/ICh0aGlzLnBhcmFtcy53YXRjaFByb3BlcnR5IGFzIChrZXlvZiBTdG9yZVN0YXRlKVtdKS5tYXAocHJvcCA9PiB0aGlzLnF1ZXJ5LnNlbGVjdChzdGF0ZSA9PiBzdGF0ZVtwcm9wXSkucGlwZShtYXAodmFsID0+ICh7IHZhbCwgX19ha2l0YUtleTogcHJvcCB9KSkpKVxuICAgICAgOiBbdGhpcy5zZWxlY3RTb3VyY2UodGhpcy5fZW50aXR5SWQpXTtcbiAgICB0aGlzLnN1YnNjcmlwdGlvbiA9IG1lcmdlKC4uLnNvdXJjZSlcbiAgICAgIC5waXBlKHNraXAoMSkpXG4gICAgICAuc3Vic2NyaWJlKChjdXJyZW50U3RhdGU6IGFueSkgPT4ge1xuICAgICAgICBpZiAoaXNVbmRlZmluZWQodGhpcy5oZWFkKSkgcmV0dXJuO1xuICAgICAgICAvKiogX19ha2l0YUtleSBpcyB1c2VkIHRvIGRldGVybWluZSBpZiB3ZSBhcmUgdHJhY2tpbmcgYSBzcGVjaWZpYyBwcm9wZXJ0eSBvciBhIHN0b3JlIGNoYW5nZSAqL1xuICAgICAgICBjb25zdCBoZWFkID0gY3VycmVudFN0YXRlLl9fYWtpdGFLZXkgPyB0aGlzLmhlYWRbY3VycmVudFN0YXRlLl9fYWtpdGFLZXkgYXMgYW55XSA6IHRoaXMuaGVhZDtcbiAgICAgICAgY29uc3QgY29tcGFyZVRvID0gY3VycmVudFN0YXRlLl9fYWtpdGFLZXkgPyBjdXJyZW50U3RhdGUudmFsIDogY3VycmVudFN0YXRlO1xuICAgICAgICBjb25zdCBpc0NoYW5nZSA9IHRoaXMucGFyYW1zLmNvbXBhcmF0b3IoaGVhZCwgY29tcGFyZVRvKTtcblxuICAgICAgICB0aGlzLnVwZGF0ZURpcnRpbmVzcyhpc0NoYW5nZSk7XG4gICAgICB9KTtcbiAgfVxuXG4gIHJlc2V0KHBhcmFtczogRGlydHlDaGVja1Jlc2V0UGFyYW1zID0ge30pIHtcbiAgICBsZXQgY3VycmVudFZhbHVlID0gdGhpcy5oZWFkO1xuICAgIGlmIChpc0Z1bmN0aW9uKHBhcmFtcy51cGRhdGVGbikpIHtcbiAgICAgIGlmICh0aGlzLmlzRW50aXR5QmFzZWQodGhpcy5fZW50aXR5SWQpKSB7XG4gICAgICAgIGN1cnJlbnRWYWx1ZSA9IHBhcmFtcy51cGRhdGVGbih0aGlzLmhlYWQsICh0aGlzLmdldFF1ZXJ5KCkgYXMgUXVlcnlFbnRpdHk8U3RvcmVTdGF0ZSwgRW50aXR5PikuZ2V0RW50aXR5KHRoaXMuX2VudGl0eUlkKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjdXJyZW50VmFsdWUgPSBwYXJhbXMudXBkYXRlRm4odGhpcy5oZWFkLCAodGhpcy5nZXRRdWVyeSgpIGFzIFF1ZXJ5PFN0b3JlU3RhdGU+KS5nZXRTbmFwc2hvdCgpKTtcbiAgICAgIH1cbiAgICB9XG4gICAgLyoqIElmIHdlIGFyZSB3YXRjaGluZyBzcGVjaWZpYyBwcm9wcyBjb21wYXJlIHRoZW0sIGlmIG5vdCBjb21wYXJlIHRoZSBlbnRpcmUgc3RvcmUgKi9cbiAgICBjb25zdCB1cGRhdGUgPSB0aGlzLnBhcmFtcy53YXRjaFByb3BlcnR5ID8gdGhpcy5jb21wYXJlUHJvcChjdXJyZW50VmFsdWUpIDogdGhpcy5fZ2V0SGVhZCgpICE9PSBjdXJyZW50VmFsdWU7XG4gICAgaWYgKHVwZGF0ZSkge1xuICAgICAgX19nbG9iYWxTdGF0ZS5zZXRDdXN0b21BY3Rpb24oeyB0eXBlOiBgQERpcnR5Q2hlY2sgLSBSZXZlcnRgIH0pO1xuICAgICAgdGhpcy51cGRhdGVTdG9yZShjdXJyZW50VmFsdWUsIHRoaXMuX2VudGl0eUlkKTtcbiAgICB9XG4gIH1cblxuICBzZXRIZWFkKCkge1xuICAgIGlmICghdGhpcy5hY3RpdmUpIHtcbiAgICAgIHRoaXMuYWN0aXZhdGUoKTtcbiAgICAgIHRoaXMuYWN0aXZlID0gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5oZWFkID0gdGhpcy5fZ2V0SGVhZCgpO1xuICAgIH1cbiAgICB0aGlzLnVwZGF0ZURpcnRpbmVzcyhmYWxzZSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBpc0RpcnR5KCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0b0Jvb2xlYW4odGhpcy5kaXJ0eS52YWx1ZSk7XG4gIH1cblxuICBoYXNIZWFkKCkge1xuICAgIHJldHVybiB0b0Jvb2xlYW4odGhpcy5nZXRIZWFkKCkpO1xuICB9XG5cbiAgZGVzdHJveSgpIHtcbiAgICB0aGlzLmhlYWQgPSBudWxsO1xuICAgIHRoaXMuc3Vic2NyaXB0aW9uICYmIHRoaXMuc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZURpcnRpbmVzcyhpc0RpcnR5OiBib29sZWFuKSB7XG4gICAgdGhpcy5kaXJ0eS5uZXh0KGlzRGlydHkpO1xuICB9XG5cbiAgcHJpdmF0ZSBfZ2V0SGVhZCgpOiBQYXJ0aWFsPFN0b3JlU3RhdGU+IHwgU3RvcmVTdGF0ZSB7XG4gICAgbGV0IGhlYWQ6IFN0b3JlU3RhdGUgfCBQYXJ0aWFsPFN0b3JlU3RhdGU+ID0gdGhpcy5nZXRTb3VyY2UodGhpcy5fZW50aXR5SWQpIGFzIFN0b3JlU3RhdGU7XG4gICAgaWYgKHRoaXMucGFyYW1zLndhdGNoUHJvcGVydHkpIHtcbiAgICAgIGhlYWQgPSAodGhpcy5wYXJhbXMud2F0Y2hQcm9wZXJ0eSBhcyAoa2V5b2YgU3RvcmVTdGF0ZSlbXSkucmVkdWNlKFxuICAgICAgICAoX2hlYWQsIHByb3ApID0+IHtcbiAgICAgICAgICBfaGVhZFtwcm9wXSA9IChoZWFkIGFzIFBhcnRpYWw8U3RvcmVTdGF0ZT4pW3Byb3BdO1xuICAgICAgICAgIHJldHVybiBfaGVhZDtcbiAgICAgICAgfSxcbiAgICAgICAge30gYXMgUGFydGlhbDxTdG9yZVN0YXRlPlxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIGhlYWQ7XG4gIH1cblxuICBwcml2YXRlIGNvbXBhcmVQcm9wKGN1cnJlbnRTdGF0ZTogUGFydGlhbDxTdG9yZVN0YXRlPik6IGJvb2xlYW4ge1xuICAgIGNvbnN0IHByb3BLZXlzID0gT2JqZWN0LmtleXMoY3VycmVudFN0YXRlKTtcbiAgICBjb25zdCBoZWFkID0gdGhpcy5fZ2V0SGVhZCgpO1xuXG4gICAgcmV0dXJuIHByb3BLZXlzLnNvbWUocHJvcEtleSA9PiBjdXJyZW50U3RhdGVbcHJvcEtleV0gIT09IGhlYWRbcHJvcEtleV0pO1xuICB9XG59XG4iLCJpbXBvcnQge0hhc2hNYXAsIElELCBJRFN9IGZyb20gJy4uLy4uL2FwaS90eXBlcyc7XG5pbXBvcnQge0RpcnR5Q2hlY2tDb21wYXJhdG9yLCBkaXJ0eUNoZWNrRGVmYXVsdFBhcmFtcywgRGlydHlDaGVja1BsdWdpbiwgRGlydHlDaGVja1Jlc2V0UGFyYW1zfSBmcm9tICcuL2RpcnR5LWNoZWNrLXBsdWdpbic7XG5pbXBvcnQge1F1ZXJ5RW50aXR5fSBmcm9tICcuLi8uLi9hcGkvcXVlcnktZW50aXR5JztcbmltcG9ydCB7RW50aXR5Q29sbGVjdGlvblBsdWdpbn0gZnJvbSAnLi4vZW50aXR5LWNvbGxlY3Rpb24tcGx1Z2luJztcbmltcG9ydCB7bWFwLCBza2lwfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQge09ic2VydmFibGV9IGZyb20gJ3J4anMnO1xuXG5leHBvcnQgdHlwZSBEaXJ0eUNoZWNrQ29sbGVjdGlvblBhcmFtczxFPiA9IHtcbiAgY29tcGFyYXRvcj86IERpcnR5Q2hlY2tDb21wYXJhdG9yPEU+O1xuICBlbnRpdHlJZHM/OiBJRCB8IElEW107XG59O1xuXG5leHBvcnQgY2xhc3MgRW50aXR5RGlydHlDaGVja1BsdWdpbjxFLCBQIGV4dGVuZHMgRGlydHlDaGVja1BsdWdpbjxFLCBhbnk+ID0gRGlydHlDaGVja1BsdWdpbjxFLCBhbnk+PiBleHRlbmRzIEVudGl0eUNvbGxlY3Rpb25QbHVnaW48RSwgUD4ge1xuXG4gIGlzU29tZURpcnR5JDogT2JzZXJ2YWJsZTxib29sZWFuPiA9IHRoaXMucXVlcnkuc2VsZWN0KHN0YXRlID0+IHN0YXRlLmVudGl0aWVzKVxuICAgIC5waXBlKG1hcCgoZW50aXRpZXM6IGFueSkgPT4gdGhpcy5jaGVja1NvbWVEaXJ0eShlbnRpdGllcykpKTtcblxuICBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgcXVlcnk6IFF1ZXJ5RW50aXR5PGFueSwgRT4sIHByaXZhdGUgcmVhZG9ubHkgcGFyYW1zOiBEaXJ0eUNoZWNrQ29sbGVjdGlvblBhcmFtczxFPiA9IHt9KSB7XG4gICAgc3VwZXIocXVlcnksIHBhcmFtcy5lbnRpdHlJZHMpO1xuICAgIHRoaXMucGFyYW1zID0gey4uLmRpcnR5Q2hlY2tEZWZhdWx0UGFyYW1zLCAuLi5wYXJhbXN9O1xuICAgIHRoaXMuYWN0aXZhdGUoKTtcbiAgICB0aGlzLnNlbGVjdElkcygpLnBpcGUoc2tpcCgxKSkuc3Vic2NyaWJlKGlkcyA9PiB7XG4gICAgICB0aGlzLnJlYmFzZShpZHMsIHthZnRlckFkZDogcGx1Z2luID0+IHBsdWdpbi5zZXRIZWFkKCl9KTtcbiAgICB9KTtcbiAgfVxuXG4gIHNldEhlYWQoaWRzPzogSURTKSB7XG4gICAgdGhpcy5mb3JFYWNoSWQoaWRzLCBlID0+IGUuc2V0SGVhZCgpKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGhhc0hlYWQoaWQ6IElEKTogYm9vbGVhbiB7XG4gICAgaWYgKHRoaXMuZW50aXRpZXMuaGFzKGlkKSkge1xuICAgICAgY29uc3QgZW50aXR5ID0gdGhpcy5nZXRFbnRpdHkoaWQpO1xuICAgICAgcmV0dXJuIGVudGl0eS5oYXNIZWFkKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgcmVzZXQoaWRzPzogSURTLCBwYXJhbXM6IERpcnR5Q2hlY2tSZXNldFBhcmFtcyA9IHt9KSB7XG4gICAgdGhpcy5mb3JFYWNoSWQoaWRzLCBlID0+IGUucmVzZXQocGFyYW1zKSk7XG4gIH1cblxuICBpc0RpcnR5KGlkOiBJRCk6IE9ic2VydmFibGU8Ym9vbGVhbj47XG4gIGlzRGlydHkoaWQ6IElELCBhc09ic2VydmFibGU6IHRydWUpOiBPYnNlcnZhYmxlPGJvb2xlYW4+O1xuICBpc0RpcnR5KGlkOiBJRCwgYXNPYnNlcnZhYmxlOiBmYWxzZSk6IGJvb2xlYW47XG4gIGlzRGlydHkoaWQ6IElELCBhc09ic2VydmFibGUgPSB0cnVlKTogT2JzZXJ2YWJsZTxib29sZWFuPiB8IGJvb2xlYW4ge1xuICAgIGlmICh0aGlzLmVudGl0aWVzLmhhcyhpZCkpIHtcbiAgICAgIGNvbnN0IGVudGl0eSA9IHRoaXMuZ2V0RW50aXR5KGlkKTtcbiAgICAgIHJldHVybiBhc09ic2VydmFibGUgPyBlbnRpdHkuaXNEaXJ0eSQgOiBlbnRpdHkuaXNEaXJ0eSgpO1xuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGlzU29tZURpcnR5KCk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IGVudGl0aWVzID0gdGhpcy5xdWVyeS5nZXRBbGwoe2FzT2JqZWN0OiB0cnVlfSk7XG4gICAgcmV0dXJuIHRoaXMuY2hlY2tTb21lRGlydHkoZW50aXRpZXMpO1xuICB9XG5cbiAgZGVzdHJveShpZHM/OiBJRFMpIHtcbiAgICB0aGlzLmZvckVhY2hJZChpZHMsIGUgPT4gZS5kZXN0cm95KCkpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGluc3RhbnRpYXRlUGx1Z2luKGlkOiBJRCk6IFAge1xuICAgIHJldHVybiBuZXcgRGlydHlDaGVja1BsdWdpbih0aGlzLnF1ZXJ5LCB0aGlzLnBhcmFtcywgaWQpIGFzIFA7XG4gIH1cblxuICBwcml2YXRlIGNoZWNrU29tZURpcnR5KGVudGl0aWVzOiBIYXNoTWFwPEU+KTogYm9vbGVhbiB7XG4gICAgY29uc3QgZW50aXRpZXNJZHMgPSB0aGlzLnJlc29sdmVkSWRzKCk7XG4gICAgZm9yIChjb25zdCBpZCBvZiBlbnRpdGllc0lkcykge1xuICAgICAgY29uc3QgZGlydHkgPSB0aGlzLnBhcmFtcy5jb21wYXJhdG9yKCh0aGlzLmdldEVudGl0eShpZCkgYXMgYW55KS5nZXRIZWFkKCksIGVudGl0aWVzW2lkXSk7XG4gICAgICBpZiAoZGlydHkpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufVxuIiwiaW1wb3J0IHsgaXNOdW1iZXIgfSBmcm9tICcuLi9pbnRlcm5hbC91dGlscyc7XG5cbi8qKlxuICogQGV4YW1wbGVcbiAqXG4gKiB0aGlzLnBlb3BsZVN0b3JlLnVwZGF0ZShpZCwgcGVyc29uID0+ICh7XG4gKiAgIGd1ZXN0czogaW5jcmVtZW50KHBlcnNvbi5ndWVzdHMpXG4gKiB9KSk7XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpbmNyZW1lbnQodmFsdWU6IG51bWJlciwgcGFyYW1zOiB7IG1heFZhbHVlOiBudW1iZXIgfCB1bmRlZmluZWQgfSA9IHsgbWF4VmFsdWU6IHVuZGVmaW5lZCB9KSB7XG4gIGlmIChpc051bWJlcih2YWx1ZSkgPT09IGZhbHNlKSByZXR1cm47XG4gIGlmIChwYXJhbXMubWF4VmFsdWUgJiYgdmFsdWUgPT09IHBhcmFtcy5tYXhWYWx1ZSkgcmV0dXJuIHZhbHVlO1xuICByZXR1cm4gdmFsdWUgKyAxO1xufVxuXG4vKipcbiAqIEBleGFtcGxlXG4gKlxuICogdGhpcy5wZW9wbGVTdG9yZS51cGRhdGUoaWQsIHBlcnNvbiA9PiAoe1xuICogICBndWVzdHM6IGRlY3JlbWVudChwZXJzb24uZ3Vlc3RzKVxuICogfSkpO1xuICovXG5leHBvcnQgZnVuY3Rpb24gZGVjcmVtZW50KHZhbHVlLCBwYXJhbXM6IHsgYWxsb3dOZWdhdGl2ZTogYm9vbGVhbiB9ID0geyBhbGxvd05lZ2F0aXZlOiBmYWxzZSB9KSB7XG4gIGlmIChpc051bWJlcih2YWx1ZSkgPT09IGZhbHNlKSByZXR1cm47XG4gIGlmIChwYXJhbXMuYWxsb3dOZWdhdGl2ZSA9PT0gZmFsc2UgJiYgdmFsdWUgPT09IDApIHtcbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cbiAgcmV0dXJuIHZhbHVlIC0gMTtcbn1cblxuLyoqXG4gKiBHZW5lcmF0ZSByYW5kb20gZ3VpZFxuICovXG5leHBvcnQgZnVuY3Rpb24gZ3VpZCgpIHtcbiAgcmV0dXJuICd4eHh4eHg0eHl4Jy5yZXBsYWNlKC9beHldL2csIGMgPT4ge1xuICAgIGNvbnN0IHIgPSAoTWF0aC5yYW5kb20oKSAqIDE2KSB8IDAsXG4gICAgICB2ID0gYyA9PSAneCcgPyByIDogKHIgJiAweDMpIHwgMHg4O1xuICAgIHJldHVybiB2LnRvU3RyaW5nKDE2KTtcbiAgfSk7XG59XG4iXSwibmFtZXMiOlsidHNsaWJfMS5fX2V4dGVuZHMiLCJza2lwIiwidHNsaWJfMS5fX2Fzc2lnbiIsIm1hcCIsInRzbGliXzEuX19zcHJlYWQiLCJ0c2xpYl8xLl9fdmFsdWVzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUlBLHFCQUErQixLQUFjO0lBQzNDLE9BQU8sS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsR0FBRyxLQUFLLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztDQUMvQzs7Ozs7O0FBR0Qsa0JBQXlCLEtBQVU7SUFDakMsT0FBTyxNQUFNLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssaUJBQWlCLENBQUM7Q0FDcEU7Ozs7O0FBRUQsdUJBQThCLEtBQUs7SUFDakMsT0FBTyxTQUFTLENBQUMsS0FBSyxDQUFDLElBQUksS0FBSyxDQUFDLFdBQVcsQ0FBQyxJQUFJLEtBQUssUUFBUSxDQUFDO0NBQ2hFOzs7OztBQUVELG9CQUEyQixLQUFLO0lBQzlCLE9BQU8sT0FBTyxLQUFLLEtBQUssVUFBVSxDQUFDO0NBQ3BDOzs7OztBQUVELG1CQUEwQixLQUFVO0lBQ2xDLE9BQU8sS0FBSyxJQUFJLElBQUksSUFBSSxLQUFHLEtBQU8sS0FBSyxPQUFPLENBQUM7Q0FDaEQ7Ozs7O0FBRUQscUJBQTRCLEtBQUs7SUFDL0IsT0FBTyxPQUFPLEtBQUssS0FBSyxXQUFXLENBQUM7Q0FDckM7Ozs7Ozs7O0FBS0Qsc0JBQWdDLEVBQU0sRUFBRSxRQUFvQjtJQUMxRCxPQUFPLFFBQVEsQ0FBQyxjQUFjLENBQUMsRUFBRSxDQUFDLENBQUM7Q0FDcEM7Ozs7OztBQUtEO0lBQ0UsT0FBTyxJQUFJLFVBQVUsQ0FBQyxVQUFBLFFBQVE7UUFDNUIsUUFBUSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ2hCLFFBQVEsQ0FBQyxRQUFRLEVBQUUsQ0FBQztLQUNyQixDQUFDLENBQUM7Q0FDSjs7Ozs7QUFFRCxzQkFBNkIsS0FBSztJQUNoQyxPQUFPLFNBQVMsQ0FBQyxLQUFLLENBQUMsSUFBSSxVQUFVLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDO0NBQ3hEOzs7OztBQUVELGtCQUF5QixHQUFpQjtJQUN4QyxPQUFPLE9BQU8sR0FBRyxLQUFLLFFBQVEsQ0FBQztDQUNoQzs7Ozs7QUFFRCxrQkFBeUIsS0FBSztJQUM1QixPQUFPLE9BQU8sS0FBSyxLQUFLLFFBQVEsQ0FBQztDQUNsQzs7Ozs7QUFFRCxtQkFBMEIsR0FBRztJQUMzQixPQUFPLEdBQUcsS0FBSyxJQUFJLElBQUksT0FBTyxHQUFHLEtBQUssV0FBVyxDQUFDO0NBQ25EOzs7Ozs7O0FBS0QscUJBQStCLEtBQXFCO0lBQ2xELE9BQU8sYUFBYSxDQUFDLEtBQUssQ0FBQyxJQUFJLFlBQVksQ0FBQyxtQkFBQyxLQUFvQixHQUFFLE1BQU0sRUFBRSxLQUFLLENBQUMsUUFBUSxDQUFDLEtBQUssS0FBSyxDQUFDO0NBQ3RHOzs7Ozs7O0FBS0QsdUJBQWlDLEtBQXFCO0lBQ3BELE9BQU8sbUJBQUMsS0FBb0IsR0FBRSxjQUFjLENBQUMsUUFBUSxDQUFDLENBQUM7Q0FDeEQ7Ozs7QUFLRCxJQUFhLFFBQVEsR0FBRyxVQUFDLEdBQVEsRUFBRSxJQUFZLEVBQUUsR0FBUTs7SUFDdkQsSUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUU5QixJQUFJLEtBQUssQ0FBQyxNQUFNLEtBQUssQ0FBQztRQUFFLE9BQU8sR0FBRyxDQUFDO0lBRW5DLEdBQUcsZ0JBQVEsR0FBRyxDQUFFLENBQUM7O0lBRWpCLElBQU0sU0FBUyxHQUFHLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDOztJQUNuQyxJQUFNLGVBQWUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUVqRCxlQUFlLENBQUMsTUFBTSxDQUFDLFVBQUMsR0FBRyxFQUFFLElBQUksRUFBRSxLQUFLO1FBQ3RDLElBQUksS0FBSyxLQUFLLFNBQVMsRUFBRTtZQUN2QixHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsR0FBRyxDQUFDO1NBQ2pCO2FBQU07WUFDTCxHQUFHLENBQUMsSUFBSSxDQUFDLGdCQUFRLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBRSxDQUFDO1NBQzlCO1FBRUQsT0FBTyxHQUFHLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO0tBQ3pCLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFFUixPQUFPLEdBQUcsQ0FBQztDQUNaLENBQUM7Ozs7QUFLRixJQUFhLFFBQVEsR0FBRyxVQUFDLEdBQVEsRUFBRSxJQUFZOztJQUU3QyxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtRQUNoQyxPQUFPLEdBQUcsQ0FBQztLQUNaOztJQUNELElBQU0sZUFBZSxHQUFHLElBQUk7U0FDekIsS0FBSyxDQUFDLEdBQUcsQ0FBQztTQUNWLEtBQUssQ0FBQyxDQUFDLENBQUM7U0FDUixJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDYixPQUFPLGVBQWUsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDLFVBQUMsR0FBUSxFQUFFLElBQVksSUFBSyxPQUFBLEdBQUcsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUEsRUFBRSxHQUFHLENBQUMsQ0FBQztDQUM3Rjs7Ozs7O0FDaEhELElBQUE7SUFBZ0NBLDhCQUFLO0lBQ25DLG9CQUFZLE9BQWU7ZUFDekIsa0JBQU0sT0FBTyxDQUFDO0tBQ2Y7cUJBTkg7RUFHZ0MsS0FBSyxFQUlwQyxDQUFBO0FBSkQsQUFNQSxJQUFBO0lBQTRDQSwwQ0FBVTtJQUNwRCxnQ0FBWSxTQUFTO2VBQ25CLGtCQUFNLGdHQUE4RixTQUFXLENBQUM7S0FDakg7aUNBWkg7RUFTNEMsVUFBVSxFQUlyRCxDQUFBO0FBSkQsQUFNQSxJQUFBO0lBQStDQSw2Q0FBVTtJQUN2RCxtQ0FBWSxFQUFFO2VBQ1osa0JBQU0sWUFBVSxFQUFFLHFCQUFrQixDQUFDO0tBQ3RDO29DQWxCSDtFQWUrQyxVQUFVLEVBSXhELENBQUE7QUFKRCxBQU1BLElBQUE7SUFBd0NBLHNDQUFVO0lBQ2hEO2VBQ0Usa0JBQU0sMEJBQTBCLENBQUM7S0FDbEM7NkJBeEJIO0VBcUJ3QyxVQUFVLEVBSWpELENBQUE7QUFKRCxBQU1BLElBQUE7SUFBNkNBLDJDQUFVO0lBQ3JEO2VBQ0Usa0JBQU0seUJBQXlCLENBQUM7S0FDakM7a0NBOUJIO0VBMkI2QyxVQUFVLEVBSXRELENBQUE7QUFKRCxBQU1BLElBQUE7SUFBMkNBLHlDQUFVO0lBQ25EO2VBQ0Usa0JBQU0saUVBQWlFLENBQUM7S0FDekU7Z0NBcENIO0VBaUMyQyxVQUFVLEVBSXBELENBQUE7QUFKRDs7Ozs7QUFNQSw0QkFBbUMsRUFBTSxFQUFFLFFBQVE7SUFDakQsSUFBSSxDQUFDLFlBQVksQ0FBQyxFQUFFLEVBQUUsUUFBUSxDQUFDLEVBQUU7UUFDL0IsTUFBTSxJQUFJLHlCQUF5QixDQUFDLEVBQUUsQ0FBQyxDQUFDO0tBQ3pDO0NBQ0Y7Ozs7O0FBRUQsc0JBQTZCLEtBQUs7SUFDaEMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEVBQUU7UUFDNUIsTUFBTSxJQUFJLGtCQUFrQixFQUFFLENBQUM7S0FDaEM7Q0FDRjs7Ozs7QUFFRCwyQkFBa0MsS0FBdUI7O0lBQ3ZELElBQU0sY0FBYyxHQUFHLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUV2QyxJQUFJLENBQUMsY0FBYyxFQUFFO1FBQ25CLE1BQU0sSUFBSSx1QkFBdUIsRUFBRSxDQUFDO0tBQ3JDO0NBQ0Y7Ozs7OztBQUVELHlCQUFnQyxJQUFZLEVBQUUsU0FBaUI7SUFDN0QsSUFBSSxDQUFDLElBQUksRUFBRTtRQUNULE9BQU8sQ0FBQyxLQUFLLENBQUMsMENBQXdDLFNBQVcsQ0FBQyxDQUFDO0tBQ3BFO0NBQ0Y7Ozs7OztBQzNERCxJQUFBOzs7Ozs7Ozs7OztJQUNFLG1CQUFJOzs7Ozs7OztJQUFKLFVBQVcsS0FBUSxFQUFFLFFBQXdDLEVBQUUsV0FBdUIsRUFBRSxLQUFLOztRQUMzRixJQUFJLEdBQUcsQ0FBYTs7UUFBcEIsSUFBUyxVQUFVLENBQUM7UUFFcEIsSUFBSSxtQkFBQyxRQUF1QixHQUFFLEdBQUcsSUFBSSxtQkFBQyxRQUF1QixHQUFFLFFBQVEsRUFBRTtZQUN2RSxHQUFHLEdBQUcsbUJBQUMsUUFBdUIsR0FBRSxHQUFHLENBQUM7WUFDcEMsVUFBVSxHQUFHLG1CQUFDLFFBQXVCLEdBQUUsUUFBUSxDQUFDO1NBQ2pEO2FBQU07O1lBQ0wsSUFBTSxPQUFPLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUN4QyxVQUFVLEdBQUcsUUFBUSxDQUFDO1lBRXRCLElBQUksT0FBTyxFQUFFO2dCQUNYLFVBQVUscUJBQUcsSUFBSSxDQUFDLEtBQUssbUJBQUMsUUFBZSxHQUFFLFdBQVcsRUFBRSxLQUFLLENBQVEsQ0FBQSxDQUFDO2FBQ3JFO2lCQUFNO2dCQUNMLGlCQUFpQixDQUFDLFFBQVEsQ0FBQyxDQUFDO2FBQzdCO1lBRUQsR0FBRyxHQUFHLE9BQU8sR0FBRyxtQkFBQyxRQUFlLEdBQUUsR0FBRyxDQUFDLFVBQUEsTUFBTSxJQUFJLE9BQUEsTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFBLENBQUMsR0FBRyxNQUFNLENBQUMsSUFBSSxtQkFBQyxVQUF3QixFQUFDLENBQUMsR0FBRyxDQUFDLFVBQUEsRUFBRSxJQUFJLE9BQUEsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFBLENBQUMsQ0FBQztTQUN2STs7UUFFRCxJQUFNLFFBQVEsbUNBQ1IsS0FBWSxNQUNoQixRQUFRLEVBQUUsVUFBVSxFQUNwQixHQUFHLEtBQUEsRUFDSCxPQUFPLEVBQUUsS0FBSyxJQUNkO1FBRUYsSUFBSSxXQUFXLENBQUMsUUFBUSxDQUFDLEVBQUU7WUFDekIsUUFBUSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUM7U0FDeEI7UUFFRCxPQUFPLFFBQVEsQ0FBQztLQUNqQjs7Ozs7Ozs7SUFFRCw2QkFBYzs7Ozs7OztJQUFkLFVBQXNDLEtBQVEsRUFBRSxFQUFNLEVBQUUsTUFBTTs7UUFDNUQsdUNBQ00sS0FBWSxNQUNoQixRQUFRLGVBQ0gsS0FBSyxDQUFDLFFBQVEsZUFDaEIsRUFBRSxJQUFHLE1BQU0sVUFFZDtLQUNIOzs7Ozs7OztJQUVELG1CQUFJOzs7Ozs7O0lBQUosVUFBK0IsS0FBUSxFQUFFLFFBQWEsRUFBRSxLQUFLOztRQUMzRCxJQUFJLGFBQWEsR0FBRyxFQUFFLENBQUM7O1FBQ3ZCLElBQUksUUFBUSxHQUFHLEVBQUUsQ0FBQztRQUVsQixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsUUFBUSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTs7WUFDeEMsSUFBTSxNQUFNLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDOztZQUMzQixJQUFNLFFBQVEsR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7WUFFL0IsSUFBSSxDQUFDLFlBQVksQ0FBQyxRQUFRLEVBQUUsS0FBSyxDQUFDLFFBQVEsQ0FBQyxFQUFFO2dCQUMzQyxhQUFhLENBQUMsUUFBUSxDQUFDLEdBQUcsTUFBTSxDQUFDO2dCQUNqQyxRQUFRLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO2FBQ3pCO1NBQ0Y7UUFFRCx1Q0FDTSxLQUFZLE1BQ2hCLFFBQVEsZUFDSCxLQUFLLENBQUMsUUFBUSxFQUNkLGFBQWEsR0FFbEIsR0FBRyxXQUFNLEtBQUssQ0FBQyxHQUFHLEVBQUssUUFBUSxLQUMvQjtLQUNIOzs7Ozs7Ozs7SUFFRCxzQkFBTzs7Ozs7Ozs7SUFBUCxVQUErQixLQUFRLEVBQUUsR0FBUyxFQUFFLFlBQXFELEVBQUUsS0FBYTs7UUFDdEgsSUFBTSxlQUFlLEdBQUcsRUFBRSxDQUFDOztRQUUzQixJQUFJLGVBQWUsR0FBRyxLQUFLLENBQUM7O1FBQzVCLElBQUksVUFBVSxDQUFLO1FBRW5CLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxHQUFHLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFOztZQUNuQyxJQUFNLEVBQUUsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDbEIsVUFBVSxHQUFHLEVBQUUsQ0FBQztZQUNoQixrQkFBa0IsQ0FBQyxFQUFFLEVBQUUsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDOztZQUV2QyxJQUFNLFNBQVMsR0FBRyxLQUFLLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDOztZQUNyQyxJQUFNLFFBQVEsR0FBRyxVQUFVLENBQUMsWUFBWSxDQUFDLEdBQUcsWUFBWSxDQUFDLFNBQVMsQ0FBQyxHQUFHLFlBQVksQ0FBQztZQUVuRixJQUFJLFFBQVEsQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDLElBQUksUUFBUSxDQUFDLEtBQUssQ0FBQyxLQUFLLFNBQVMsQ0FBQyxLQUFLLENBQUMsRUFBRTtnQkFDMUUsSUFBSSxHQUFHLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtvQkFDbEIsTUFBTSxJQUFJLHFCQUFxQixFQUFFLENBQUM7aUJBQ25DO2dCQUNELGVBQWUsR0FBRyxJQUFJLENBQUM7Z0JBQ3ZCLFVBQVUsR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUM7YUFDOUI7O1lBRUQsSUFBSSxTQUFTLFVBQUM7O1lBRWQsSUFBTSxNQUFNLGdCQUNQLFNBQVMsRUFDVCxRQUFRLEVBQ1g7WUFFRixJQUFJLGFBQWEsQ0FBQyxTQUFTLENBQUMsRUFBRTtnQkFDNUIsU0FBUyxHQUFHLE1BQU0sQ0FBQzthQUNwQjtpQkFBTTtnQkFDTCxTQUFTLEdBQUcsSUFBSSxTQUFTLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDO2FBQy9DO1lBRUQsZUFBZSxDQUFDLFVBQVUsQ0FBQyxHQUFHLFNBQVMsQ0FBQztTQUN6Qzs7UUFFRCxJQUFJLFVBQVUsR0FBRyxLQUFLLENBQUMsR0FBRyxDQUFDOztRQUMzQixJQUFJLGFBQWEsR0FBRyxLQUFLLENBQUMsUUFBUSxDQUFDO1FBQ25DLElBQUksZUFBZSxFQUFFO1lBQ25CLHlCQUFPLFlBQUUsQ0FBUTtZQUNqQix5QkFBUSxTQUFJLEVBQUosc0JBQW1CLEVBQUUsMERBQU8sQ0FBb0I7WUFDeEQsYUFBYSxHQUFHLElBQUksQ0FBQztZQUNyQixVQUFVLEdBQUcsS0FBSyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsVUFBQSxPQUFPLElBQUksUUFBQyxPQUFPLEtBQUssSUFBRSxHQUFHLFVBQVUsR0FBRyxPQUFPLElBQUMsQ0FBQyxDQUFDO1NBQ2hGO1FBRUQsdUNBQ00sS0FBWSxNQUNoQixRQUFRLGVBQ0gsYUFBYSxFQUNiLGVBQWUsR0FFcEIsR0FBRyxFQUFFLFVBQVUsSUFDZjtLQUNIOzs7Ozs7O0lBRUQsc0JBQU87Ozs7OztJQUFQLFVBQStCLEtBQVEsRUFBRSxHQUFnQjtRQUN2RCxJQUFJLENBQUMsR0FBRztZQUFFLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQzs7UUFFeEMsSUFBTSxPQUFPLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxVQUFDLEdBQUcsRUFBRSxFQUFFO1lBQ2pDLElBQVEsT0FBSSxFQUFKLGdCQUFZLEVBQUUsMkRBQU8sQ0FBUztZQUN0QyxPQUFPLElBQUksQ0FBQztTQUNiLEVBQUUsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDOztRQUNuQixJQUFNLFFBQVEsbUNBQ1IsS0FBWSxNQUNoQixRQUFRLEVBQUUsT0FBTyxFQUNqQixHQUFHLEVBQUUsS0FBSyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsVUFBQSxPQUFPLElBQUksT0FBQSxHQUFHLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxHQUFBLENBQUMsSUFDN0Q7UUFFRixJQUFJLFdBQVcsQ0FBQyxRQUFRLENBQUMsRUFBRTtZQUN6QixRQUFRLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQztTQUN4QjtRQUVELE9BQU8sUUFBUSxDQUFDO0tBQ2pCOzs7Ozs7SUFFTyx5QkFBVTs7Ozs7Y0FBd0IsS0FBUTs7UUFDaEQsSUFBTSxRQUFRLG1DQUNSLEtBQVksTUFDaEIsUUFBUSxFQUFFLEVBQUUsRUFDWixHQUFHLEVBQUUsRUFBRSxFQUNQLE1BQU0sRUFBRSxJQUFJLElBQ1o7UUFFRixPQUFPLFFBQVEsQ0FBQzs7Ozs7Ozs7SUFHVixvQkFBSzs7Ozs7O2NBQUMsUUFBZSxFQUFFLFdBQTBCLEVBQUUsRUFBUztRQUFULG1CQUFBLEVBQUEsU0FBUzs7UUFDbEUsSUFBTSxHQUFHLEdBQUcsRUFBRSxDQUFDO1FBRWYsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxHQUFHLFFBQVEsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBRTs7WUFDbkQsSUFBTSxNQUFNLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzNCLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxXQUFXLEdBQUcsSUFBSSxXQUFXLENBQUMsTUFBTSxDQUFDLEdBQUcsTUFBTSxDQUFDO1NBQ2xFO1FBRUQsT0FBTyxHQUFHLENBQUM7O2VBeEtmO0lBMEtDLENBQUE7QUF0S0Q7QUF3S0EsSUFBYSxLQUFLLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQzs7Ozs7O0FDbktoQyxJQUFBOzswQkFHZSxLQUFLO2tDQUNHLEtBQUs7d0JBQ2YsRUFBRTtrQ0FDUSxDQUFDOzs7Ozs7SUFHdEIsZ0NBQVM7Ozs7SUFBVCxVQUFVLE9BQWU7UUFDdkIsSUFBSSxJQUFJLENBQUMsWUFBWSxFQUFFO1lBQ3JCLElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQztZQUN2QyxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQztZQUN6QixJQUFJLENBQUMsa0JBQWtCLEdBQUcsS0FBSyxDQUFDO1NBQ2pDO2FBQU07WUFDTCxJQUFJLElBQUksQ0FBQyxrQkFBa0IsS0FBSyxDQUFDLEVBQUU7Z0JBQ2pDLElBQUksQ0FBQyxhQUFhLEdBQUcsT0FBTyxDQUFDO2FBQzlCO1NBQ0Y7UUFFRCxJQUFJLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxDQUFDLEVBQUU7WUFDL0IsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7U0FDN0I7S0FDRjs7Ozs7O0lBRUQsc0NBQWU7Ozs7O0lBQWYsVUFBZ0IsTUFBYyxFQUFFLGtCQUEwQjtRQUExQixtQ0FBQSxFQUFBLDBCQUEwQjtRQUN4RCxJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxZQUFZLEdBQUcsTUFBTSxDQUFDO1FBQ2hELElBQUksQ0FBQyxrQkFBa0IsR0FBRyxrQkFBa0IsQ0FBQztLQUM5Qzs7Ozs7SUFFRCxvQ0FBYTs7OztJQUFiLFVBQWNDLE9BQVc7UUFBWCx3QkFBQSxFQUFBQSxjQUFXO1FBQ3ZCLElBQUksQ0FBQyxVQUFVLEdBQUdBLE9BQUksQ0FBQztLQUN4Qjt1QkF6Q0g7SUEwQ0MsQ0FBQTtBQWpDRDtBQW1DQSxJQUFhLGFBQWEsR0FBRyxJQUFJLFlBQVksRUFBRTs7Ozs7O0FDNUMvQzs7OztBQU1BO0lBQ0UsSUFBSSxDQUFDLHNCQUFzQixFQUFFLEVBQUU7UUFDN0IsYUFBYSxDQUFDLGdCQUFnQixHQUFHLElBQUksT0FBTyxFQUFFLENBQUM7S0FDaEQ7SUFDRCxhQUFhLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztDQUNwQzs7Ozs7QUFLRDtJQUNFLElBQUksRUFBRSxhQUFhLENBQUMsa0JBQWtCLEtBQUssQ0FBQyxFQUFFO1FBQzVDLGFBQWEsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDMUMsYUFBYSxDQUFDLGdCQUFnQixDQUFDLFFBQVEsRUFBRSxDQUFDO0tBQzNDO0NBQ0Y7Ozs7O0FBS0Q7SUFDRSxPQUFPLGFBQWEsQ0FBQyxrQkFBa0IsR0FBRyxDQUFDLENBQUM7Q0FDN0M7Ozs7O0FBSUQ7SUFDRSxPQUFPLGFBQWEsQ0FBQyxnQkFBZ0IsR0FBRyxhQUFhLENBQUMsZ0JBQWdCLENBQUMsWUFBWSxFQUFFLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDO0NBQ2xHOzs7Ozs7Ozs7O0FDbENELG9CQUEyQixDQUFDO0lBQzFCLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFFakIsTUFBTSxDQUFDLG1CQUFtQixDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxVQUFTLElBQUk7UUFDakQsSUFBSSxDQUFDLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxJQUFJLEtBQUssT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssUUFBUSxJQUFJLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLFVBQVUsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRTtZQUM3SSxVQUFVLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7U0FDckI7S0FDRixDQUFDLENBQUM7SUFFSCxPQUFPLENBQUMsQ0FBQztDQUNWOzs7Ozs7O0FDTEQsSUFBYSxTQUFTLEdBQUcsYUFBYSxDQUFDOzs7OztBQUV2QyxxQkFBNEIsUUFBNEI7SUFDdEQsT0FBTyxVQUFTLFdBQXFCO1FBQ25DLFdBQVcsQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsQ0FBQztRQUV6QyxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxJQUFJLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTs7WUFDbEUsSUFBTSxHQUFHLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDOztZQUVwQixJQUFJLEdBQUcsS0FBSyxNQUFNLEVBQUU7Z0JBQ2xCLFdBQVcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxXQUFXLENBQUMsR0FBRyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUM7YUFDckQ7aUJBQU07Z0JBQ0wsV0FBVyxDQUFDLFNBQVMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQzthQUM3QztTQUNGO0tBQ0YsQ0FBQztDQUNIOzs7Ozs7Ozs7QUNWRCxJQUFJLE9BQU8sR0FBRyxJQUFJLENBQUM7O0FBRW5CLElBQWEsVUFBVSxHQUF3QyxFQUFFLENBQUM7O0FBWWxFLElBQWEsY0FBYyxHQUFHLElBQUksYUFBYSxFQUFVLENBQUM7Ozs7OztBQUUxRCxtQkFBbUIsU0FBUyxFQUFFLFlBQW9CO0lBQXBCLDZCQUFBLEVBQUEsb0JBQW9CO0lBQ2hELE9BQU87UUFDTCxJQUFJO1FBQ0osT0FBTyxFQUFFO1lBQ1AsSUFBSSxFQUFFLFNBQVM7WUFDZixZQUFZLGNBQUE7U0FDYjtLQUNGLENBQUM7Q0FDSDs7Ozs7QUFLRDtJQUNFLE9BQU8sR0FBRyxLQUFLLENBQUM7Q0FDakI7Ozs7QUFFRDtJQUNFLE9BQU8sT0FBTyxDQUFDO0NBQ2hCOzs7Ozs7QUFNRDs7Ozs7QUFBQTs7Ozs7SUFnQkUsZUFBWSxZQUFZOzs7OzZCQVJBLEtBQUs7MkJBRVAsSUFBSTtRQU94QixhQUFhLENBQUMsU0FBUyxDQUFDLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxDQUFDLENBQUM7UUFDNUMsVUFBVSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxJQUFJLENBQUM7UUFDbEMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxjQUFNLE9BQUEsWUFBWSxHQUFBLENBQUMsQ0FBQztRQUNsQyxjQUFjLENBQUMsSUFBSSxDQUFDO1lBQ2xCLElBQUk7WUFDSixPQUFPLEVBQUUsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFO1NBQ3pCLENBQUMsQ0FBQztRQUNILEtBQUssRUFBRSxJQUFJLGVBQWUsQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUM7S0FDbkU7Ozs7O0lBRUQsMEJBQVU7Ozs7SUFBVixVQUFXLE9BQWU7UUFBZix3QkFBQSxFQUFBLGVBQWU7UUFDeEIsSUFBSSxPQUFPLEtBQUssbUJBQUMsSUFBSSxDQUFDLE1BQU0sRUFBOEIsR0FBRSxPQUFPLEVBQUU7WUFDbkUsS0FBSyxFQUFFLElBQUksYUFBYSxDQUFDLFNBQVMsQ0FBQyxFQUFFLElBQUksRUFBRSxhQUFhLEVBQUUsQ0FBQyxDQUFDO1lBQzVELElBQUksQ0FBQyxRQUFRLENBQUMsVUFBQSxDQUFDLElBQUksMEJBQUNDLGdDQUFNLENBQVcsTUFBRyxPQUFPLFNBQUEsR0FBUyxLQUFDLENBQUMsQ0FBQztTQUM1RDtLQUNGOzs7Ozs7Ozs7O0lBS0Qsd0JBQVE7Ozs7OztJQUFSLFVBQVksS0FBUTtRQUNsQixJQUFJLEtBQUssS0FBSyxtQkFBQyxJQUFJLENBQUMsTUFBTSxFQUF3QixHQUFFLEtBQUssRUFBRTtZQUN6RCxLQUFLLEVBQUUsSUFBSSxhQUFhLENBQUMsU0FBUyxDQUFDLEVBQUUsSUFBSSxFQUFFLFdBQVcsRUFBRSxDQUFDLENBQUM7WUFDMUQsSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFBLENBQUMsSUFBSSwwQkFBQ0EsZ0NBQU0sQ0FBVyxNQUFHLEtBQUssT0FBQSxHQUFTLEtBQUMsQ0FBQyxDQUFDO1NBQzFEO0tBQ0Y7Ozs7Ozs7Ozs7Ozs7Ozs7OztJQVNELHVCQUFPOzs7Ozs7Ozs7O0lBQVAsVUFBVyxPQUF3QjtRQUNqQyxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUNyQixHQUFHLENBQUMsT0FBTyxDQUFDLEVBQ1osb0JBQW9CLEVBQUUsQ0FDdkIsQ0FBQztLQUNIOzs7O0lBRUQsc0JBQU07OztJQUFOO1FBQ0UsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDO0tBQ3hCO0lBRUQsc0JBQUkseUJBQU07Ozs7UUFBVjtZQUNFLE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsQ0FBQztTQUNwQzs7O09BQUE7SUFLRCxzQkFBSSw0QkFBUzs7Ozs7Ozs7UUFBYjtZQUNFLE9BQU8sSUFBSSxDQUFDLE1BQU0sSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1NBQ2hEOzs7T0FBQTtJQUVELHNCQUFJLDZCQUFVOzs7O1FBQWQ7WUFDRSxPQUFPLElBQUksQ0FBQyxXQUFXLENBQUM7U0FDekI7OztPQUFBOzs7Ozs7Ozs7Ozs7OztJQU9ELHdCQUFROzs7Ozs7OztJQUFSLFVBQVMsVUFBcUMsRUFBRSxlQUFzQjtRQUF0QixnQ0FBQSxFQUFBLHNCQUFzQjs7UUFDcEUsSUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQ2hDLElBQUksQ0FBQyxVQUFVLEdBQUcsT0FBTyxHQUFHLFVBQVUsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUMsR0FBRyxVQUFVLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUM7UUFFOUYsSUFBSSxTQUFTLEtBQUssSUFBSSxDQUFDLFVBQVUsRUFBRTtZQUNqQyxNQUFNLElBQUksc0JBQXNCLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1NBQ2xEO1FBRUQsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUU7WUFDZixJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksZUFBZSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUNsRCxjQUFjLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDckQsT0FBTztTQUNSO1FBRUQsSUFBSSxzQkFBc0IsRUFBRSxFQUFFO1lBQzVCLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1lBQ3pCLE9BQU87U0FDUjtRQUVELElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxlQUFlLENBQUMsQ0FBQztLQUNqRDs7Ozs7O0lBWUQsc0JBQU07Ozs7O0lBQU4sVUFBTyxZQUFrRixFQUFFLFFBQXFCO1FBQzlHLGFBQWEsQ0FBQyxTQUFTLENBQUMsRUFBRSxJQUFJLEVBQUUsY0FBYyxFQUFFLENBQUMsQ0FBQztRQUNsRCxJQUFJLENBQUMsUUFBUSxDQUFDLFVBQUEsS0FBSzs7WUFDakIsSUFBSSxLQUFLLEdBQUcsVUFBVSxDQUFDLFlBQVksQ0FBQyxHQUFHLFlBQVksQ0FBQyxLQUFLLENBQUMsR0FBRyxZQUFZLENBQUM7O1lBQzFFLElBQUksTUFBTSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLEtBQUssRUFBRSxLQUFLLENBQUMsQ0FBQztZQUM3QyxPQUFPLGFBQWEsQ0FBQyxLQUFLLENBQUMsR0FBRyxNQUFNLEdBQUcsSUFBSSxtQkFBQyxLQUFZLEdBQUUsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1NBQy9FLENBQUMsQ0FBQztRQUNILElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztLQUNqQjs7Ozs7Ozs7SUFLRCwyQkFBVzs7OztJQUFYO1FBQ0UsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUM7S0FDekI7Ozs7Ozs7O0lBS0Qsd0JBQVE7Ozs7SUFBUjtRQUNFLElBQUksQ0FBQyxXQUFXLEdBQUcsS0FBSyxDQUFDO0tBQzFCOzs7Ozs7SUFFTyx3QkFBUTs7Ozs7Y0FBQyxLQUFRLEVBQUUsZUFBc0I7UUFBdEIsZ0NBQUEsRUFBQSxzQkFBc0I7UUFDL0MsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDdkIsSUFBSSxlQUFlLEVBQUU7WUFDbkIsY0FBYyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUM7WUFDL0MsS0FBSyxFQUFFLElBQUksYUFBYSxDQUFDLFNBQVMsQ0FBQyxFQUFFLElBQUksRUFBRSxXQUFXLEVBQUUsQ0FBQyxDQUFDO1NBQzNEOzswQkFHUyx5QkFBTTs7Ozs7WUFDaEIsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLFlBQVksRUFBRSxDQUFDOzs7Ozs7Ozs7SUFNM0IsZ0NBQWdCOzs7Ozs7UUFDdEIsTUFBTSxFQUFFLENBQUMsU0FBUyxDQUFDO1lBQ2pCLEtBQUksQ0FBQyxhQUFhLEdBQUcsS0FBSyxDQUFDO1lBQzNCLElBQUksS0FBSyxFQUFFLElBQUksQ0FBQyxhQUFhLENBQUMsa0JBQWtCLEVBQUU7Z0JBQ2hELGFBQWEsQ0FBQyxTQUFTLENBQUMsRUFBRSxJQUFJLEVBQUUsY0FBYyxFQUFFLENBQUMsQ0FBQzthQUNuRDtZQUNELEtBQUksQ0FBQyxRQUFRLENBQUMsS0FBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUM7WUFDN0IsYUFBYSxDQUFDLFFBQVEsR0FBRyxFQUFFLENBQUM7WUFDNUIsYUFBYSxDQUFDLGtCQUFrQixHQUFHLEtBQUssQ0FBQztTQUMxQyxDQUFDLENBQUM7Ozs7OztJQU1HLGlDQUFpQjs7Ozs7UUFDdkIsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLEVBQUU7WUFDdkIsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUM7WUFDeEIsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLENBQUM7U0FDM0I7Ozs7O0lBR0ssMkJBQVc7Ozs7UUFDakIsSUFBSSxJQUFJLEtBQUssVUFBVSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsRUFBRTtZQUN2QyxPQUFPLFVBQVUsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7U0FDbkM7O2dCQXRPTDtJQXdPQzs7Ozs7Ozs7Ozs7O0FDN05EOzs7Ozs7O0FBQUE7SUFBOERGLCtCQUFROzs7OztJQUtwRSxxQkFBWSxZQUFpQixFQUFVLE9BQWdDO1FBQTNELDZCQUFBLEVBQUEsaUJBQWlCOzhDQUEwQztRQUF2RSxZQUNFLCtCQUFXLHVCQUF1QixFQUFFLEVBQUssWUFBWSxFQUFHLFNBQ3pEO1FBRnNDLGFBQU8sR0FBUCxPQUFPLENBQXlCOztLQUV0RTtJQUVELHNCQUFJLGlDQUFROzs7O1FBQVo7WUFDRSxPQUFPLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxRQUFRLENBQUM7U0FDL0I7OztPQUFBO0lBRUQsc0JBQUksOEJBQUs7Ozs7UUFBVDs7OztZQUVFLElBQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxNQUFNLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUM7WUFDbEQsSUFBSSxDQUFDLFFBQVEsRUFBRTtnQkFDYixPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQzthQUNuQztZQUNELE9BQU8sUUFBUSxDQUFDO1NBQ2pCOzs7T0FBQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0lBWUQseUJBQUc7Ozs7Ozs7Ozs7Ozs7SUFBSCxVQUFJLFFBQXdDLEVBQUUsT0FBMEM7UUFBeEYsaUJBSUM7UUFKNkMsd0JBQUEsRUFBQSxZQUEwQztRQUN0RixLQUFLLEVBQUUsSUFBSSxhQUFhLENBQUMsU0FBUyxDQUFDLEVBQUUsSUFBSSxFQUFFLGNBQWMsRUFBRSxDQUFDLENBQUM7UUFDN0QsSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFBLEtBQUssSUFBSSxPQUFBLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLFFBQVEsRUFBRSxPQUFPLENBQUMsV0FBVyxFQUFFLEtBQUksQ0FBQyxLQUFLLENBQUMsR0FBQSxDQUFDLENBQUM7UUFDckYsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO0tBQ2pCOzs7Ozs7Ozs7Ozs7Ozs7Ozs7SUFTRCxxQ0FBZTs7Ozs7Ozs7OztJQUFmLFVBQWdCLEVBQU0sRUFBRSxNQUFTO1FBQy9CLElBQUksQ0FBQyxZQUFZLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxRQUFRLENBQUMsRUFBRTtZQUM3QyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRTtnQkFDdkIsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxFQUFFLENBQUM7YUFDekI7WUFDRCxPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7U0FDekI7UUFDRCxLQUFLLEVBQUUsSUFBSSxhQUFhLENBQUMsU0FBUyxDQUFDLEVBQUUsSUFBSSxFQUFFLGVBQWUsRUFBRSxRQUFRLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDOUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFBLEtBQUssSUFBSSxPQUFBLEtBQUssQ0FBQyxjQUFjLENBQUMsS0FBSyxFQUFFLEVBQUUsRUFBRSxNQUFNLENBQUMsR0FBQSxDQUFDLENBQUM7S0FDakU7Ozs7Ozs7Ozs7Ozs7Ozs7O0lBU0QseUJBQUc7Ozs7Ozs7OztJQUFILFVBQUksUUFBaUI7UUFBckIsaUJBS0M7O1FBSkMsSUFBTSxPQUFPLEdBQUcsV0FBVyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ3RDLElBQUksT0FBTyxDQUFDLE1BQU0sS0FBSyxDQUFDO1lBQUUsT0FBTztRQUNqQyxLQUFLLEVBQUUsSUFBSSxhQUFhLENBQUMsU0FBUyxDQUFDLEVBQUUsSUFBSSxFQUFFLFlBQVksRUFBRSxDQUFDLENBQUM7UUFDM0QsSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFBLEtBQUssSUFBSSxPQUFBLEtBQUssQ0FBQyxJQUFJLENBQU8sS0FBSyxFQUFFLE9BQU8sRUFBRSxLQUFJLENBQUMsS0FBSyxDQUFDLEdBQUEsQ0FBQyxDQUFDO0tBQ3RFOzs7Ozs7SUF5Q0QsNEJBQU07Ozs7O0lBQU4sVUFDRSxPQUFrSCxFQUNsSCxZQUE4RTtRQUZoRixpQkF5QkM7O1FBckJDLElBQUksR0FBRyxHQUFTLEVBQUUsQ0FBQzs7UUFDbkIsSUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLEdBQUcsQ0FBQztRQUVuQyxJQUFJLFVBQVUsQ0FBQyxPQUFPLENBQUMsRUFBRTtZQUN2QixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxHQUFHLEdBQUcsUUFBUSxDQUFDLE1BQU0sRUFBRSxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUMsRUFBRSxFQUFFOztnQkFDbkQsSUFBTSxFQUFFLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDOztnQkFDdkIsSUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQztnQkFDMUMsSUFBSSxNQUFNLElBQUksbUJBQUMsT0FBbUIsR0FBRSxNQUFNLENBQUMsRUFBRTtvQkFDM0MsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztpQkFDZDthQUNGO1NBQ0Y7YUFBTTtZQUNMLEdBQUcsR0FBRyxTQUFTLENBQUMsT0FBTyxDQUFDLEdBQUcsV0FBVyxDQUFDLE9BQU8sQ0FBQyxHQUFHLFFBQVEsQ0FBQztTQUM1RDtRQUVELElBQUksR0FBRyxDQUFDLE1BQU0sS0FBSyxDQUFDO1lBQUUsT0FBTztRQUM3QixLQUFLLEVBQUUsSUFBSSxhQUFhLENBQUMsU0FBUyxDQUFDLEVBQUUsSUFBSSxFQUFFLGVBQWUsRUFBRSxRQUFRLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztRQUU3RSxJQUFJLENBQUMsUUFBUSxDQUFDLFVBQUEsS0FBSztZQUNqQixPQUFPLEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLEdBQUcsRUFBRSxZQUFZLEVBQUUsS0FBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQzVELENBQUMsQ0FBQztLQUNKOzs7Ozs7Ozs7SUFLRCwrQkFBUzs7Ozs7SUFBVCxVQUFVLEtBQWlCO1FBQ3pCLElBQUksSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEtBQUssQ0FBQztZQUFFLE9BQU87UUFDM0MsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUM7S0FDMUI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0lBbUJELGdDQUFVOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztJQUFWLFVBQVcsVUFBNkQsRUFBRSxNQUFlOztRQUN2RixJQUFNLFFBQVEsR0FBRyxVQUFVLENBQUMsVUFBVSxDQUFDLEdBQUcsVUFBVSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxHQUFHLFVBQVUsQ0FBQztRQUVqRixJQUFJLFFBQVEsS0FBSyxJQUFJLENBQUMsTUFBTSxFQUFFLEVBQUU7WUFDOUIsTUFBTSxJQUFJLHNCQUFzQixDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztTQUNsRDtRQUVELEtBQUssRUFBRSxJQUFJLGFBQWEsQ0FBQyxTQUFTLENBQUMsTUFBTSxJQUFJLEVBQUUsSUFBSSxFQUFFLGFBQWEsRUFBRSxDQUFDLENBQUM7UUFFdEUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFBLEtBQUs7WUFDakIsdUNBQ00sS0FBWSx1QkFDWixRQUFlLElBQ25CO1NBQ0gsQ0FBQyxDQUFDO0tBQ0o7Ozs7O0lBY0QsNEJBQU07Ozs7SUFBTixVQUFPLE9BQXdEOztRQUM3RCxJQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDO1FBRW5DLElBQUksUUFBUSxDQUFDLE1BQU0sS0FBSyxDQUFDO1lBQUUsT0FBTzs7UUFDbEMsSUFBTSxRQUFRLEdBQUcsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ3BDLElBQUksQ0FBQyxRQUFRO1lBQUUsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDOztRQUVsQyxJQUFJLEdBQUcsR0FBUyxFQUFFLENBQUM7UUFDbkIsSUFBSSxVQUFVLENBQUMsT0FBTyxDQUFDLEVBQUU7WUFDdkIsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxHQUFHLFFBQVEsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBRTs7Z0JBQ25ELElBQU0sRUFBRSxHQUFHLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQzs7Z0JBQ3ZCLElBQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUM7Z0JBQzFDLElBQUksTUFBTSxJQUFJLE9BQU8sQ0FBQyxNQUFNLENBQUMsRUFBRTtvQkFDN0IsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztpQkFDZDthQUNGO1NBQ0Y7YUFBTTtZQUNMLEdBQUcsR0FBRyxRQUFRLEdBQUcsV0FBVyxDQUFDLE9BQU8sQ0FBQyxHQUFHLElBQUksQ0FBQztTQUM5QztRQUVELElBQUksR0FBRyxJQUFJLEdBQUcsQ0FBQyxNQUFNLEtBQUssQ0FBQztZQUFFLE9BQU87UUFDcEMsS0FBSyxFQUFFLElBQUksYUFBYSxDQUFDLFNBQVMsQ0FBQyxFQUFFLElBQUksRUFBRSxlQUFlLEVBQUUsUUFBUSxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFFN0UsSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFBLEtBQUs7WUFDakIsT0FBTyxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQztTQUNsQyxDQUFDLENBQUM7S0FDSjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztJQWdCRCxrQ0FBWTs7Ozs7Ozs7Ozs7Ozs7OztJQUFaLFVBQWEsVUFBOEQ7UUFBM0UsaUJBV0M7UUFWQyxZQUFZLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUM7UUFDNUIsS0FBSyxFQUFFLElBQUksYUFBYSxDQUFDLFNBQVMsQ0FBQyxFQUFFLElBQUksRUFBRSxzQkFBc0IsRUFBRSxRQUFRLEVBQUUsSUFBSSxDQUFDLE1BQU0sRUFBRSxVQUFPLEVBQUUsQ0FBQyxDQUFDO1FBQ3JHLElBQUksQ0FBQyxRQUFRLENBQUMsVUFBQSxLQUFLOztZQUNqQixJQUFNLFFBQVEsR0FBRyxLQUFLLFdBQVE7O1lBQzlCLElBQU0sUUFBUSxHQUFHLFVBQVUsQ0FBQyxVQUFVLENBQUMsR0FBRyxVQUFVLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQyxHQUFHLFVBQVUsQ0FBQztZQUM1RixJQUFJLFFBQVEsS0FBSyxLQUFLLEVBQUU7Z0JBQ3RCLE1BQU0sSUFBSSxzQkFBc0IsQ0FBQyxLQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7YUFDbEQ7WUFDRCxPQUFPLEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUMsUUFBUSxDQUFDLEVBQUUsUUFBUSxFQUFFLEtBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztTQUMvRCxDQUFDLENBQUM7S0FDSjs7Ozs7Ozs7O0lBS0QsK0JBQVM7Ozs7O0lBQVQsVUFBVSxFQUFNO1FBQ2QsSUFBSSxFQUFFLEtBQUssSUFBSSxDQUFDLE1BQU0sRUFBRSxVQUFPO1lBQUUsT0FBTztRQUN4QyxLQUFLLEVBQUUsSUFBSSxhQUFhLENBQUMsU0FBUyxDQUFDLEVBQUUsSUFBSSxFQUFFLG1CQUFtQixFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ2hGLElBQUksQ0FBQyxRQUFRLENBQUMsVUFBQSxLQUFLO1lBQ2pCLHVDQUNNLEtBQVksTUFDaEIsTUFBTSxFQUFFLEVBQUUsSUFDVjtTQUNILENBQUMsQ0FBQztLQUNKO3NCQTVRSDtFQVc4RCxLQUFLLEVBa1FsRSxDQUFBOztBQUVELElBQWEsdUJBQXVCLEdBQUc7SUFDckMsMEJBQUM7UUFDQyxRQUFRLEVBQUUsRUFBRTtRQUNaLEdBQUcsRUFBRSxFQUFFO1FBQ1AsT0FBTyxFQUFFLElBQUk7UUFDYixLQUFLLEVBQUUsSUFBSTtLQUNHO0NBQUMsQ0FBQzs7QUFFcEIsSUFBYSxxQkFBcUIsR0FBRztJQUNuQywwQkFBQztRQUNDLE1BQU0sRUFBRSxJQUFJO0tBQ0U7Q0FBQzs7Ozs7Ozs7SUN6UmpCLEtBQU0sS0FBSztJQUNYLE1BQU8sTUFBTTs7Ozs7OztBQUdmLHVCQUE4QixHQUFHLEVBQUUsS0FBd0I7SUFBeEIsc0JBQUEsRUFBQSxRQUFlLEtBQUssQ0FBQyxHQUFHO0lBQ3pELE9BQU8sVUFBUyxDQUFDLEVBQUUsQ0FBQztRQUNsQixJQUFJLENBQUMsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDcEQsT0FBTyxDQUFDLENBQUM7U0FDVjs7UUFFRCxJQUFNLElBQUksR0FBRyxPQUFPLENBQUMsQ0FBQyxHQUFHLENBQUMsS0FBSyxRQUFRLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLFdBQVcsRUFBRSxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQzs7UUFDeEUsSUFBTSxJQUFJLEdBQUcsT0FBTyxDQUFDLENBQUMsR0FBRyxDQUFDLEtBQUssUUFBUSxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxXQUFXLEVBQUUsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7O1FBRXhFLElBQUksVUFBVSxHQUFHLENBQUMsQ0FBQztRQUNuQixJQUFJLElBQUksR0FBRyxJQUFJLEVBQUU7WUFDZixVQUFVLEdBQUcsQ0FBQyxDQUFDO1NBQ2hCO2FBQU0sSUFBSSxJQUFJLEdBQUcsSUFBSSxFQUFFO1lBQ3RCLFVBQVUsR0FBRyxDQUFDLENBQUMsQ0FBQztTQUNqQjtRQUNELE9BQU8sS0FBSyxJQUFJLEtBQUssQ0FBQyxJQUFJLEdBQUcsVUFBVSxHQUFHLENBQUMsQ0FBQyxHQUFHLFVBQVUsQ0FBQztLQUMzRCxDQUFDO0NBQ0g7Ozs7Ozs7Ozs7QUN0QkQsb0JBQTJCLEVBQVk7O0lBQ3JDLElBQUksUUFBUSxDQUFDOztJQUNiLElBQUksT0FBTyxHQUFHLEtBQUssQ0FBQzs7SUFDcEIsSUFBSSxTQUFTLEdBQUcsSUFBSSxDQUFDOztJQUNyQixJQUFJLFVBQVUsQ0FBQztJQUVmLE9BQU87UUFBUyxjQUFPO2FBQVAsVUFBTyxFQUFQLHFCQUFPLEVBQVAsSUFBTztZQUFQLHlCQUFPOztRQUNyQixJQUFJLFFBQVEsRUFBRTs7WUFFWixPQUFPLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxLQUFLLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxRQUFRLENBQUMsQ0FBQyxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQzlEO1FBRUQsSUFBSSxTQUFTLEtBQUssT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLEVBQUU7WUFDeEMsVUFBVSxHQUFHLEVBQUUsQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO1NBQ25DO1FBRUQsU0FBUyxHQUFHLEtBQUssQ0FBQztRQUNsQixRQUFRLEdBQUcsSUFBSSxDQUFDO1FBQ2hCLE9BQU8sVUFBVSxDQUFDO0tBQ25CLENBQUM7Q0FDSDs7Ozs7OztBQ1RELElBQWEsY0FBYyxHQUFHLGtCQUFrQixDQUFDOzs7Ozs7QUFFakQscUJBQStCLFFBQStCO0lBQzVELE9BQU8sVUFBUyxXQUFxQjtRQUNuQyxXQUFXLENBQUMsY0FBYyxDQUFDLEdBQUcsRUFBRSxDQUFDO1FBQ2pDLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLElBQUksR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFOztZQUNsRSxJQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDcEIsV0FBVyxDQUFDLGNBQWMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQztTQUNsRDtLQUNGLENBQUM7Q0FDSDs7Ozs7O0FDbkJEOzs7QUFHQTs7O0FBQUE7SUFJRSxlQUFzQixLQUFlO1FBQWYsVUFBSyxHQUFMLEtBQUssQ0FBVTtRQUNuQyxJQUFJLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQztLQUN4Qjs7Ozs7O0lBV0Qsc0JBQU07Ozs7O0lBQU4sVUFBVSxPQUF5Qjs7UUFDakMsSUFBSSxLQUFLLEdBQUcsT0FBTyxHQUFHLE9BQU8sR0FBRyxVQUFBLEtBQUssSUFBSSxPQUFBLEtBQUssR0FBQSxDQUFDO1FBQy9DLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7S0FDbEM7Ozs7Ozs7Ozs7SUFLRCwwQkFBVTs7Ozs7O0lBQVYsVUFBYyxPQUF3QjtRQUNwQyxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0tBQzNDOzs7Ozs7OztJQUtELDZCQUFhOzs7O0lBQWI7UUFDRSxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsVUFBQSxLQUFLLElBQUksT0FBQSxtQkFBQyxLQUFpQyxHQUFFLE9BQU8sR0FBQSxDQUFDLENBQUM7S0FDMUU7Ozs7Ozs7O0lBS0QsMkJBQVc7Ozs7SUFBWDtRQUNFLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFBLEtBQUssSUFBSSxPQUFBLG1CQUFDLEtBQTJCLEdBQUUsS0FBSyxHQUFBLENBQUMsQ0FBQztLQUNsRTs7Ozs7Ozs7SUFLRCwyQkFBVzs7OztJQUFYO1FBQ0UsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDO0tBQzVCO0lBTUQsc0JBQUksNkJBQVU7Ozs7Ozs7Ozs7UUFBZDtZQUNFLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUM7U0FDOUI7OztPQUFBO0lBT0Qsc0JBQUksMEJBQU87Ozs7Ozs7Ozs7OztRQUFYO1lBQ0UsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDO1NBQy9COzs7T0FBQTtJQUVELHNCQUFJLHlCQUFNOzs7O1FBQVY7WUFDRSxPQUFPLElBQUksQ0FBQyxXQUFXLENBQUMsY0FBYyxDQUFDLENBQUM7U0FDekM7OztPQUFBO2dCQTFFSDtJQTJFQzs7Ozs7Ozs7Ozs7QUN2REQ7Ozs7OztBQUFBO0lBQTJEQSwrQkFBUTtJQU9qRSxxQkFBWSxLQUF3QjtRQUFwQyxZQUNFLGtCQUFNLEtBQUssQ0FBQyxTQUViO1FBREMsS0FBSSxDQUFDLFNBQVMsR0FBRyxLQUFLLENBQUM7O0tBQ3hCOzs7OztJQWNELCtCQUFTOzs7O0lBQVQsVUFDRSxPQUVDO1FBSEgsaUJBNEJDO1FBM0JDLHdCQUFBLEVBQUE7WUFDRSxRQUFRLEVBQUUsS0FBSztTQUNoQjs7UUFFRCxJQUFNLFlBQVksR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLFVBQUEsS0FBSyxJQUFJLE9BQUEsS0FBSyxHQUFBLENBQUMsQ0FBQzs7UUFDakQsSUFBTSxlQUFlLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFBLEtBQUssSUFBSSxPQUFBLEtBQUssQ0FBQyxRQUFRLEdBQUEsQ0FBQyxDQUFDO1FBRTdELE9BQU8sQ0FBQyxNQUFNLEdBQUcsT0FBTyxDQUFDLE1BQU0sS0FBSyxJQUFJLENBQUMsTUFBTSx1QkFBSyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQW1CLEVBQUMsQ0FBQyxDQUFDO1FBQ3RGLE9BQU8sQ0FBQyxXQUFXLEdBQUcsT0FBTyxDQUFDLFdBQVcsS0FBSyxJQUFJLENBQUMsTUFBTSxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUM7UUFFdEYsT0FBTyxlQUFlLENBQUMsSUFBSSxDQUN6QixjQUFjLENBQUMsWUFBWSxFQUFFLFVBQUMsUUFBb0IsRUFBRSxLQUFRO1lBQ2xELElBQUEsZUFBRyxDQUFXO1lBQ3RCLElBQUksT0FBTyxDQUFDLFFBQVEsRUFBRTtnQkFDcEIsT0FBTyxLQUFLLENBQUMsR0FBRyxFQUFFLFFBQVEsRUFBRSxPQUFPLENBQUMsQ0FBQzthQUN0QztpQkFBTTtnQkFDTCxJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUU7b0JBQ3hDLElBQUksQ0FBQyxLQUFJLENBQUMsUUFBUSxFQUFFO3dCQUNsQixLQUFJLENBQUMsUUFBUSxHQUFHLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQztxQkFDckM7b0JBQ0QsT0FBTyxLQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssRUFBRSxPQUFPLENBQUMsQ0FBQztpQkFDdEM7Z0JBRUQsT0FBTyxPQUFPLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFDO2FBQ2hDO1NBQ0YsQ0FBQyxDQUNILENBQUM7S0FDSDs7Ozs7SUFjRCw0QkFBTTs7OztJQUFOLFVBQU8sT0FBd0Y7UUFBeEYsd0JBQUEsRUFBQSxZQUE4QixRQUFRLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQUUsT0FBTyxFQUFFLFNBQVMsRUFBRTs7UUFDN0YsSUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBRWpDLElBQUksT0FBTyxDQUFDLFFBQVEsRUFBRTtZQUNwQixPQUFPLEtBQUssQ0FBQyxLQUFLLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxRQUFRLEVBQUUsT0FBTyxFQUFFLElBQUksQ0FBQyxDQUFDO1NBQ3hEO1FBRUQsT0FBTyxPQUFPLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0tBQ2hDOzs7Ozs7Ozs7Ozs7Ozs7O0lBUUQsZ0NBQVU7Ozs7Ozs7OztJQUFWLFVBQVcsR0FBUyxFQUFFLE9BQTJDO1FBQWpFLGlCQVVDO1FBVnFCLHdCQUFBLEVBQUEsWUFBMkM7O1FBQy9ELElBQU0sZUFBZSxHQUFHLFdBQVcsQ0FBQyxPQUFPLENBQUMsZUFBZSxDQUFDLEdBQUcsSUFBSSxHQUFHLE9BQU8sQ0FBQyxlQUFlLENBQUM7O1FBQzlGLElBQU0sUUFBUSxHQUFHLEdBQUcsQ0FBQyxHQUFHLENBQUMsVUFBQSxFQUFFLElBQUksT0FBQSxLQUFJLENBQUMsWUFBWSxDQUFDLEVBQUUsQ0FBQyxHQUFBLENBQUMsQ0FBQztRQUV0RCxPQUFPLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQ2pDLEdBQUcsQ0FBQyxVQUFBLFFBQVE7WUFDVixPQUFPLGVBQWUsR0FBRyxRQUFRLENBQUMsTUFBTSxDQUFDLFVBQUEsR0FBRyxJQUFJLE9BQUEsQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLEdBQUEsQ0FBQyxHQUFHLFFBQVEsQ0FBQztTQUMvRSxDQUFDLEVBQ0YsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUNiLENBQUM7S0FDSDs7Ozs7OztJQVlELGtDQUFZOzs7Ozs7SUFBWixVQUFnQixFQUFNLEVBQUUsT0FBMEI7UUFBbEQsaUJBWUM7UUFYQyxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQ1osT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1NBQ3ZCO1FBRUQsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLFVBQUEsS0FBSztZQUN0QixJQUFJLEtBQUksQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDLEVBQUU7Z0JBQ3RCLE9BQU8sT0FBTyxDQUFDLEtBQUksQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQzthQUNwQztZQUVELE9BQU8sU0FBUyxDQUFDO1NBQ2xCLENBQUMsQ0FBQztLQUNKOzs7Ozs7Ozs7Ozs7Ozs7SUFRRCwrQkFBUzs7Ozs7Ozs7SUFBVCxVQUFVLEVBQU07UUFDZCxPQUFPLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUM7S0FDeEM7Ozs7Ozs7O0lBS0Qsb0NBQWM7Ozs7SUFBZDtRQUNFLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFBLEtBQUssSUFBSSxPQUFBLG1CQUFDLEtBQXdCLEdBQUUsTUFBTSxHQUFBLENBQUMsQ0FBQztLQUNoRTs7Ozs7Ozs7SUFLRCxpQ0FBVzs7OztJQUFYO1FBQ0UsT0FBTyxtQkFBQyxJQUFJLENBQUMsV0FBVyxFQUFxQixHQUFFLE1BQU0sQ0FBQztLQUN2RDs7Ozs7O0lBT0Qsa0NBQVk7Ozs7O0lBQVosVUFBZ0IsT0FBMEI7UUFBMUMsaUJBRUM7UUFEQyxPQUFPLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLFVBQUEsUUFBUSxJQUFJLE9BQUEsS0FBSSxDQUFDLFlBQVksQ0FBQyxRQUFRLEVBQUUsT0FBTyxDQUFDLEdBQUEsQ0FBQyxDQUFDLENBQUM7S0FDaEc7Ozs7Ozs7O0lBS0QsK0JBQVM7Ozs7SUFBVDs7UUFDRSxJQUFNLFFBQVEsR0FBTyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDeEMsT0FBTyxTQUFTLENBQUMsUUFBUSxDQUFDLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsR0FBRyxTQUFTLENBQUM7S0FDbkU7Ozs7Ozs7OztJQUtELGlDQUFXOzs7OztJQUFYLFVBQVksU0FBa0M7UUFDNUMsSUFBSSxVQUFVLENBQUMsU0FBUyxDQUFDLEVBQUU7WUFDekIsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDO2dCQUNwQixRQUFRLEVBQUUsU0FBUzthQUNwQixDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxVQUFBLFFBQVEsSUFBSSxPQUFBLFFBQVEsQ0FBQyxNQUFNLEdBQUEsQ0FBQyxDQUFDLENBQUM7U0FDM0M7UUFFRCxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsVUFBQSxLQUFLLElBQUksT0FBQSxLQUFLLENBQUMsR0FBRyxDQUFDLE1BQU0sR0FBQSxDQUFDLENBQUM7S0FDL0M7Ozs7Ozs7OztJQUtELDhCQUFROzs7OztJQUFSLFVBQVMsU0FBa0M7UUFDekMsSUFBSSxVQUFVLENBQUMsU0FBUyxDQUFDLEVBQUU7WUFDekIsT0FBTyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLE1BQU0sQ0FBQztTQUMvQztRQUNELE9BQU8sSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUM7S0FDdEM7Ozs7O0lBT0QsK0JBQVM7Ozs7SUFBVCxVQUFVLFdBQWdCO1FBQ3hCLElBQUksVUFBVSxDQUFDLFdBQVcsQ0FBQyxFQUFFO1lBQzNCLE9BQU8sSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztTQUN4QztRQUNELE9BQU8sV0FBVyxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDO0tBQzNDOzs7O0lBRUQsNkJBQU87OztJQUFQO1FBQ0UsT0FBTyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUMsR0FBRyxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUM7S0FDNUM7Ozs7O0lBRU8sMkJBQUs7Ozs7Y0FBQyxFQUFNOztRQUNsQixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsVUFBQSxLQUFLLElBQUksT0FBQSxLQUFJLENBQUMsU0FBUyxDQUFDLEVBQUUsQ0FBQyxHQUFBLENBQUMsQ0FBQzs7Ozs7SUFHbEQsaUNBQVc7OztJQUFYO1FBQ0UsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUM7S0FDdEI7c0JBaE9IO0VBb0IyRCxLQUFLLEVBNk0vRCxDQUFBOzs7Ozs7O0FBRUQsaUJBQTJDLEtBQVEsRUFBRSxPQUF5Qjs7SUFDNUUsSUFBSSxHQUFHLEdBQUcsRUFBRSxDQUFDO0lBQ0wsSUFBQSxlQUFHLEVBQUUseUJBQVEsQ0FBVztJQUN4QixJQUFBLDJCQUFRLEVBQUUseUJBQU8sRUFBRSx1QkFBTSxFQUFFLGlDQUFXLENBQWE7SUFFM0QsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7O1FBQ25DLElBQU0sRUFBRSxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUVsQixJQUFJLENBQUMsWUFBWSxDQUFDLEVBQUUsRUFBRSxRQUFRLENBQUMsRUFBRTtZQUMvQixTQUFTO1NBQ1Y7UUFFRCxJQUFJLENBQUMsUUFBUSxFQUFFO1lBQ2IsR0FBRyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUN2QixTQUFTO1NBQ1Y7UUFFRCxJQUFJLFFBQVEsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRTtZQUMxQixHQUFHLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1NBQ3hCO0tBQ0Y7SUFFRCxJQUFJLE1BQU0sRUFBRTs7UUFDVixJQUFJLFNBQU8sR0FBUSxVQUFVLENBQUMsTUFBTSxDQUFDLEdBQUcsTUFBTSxHQUFHLGFBQWEsQ0FBQyxNQUFNLEVBQUUsV0FBVyxDQUFDLENBQUM7UUFDcEYsR0FBRyxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsVUFBQyxDQUFDLEVBQUUsQ0FBQyxJQUFLLE9BQUEsU0FBTyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsS0FBSyxDQUFDLEdBQUEsQ0FBQyxDQUFDO0tBQ2hEOztJQUNELElBQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsT0FBTyxJQUFJLEdBQUcsQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBRTNELE9BQU8sTUFBTSxLQUFLLEdBQUcsQ0FBQyxNQUFNLEdBQUcsR0FBRyxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0NBQzNEOzs7Ozs7Ozs7QUFFRCxlQUFrQixHQUFTLEVBQUUsUUFBb0IsRUFBRSxPQUF5QixFQUFFLEdBQVc7SUFBWCxvQkFBQSxFQUFBLFdBQVc7O0lBQ3ZGLElBQU1HLE1BQUcsR0FBRyxFQUFFLENBQUM7SUFDUCxJQUFBLDJCQUFRLEVBQUUseUJBQU8sQ0FBYTtJQUV0QyxJQUFJLEdBQUcsSUFBSSxDQUFDLFFBQVEsSUFBSSxDQUFDLE9BQU8sRUFBRTtRQUNoQyxPQUFPLFFBQVEsQ0FBQztLQUNqQjs7SUFFRCxJQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sSUFBSSxHQUFHLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUUzRCxJQUFJLFFBQVEsSUFBSSxXQUFXLENBQUMsT0FBTyxDQUFDLEtBQUssS0FBSyxFQUFFOztRQUM5QyxJQUFJLEtBQUssR0FBRyxDQUFDLENBQUM7UUFDZCxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxRQUFNLEdBQUcsR0FBRyxDQUFDLE1BQU0sRUFBRSxDQUFDLEdBQUcsUUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO1lBQ3BELElBQUksS0FBSyxLQUFLLE9BQU87Z0JBQUUsTUFBTTs7WUFDN0IsSUFBTSxFQUFFLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2xCLElBQUksQ0FBQyxZQUFZLENBQUMsRUFBRSxFQUFFLFFBQVEsQ0FBQyxFQUFFO2dCQUMvQixTQUFTO2FBQ1Y7WUFDRCxJQUFJLFFBQVEsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRTtnQkFDMUJBLE1BQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUM7Z0JBQ3ZCLEtBQUssRUFBRSxDQUFDO2FBQ1Q7U0FDRjtLQUNGO1NBQU07UUFDTCxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFOztZQUMvQixJQUFNLEVBQUUsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFFbEIsSUFBSSxDQUFDLFlBQVksQ0FBQyxFQUFFLEVBQUUsUUFBUSxDQUFDLEVBQUU7Z0JBQy9CLFNBQVM7YUFDVjtZQUVELElBQUksQ0FBQyxRQUFRLEVBQUU7Z0JBQ2JBLE1BQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUM7Z0JBQ3ZCLFNBQVM7YUFDVjtZQUVELElBQUksU0FBUyxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFO2dCQUNyQ0EsTUFBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQzthQUN4QjtTQUNGO0tBQ0Y7SUFFRCxPQUFPQSxNQUFHLENBQUM7Q0FDWjs7Ozs7O0FDN1NEOzs7Ozs7Ozs7Ozs7Ozs7O0FBY0EsMEJBQW9DLE1BQWUsRUFBRSxPQUFtQjtJQUFuQix3QkFBQSxFQUFBLG1CQUFtQjtJQUN0RSxVQUFVLEVBQUUsQ0FBQztJQUNiLElBQUk7UUFDRixPQUFPLE1BQU0sQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7S0FDOUI7WUFBUztRQUNSLFFBQVEsRUFBRSxDQUFDO0tBQ1o7Q0FDRjs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFpQkQ7SUFDRSxPQUFPLFVBQVMsTUFBVyxFQUFFLFdBQW1CLEVBQUUsVUFBOEI7O1FBQzlFLElBQU0sY0FBYyxHQUFHLFVBQVUsQ0FBQyxLQUFLLENBQUM7UUFFeEMsVUFBVSxDQUFDLEtBQUssR0FBRztZQUFBLGlCQUlsQjtZQUoyQixjQUFPO2lCQUFQLFVBQU8sRUFBUCxxQkFBTyxFQUFQLElBQU87Z0JBQVAseUJBQU87O1lBQ2pDLE9BQU8sZ0JBQWdCLENBQUM7Z0JBQ3RCLE9BQU8sY0FBYyxDQUFDLEtBQUssQ0FBQyxLQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7YUFDekMsRUFBRSxJQUFJLENBQUMsQ0FBQztTQUNWLENBQUM7UUFFRixPQUFPLFVBQVUsQ0FBQztLQUNuQixDQUFDO0NBQ0g7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDcENELGNBQXdCLEtBQVU7SUFBRSxrQkFBZ0I7U0FBaEIsVUFBZ0IsRUFBaEIscUJBQWdCLEVBQWhCLElBQWdCO1FBQWhCLGlDQUFnQjs7SUFDbEQsZ0JBQVcsS0FBSyxFQUFLLFFBQVEsRUFBRTtDQUNoQzs7Ozs7Ozs7Ozs7Ozs7QUFXRCxnQkFBMEIsS0FBVSxFQUFFLEtBQWE7SUFDakQsT0FBTyxLQUFLLElBQUksQ0FBQyxZQUFPLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxFQUFLLEtBQUssQ0FBQyxLQUFLLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxhQUFRLEtBQUssQ0FBQyxDQUFDO0NBQ3hGOzs7Ozs7Ozs7Ozs7OztBQVlELGFBQXVCLEtBQVU7SUFDL0IsT0FBTyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO0NBQzNCOzs7Ozs7Ozs7Ozs7OztBQVdELGlCQUEyQixLQUFVO0lBQUUsa0JBQWdCO1NBQWhCLFVBQWdCLEVBQWhCLHFCQUFnQixFQUFoQixJQUFnQjtRQUFoQixpQ0FBZ0I7O0lBQ3JELGdCQUFXLFFBQVEsRUFBSyxLQUFLLEVBQUU7Q0FDaEM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUF5QkQsY0FBd0IsS0FBVSxFQUFFLGVBQXdDO0lBQzFFLE9BQU9DLFNBQUksS0FBSyxFQUFFLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQztDQUN6Qzs7Ozs7Ozs7Ozs7Ozs7QUFZRCxpQkFBMkIsS0FBVTtJQUNuQyxPQUFPQSxTQUFJLEtBQUssRUFBRSxPQUFPLEVBQUUsQ0FBQztDQUM3Qjs7Ozs7Ozs7Ozs7Ozs7O0FBV0QsY0FBd0IsS0FBVSxFQUFFLFVBQWtCLEVBQUUsV0FBbUI7O0lBQ3pFLElBQU0sT0FBTyxHQUFHLEtBQUssQ0FBQyxLQUFLLEVBQUUsQ0FBQzs7SUFDOUIsSUFBTSxTQUFTLEdBQUcsS0FBSyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQ3BDLE9BQU8sQ0FBQyxVQUFVLENBQUMsR0FBRyxLQUFLLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDekMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxHQUFHLFNBQVMsQ0FBQztJQUVqQyxPQUFPLE9BQU8sQ0FBQztDQUNoQjs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBY0QsZ0JBQTBCLEtBQVUsRUFBRSxXQUE0QixFQUFFLE9BQVU7SUFDNUUsT0FBTyxLQUFLLENBQUMsR0FBRyxDQUFDLFVBQUMsT0FBTyxFQUFFLEdBQUc7UUFDNUIsSUFBSSxPQUFPLFdBQVcsS0FBSyxRQUFRLElBQUksR0FBRyxLQUFLLFdBQVcsRUFBRTtZQUMxRCxPQUFPLE9BQU8sQ0FBQztTQUNoQjtRQUVELElBQUksUUFBUSxDQUFDLFdBQVcsQ0FBQyxJQUFJLG1CQUFDLFdBQWtCLE9BQU0sT0FBTyxFQUFFO1lBQzdELHVDQUNNLFdBQXFCLHVCQUNyQixPQUFjLElBQ2xCO1NBQ0g7UUFFRCxPQUFPLE9BQU8sQ0FBQztLQUNoQixDQUFDLENBQUM7Q0FDSjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFtREQsZ0JBQTBCLEtBQVUsRUFBRSxLQUFvQixFQUFFLFdBQWtDO0lBQXhELHNCQUFBLEVBQUEsUUFBUSxLQUFLLENBQUMsTUFBTTtJQUFFLDRCQUFBLEVBQUEsY0FBYyxLQUFLLENBQUMsTUFBTSxHQUFHLEtBQUs7SUFBRSxrQkFBZ0I7U0FBaEIsVUFBZ0IsRUFBaEIscUJBQWdCLEVBQWhCLElBQWdCO1FBQWhCLGlDQUFnQjs7SUFDOUcsZ0JBQVcsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLEVBQUssUUFBUSxFQUFLLEtBQUssQ0FBQyxLQUFLLENBQUMsS0FBSyxJQUFJLFdBQVcsR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHLFdBQVcsQ0FBQyxDQUFDLEVBQUU7Q0FDN0c7Ozs7Ozs7QUFFRCxnQkFBMEIsR0FBUSxFQUFFLElBQU87SUFDekMsT0FBTyxHQUFHLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUMsVUFBQSxPQUFPLElBQUksT0FBQSxJQUFJLEtBQUssT0FBTyxHQUFBLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxDQUFDO0NBQzNGOzs7Ozs7QUN2TUQ7QUFFQSxJQUFhLFNBQVMsR0FBRyxVQUFJLE1BQXFCLElBQUssT0FBQSxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFBLEtBQUssSUFBSSxPQUFBLEtBQUssS0FBSyxJQUFJLElBQUksT0FBTyxLQUFLLEtBQUssV0FBVyxHQUFBLENBQUMsQ0FBQyxHQUFBOzs7Ozs7QUNKbkk7Ozs7Ozs7QUFFQSxxQkFBK0IsSUFBYSxFQUFFLE1BQWMsRUFBRSxPQUFtQjtJQUFuQix3QkFBQSxFQUFBLG1CQUFtQjtJQUMvRSxhQUFhLENBQUMsZUFBZSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsQ0FBQztJQUM1QyxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7Q0FDNUI7Ozs7OztBQUVELGdCQUF1QixNQUFjLEVBQUUsa0JBQXlCO0lBQXpCLG1DQUFBLEVBQUEseUJBQXlCO0lBQzlELE9BQU8sVUFBUyxNQUFXLEVBQUUsV0FBbUIsRUFBRSxVQUE4Qjs7UUFDOUUsSUFBTSxjQUFjLEdBQUcsVUFBVSxDQUFDLEtBQUssQ0FBQztRQUN4QyxVQUFVLENBQUMsS0FBSyxHQUFHO1lBQVMsY0FBTztpQkFBUCxVQUFPLEVBQVAscUJBQU8sRUFBUCxJQUFPO2dCQUFQLHlCQUFPOztZQUNqQyxhQUFhLENBQUMsZUFBZSxDQUFDLE1BQU0sRUFBRSxrQkFBa0IsQ0FBQyxDQUFDO1lBQzFELE9BQU8sY0FBYyxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7U0FDekMsQ0FBQztRQUVGLE9BQU8sVUFBVSxDQUFDO0tBQ25CLENBQUM7Q0FDSDs7Ozs7O0FDakJEOzs7O0FBRUEsbUJBQW1CLE1BQU07SUFDdkIsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sRUFBRSxVQUFTLEdBQUcsRUFBRSxLQUFLO1FBQy9DLElBQUksT0FBTyxLQUFLLEtBQUssVUFBVSxFQUFFO1lBQy9CLE9BQU8sS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDO1NBQ3pCO1FBQ0QsT0FBTyxLQUFLLENBQUM7S0FDZCxDQUFDLENBQUM7Q0FDSjs7OztBQUVEOztJQUNFLElBQU0sSUFBSSxHQUFHLElBQUksSUFBSSxDQUNuQjtRQUNFLG96QkF1QkE7S0FDRCxFQUNEO1FBQ0UsSUFBSSxFQUFFLGlCQUFpQjtLQUN4QixDQUNGLENBQUM7O0lBRUYsSUFBTSxHQUFHLEdBQUcsR0FBRyxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUN0QyxPQUFPLElBQUksTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0NBQ3hCOzs7Ozs7Ozs7OztBQVNELHFCQUErQixTQUFtQjtJQUNoRCxPQUFPLFVBQVMsTUFBTTtRQUNwQixPQUFPLElBQUksVUFBVSxDQUFDLFVBQUEsUUFBUTs7WUFDNUIsSUFBTSxNQUFNLEdBQUcsWUFBWSxFQUFFLENBQUM7WUFFOUIsTUFBTSxDQUFDLFNBQVMsR0FBRyxVQUFTLENBQUM7Z0JBQzNCLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUN0QixRQUFRLENBQUMsUUFBUSxFQUFFLENBQUM7Z0JBQ3BCLE1BQU0sQ0FBQyxTQUFTLEVBQUUsQ0FBQzthQUNwQixDQUFDO1lBRUYsTUFBTSxDQUFDLE9BQU8sR0FBRyxVQUFTLEdBQUc7Z0JBQzNCLFFBQVEsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQ3BCLFFBQVEsQ0FBQyxRQUFRLEVBQUUsQ0FBQztnQkFDcEIsTUFBTSxDQUFDLFNBQVMsRUFBRSxDQUFDO2FBQ3BCLENBQUM7WUFFRixPQUFPLE1BQU0sQ0FBQyxTQUFTLENBQUMsVUFBQSxLQUFLOztnQkFDM0IsSUFBTSxLQUFLLEdBQUc7b0JBQ1osT0FBTyxFQUFFLFNBQVM7b0JBQ2xCLElBQUksRUFBRSxLQUFLO2lCQUNaLENBQUM7O2dCQUNGLElBQU0sVUFBVSxHQUFHLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFFcEMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsQ0FBQzthQUNoQyxDQUFDLENBQUM7U0FDSixDQUFDLENBQUM7S0FDSixDQUFDO0NBQ0g7Ozs7OztBQ25GRCxJQUdBOzs7Ozs7Ozs7Ozs7O0lBS0UsMkNBQWlCOzs7Ozs7SUFBakIsVUFBa0IsTUFBcUI7UUFBckIsdUJBQUEsRUFBQSxXQUFxQjs7UUFDckMsSUFBSSxHQUFHLEdBQUcsRUFBRSxDQUFDOztRQUNiLElBQU0sVUFBVSxHQUFHLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDOztRQUNyQyxJQUFNLElBQUksR0FBRyxVQUFVLEdBQUcsTUFBTSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDM0QsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7O1lBQ3BDLElBQUksU0FBUyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN4QixHQUFHLENBQUMsU0FBUyxDQUFDLEdBQUcsVUFBVSxDQUFDLFNBQVMsQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDO1NBQ2pEO1FBRUQsT0FBTyxHQUFHLENBQUM7S0FDWjs7Ozs7Ozs7O0lBS0QsMkNBQWlCOzs7OztJQUFqQixVQUFrQixNQUE2Qzs7UUFDN0QsSUFBSSxnQkFBZ0IsR0FBRyxNQUFNLENBQUM7UUFDOUIsSUFBSSxRQUFRLENBQUMsTUFBTSxDQUFDLEVBQUU7WUFDcEIsZ0JBQWdCLEdBQUcsSUFBSSxDQUFDLEtBQUssbUJBQUMsZ0JBQTBCLEVBQUMsQ0FBQztTQUMzRDtnQ0FFUSxDQUFDLEVBQU0sSUFBSTs7WUFDbEIsSUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzFCLElBQUksVUFBVSxDQUFDLFNBQVMsQ0FBQyxFQUFFO2dCQUN6QixVQUFVLENBQUMsU0FBUyxDQUFDLENBQUMsUUFBUSxDQUFDLGNBQU0sT0FBQSxnQkFBZ0IsQ0FBQyxTQUFTLENBQUMsR0FBQSxDQUFDLENBQUM7YUFDbkU7O1FBSkgsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsSUFBSSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUU7b0JBQWpFLENBQUMsRUFBTSxJQUFJO1NBS25CO0tBQ0Y7MEJBbkNIO0lBb0NDLENBQUE7QUFqQ0Q7QUFtQ0EsSUFBYSxlQUFlLEdBQUcsSUFBSSxlQUFlLEVBQUU7Ozs7Ozs7Ozs7QUM3QnBEOzs7O0FBQUE7SUFDRSxxQkFBZ0MsS0FBb0I7UUFBcEIsVUFBSyxHQUFMLEtBQUssQ0FBZTtLQUFJOzs7Ozs7SUFHOUMsOEJBQVE7Ozs7SUFBbEI7UUFDRSxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUM7S0FDbkI7Ozs7OztJQUdTLDhCQUFROzs7O0lBQWxCO1FBQ0UsT0FBTyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUMsU0FBUyxDQUFDO0tBQ2xDOzs7Ozs7O0lBTVMsbUNBQWE7Ozs7O0lBQXZCLFVBQXdCLFFBQVk7UUFDbEMsT0FBTyxTQUFTLENBQUMsUUFBUSxDQUFDLENBQUM7S0FDNUI7Ozs7Ozs7SUFHUyxrQ0FBWTs7Ozs7SUFBdEIsVUFBdUIsUUFBWTtRQUNqQyxJQUFJLElBQUksQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLEVBQUU7WUFDaEMsT0FBTyxtQkFBQyxJQUFJLENBQUMsUUFBUSxFQUF1QixHQUFFLFlBQVksQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7U0FDdEY7UUFFRCxPQUFPLG1CQUFDLElBQUksQ0FBQyxRQUFRLEVBQWMsR0FBRSxNQUFNLENBQUMsVUFBQSxLQUFLLElBQUksT0FBQSxLQUFLLEdBQUEsQ0FBQyxDQUFDO0tBQzdEOzs7OztJQUVTLCtCQUFTOzs7O0lBQW5CLFVBQW9CLFFBQVk7UUFDOUIsSUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxFQUFFO1lBQ2hDLE9BQU8sbUJBQUMsSUFBSSxDQUFDLFFBQVEsRUFBdUIsR0FBRSxTQUFTLENBQUMsUUFBUSxDQUFDLENBQUM7U0FDbkU7UUFFRCxPQUFPLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQyxXQUFXLEVBQUUsQ0FBQztLQUN0Qzs7Ozs7Ozs7SUFHUyxpQ0FBVzs7Ozs7O0lBQXJCLFVBQXNCLFFBQVEsRUFBRSxRQUFTO1FBQ3ZDLElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsRUFBRTtZQUNoQyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRSxRQUFRLENBQUMsQ0FBQztTQUM1QzthQUFNO1lBQ0wsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDLFFBQVEsQ0FBQyxVQUFDLEtBQUssSUFBSyxxQkFBSyxLQUFLLEVBQUssUUFBUSxLQUFFLENBQUMsQ0FBQztTQUNoRTtLQUNGO3NCQXRESDtJQXVEQzs7Ozs7OztBQzVCRCxJQUFNLGlCQUFpQixHQUFvQjtJQUN6QyxhQUFhLEVBQUUsS0FBSztJQUNwQixLQUFLLEVBQUUsS0FBSztJQUNaLFNBQVMsRUFBRSxDQUFDO0lBQ1osWUFBWSxFQUFFLFNBQVM7Q0FDeEIsQ0FBQzs7Ozs7SUFFc0NKLG1DQUFjO0lBc0JwRCx5QkFBc0IsS0FBMEIsRUFBUyxNQUE0Qjs0Q0FBQTtRQUFyRixZQUNFLGtCQUFNLEtBQUssQ0FBQyxTQU9iO1FBUnFCLFdBQUssR0FBTCxLQUFLLENBQXFCO1FBQVMsWUFBTSxHQUFOLE1BQU0sQ0FBc0I7Ozs7eUJBcEIxRSxJQUFJLEdBQUcsRUFBRTtzQkFHSixJQUFJLEdBQUcsRUFBeUI7MkJBR0o7WUFDMUMsV0FBVyxFQUFFLENBQUM7WUFDZCxPQUFPLEVBQUUsQ0FBQztZQUNWLEtBQUssRUFBRSxDQUFDO1lBQ1IsUUFBUSxFQUFFLENBQUM7WUFDWCxJQUFJLEVBQUUsRUFBRTtTQUNUOzs7Ozt3QkFNaUIsS0FBSzs7OzsyQkFlVixLQUFJLENBQUMsS0FBSyxDQUFDLGFBQWEsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFYcEQsS0FBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLGlCQUFpQixFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBQ3ZELHVCQUFRLHdCQUFTLEVBQUUsOEJBQVksQ0FBaUI7UUFDaEQsS0FBSSxDQUFDLElBQUksR0FBRyxJQUFJLGVBQWUsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUMzQyxJQUFJLFlBQVksQ0FBQyxZQUFZLENBQUMsRUFBRTtZQUM5QixLQUFJLENBQUMsc0JBQXNCLEdBQUcsWUFBWSxDQUFDLFNBQVMsQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLEtBQUksQ0FBQyxVQUFVLEVBQUUsR0FBQSxDQUFDLENBQUM7U0FDOUU7O0tBQ0Y7SUFVRCxzQkFBSSx3Q0FBVzs7Ozs7Ozs7UUFBZjtZQUNFLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztTQUNqQzs7O09BQUE7SUFLRCxzQkFBSSx3Q0FBVzs7Ozs7Ozs7UUFBZjtZQUNFLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxXQUFXLENBQUM7U0FDcEM7OztPQUFBO0lBS0Qsc0JBQUksb0NBQU87Ozs7Ozs7O1FBQVg7WUFDRSxPQUFPLElBQUksQ0FBQyxXQUFXLEtBQUssQ0FBQyxDQUFDO1NBQy9COzs7T0FBQTtJQUtELHNCQUFJLG1DQUFNOzs7Ozs7OztRQUFWO1lBQ0UsT0FBTyxJQUFJLENBQUMsV0FBVyxLQUFLLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDO1NBQ3REOzs7T0FBQTs7Ozs7Ozs7OztJQU1ELHNDQUFZOzs7OztJQUFaO1FBQ0UsSUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDO1FBQ2pDLE9BQU8sSUFBSSxDQUFDO0tBQ2I7Ozs7Ozs7Ozs7SUFNRCxtQ0FBUzs7Ozs7SUFBVDtRQUNFLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztRQUN6QixPQUFPLElBQUksQ0FBQztLQUNiOzs7Ozs7Ozs7SUFLRCxvQ0FBVTs7Ozs7SUFBVixVQUFXLEtBQVk7UUFBWixzQkFBQSxFQUFBLFlBQVk7UUFDckIsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQztLQUNuQzs7Ozs7Ozs7O0lBTUQsZ0NBQU07Ozs7O2NBQUMsUUFBK0I7UUFDcEMsSUFBSSxDQUFDLFVBQVUsR0FBRyxRQUFRLENBQUM7UUFDM0IsSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7S0FDN0I7Ozs7Ozs7Ozs7O0lBTUQsaUNBQU87Ozs7OztJQUFQLFVBQVEsSUFBUztRQUFqQixpQkFHQztRQUZDLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsRUFBRSxHQUFHLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxVQUFBLE1BQU0sSUFBSSxPQUFBLE1BQU0sQ0FBQyxLQUFJLENBQUMsUUFBUSxFQUFFLENBQUMsS0FBSyxDQUFDLEdBQUEsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUM3RixJQUFJLENBQUMsUUFBUSxFQUFFLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO0tBQzNCOzs7Ozs7OztJQUtELG9DQUFVOzs7O0lBQVY7UUFBQSxpQkFXQztRQVZDLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQ2pCLFdBQVcsQ0FDVDtnQkFDRSxLQUFJLENBQUMsUUFBUSxFQUFFLENBQUMsTUFBTSxFQUFFLENBQUM7YUFDMUIsRUFDRCxFQUFFLElBQUksRUFBRSwyQkFBMkIsRUFBRSxDQUN0QyxDQUFDO1lBQ0YsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFDO1NBQ3hCO1FBQ0QsSUFBSSxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUM7S0FDdEI7Ozs7O0lBRUQsbUNBQVM7Ozs7SUFBVCxVQUFVLElBQVk7UUFDcEIsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7S0FDekI7Ozs7Ozs7OztJQUtELGlDQUFPOzs7OztJQUFQLFVBQVEsRUFBZ0Y7WUFBaEYsNEJBQWdGLEVBQTlFLDBCQUFVLEVBQUUsNEJBQVc7UUFDL0IsSUFBSSxJQUFJLENBQUMsc0JBQXNCLEVBQUU7WUFDL0IsSUFBSSxDQUFDLHNCQUFzQixDQUFDLFdBQVcsRUFBRSxDQUFDO1NBQzNDO1FBQ0QsSUFBSSxVQUFVLEVBQUU7WUFDZCxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7U0FDbkI7UUFDRCxJQUFJLENBQUMsV0FBVyxDQUFDLFdBQVcsQ0FBQyxFQUFFO1lBQzdCLElBQUksQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUM7U0FDM0I7UUFDRCxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQztLQUNyQjs7Ozs7Ozs7O0lBS0Qsc0NBQVk7Ozs7O0lBQVosVUFBYSxJQUFZO1FBQ3ZCLE9BQU8sSUFBSSxDQUFDLFdBQVcsS0FBSyxJQUFJLENBQUM7S0FDbEM7Ozs7Ozs7OztJQUtELGlDQUFPOzs7OztJQUFQLFVBQVEsSUFBWTtRQUNsQixJQUFJLElBQUksS0FBSyxJQUFJLENBQUMsV0FBVyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRTtZQUNwRCxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLFdBQVcsR0FBRyxJQUFJLEVBQUUsQ0FBQztTQUN0RDtLQUNGOzs7Ozs7OztJQUtELGtDQUFROzs7O0lBQVI7UUFDRSxJQUFJLElBQUksQ0FBQyxXQUFXLEtBQUssSUFBSSxDQUFDLFVBQVUsQ0FBQyxRQUFRLEVBQUU7WUFDakQsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLFdBQVcsR0FBRyxDQUFDLENBQUMsQ0FBQztTQUMvQztLQUNGOzs7Ozs7OztJQUtELGtDQUFROzs7O0lBQVI7UUFDRSxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsV0FBVyxHQUFHLENBQUMsRUFBRTtZQUNuQyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsV0FBVyxHQUFHLENBQUMsQ0FBQyxDQUFDO1NBQy9DO0tBQ0Y7Ozs7Ozs7O0lBS0QscUNBQVc7Ozs7SUFBWDtRQUNFLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsQ0FBQztLQUN4Qzs7Ozs7Ozs7SUFLRCxzQ0FBWTs7OztJQUFaO1FBQ0UsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztLQUNqQjs7Ozs7Ozs7O0lBS0QsaUNBQU87Ozs7O0lBQVAsVUFBUSxJQUFZO1FBQ2xCLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7S0FDN0I7Ozs7Ozs7OztJQUtELGlDQUFPOzs7OztJQUFQLFVBQVEsR0FBNEM7UUFBcEQsaUJBZ0JDOztRQWZDLElBQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsV0FBVyxDQUFDO1FBQ3pDLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRTtZQUN0QixPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDOUI7YUFBTTtZQUNMLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDdEIsT0FBTyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQ3JCLFNBQVMsQ0FBQyxVQUFDLE1BQTZCO2dCQUN0QyxnQkFBZ0IsQ0FBQztvQkFDZixLQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDO29CQUN2QixLQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDO2lCQUNyQixDQUFDLENBQUM7Z0JBQ0gsT0FBTyxLQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDO2FBQzlCLENBQUMsQ0FDSCxDQUFDO1NBQ0g7S0FDRjs7OztJQUVELGtDQUFROzs7SUFBUjtRQUNFLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQztLQUNuQjs7OztJQUVPLGlDQUFPOzs7O1FBQ2IsSUFBSSxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQ2hCLE9BQU8sQ0FBQyxDQUFDO1NBQ1Y7UUFDRCxPQUFPLENBQUMsSUFBSSxDQUFDLFdBQVcsR0FBRyxDQUFDLElBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQyxPQUFPLEdBQUcsQ0FBQyxDQUFDOzs7OztJQUd0RCwrQkFBSzs7OztRQUNYLE9BQU8sSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQzs7Ozs7OztJQU01QyxvQ0FBVTs7Ozs7Y0FBQyxJQUFZOztRQUM3QixPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsSUFBSSxDQUNsRCxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQ1AsR0FBRyxDQUFDLFVBQUEsUUFBUTs7WUFDVixJQUFJLFFBQVEsZ0JBQ1AsS0FBSSxDQUFDLFVBQVUsSUFDbEIsSUFBSSxFQUFFLEtBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsVUFBQSxFQUFFLElBQUksT0FBQSxRQUFRLENBQUMsRUFBRSxDQUFDLEdBQUEsQ0FBQyxJQUN0RDtZQUVGLHVCQUFRLGdCQUFLLEVBQUUsZ0NBQWEsQ0FBaUI7WUFFN0MsSUFBSSxDQUFDLEtBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxFQUFFO2dCQUMxQixRQUFRLENBQUMsS0FBSyxHQUFHLFFBQVEsQ0FBQyxPQUFPLEdBQUcsUUFBUSxDQUFDLFFBQVEsQ0FBQztnQkFDdEQsS0FBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLEdBQUcsUUFBUSxDQUFDLEtBQUssQ0FBQzthQUN4QztZQUVELElBQUksS0FBSyxFQUFFO2dCQUNULFFBQVEsQ0FBQyxJQUFJLEdBQUcsS0FBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO2dCQUMvQixRQUFRLENBQUMsRUFBRSxHQUFHLEtBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQzthQUM1QjtZQUVELElBQUksYUFBYSxFQUFFO2dCQUNqQixRQUFRLENBQUMsWUFBWSxHQUFHLGFBQWEsQ0FBQyxLQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssRUFBRSxLQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFDO2FBQ3ZGO1lBRUQsT0FBTyxRQUFRLENBQUM7U0FDakIsQ0FBQyxDQUNILENBQUM7OztRQTVLSCxNQUFNLENBQUMsRUFBRSxJQUFJLEVBQUUsd0JBQXdCLEVBQUUsRUFBRSxJQUFJLENBQUM7Ozs7aURBSWhEOzBCQW5JSDtFQWtDd0MsV0FBVzs7Ozs7OztBQWdSbkQsdUJBQXVCLEtBQWEsRUFBRSxPQUFlOztJQUNuRCxJQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssR0FBRyxPQUFPLENBQUMsQ0FBQzs7SUFDdkMsSUFBSSxHQUFHLEdBQUcsRUFBRSxDQUFDO0lBQ2IsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBRTtRQUM1QixHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztLQUNqQjtJQUNELE9BQU8sR0FBRyxDQUFDO0NBQ1o7Ozs7QUFHRCxJQUFhLFNBQVMsR0FBRyxlQUFlOzs7Ozs7Ozs7QUNyU3hDOzs7QUFBQTtJQUFrREEsdUNBQVc7SUFNM0QsNkJBQXNCLEtBQWlCLEVBQVUsZUFBa0MsRUFBVSxNQUE4Qjs0Q0FBQTtRQUEzSCxZQUNFLGtCQUFNLEtBQUssQ0FBQyxTQUdiO1FBSnFCLFdBQUssR0FBTCxLQUFLLENBQVk7UUFBVSxxQkFBZSxHQUFmLGVBQWUsQ0FBbUI7UUFBVSxZQUFNLEdBQU4sTUFBTSxDQUF3QjtRQUV6SCxLQUFJLENBQUMsTUFBTSxZQUFRLEVBQUUsWUFBWSxFQUFFLEdBQUcsRUFBRSxPQUFPLEVBQUUsV0FBVyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsRUFBSyxNQUFNLENBQUUsQ0FBQztRQUM5RixLQUFJLENBQUMsVUFBVSxHQUFHLFFBQVEsQ0FBQyxlQUFlLENBQUMsQ0FBQzs7S0FDN0M7Ozs7O0lBRUQscUNBQU87Ozs7SUFBUCxVQUFRLElBQW1CO1FBQ3pCLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ2pCLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUNoQixPQUFPLElBQUksQ0FBQztLQUNiOzs7OztJQUVELG1DQUFLOzs7O0lBQUwsVUFBTSxZQUFnQjs7O1FBQ3BCLElBQUksS0FBSyxDQUFDO1FBQ1YsSUFBSSxZQUFZLEVBQUU7WUFDaEIsS0FBSyxHQUFHLFlBQVksQ0FBQztTQUN0QjthQUFNO1lBQ0wsS0FBSyxHQUFHLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLFlBQVksR0FBRyxtQkFBQyxJQUFXLEdBQUUsZUFBZSxFQUFFLENBQUM7U0FDL0U7UUFFRCxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQzs7UUFFNUIsSUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLFVBQVUsR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDLE1BQU0sRUFBRSxFQUFLLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQyxTQUFTLFNBQUksSUFBSSxDQUFDLGVBQWlCLEVBQUUsS0FBSyxDQUFDLGFBQUssR0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sSUFBRyxLQUFLLEtBQUUsQ0FBQztRQUMxSyxJQUFJLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0tBQzlCOzs7O0lBRU8sc0NBQVE7Ozs7Ozs7UUFDZCxJQUFJLElBQUksQ0FBQztRQUVULElBQUksSUFBSSxDQUFDLFVBQVUsRUFBRTtZQUNuQixJQUFJLEdBQU0sSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDLFNBQVMsU0FBSSxJQUFJLENBQUMsZUFBaUIsQ0FBQztZQUM5RCxJQUFJLENBQUMsWUFBWSxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUMsTUFBTSxFQUFFLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFDN0QsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxFQUFFLFNBQVMsRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsRUFBRSxDQUFDLENBQUM7U0FDL0U7YUFBTTtZQUNMLElBQUksQ0FBQyxtQkFBQyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUMsV0FBVyxFQUFzQixHQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLEVBQUU7Z0JBQzdFLGFBQWEsQ0FBQyxTQUFTLENBQUMsRUFBRSxJQUFJLEVBQUUsK0JBQStCLEVBQUUsQ0FBQyxDQUFDO2dCQUNuRSxJQUFJLENBQUMsV0FBVyxXQUFHLEdBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLElBQUcsbUJBQUMsSUFBVyxHQUFFLGVBQWUsRUFBRSxNQUFHLENBQUM7YUFDOUU7WUFFRCxJQUFJLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxVQUFBLEtBQUssSUFBSSxPQUFBLG1CQUFDLEtBQXlCLEdBQUUsS0FBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsR0FBQSxDQUFDLENBQUMsU0FBUyxDQUFDLFVBQUEsU0FBUyxJQUFJLE9BQUEsS0FBSSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLEdBQUEsQ0FBQyxDQUFDO1NBQzFJO1FBRUQsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsVUFBQSxLQUFLO1lBQ3BHLGFBQWEsQ0FBQyxTQUFTLENBQUMsRUFBRSxJQUFJLEVBQUUsdUJBQXVCLEVBQUUsQ0FBQyxDQUFDOztZQUMzRCxJQUFJLFFBQVEsQ0FBQztZQUNiLElBQUksS0FBSSxDQUFDLFVBQVUsRUFBRTtnQkFDbkIsUUFBUSxHQUFHLFVBQUEsS0FBSyxJQUFJLE9BQUEsUUFBUSxDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxDQUFDLEdBQUEsQ0FBQzthQUNsRDtpQkFBTTtnQkFDTCxRQUFRLEdBQUc7O29CQUFNLGlCQUFHLEdBQUMsS0FBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLElBQUcsS0FBSztpQkFBRyxDQUFDO2FBQ3JEO1lBQ0QsS0FBSSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsS0FBSSxDQUFDLFFBQVEsRUFBRSxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUMsQ0FBQztTQUN0RCxDQUFDLENBQUM7Ozs7O0lBR0wscUNBQU87OztJQUFQO1FBQ0UsSUFBSSxDQUFDLFdBQVcsSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLFdBQVcsRUFBRSxDQUFDO0tBQ3BEOzhCQXJGSDtFQXVCa0QsV0FBVyxFQStENUQ7Ozs7OztBQ3RGRDtBQU1BLElBQU0sS0FBSyxHQUFHLE9BQU8sWUFBWSxLQUFLLFdBQVcsQ0FBQzs7Ozs7QUF1QmxELHNCQUE2QixNQUFvQztJQUMvRCxJQUFJLEtBQUs7UUFBRSxPQUFPOztJQUVsQixJQUFNLFFBQVEsR0FBdUI7UUFDbkMsR0FBRyxFQUFFLGFBQWE7UUFDbEIsT0FBTyxFQUFFLFlBQVk7UUFDckIsV0FBVyxFQUFFLElBQUksQ0FBQyxLQUFLO1FBQ3ZCLFNBQVMsRUFBRSxJQUFJLENBQUMsU0FBUztRQUN6QixPQUFPLEVBQUUsRUFBRTtRQUNYLE9BQU8sRUFBRSxFQUFFO0tBQ1osQ0FBQztJQUNGLDhDQUFRLG9CQUFPLEVBQUUsNEJBQVcsRUFBRSx3QkFBUyxFQUFFLG9CQUFPLEVBQUUsb0JBQU8sRUFBRSxZQUFHLENBQXlDOztJQUV2RyxJQUFNLFVBQVUsR0FBRyxPQUFPLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQzs7SUFDdEMsSUFBTSxVQUFVLEdBQUcsT0FBTyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7SUFFdEMsSUFBSSxVQUFVLElBQUksVUFBVSxFQUFFO1FBQzVCLE1BQU0sSUFBSSxVQUFVLENBQUMsd0NBQXdDLENBQUMsQ0FBQztLQUNoRTs7SUFFRCxJQUFNLFlBQVksR0FBRyxXQUFXLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxJQUFJLENBQUMsQ0FBQzs7SUFFL0QsSUFBSSxNQUFNLEdBQUcsRUFBRSxDQUFDOztJQUNoQixJQUFJLEdBQUcsR0FBRyxFQUFFLENBQUM7Ozs7SUFFYjtRQUNFLE9BQU8sQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLFNBQVMsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxZQUFZLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO0tBQ3ZFOzs7Ozs7SUFFRCxtQkFBbUIsU0FBUyxFQUFFLElBQUk7UUFDaEMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxHQUFHLFVBQVUsQ0FBQyxTQUFTLENBQUM7YUFDdEMsT0FBTyxDQUFDLFVBQUEsS0FBSyxJQUFJLE9BQUEsUUFBUSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsR0FBQSxDQUFDO2FBQ3ZDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7YUFDYixTQUFTLENBQUMsVUFBQSxJQUFJO1lBQ2IsR0FBRyxDQUFDLFNBQVMsQ0FBQyxHQUFHLElBQUksQ0FBQztZQUN0QixJQUFJLEVBQUUsQ0FBQztTQUNSLENBQUMsQ0FBQztLQUNOOzs7Ozs7O0lBRUQsb0JBQW9CLFNBQVMsRUFBRSxLQUFLLEVBQUUsSUFBSTtRQUN4QyxJQUFJLFlBQVksQ0FBQyxTQUFTLENBQUMsRUFBRTtZQUMzQixhQUFhLENBQUMsU0FBUyxDQUFDLEVBQUUsSUFBSSxFQUFFLGVBQWUsRUFBRSxDQUFDLENBQUM7WUFDbkQsS0FBSyxDQUFDLFFBQVEsQ0FBQyxVQUFBLEtBQUs7Z0JBQ2xCLE9BQU8sUUFBUSxDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsWUFBWSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUM7YUFDdkQsQ0FBQyxDQUFDO1lBQ0gsSUFBSSxLQUFLLENBQUMsUUFBUSxFQUFFO2dCQUNsQixLQUFLLENBQUMsUUFBUSxFQUFFLENBQUM7YUFDbEI7U0FDRjtLQUNGOztJQUVELElBQU0sWUFBWSxHQUFHLGNBQWMsQ0FBQyxTQUFTLENBQUMsVUFBQSxNQUFNO1FBQ2xELElBQUksTUFBTSxDQUFDLElBQUksd0JBQXdCOztZQUNyQyxJQUFJLGtCQUFnQixHQUFHLE1BQU0sQ0FBQyxPQUFPLFVBQU8sU0FBUyxDQUFDO1lBRXRELElBQUksVUFBVSxJQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsa0JBQWdCLENBQUMsR0FBRyxDQUFDLENBQUMsS0FBSyxJQUFJLEVBQUU7Z0JBQ2pFLE9BQU87YUFDUjtZQUVELElBQUksVUFBVSxFQUFFOztnQkFDZCxJQUFNLElBQUksR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLFVBQUEsSUFBSSxJQUFJLE9BQUEsSUFBSSxDQUFDLE9BQU8sQ0FBQyxrQkFBZ0IsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFBLENBQUMsQ0FBQztnQkFDdkUsSUFBSSxDQUFDLElBQUksRUFBRTtvQkFDVCxPQUFPO2lCQUNSO3FCQUFNO29CQUNMLGtCQUFnQixHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBQ3RDLFVBQVUsQ0FBQyxrQkFBZ0IsRUFBRSxNQUFNLENBQUMsT0FBTyxXQUFRLElBQUksQ0FBQyxDQUFDO29CQUN6RCxTQUFTLENBQUMsa0JBQWdCLEVBQUUsSUFBSSxDQUFDLENBQUM7aUJBQ25DO2FBQ0Y7aUJBQU07Z0JBQ0wsVUFBVSxDQUFDLGtCQUFnQixFQUFFLE1BQU0sQ0FBQyxPQUFPLFdBQVEsa0JBQWdCLENBQUMsQ0FBQztnQkFDckUsU0FBUyxDQUFDLGtCQUFnQixFQUFFLGtCQUFnQixDQUFDLENBQUM7YUFDL0M7U0FDRjtLQUNGLENBQUMsQ0FBQztJQUVILE9BQU87UUFDTCxPQUFPOzs7O1lBQ0wsWUFBWSxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQzNCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLElBQUksR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFOztnQkFDaEUsSUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUMxQixNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7YUFDakM7WUFDRCxNQUFNLEdBQUcsRUFBRSxDQUFDO1NBQ2I7UUFDRCxLQUFLOzs7O1lBQ0gsT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFDO1NBQ2pCO1FBQ0QsVUFBVTs7OztrQkFBQyxTQUFpQjs7WUFDMUIsSUFBTSxZQUFZLEdBQUcsV0FBVyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksSUFBSSxDQUFDLENBQUM7WUFFL0QsSUFBSSxZQUFZLENBQUMsU0FBUyxDQUFDLEVBQUU7Z0JBQzNCLE9BQU8sWUFBWSxDQUFDLFNBQVMsQ0FBQyxDQUFDO2dCQUMvQixPQUFPLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxTQUFTLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQzthQUMvQztTQUNGO0tBQ0YsQ0FBQztDQUNIOzs7Ozs7Ozs7OztBQzFHRCx1QkFBOEIsZUFBdUQsRUFBRSxPQUFzQztJQUF0Qyx3QkFBQSxFQUFBLFlBQXNDO0lBQzNILElBQUksQ0FBQyxtQkFBQyxNQUFhLEdBQUUsNEJBQTRCLEVBQUU7UUFDakQsT0FBTztLQUNSOztJQUVELElBQU0sU0FBUyxHQUFHLGVBQWUsSUFBSSxlQUFlLENBQUMsS0FBSyxDQUFDLENBQUM7SUFFNUQsSUFBSSxDQUFDLFNBQVMsRUFBRTtRQUNkLGVBQWUsR0FBRyxlQUFlLElBQUksRUFBRSxDQUFDO1FBQ3hDLG1CQUFDLGVBQXNCLEdBQUUsR0FBRyxHQUFHLFVBQUEsRUFBRSxJQUFJLE9BQUEsRUFBRSxFQUFFLEdBQUEsQ0FBQztRQUMxQyxPQUFPLHFCQUFHLGVBQTJDLENBQUEsQ0FBQztLQUN2RDs7SUFFRCxJQUFNLGNBQWMsR0FBZ0QsRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLENBQUM7O0lBQ3RGLElBQU0sTUFBTSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLGNBQWMsRUFBRSxPQUFPLENBQUMsQ0FBQzs7SUFFMUQsSUFBTSxRQUFRLEdBQUcsbUJBQUMsTUFBYSxHQUFFLDRCQUE0QixDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQzs7SUFDOUUsSUFBSSxRQUFRLEdBQUcsRUFBRSxDQUFDO0lBRWxCLGNBQWMsQ0FBQyxTQUFTLENBQUMsVUFBQSxNQUFNOztRQUM3QixJQUFJLE1BQU0sQ0FBQyxJQUFJLHdCQUF3QjtZQUNyQyxJQUFJLGFBQWEsQ0FBQyxVQUFVLEVBQUU7Z0JBQzVCLGFBQWEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQ25DLE9BQU87YUFDUjtZQUVELFFBQVEsZ0JBQ0gsUUFBUSxlQUNWLE1BQU0sQ0FBQyxPQUFPLFlBQVEsVUFBVSxDQUFDLE1BQU0sQ0FBQyxPQUFPLFNBQU0sQ0FBQyxNQUFNLEVBQUUsTUFDaEUsQ0FBQztZQUVGLHNDQUFRLGNBQUksRUFBRSxzQkFBUSxDQUFpQzs7WUFDdkQsSUFBTSxTQUFTLEdBQUcsVUFBVSxDQUFDLE1BQU0sQ0FBQyxPQUFPLFNBQU0sQ0FBQzs7WUFDbEQsSUFBSSxHQUFHLEdBQUcsU0FBUyxDQUFDLFFBQVEsQ0FBQyxHQUFHLE1BQUksU0FBUyxZQUFPLElBQUksZUFBVSxRQUFRLE1BQUcsR0FBRyxNQUFJLFNBQVMsWUFBTyxJQUFNLENBQUM7WUFFM0csSUFBSSxPQUFPLENBQUMsUUFBUSxFQUFFO2dCQUNwQixPQUFPLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUNuQixPQUFPLENBQUMsS0FBSyxFQUFFLENBQUM7Z0JBQ2hCLE9BQU8sQ0FBQyxRQUFRLEVBQUUsQ0FBQzthQUNwQjtZQUVELFFBQVEsQ0FBQyxJQUFJLENBQUMsRUFBRSxJQUFJLEVBQUUsR0FBRyxFQUFFLFdBQVcsRUFBRSxhQUFhLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxJQUFJLEdBQUEsQ0FBQyxFQUFFLEVBQUUsUUFBUSxDQUFDLENBQUM7U0FDOUY7S0FDRixDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsU0FBUyxDQUFDLFVBQUEsT0FBTztRQUN4QixJQUFJLE9BQU8sQ0FBQyxJQUFJLEtBQUssUUFBUSxFQUFFO1lBQzdCLGdEQUFPLG1CQUFTLENBQStCO1lBRS9DLElBQUksVUFBVSxDQUFDLFdBQVMsQ0FBQyxFQUFFO2dCQUN6QixtQkFBQyxlQUE2QixHQUFFLEdBQUcsQ0FBQzs7b0JBQ2xDLElBQU0sUUFBUSxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLFdBQVMsRUFBRSxXQUFTLFdBQVMsT0FBSSxDQUFDLENBQUM7b0JBQzVFLElBQUk7d0JBQ0YsSUFBSSxRQUFRLENBQUMsS0FBRyxRQUFVLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7cUJBQzlDO29CQUFDLE9BQU8sQ0FBQyxFQUFFO3dCQUNWLE9BQU8sQ0FBQyxJQUFJLENBQUMsbUJBQW1CLENBQUMsQ0FBQztxQkFDbkM7aUJBQ0YsQ0FBQyxDQUFDO2FBQ0o7U0FDRjtRQUVELElBQUksT0FBTyxDQUFDLElBQUksS0FBSyxVQUFVLEVBQUU7O1lBQy9CLElBQU0sV0FBVyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDO1lBRXpDLElBQUksV0FBVyxLQUFLLFFBQVEsRUFBRTtnQkFDNUIsUUFBUSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztnQkFDeEIsT0FBTzthQUNSO1lBRUQsSUFBSSxPQUFPLENBQUMsS0FBSyxFQUFFOztnQkFDakIsSUFBTSxXQUFTLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7d0NBQ25DLENBQUMsRUFBTSxJQUFJOztvQkFDbEIsSUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUMxQixJQUFJLFVBQVUsQ0FBQyxTQUFTLENBQUMsRUFBRTt3QkFDekIsbUJBQUMsZUFBNkIsR0FBRSxHQUFHLENBQUM7NEJBQ2xDLFVBQVUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxRQUFRLENBQUMsY0FBTSxPQUFBLFdBQVMsQ0FBQyxTQUFTLENBQUMsR0FBQSxFQUFFLEtBQUssQ0FBQyxDQUFDO3lCQUNuRSxDQUFDLENBQUM7cUJBQ0o7O2dCQU5ILEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLElBQUksR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLFdBQVMsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRTs0QkFBMUQsQ0FBQyxFQUFNLElBQUk7aUJBT25CO2FBQ0Y7U0FDRjtLQUNGLENBQUMsQ0FBQztDQUNKOzs7OztBQUVELG9CQUFvQixNQUFNO0lBQ3hCLE9BQU8sTUFBTSxJQUFJLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsV0FBVyxFQUFFLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztDQUNuRTs7Ozs7O0FDekdELFNBY3FELFVBQUEsTUFBTSxJQUFJLE9BQUEsTUFBTSxDQUFDLE9BQU8sRUFBRSxHQUFBOztBQUEvRSxJQUFNLGNBQWMsR0FBa0IsRUFBQyxZQUFZLElBQTRCLEVBQUMsQ0FBQzs7Ozs7QUFFakY7Ozs7QUFBQTtJQUdFLGdDQUFnQyxLQUEwQixFQUFVLFNBQWlDO1FBQXJFLFVBQUssR0FBTCxLQUFLLENBQXFCO1FBQVUsY0FBUyxHQUFULFNBQVMsQ0FBd0I7d0JBRmhGLElBQUksR0FBRyxFQUFTO0tBRW9FOzs7Ozs7Ozs7SUFLL0YsMENBQVM7Ozs7O0lBQW5CLFVBQW9CLEVBQU07UUFDeEIsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQztLQUM5Qjs7Ozs7Ozs7O0lBS1MsMENBQVM7Ozs7O0lBQW5CLFVBQW9CLEVBQU07UUFDeEIsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQztLQUM5Qjs7Ozs7Ozs7O0lBS1MsNkNBQVk7Ozs7O0lBQXRCLFVBQXVCLEVBQU07UUFDM0IsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQztLQUNqQzs7Ozs7Ozs7OztJQUtTLDZDQUFZOzs7Ozs7SUFBdEIsVUFBdUIsRUFBTSxFQUFFLE1BQVM7UUFDdEMsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQUUsTUFBTSxDQUFDLENBQUM7S0FDdEM7Ozs7Ozs7O0lBS1MsdUNBQU07Ozs7SUFBaEI7UUFDRSxPQUFPLFdBQVcsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxXQUFXLEVBQUUsQ0FBQyxHQUFHLEdBQUcsV0FBVyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztLQUNqRzs7Ozs7Ozs7O0lBS1MsNENBQVc7Ozs7O0lBQXJCLFVBQXNCLEdBQUk7UUFDeEIsT0FBTyxXQUFXLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQztLQUM1RDs7Ozs7Ozs7Ozs7Ozs7Ozs7O0lBU1MsdUNBQU07Ozs7Ozs7Ozs7SUFBaEIsVUFBaUIsR0FBUyxFQUFFLE9BQTBDO1FBQXRFLGlCQTREQztRQTVEMkIsd0JBQUEsRUFBQSx3QkFBMEM7Ozs7Ozs7UUFPcEUsSUFBSSxTQUFTLENBQUMsR0FBRyxDQUFDLEVBQUU7Ozs7WUFJbEIsSUFBSSxXQUFXLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFFO2dCQUMvQixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxHQUFHLEdBQUcsR0FBRyxDQUFDLE1BQU0sRUFBRSxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUMsRUFBRSxFQUFFOztvQkFDOUMsSUFBTSxRQUFRLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUN4QixJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLEtBQUssS0FBSyxFQUFFO3dCQUN0QyxVQUFVLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxJQUFJLE9BQU8sQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLENBQUM7O3dCQUM3RCxJQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUMsUUFBUSxDQUFDLENBQUM7d0JBQ2hELElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxNQUFNLENBQUMsQ0FBQzt3QkFDcEMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsSUFBSSxPQUFPLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDO3FCQUMxRDtpQkFDRjtnQkFFRCxJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxVQUFDLE1BQU0sRUFBRSxRQUFRO29CQUNyQyxJQUFJLEdBQUcsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUU7d0JBQ2hDLFVBQVUsQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLElBQUksT0FBTyxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQzt3QkFDakUsS0FBSSxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsQ0FBQztxQkFDN0I7aUJBQ0YsQ0FBQyxDQUFDO2FBQ0o7aUJBQU07Ozs7Z0JBSUwsSUFBTSxJQUFJLEdBQUcsV0FBVyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztnQkFDekMsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBRTs7b0JBQy9DLElBQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQzs7b0JBRXpCLElBQUksR0FBRyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxLQUFLLEtBQUssRUFBRTt3QkFDcEUsVUFBVSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsSUFBSSxPQUFPLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxDQUFDOzt3QkFDN0QsSUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFFBQVEsQ0FBQyxDQUFDO3dCQUNoRCxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsTUFBTSxDQUFDLENBQUM7d0JBQ3BDLFVBQVUsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLElBQUksT0FBTyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQztxQkFDMUQ7eUJBQU07d0JBQ0wsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsVUFBQyxNQUFNLEVBQUUsUUFBUTs7NEJBRXJDLElBQUksR0FBRyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxLQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxLQUFLLElBQUksRUFBRTtnQ0FDckUsVUFBVSxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsSUFBSSxPQUFPLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxDQUFDO2dDQUNqRSxLQUFJLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxDQUFDOzZCQUM3Qjt5QkFDRixDQUFDLENBQUM7cUJBQ0o7aUJBQ0Y7YUFDRjtTQUNGO2FBQU07Ozs7WUFJTCxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsT0FBTyxDQUFDLFVBQUEsRUFBRTtnQkFDdEIsSUFBSSxDQUFDLEtBQUksQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDO29CQUFFLEtBQUksQ0FBQyxZQUFZLENBQUMsRUFBRSxFQUFFLEtBQUksQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFBO2FBQzNFLENBQUMsQ0FBQztTQUNKO0tBQ0Y7Ozs7Ozs7O0lBS1MsMENBQVM7Ozs7SUFBbkI7UUFDRSxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLFVBQUEsS0FBSyxJQUFJLE9BQUEsS0FBSyxDQUFDLEdBQUcsR0FBQSxDQUFDLENBQUM7S0FDOUM7Ozs7Ozs7OztJQUtTLHlDQUFROzs7OztJQUFsQixVQUFtQixHQUFVO1FBQzNCLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7S0FDbEI7Ozs7Ozs7Ozs7SUFrQlMsMENBQVM7Ozs7OztJQUFuQixVQUFvQixHQUFRLEVBQUUsRUFBc0I7O1FBQ2xELElBQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUM7UUFFbkMsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBRTs7WUFDL0MsSUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ25CLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUMsRUFBRTtnQkFDdEIsRUFBRSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQzthQUN4QjtTQUNGO0tBQ0Y7aUNBM0tIO0lBNEtDOzs7Ozs7Ozs7QUNsS0Q7OztBQUFBO0lBQTBEQSxzQ0FBaUI7SUFjekUsNEJBQXNCLEtBQW9CLEVBQVUsTUFBK0IsRUFBVSxTQUF1Qjs0Q0FBakM7UUFBbkYsWUFDRSxrQkFBTSxLQUFLLENBQUMsU0FHYjtRQUpxQixXQUFLLEdBQUwsS0FBSyxDQUFlO1FBQVUsWUFBTSxHQUFOLE1BQU0sQ0FBeUI7UUFBVSxlQUFTLEdBQVQsU0FBUyxDQUFjOzs7O3FCQVpyRyxLQUFLO3dCQUVGO1lBQ2hCLElBQUksRUFBRSxFQUFFO1lBQ1IsT0FBTyxFQUFFLElBQUk7WUFDYixNQUFNLEVBQUUsRUFBRTtTQUNYOzs7OzJCQUdvQixLQUFLO1FBS3hCLE1BQU0sQ0FBQyxNQUFNLEdBQUcsU0FBUyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsR0FBRyxNQUFNLENBQUMsTUFBTSxHQUFHLEVBQUUsQ0FBQztRQUM5RCxLQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7O0tBQ2pCO0lBRUQsc0JBQUksdUNBQU87Ozs7UUFBWDtZQUNFLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztTQUNyQzs7O09BQUE7SUFFRCxzQkFBSSx5Q0FBUzs7OztRQUFiO1lBQ0UsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1NBQ3ZDOzs7T0FBQTs7OztJQUVELHFDQUFROzs7SUFBUjtRQUFBLGlCQWlCQztRQWhCQyxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUN0RCxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQzthQUNsRCxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7YUFDaEIsU0FBUyxDQUFDLFVBQUMsRUFBZTtnQkFBZixrQkFBZSxFQUFkLFlBQUksRUFBRSxlQUFPO1lBQ3hCLElBQUksS0FBSSxDQUFDLElBQUksRUFBRTtnQkFDYixLQUFJLENBQUMsSUFBSSxHQUFHLEtBQUssQ0FBQztnQkFDbEIsT0FBTzthQUNSO1lBQ0QsSUFBSSxDQUFDLEtBQUksQ0FBQyxVQUFVLEVBQUU7Z0JBQ3BCLElBQUksS0FBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxLQUFLLEtBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFO29CQUNuRCxLQUFJLENBQUMsT0FBTyxDQUFDLElBQUksR0FBRyxLQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7aUJBQ2hEO2dCQUNELEtBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxZQUFPLEtBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxHQUFFLElBQUksRUFBQyxDQUFDO2dCQUNqRCxLQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7YUFDaEM7U0FDRixDQUFDLENBQUM7S0FDTjs7OztJQUVELGlDQUFJOzs7SUFBSjtRQUNFLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUNoQyx1QkFBUSxjQUFJLEVBQUUsb0JBQU8sRUFBRSxrQkFBTSxDQUFrQjs7WUFDL0MsSUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUM7O1lBQ3ZDLElBQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFFL0MsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEdBQUcsT0FBTyxDQUFDO1lBQzVCLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxHQUFHLFFBQVEsQ0FBQztZQUNoQyxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sYUFBSSxPQUFPLEdBQUssSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUN4RCxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7U0FDZjtLQUNGOzs7O0lBRUQsaUNBQUk7OztJQUFKO1FBQ0UsSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO1lBQ2xDLHVCQUFRLGNBQUksRUFBRSxvQkFBTyxFQUFFLGtCQUFNLENBQWtCOztZQUMvQyxJQUFNLElBQUksR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQzs7WUFDcEMsSUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQy9DLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxZQUFPLElBQUksR0FBRSxPQUFPLEVBQUMsQ0FBQztZQUN2QyxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUM7WUFDNUIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEdBQUcsU0FBUyxDQUFDO1lBQ2hDLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUM7U0FDckI7S0FDRjs7Ozs7SUFFRCx1Q0FBVTs7OztJQUFWLFVBQVcsS0FBYTtRQUN0QixJQUFJLEtBQUssR0FBRyxDQUFDLElBQUksS0FBSyxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU07WUFBRSxPQUFPO1FBRTNELHVCQUFRLGNBQUksRUFBRSxrQkFBTSxDQUFrQjs7Ozs7Ozs7OztRQVV0QyxJQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQzs7UUFDckMsSUFBTSxTQUFTLFlBQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLEVBQUssTUFBTSxFQUFFOztRQUN4RCxJQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDL0IsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEdBQUcsT0FBTyxDQUFDO1FBQzVCLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxHQUFHLFVBQVUsQ0FBQztRQUNsQyxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sR0FBRyxTQUFTLENBQUM7UUFDaEMsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO0tBQ2Y7Ozs7O0lBRUQseUNBQVk7Ozs7SUFBWixVQUFhLEtBQWE7UUFDeEIsSUFBSSxLQUFLLEdBQUcsQ0FBQyxJQUFJLEtBQUssSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxNQUFNO1lBQUUsT0FBTztRQUU3RCx1QkFBUSxjQUFJLEVBQUUsa0JBQU0sQ0FBa0I7O1FBRXRDLElBQU0sT0FBTyxZQUFPLElBQUksRUFBSyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxLQUFLLENBQUMsRUFBRTs7UUFDckQsSUFBTSxVQUFVLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDOztRQUNqQyxJQUFNLFNBQVMsR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQztRQUUxQyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksR0FBRyxPQUFPLENBQUM7UUFDNUIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLEdBQUcsVUFBVSxDQUFDO1FBQ2xDLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxHQUFHLFNBQVMsQ0FBQztRQUNoQyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0tBQ3JCOzs7O0lBRUQsa0NBQUs7OztJQUFMO1FBQ0UsSUFBSSxDQUFDLE9BQU8sR0FBRztZQUNiLElBQUksRUFBRSxFQUFFO1lBQ1IsT0FBTyxFQUFFLElBQUk7WUFDYixNQUFNLEVBQUUsRUFBRTtTQUNYLENBQUM7S0FDSDs7Ozs7SUFFRCxvQ0FBTzs7OztJQUFQLFVBQVEsWUFBb0I7UUFBcEIsNkJBQUEsRUFBQSxvQkFBb0I7UUFDMUIsSUFBSSxZQUFZLEVBQUU7WUFDaEIsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO1NBQ2Q7UUFDRCxJQUFJLENBQUMsWUFBWSxDQUFDLFdBQVcsRUFBRSxDQUFDO0tBQ2pDOzs7O0lBRUQsdUNBQVU7OztJQUFWO1FBQ0UsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7S0FDbEI7Ozs7O0lBRU8sbUNBQU07Ozs7Y0FBQyxNQUFlO1FBQWYsdUJBQUEsRUFBQSxlQUFlO1FBQzVCLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDO1FBQ3ZCLGFBQWEsQ0FBQyxlQUFlLENBQUMsRUFBRSxJQUFJLEVBQUUscUJBQW1CLE1BQVEsRUFBRSxDQUFDLENBQUM7UUFDckUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDdkQsSUFBSSxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUM7OzZCQTlJNUI7RUFVMEQsV0FBVyxFQXNJcEU7Ozs7Ozs7Ozs7QUNySUQ7Ozs7O0FBQUE7SUFBb0hBLDRDQUE0QjtJQUM5SSxrQ0FBc0IsS0FBMEIsRUFBcUIsTUFBcUM7NENBQUE7UUFBMUcsWUFDRSxrQkFBTSxLQUFLLEVBQUUsTUFBTSxDQUFDLFNBQVMsQ0FBQyxTQU0vQjtRQVBxQixXQUFLLEdBQUwsS0FBSyxDQUFxQjtRQUFxQixZQUFNLEdBQU4sTUFBTSxDQUErQjtRQUV4RyxNQUFNLENBQUMsTUFBTSxHQUFHLFNBQVMsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLEdBQUcsTUFBTSxDQUFDLE1BQU0sR0FBRyxFQUFFLENBQUM7UUFDOUQsS0FBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQ2hCLEtBQUksQ0FBQyxTQUFTLEVBQUU7YUFDYixJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQ2IsU0FBUyxDQUFDLFVBQUEsR0FBRyxJQUFJLE9BQUEsS0FBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsR0FBQSxDQUFDLENBQUM7O0tBQ3pDOzs7OztJQUVELHVDQUFJOzs7O0lBQUosVUFBSyxHQUFTO1FBQ1osSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLEVBQUUsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsSUFBSSxFQUFFLEdBQUEsQ0FBQyxDQUFDO0tBQ3BDOzs7OztJQUVELHVDQUFJOzs7O0lBQUosVUFBSyxHQUFTO1FBQ1osSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLEVBQUUsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsSUFBSSxFQUFFLEdBQUEsQ0FBQyxDQUFDO0tBQ3BDOzs7OztJQUVELDBDQUFPOzs7O0lBQVAsVUFBUSxFQUFNO1FBQ1osSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLEVBQUUsQ0FBQyxFQUFFO1lBQ3RCLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUM7U0FDbkM7S0FDRjs7Ozs7SUFFRCw0Q0FBUzs7OztJQUFULFVBQVUsRUFBTTtRQUNkLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUMsRUFBRTtZQUN0QixPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDLENBQUMsU0FBUyxDQUFDO1NBQ3JDO0tBQ0Y7Ozs7OztJQUVELCtDQUFZOzs7OztJQUFaLFVBQWEsR0FBUSxFQUFFLEtBQWE7UUFDbEMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLEVBQUUsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQyxHQUFBLENBQUMsQ0FBQztLQUNqRDs7Ozs7O0lBRUQsNkNBQVU7Ozs7O0lBQVYsVUFBVyxHQUFRLEVBQUUsS0FBYTtRQUNoQyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsRUFBRSxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLEdBQUEsQ0FBQyxDQUFDO0tBQy9DOzs7OztJQUVELHdDQUFLOzs7O0lBQUwsVUFBTSxHQUFTO1FBQ2IsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLEVBQUUsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsS0FBSyxFQUFFLEdBQUEsQ0FBQyxDQUFDO0tBQ3JDOzs7Ozs7SUFFRCwwQ0FBTzs7Ozs7SUFBUCxVQUFRLEdBQVMsRUFBRSxZQUFvQjtRQUFwQiw2QkFBQSxFQUFBLG9CQUFvQjtRQUNyQyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsRUFBRSxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLEdBQUEsQ0FBQyxDQUFDO0tBQ25EOzs7OztJQUVTLG9EQUFpQjs7OztJQUEzQixVQUE0QixFQUFNO1FBQ2hDLHlCQUFPLElBQUksa0JBQWtCLENBQVMsSUFBSSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBTSxFQUFDO0tBQ3pFO21DQTNESDtFQVdvSCxzQkFBc0IsRUFpRHpJOzs7Ozs7O0FDNUNELElBQWEsdUJBQXVCLEdBQUc7SUFDckMsVUFBVSxFQUFFLFVBQUMsSUFBSSxFQUFFLE9BQU8sSUFBSyxPQUFBLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLEtBQUssSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsR0FBQTtDQUNoRixDQUFDOzs7O0FBTUY7OztBQUFBO0lBQXNFQSxvQ0FBK0I7SUFRbkcsMEJBQXNCLEtBQWtDLEVBQVUsTUFBeUIsRUFBVSxTQUF1QjtRQUE1SCxZQUNFLGtCQUFNLEtBQUssQ0FBQyxTQVViO1FBWHFCLFdBQUssR0FBTCxLQUFLLENBQTZCO1FBQVUsWUFBTSxHQUFOLE1BQU0sQ0FBbUI7UUFBVSxlQUFTLEdBQVQsU0FBUyxDQUFjO3NCQU41RyxJQUFJLGVBQWUsQ0FBQyxLQUFLLENBQUM7dUJBRXpCLEtBQUs7eUJBRVUsS0FBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLEVBQUUsQ0FBQyxJQUFJLENBQUMsb0JBQW9CLEVBQUUsQ0FBQztRQUlwRixLQUFJLENBQUMsTUFBTSxnQkFBUSx1QkFBdUIsRUFBSyxNQUFNLENBQUUsQ0FBQztRQUN4RCxJQUFJLEtBQUksQ0FBQyxNQUFNLENBQUMsYUFBYSxFQUFFOztZQUM3QixJQUFJLFNBQVMsR0FBRyxLQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQztZQUMxQyxTQUFTLEdBQUcsV0FBVyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQ25DLElBQUksU0FBUyxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLElBQUksS0FBSyxZQUFZLFdBQVcsRUFBRTtnQkFDaEcsU0FBUyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQzthQUN2QjtZQUNELEtBQUksQ0FBQyxNQUFNLENBQUMsYUFBYSxHQUFHLFNBQVMsQ0FBQztTQUN2Qzs7S0FDRjs7OztJQUVTLGtDQUFPOzs7SUFBakI7UUFDRSxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUM7S0FDbEI7Ozs7SUFFTyxtQ0FBUTs7Ozs7UUFDZCxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQzs7OztRQUU1QixJQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLGFBQWE7Y0FDcEMsbUJBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFxQyxHQUFFLEdBQUcsQ0FBQyxVQUFBLElBQUksSUFBSSxPQUFBLEtBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLFVBQUEsS0FBSyxJQUFJLE9BQUEsS0FBSyxDQUFDLElBQUksQ0FBQyxHQUFBLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFVBQUEsR0FBRyxJQUFJLFFBQUMsRUFBRSxHQUFHLEtBQUEsRUFBRSxVQUFVLEVBQUUsSUFBSSxFQUFFLElBQUMsQ0FBQyxDQUFDLEdBQUEsQ0FBQztjQUN0SixDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUM7UUFDeEMsSUFBSSxDQUFDLFlBQVksR0FBRyxLQUFLLHdCQUFJLE1BQU0sR0FDaEMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQzthQUNiLFNBQVMsQ0FBQyxVQUFDLFlBQWlCO1lBQzNCLElBQUksV0FBVyxDQUFDLEtBQUksQ0FBQyxJQUFJLENBQUM7Z0JBQUUsT0FBTzs7OztZQUVuQyxJQUFNLElBQUksR0FBRyxZQUFZLENBQUMsVUFBVSxHQUFHLEtBQUksQ0FBQyxJQUFJLG1CQUFDLFlBQVksQ0FBQyxVQUFpQixFQUFDLEdBQUcsS0FBSSxDQUFDLElBQUksQ0FBQzs7WUFDN0YsSUFBTSxTQUFTLEdBQUcsWUFBWSxDQUFDLFVBQVUsR0FBRyxZQUFZLENBQUMsR0FBRyxHQUFHLFlBQVksQ0FBQzs7WUFDNUUsSUFBTSxRQUFRLEdBQUcsS0FBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsSUFBSSxFQUFFLFNBQVMsQ0FBQyxDQUFDO1lBRXpELEtBQUksQ0FBQyxlQUFlLENBQUMsUUFBUSxDQUFDLENBQUM7U0FDaEMsQ0FBQyxDQUFDOzs7Ozs7SUFHUCxnQ0FBSzs7OztJQUFMLFVBQU0sTUFBa0M7UUFBbEMsdUJBQUEsRUFBQSxXQUFrQzs7UUFDdEMsSUFBSSxZQUFZLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQztRQUM3QixJQUFJLFVBQVUsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLEVBQUU7WUFDL0IsSUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsRUFBRTtnQkFDdEMsWUFBWSxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxtQkFBQyxJQUFJLENBQUMsUUFBUSxFQUFxQyxHQUFFLFNBQVMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQzthQUMzSDtpQkFBTTtnQkFDTCxZQUFZLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLG1CQUFDLElBQUksQ0FBQyxRQUFRLEVBQXVCLEdBQUUsV0FBVyxFQUFFLENBQUMsQ0FBQzthQUNqRztTQUNGOzs7O1FBRUQsSUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxZQUFZLENBQUMsR0FBRyxJQUFJLENBQUMsUUFBUSxFQUFFLEtBQUssWUFBWSxDQUFDO1FBQzdHLElBQUksTUFBTSxFQUFFO1lBQ1YsYUFBYSxDQUFDLGVBQWUsQ0FBQyxFQUFFLElBQUksRUFBRSxzQkFBc0IsRUFBRSxDQUFDLENBQUM7WUFDaEUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxZQUFZLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1NBQ2hEO0tBQ0Y7Ozs7SUFFRCxrQ0FBTzs7O0lBQVA7UUFDRSxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRTtZQUNoQixJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7WUFDaEIsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUM7U0FDcEI7YUFBTTtZQUNMLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1NBQzdCO1FBQ0QsSUFBSSxDQUFDLGVBQWUsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUM1QixPQUFPLElBQUksQ0FBQztLQUNiOzs7O0lBRUQsa0NBQU87OztJQUFQO1FBQ0UsT0FBTyxTQUFTLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztLQUNwQzs7OztJQUVELGtDQUFPOzs7SUFBUDtRQUNFLE9BQU8sU0FBUyxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO0tBQ2xDOzs7O0lBRUQsa0NBQU87OztJQUFQO1FBQ0UsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDakIsSUFBSSxDQUFDLFlBQVksSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLFdBQVcsRUFBRSxDQUFDO0tBQ3REOzs7OztJQUVPLDBDQUFlOzs7O2NBQUMsT0FBZ0I7UUFDdEMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7Ozs7O0lBR25CLG1DQUFROzs7OztRQUNkLElBQUksSUFBSSxxQkFBcUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFlLEVBQUM7UUFDMUYsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsRUFBRTtZQUM3QixJQUFJLEdBQUcsbUJBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFxQyxHQUFFLE1BQU0sQ0FDL0QsVUFBQyxLQUFLLEVBQUUsSUFBSTtnQkFDVixLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsbUJBQUMsSUFBMkIsR0FBRSxJQUFJLENBQUMsQ0FBQztnQkFDbEQsT0FBTyxLQUFLLENBQUM7YUFDZCxvQkFDRCxFQUF5QixFQUMxQixDQUFDO1NBQ0g7UUFDRCxPQUFPLElBQUksQ0FBQzs7Ozs7O0lBR04sc0NBQVc7Ozs7Y0FBQyxZQUFpQzs7UUFDbkQsSUFBTSxRQUFRLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQzs7UUFDM0MsSUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBRTdCLE9BQU8sUUFBUSxDQUFDLElBQUksQ0FBQyxVQUFBLE9BQU8sSUFBSSxPQUFBLFlBQVksQ0FBQyxPQUFPLENBQUMsS0FBSyxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUEsQ0FBQyxDQUFDOzsyQkFuSTdFO0VBd0JzRSxXQUFXLEVBNkdoRjs7Ozs7Ozs7OztBQ3pIRDs7Ozs7QUFBQTtJQUE4R0EsMENBQTRCO0lBS3hJLGdDQUFzQixLQUEwQixFQUFtQixNQUEwQzs0Q0FBQTtRQUE3RyxZQUNFLGtCQUFNLEtBQUssRUFBRSxNQUFNLENBQUMsU0FBUyxDQUFDLFNBTS9CO1FBUHFCLFdBQUssR0FBTCxLQUFLLENBQXFCO1FBQW1CLFlBQU0sR0FBTixNQUFNLENBQW9DOzZCQUh6RSxLQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxVQUFBLEtBQUssSUFBSSxPQUFBLEtBQUssQ0FBQyxRQUFRLEdBQUEsQ0FBQzthQUMzRSxJQUFJLENBQUMsR0FBRyxDQUFDLFVBQUMsUUFBYSxJQUFLLE9BQUEsS0FBSSxDQUFDLGNBQWMsQ0FBQyxRQUFRLENBQUMsR0FBQSxDQUFDLENBQUM7UUFJNUQsS0FBSSxDQUFDLE1BQU0sZ0JBQU8sdUJBQXVCLEVBQUssTUFBTSxDQUFDLENBQUM7UUFDdEQsS0FBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQ2hCLEtBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLFVBQUEsR0FBRztZQUMxQyxLQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxFQUFDLFFBQVEsRUFBRSxVQUFBLE1BQU0sSUFBSSxPQUFBLE1BQU0sQ0FBQyxPQUFPLEVBQUUsR0FBQSxFQUFDLENBQUMsQ0FBQztTQUMxRCxDQUFDLENBQUM7O0tBQ0o7Ozs7O0lBRUQsd0NBQU87Ozs7SUFBUCxVQUFRLEdBQVM7UUFDZixJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsRUFBRSxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxPQUFPLEVBQUUsR0FBQSxDQUFDLENBQUM7UUFDdEMsT0FBTyxJQUFJLENBQUM7S0FDYjs7Ozs7SUFFRCx3Q0FBTzs7OztJQUFQLFVBQVEsRUFBTTtRQUNaLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUU7O1lBQ3pCLElBQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDbEMsT0FBTyxNQUFNLENBQUMsT0FBTyxFQUFFLENBQUM7U0FDekI7UUFFRCxPQUFPLEtBQUssQ0FBQztLQUNkOzs7Ozs7SUFFRCxzQ0FBSzs7Ozs7SUFBTCxVQUFNLEdBQVMsRUFBRSxNQUFrQztRQUFsQyx1QkFBQSxFQUFBLFdBQWtDO1FBQ2pELElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsR0FBQSxDQUFDLENBQUM7S0FDM0M7Ozs7OztJQUtELHdDQUFPOzs7OztJQUFQLFVBQVEsRUFBTSxFQUFFLFlBQW1CO1FBQW5CLDZCQUFBLEVBQUEsbUJBQW1CO1FBQ2pDLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUU7O1lBQ3pCLElBQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDbEMsT0FBTyxZQUFZLEdBQUcsTUFBTSxDQUFDLFFBQVEsR0FBRyxNQUFNLENBQUMsT0FBTyxFQUFFLENBQUM7U0FDMUQ7UUFFRCxPQUFPLEtBQUssQ0FBQztLQUNkOzs7O0lBRUQsNENBQVc7OztJQUFYOztRQUNFLElBQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEVBQUMsUUFBUSxFQUFFLElBQUksRUFBQyxDQUFDLENBQUM7UUFDckQsT0FBTyxJQUFJLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0tBQ3RDOzs7OztJQUVELHdDQUFPOzs7O0lBQVAsVUFBUSxHQUFTO1FBQ2YsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLEVBQUUsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsT0FBTyxFQUFFLEdBQUEsQ0FBQyxDQUFDO0tBQ3ZDOzs7OztJQUVTLGtEQUFpQjs7OztJQUEzQixVQUE0QixFQUFNO1FBQ2hDLHlCQUFPLElBQUksZ0JBQWdCLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBTSxFQUFDO0tBQy9EOzs7OztJQUVPLCtDQUFjOzs7O2NBQUMsUUFBb0I7OztRQUN6QyxJQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7O1lBQ3ZDLEtBQWlCLElBQUEsZ0JBQUFLLFNBQUEsV0FBVyxDQUFBLHdDQUFBLGlFQUFFO2dCQUF6QixJQUFNLEVBQUUsd0JBQUE7O2dCQUNYLElBQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLG1CQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFRLEdBQUUsT0FBTyxFQUFFLEVBQUUsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7Z0JBQzFGLElBQUksS0FBSyxFQUFFO29CQUNULE9BQU8sSUFBSSxDQUFDO2lCQUNiO2FBQ0Y7Ozs7Ozs7OztRQUNELE9BQU8sS0FBSyxDQUFDOztpQ0E3RWpCO0VBWThHLHNCQUFzQixFQW1Fbkk7Ozs7OztBQy9FRDs7Ozs7Ozs7OztBQVNBLG1CQUEwQixLQUFhLEVBQUUsTUFBa0U7SUFBbEUsdUJBQUEsRUFBQSxXQUE2QyxRQUFRLEVBQUUsU0FBUyxFQUFFO0lBQ3pHLElBQUksUUFBUSxDQUFDLEtBQUssQ0FBQyxLQUFLLEtBQUs7UUFBRSxPQUFPO0lBQ3RDLElBQUksTUFBTSxDQUFDLFFBQVEsSUFBSSxLQUFLLEtBQUssTUFBTSxDQUFDLFFBQVE7UUFBRSxPQUFPLEtBQUssQ0FBQztJQUMvRCxPQUFPLEtBQUssR0FBRyxDQUFDLENBQUM7Q0FDbEI7Ozs7Ozs7Ozs7O0FBU0QsbUJBQTBCLEtBQUssRUFBRSxNQUE2RDtJQUE3RCx1QkFBQSxFQUFBLFdBQXVDLGFBQWEsRUFBRSxLQUFLLEVBQUU7SUFDNUYsSUFBSSxRQUFRLENBQUMsS0FBSyxDQUFDLEtBQUssS0FBSztRQUFFLE9BQU87SUFDdEMsSUFBSSxNQUFNLENBQUMsYUFBYSxLQUFLLEtBQUssSUFBSSxLQUFLLEtBQUssQ0FBQyxFQUFFO1FBQ2pELE9BQU8sS0FBSyxDQUFDO0tBQ2Q7SUFDRCxPQUFPLEtBQUssR0FBRyxDQUFDLENBQUM7Q0FDbEI7Ozs7O0FBS0Q7SUFDRSxPQUFPLFlBQVksQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLFVBQUEsQ0FBQzs7UUFDcEMsSUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsRUFBRSxJQUFJLENBQUMsQ0FDRzs7UUFEckMsSUFDRSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEdBQUcsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsR0FBRyxJQUFJLEdBQUcsQ0FBQztRQUNyQyxPQUFPLENBQUMsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUM7S0FDdkIsQ0FBQyxDQUFDO0NBQ0o7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7In0=