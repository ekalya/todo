/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import * as tslib_1 from "tslib";
import { __stores__, rootDispatcher } from '../api/store';
import { __globalState } from '../internal/global-state';
import { isDefined } from '../internal/utils';
/**
 * @param {?=} ngZoneOrOptions
 * @param {?=} options
 * @return {?}
 */
export function akitaDevtools(ngZoneOrOptions, options) {
    if (options === void 0) { options = {}; }
    if (!(/** @type {?} */ (window)).__REDUX_DEVTOOLS_EXTENSION__) {
        return;
    }
    /** @type {?} */
    var isAngular = ngZoneOrOptions && ngZoneOrOptions['run'];
    if (!isAngular) {
        ngZoneOrOptions = ngZoneOrOptions || {};
        (/** @type {?} */ (ngZoneOrOptions)).run = function (cb) { return cb(); };
        options = /** @type {?} */ (ngZoneOrOptions);
    }
    /** @type {?} */
    var defaultOptions = { name: 'Akita' };
    /** @type {?} */
    var merged = Object.assign({}, defaultOptions, options);
    /** @type {?} */
    var devTools = (/** @type {?} */ (window)).__REDUX_DEVTOOLS_EXTENSION__.connect(merged);
    /** @type {?} */
    var appState = {};
    rootDispatcher.subscribe(function (action) {
        var _a;
        if (action.type === 1 /* NEW_STATE */) {
            if (__globalState.skipAction) {
                __globalState.setSkipAction(false);
                return;
            }
            appState = tslib_1.__assign({}, appState, (_a = {}, _a[action.payload["name"]] = __stores__[action.payload["name"]]._value(), _a));
            var _b = __globalState.currentAction, type = _b.type, entityId = _b.entityId;
            /** @type {?} */
            var storeName = capitalize(action.payload["name"]);
            /** @type {?} */
            var msg = isDefined(entityId) ? "[" + storeName + "] - " + type + " (ids: " + entityId + ")" : "[" + storeName + "] - " + type;
            if (options.logTrace) {
                console.group(msg);
                console.trace();
                console.groupEnd();
            }
            devTools.send({ type: msg, transaction: __globalState.currentT.map(function (t) { return t.type; }) }, appState);
        }
    });
    devTools.subscribe(function (message) {
        if (message.type === 'ACTION') {
            var _a = tslib_1.__read(message.payload.split('.'), 1), storeName_1 = _a[0];
            if (__stores__[storeName_1]) {
                (/** @type {?} */ (ngZoneOrOptions)).run(function () {
                    /** @type {?} */
                    var funcCall = message.payload.replace(storeName_1, "this['" + storeName_1 + "']");
                    try {
                        new Function("" + funcCall).call(__stores__);
                    }
                    catch (e) {
                        console.warn('Unknown Method ☹️');
                    }
                });
            }
        }
        if (message.type === 'DISPATCH') {
            /** @type {?} */
            var payloadType = message.payload.type;
            if (payloadType === 'COMMIT') {
                devTools.init(appState);
                return;
            }
            if (message.state) {
                /** @type {?} */
                var rootState_1 = JSON.parse(message.state);
                var _loop_1 = function (i, keys) {
                    /** @type {?} */
                    var storeName = keys[i];
                    if (__stores__[storeName]) {
                        (/** @type {?} */ (ngZoneOrOptions)).run(function () {
                            __stores__[storeName].setState(function () { return rootState_1[storeName]; }, false);
                        });
                    }
                };
                for (var i = 0, keys = Object.keys(rootState_1); i < keys.length; i++) {
                    _loop_1(i, keys);
                }
            }
        }
    });
}
/**
 * @param {?} string
 * @return {?}
 */
function capitalize(string) {
    return string && string.charAt(0).toUpperCase() + string.slice(1);
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGV2dG9vbHMuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZGF0b3JhbWEvYWtpdGEvIiwic291cmNlcyI6WyJzcmMvZW5oYW5jZXJzL2RldnRvb2xzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBVyxjQUFjLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFDbkUsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ3pELE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQzs7Ozs7O0FBaUI5QyxNQUFNLHdCQUF3QixlQUF1RCxFQUFFLE9BQXNDO0lBQXRDLHdCQUFBLEVBQUEsWUFBc0M7SUFDM0gsSUFBSSxDQUFDLG1CQUFDLE1BQWEsRUFBQyxDQUFDLDRCQUE0QixFQUFFO1FBQ2pELE9BQU87S0FDUjs7SUFFRCxJQUFNLFNBQVMsR0FBRyxlQUFlLElBQUksZUFBZSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBRTVELElBQUksQ0FBQyxTQUFTLEVBQUU7UUFDZCxlQUFlLEdBQUcsZUFBZSxJQUFJLEVBQUUsQ0FBQztRQUN4QyxtQkFBQyxlQUFzQixFQUFDLENBQUMsR0FBRyxHQUFHLFVBQUEsRUFBRSxJQUFJLE9BQUEsRUFBRSxFQUFFLEVBQUosQ0FBSSxDQUFDO1FBQzFDLE9BQU8scUJBQUcsZUFBMkMsQ0FBQSxDQUFDO0tBQ3ZEOztJQUVELElBQU0sY0FBYyxHQUFnRCxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsQ0FBQzs7SUFDdEYsSUFBTSxNQUFNLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsY0FBYyxFQUFFLE9BQU8sQ0FBQyxDQUFDOztJQUUxRCxJQUFNLFFBQVEsR0FBRyxtQkFBQyxNQUFhLEVBQUMsQ0FBQyw0QkFBNEIsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7O0lBQzlFLElBQUksUUFBUSxHQUFHLEVBQUUsQ0FBQztJQUVsQixjQUFjLENBQUMs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O2dCQU5ILEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLElBQUksR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLFdBQVMsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRTs0QkFBMUQsQ0FBQyxFQUFNLElBQUk7aUJBT25CO2FBQ0Y7U0FDRjtLQUNGLENBQUMsQ0FBQztDQUNKOzs7OztBQUVELG9CQUFvQixNQUFNO0lBQ3hCLE9BQU8sTUFBTSxJQUFJLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsV0FBVyxFQUFFLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztDQUNuRSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IF9fc3RvcmVzX18sIEFjdGlvbnMsIHJvb3REaXNwYXRjaGVyIH0gZnJvbSAnLi4vYXBpL3N0b3JlJztcbmltcG9ydCB7IF9fZ2xvYmFsU3RhdGUgfSBmcm9tICcuLi9pbnRlcm5hbC9nbG9iYWwtc3RhdGUnO1xuaW1wb3J0IHsgaXNEZWZpbmVkIH0gZnJvbSAnLi4vaW50ZXJuYWwvdXRpbHMnO1xuXG5leHBvcnQgdHlwZSBEZXZ0b29sc09wdGlvbnMgPSB7XG4gIC8qKiAgbWF4aW11bSBhbGxvd2VkIGFjdGlvbnMgdG8gYmUgc3RvcmVkIGluIHRoZSBoaXN0b3J5IHRyZWUgKi9cbiAgbWF4QWdlOiBudW1iZXI7XG4gIGxhdGVuY3k6IG51bWJlcjtcbiAgYWN0aW9uc0JsYWNrbGlzdDogc3RyaW5nW107XG4gIGFjdGlvbnNXaGl0ZWxpc3Q6IHN0cmluZ1tdO1xuICBzaG91bGRDYXRjaEVycm9yczogYm9vbGVhbjtcbiAgbG9nVHJhY2U6IGJvb2xlYW47XG4gIHByZWRpY2F0ZTogKHN0YXRlOiBhbnksIGFjdGlvbjogYW55KSA9PiBib29sZWFuO1xufTtcblxuZXhwb3J0IHR5cGUgTmdab25lTGlrZSA9IHsgcnVuOiBhbnkgfTtcblxuZXhwb3J0IGZ1bmN0aW9uIGFraXRhRGV2dG9vbHMobmdab25lOiBOZ1pvbmVMaWtlLCBvcHRpb25zPzogUGFydGlhbDxEZXZ0b29sc09wdGlvbnM+KTtcbmV4cG9ydCBmdW5jdGlvbiBha2l0YURldnRvb2xzKG9wdGlvbnM/OiBQYXJ0aWFsPERldnRvb2xzT3B0aW9ucz4pO1xuZXhwb3J0IGZ1bmN0aW9uIGFraXRhRGV2dG9vbHMobmdab25lT3JPcHRpb25zPzogTmdab25lTGlrZSB8IFBhcnRpYWw8RGV2dG9vbHNPcHRpb25zPiwgb3B0aW9uczogUGFydGlhbDxEZXZ0b29sc09wdGlvbnM+ID0ge30pIHtcbiAgaWYgKCEod2luZG93IGFzIGFueSkuX19SRURVWF9ERVZUT09MU19FWFRFTlNJT05fXykge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IGlzQW5ndWxhciA9IG5nWm9uZU9yT3B0aW9ucyAmJiBuZ1pvbmVPck9wdGlvbnNbJ3J1biddO1xuXG4gIGlmICghaXNBbmd1bGFyKSB7XG4gICAgbmdab25lT3JPcHRpb25zID0gbmdab25lT3JPcHRpb25zIHx8IHt9O1xuICAgIChuZ1pvbmVPck9wdGlvbnMgYXMgYW55KS5ydW4gPSBjYiA9PiBjYigpO1xuICAgIG9wdGlvbnMgPSBuZ1pvbmVPck9wdGlvbnMgYXMgUGFydGlhbDxEZXZ0b29sc09wdGlvbnM+O1xuICB9XG5cbiAgY29uc3QgZGVmYXVsdE9wdGlvbnM6IFBhcnRpYWw8RGV2dG9vbHNPcHRpb25zPiAmIHsgbmFtZTogc3RyaW5nIH0gPSB7IG5hbWU6ICdBa2l0YScgfTtcbiAgY29uc3QgbWVyZ2VkID0gT2JqZWN0LmFzc2lnbih7fSwgZGVmYXVsdE9wdGlvbnMsIG9wdGlvbnMpO1xuXG4gIGNvbnN0IGRldlRvb2xzID0gKHdpbmRvdyBhcyBhbnkpLl9fUkVEVVhfREVWVE9PTFNfRVhURU5TSU9OX18uY29ubmVjdChtZXJnZWQpO1xuICBsZXQgYXBwU3RhdGUgPSB7fTtcblxuICByb290RGlzcGF0Y2hlci5zdWJzY3JpYmUoYWN0aW9uID0+IHtcbiAgICBpZiAoYWN0aW9uLnR5cGUgPT09IEFjdGlvbnMuTkVXX1NUQVRFKSB7XG4gICAgICBpZiAoX19nbG9iYWxTdGF0ZS5za2lwQWN0aW9uKSB7XG4gICAgICAgIF9fZ2xvYmFsU3RhdGUuc2V0U2tpcEFjdGlvbihmYWxzZSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgYXBwU3RhdGUgPSB7XG4gICAgICAgIC4uLmFwcFN0YXRlLFxuICAgICAgICBbYWN0aW9uLnBheWxvYWQubmFtZV06IF9fc3RvcmVzX19bYWN0aW9uLnBheWxvYWQubmFtZV0uX3ZhbHVlKClcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHsgdHlwZSwgZW50aXR5SWQgfSA9IF9fZ2xvYmFsU3RhdGUuY3VycmVudEFjdGlvbjtcbiAgICAgIGNvbnN0IHN0b3JlTmFtZSA9IGNhcGl0YWxpemUoYWN0aW9uLnBheWxvYWQubmFtZSk7XG4gICAgICBsZXQgbXNnID0gaXNEZWZpbmVkKGVudGl0eUlkKSA/IGBbJHtzdG9yZU5hbWV9XSAtICR7dHlwZX0gKGlkczogJHtlbnRpdHlJZH0pYCA6IGBbJHtzdG9yZU5hbWV9XSAtICR7dHlwZX1gO1xuXG4gICAgICBpZiAob3B0aW9ucy5sb2dUcmFjZSkge1xuICAgICAgICBjb25zb2xlLmdyb3VwKG1zZyk7XG4gICAgICAgIGNvbnNvbGUudHJhY2UoKTtcbiAgICAgICAgY29uc29sZS5ncm91cEVuZCgpO1xuICAgICAgfVxuXG4gICAgICBkZXZUb29scy5zZW5kKHsgdHlwZTogbXNnLCB0cmFuc2FjdGlvbjogX19nbG9iYWxTdGF0ZS5jdXJyZW50VC5tYXAodCA9PiB0LnR5cGUpIH0sIGFwcFN0YXRlKTtcbiAgICB9XG4gIH0pO1xuXG4gIGRldlRvb2xzLnN1YnNjcmliZShtZXNzYWdlID0+IHtcbiAgICBpZiAobWVzc2FnZS50eXBlID09PSAnQUNUSU9OJykge1xuICAgICAgY29uc3QgW3N0b3JlTmFtZV0gPSBtZXNzYWdlLnBheWxvYWQuc3BsaXQoJy4nKTtcblxuICAgICAgaWYgKF9fc3RvcmVzX19bc3RvcmVOYW1lXSkge1xuICAgICAgICAobmdab25lT3JPcHRpb25zIGFzIE5nWm9uZUxpa2UpLnJ1bigoKSA9PiB7XG4gICAgICAgICAgY29uc3QgZnVuY0NhbGwgPSBtZXNzYWdlLnBheWxvYWQucmVwbGFjZShzdG9yZU5hbWUsIGB0aGlzWycke3N0b3JlTmFtZX0nXWApO1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBuZXcgRnVuY3Rpb24oYCR7ZnVuY0NhbGx9YCkuY2FsbChfX3N0b3Jlc19fKTtcbiAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ1Vua25vd24gTWV0aG9kIOKYue+4jycpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKG1lc3NhZ2UudHlwZSA9PT0gJ0RJU1BBVENIJykge1xuICAgICAgY29uc3QgcGF5bG9hZFR5cGUgPSBtZXNzYWdlLnBheWxvYWQudHlwZTtcblxuICAgICAgaWYgKHBheWxvYWRUeXBlID09PSAnQ09NTUlUJykge1xuICAgICAgICBkZXZUb29scy5pbml0KGFwcFN0YXRlKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAobWVzc2FnZS5zdGF0ZSkge1xuICAgICAgICBjb25zdCByb290U3RhdGUgPSBKU09OLnBhcnNlKG1lc3NhZ2Uuc3RhdGUpO1xuICAgICAgICBmb3IgKGxldCBpID0gMCwga2V5cyA9IE9iamVjdC5rZXlzKHJvb3RTdGF0ZSk7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgY29uc3Qgc3RvcmVOYW1lID0ga2V5c1tpXTtcbiAgICAgICAgICBpZiAoX19zdG9yZXNfX1tzdG9yZU5hbWVdKSB7XG4gICAgICAgICAgICAobmdab25lT3JPcHRpb25zIGFzIE5nWm9uZUxpa2UpLnJ1bigoKSA9PiB7XG4gICAgICAgICAgICAgIF9fc3RvcmVzX19bc3RvcmVOYW1lXS5zZXRTdGF0ZSgoKSA9PiByb290U3RhdGVbc3RvcmVOYW1lXSwgZmFsc2UpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn1cblxuZnVuY3Rpb24gY2FwaXRhbGl6ZShzdHJpbmcpIHtcbiAgcmV0dXJuIHN0cmluZyAmJiBzdHJpbmcuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBzdHJpbmcuc2xpY2UoMSk7XG59XG4iXX0=